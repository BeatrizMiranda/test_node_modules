# Driveway React Library

Component, Hooks, and Utility Library for the larger Driveway frontend
ecosystem.

## Table of Contents

- [Quick Start](#quick-start)
- [Getting Started](#getting-started)
  - [Local Development](#local-development)
  - [Troubleshooting](#troubleshooting)
- [Provided Exports](#provided-exports)
- [Publishing, Versioning, and Branching](#publishing-versioning-and-branching)
- [Contributing](#contributing)
  - [Exports](#exports)
  - [Generics](#generics)
  - [Dependencies](#dependencies)

## Quick Start

1. Clone Project
1. Set up [Azure Personal Access Token (PAT)](https://dev.azure.com/Lithia-Digital/_usersSettings/tokens)
1. Create a `~/.npmrc` file containing access token
1. Add a `.npmrc` file to your project
1. Install package

## Getting Started

This project uses [Azure
Artifacts](https://azure.microsoft.com/en-us/products/devops/artifacts/) to host
`npm` packages and so you must be authenticated in order to install them.

**Note:** This setup is required only the first time for any fresh machine
wanting to install this package.

```bash
# Step 1. Clone Project
# First open a terminal using `bash`, `zsh`, or your shell of choice

git clone git@ssh.dev.azure.com:v3/Lithia-Digital/Roam/Driveway-React-Library
cd Driveway-React-Library

# Step 2. Set up Personal Access Token
# 1. Visit <https://dev.azure.com/Lithia-Digital/_usersSettings/tokens>
# 2. Click `New Token`
# 3. Enter a name (e.g. `@driveway/react`)
# 4. Check `Packaging -> Read & write` box
# 5. Copy the token

# Step 3: Create a `~/.npmrc` file
node tools/generateNpmrc.js

# Paste your personal access token value and press Enter
# Type your email and press Enter

# Step 4. Add a `.npmrc` file to your project
# Only needed if your project doesn't already have `@driveway/react` installed

# <Your Project Directory>/.npmrc:
@driveway:registry=https://pkgs.dev.azure.com/Lithia-Digital/bd299584-94e4-4218-91eb-ecaffa757eb4/_packaging/npm-feed/npm/registry/
always-auth=true

# Step 5. Install package
npm i @driveway/react
```

### Local Development

To contribute by adding/modifying hooks or components locally and test them in a
consuming repo like `Driveway-UI`, use the following steps:

```bash
# Or a directory of your choice
cd ~/
git clone git@ssh.dev.azure.com:v3/Lithia-Digital/Roam/Driveway-React-Library
cd Driveway-React-Library

npm run build:watch

# Assumes Driveway-UI is already checked out in `~`
cd ../Driveway-UI
npm i ../Driveway-React-Library/driveway-react-<package-version>.tgz
```

This setup links the local filesystem to the `@driveway/react` package. You can
then make changes to both packages and test integration prior to committing and
creating a PR.

### Troubleshooting

#### Azure Repos Git Access

If you have trouble calling `git clone` from the command line, you may need to
add a SSH key <https://go.microsoft.com/fwlink/?LinkID=715524> or generate a
temporary password using `https` by clicking the `Generate Git Credentials`
button after clicking `Clone` in
[Driveway-UI](https://dev.azure.com/Lithia-Digital/Roam/_git/Driveway-UI).

## Provided Exports

This package provides the following exports:

- A US `states` array and `State` type union for all US states.
- Several custom `hooks` - a full list with descriptions is available in the
  `hooks/README.md` file.
- Custom `providers` to support statefulness of custom hooks.
- An `AbortError` type for cancellable promises, used by some hooks.
- The Driveway Theme, used with MUI
- Some Driveway Component Library components

## Publishing, Versioning, and Branching

This project uses [GitVersion](https://gitversion.net/docs/) to [handle
automatic semantic
versioning](https://dev.azure.com/Lithia-Digital/Roam/_wiki/wikis/Roam.wiki/1081/Automatic-Semantic-Versioning)
with a [mainline branching
strategy](https://dev.azure.com/Lithia-Digital/Roam/_wiki/wikis/Roam.wiki/1081/Automatic-Semantic-Versioning-Branching-Strategies?anchor=mainline).
This means that every PR is made directly against the `main` branch. When the PR
gets merged, a new version is generated and published.

## Contributing

### Exports

Note that in order to have your code available from this package, you'll need to
export your component / hook / method, etc as a _named export_ from the
`index.ts` file within the containing folder, as well as the root `index.ts`
file.

Example:

```typescript
// /src/comp-lib/index.ts:
export { default as Button } from "./Button";
export { default as Link } from "./Link";
```

```typescript
// /src/index.ts:
export * from ./comp-lib;
```

### Generics

Components, custom hooks, and utilities should attempt to be as generic as
possible and should not rely on concrete implementations or libraries, instead
preferring to allow the consuming repo to pass in such dependencies via
callbacks.

Some examples is features that may rely on page routing implementations. Several
types of consuming repositories may exist with different routing libraries and the
exports from this package should be available to as many consuming repositories
as reasonable.

There are no hard and fast rules, so this is just a guideline. Example
exceptions are the fact that this library does use React 18 and Material UI 5.

### Dependencies

This package has three types of dependencies:

#### `peerDependencies`

A dependency that the consuming repository will definitely contain. For example,
`react`.

#### `devDependencies`

A dependency that is only used in development for this package to build /
compile / publish.

#### `dependencies`

A dependency that is needed for exported items, and won't likely be contained in
the consuming repo. e.g. `cancelable-promise`. These dependencies should be few.
