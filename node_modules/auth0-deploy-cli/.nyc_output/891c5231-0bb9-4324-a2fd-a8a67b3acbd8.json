{"/home/circleci/repo/src/context/index.js":{"path":"/home/circleci/repo/src/context/index.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":0},"end":{"line":82,"column":2}},"2":{"start":{"line":8,"column":17},"end":{"line":8,"column":19}},"3":{"start":{"line":9,"column":2},"end":{"line":9,"column":56}},"4":{"start":{"line":9,"column":28},"end":{"line":9,"column":56}},"5":{"start":{"line":11,"column":2},"end":{"line":14,"column":3}},"6":{"start":{"line":12,"column":4},"end":{"line":12,"column":64}},"7":{"start":{"line":12,"column":33},"end":{"line":12,"column":64}},"8":{"start":{"line":13,"column":4},"end":{"line":13,"column":72}},"9":{"start":{"line":13,"column":37},"end":{"line":13,"column":72}},"10":{"start":{"line":16,"column":2},"end":{"line":18,"column":3}},"11":{"start":{"line":17,"column":4},"end":{"line":17,"column":155}},"12":{"start":{"line":20,"column":20},"end":{"line":20,"column":45}},"13":{"start":{"line":22,"column":2},"end":{"line":32,"column":3}},"14":{"start":{"line":23,"column":23},"end":{"line":27,"column":6}},"15":{"start":{"line":28,"column":30},"end":{"line":30,"column":6}},"16":{"start":{"line":31,"column":4},"end":{"line":31,"column":49}},"17":{"start":{"line":34,"column":21},"end":{"line":44,"column":4}},"18":{"start":{"line":45,"column":20},"end":{"line":45,"column":43}},"19":{"start":{"line":47,"column":23},"end":{"line":59,"column":3}},"20":{"start":{"line":48,"column":4},"end":{"line":56,"column":5}},"21":{"start":{"line":49,"column":6},"end":{"line":55,"column":7}},"22":{"start":{"line":50,"column":8},"end":{"line":50,"column":33}},"23":{"start":{"line":52,"column":8},"end":{"line":52,"column":97}},"24":{"start":{"line":54,"column":8},"end":{"line":54,"column":21}},"25":{"start":{"line":58,"column":4},"end":{"line":58,"column":17}},"26":{"start":{"line":61,"column":2},"end":{"line":65,"column":5}},"27":{"start":{"line":62,"column":4},"end":{"line":64,"column":5}},"28":{"start":{"line":63,"column":6},"end":{"line":63,"column":51}},"29":{"start":{"line":67,"column":2},"end":{"line":69,"column":3}},"30":{"start":{"line":68,"column":4},"end":{"line":68,"column":50}},"31":{"start":{"line":71,"column":2},"end":{"line":73,"column":3}},"32":{"start":{"line":72,"column":4},"end":{"line":72,"column":55}},"33":{"start":{"line":75,"column":14},"end":{"line":75,"column":47}},"34":{"start":{"line":77,"column":2},"end":{"line":79,"column":3}},"35":{"start":{"line":78,"column":4},"end":{"line":78,"column":50}},"36":{"start":{"line":81,"column":2},"end":{"line":81,"column":106}},"37":{"start":{"line":84,"column":12},"end":{"line":84,"column":27}},"38":{"start":{"line":86,"column":13},"end":{"line":86,"column":42}},"39":{"start":{"line":88,"column":12},"end":{"line":88,"column":28}},"40":{"start":{"line":90,"column":12},"end":{"line":90,"column":29}},"41":{"start":{"line":92,"column":13},"end":{"line":92,"column":42}},"42":{"start":{"line":94,"column":17},"end":{"line":94,"column":39}},"43":{"start":{"line":96,"column":18},"end":{"line":96,"column":52}},"44":{"start":{"line":98,"column":13},"end":{"line":98,"column":32}},"45":{"start":{"line":100,"column":15},"end":{"line":100,"column":44}},"46":{"start":{"line":102,"column":14},"end":{"line":102,"column":34}},"47":{"start":{"line":104,"column":15},"end":{"line":104,"column":46}},"48":{"start":{"line":106,"column":39},"end":{"line":106,"column":93}},"49":{"start":{"line":108,"column":26},"end":{"line":108,"column":266}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":18},"end":{"line":7,"column":19}},"loc":{"start":{"line":7,"column":42},"end":{"line":82,"column":1}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":47,"column":23},"end":{"line":47,"column":24}},"loc":{"start":{"line":47,"column":39},"end":{"line":59,"column":3}},"line":47},"2":{"name":"(anonymous_2)","decl":{"start":{"line":61,"column":28},"end":{"line":61,"column":29}},"loc":{"start":{"line":61,"column":35},"end":{"line":65,"column":3}},"line":61},"3":{"name":"_interopRequireDefault","decl":{"start":{"line":106,"column":9},"end":{"line":106,"column":31}},"loc":{"start":{"line":106,"column":37},"end":{"line":106,"column":95}},"line":106}},"branchMap":{"0":{"loc":{"start":{"line":9,"column":2},"end":{"line":9,"column":56}},"type":"if","locations":[{"start":{"line":9,"column":2},"end":{"line":9,"column":56}},{"start":{"line":9,"column":2},"end":{"line":9,"column":56}}],"line":9},"1":{"loc":{"start":{"line":11,"column":2},"end":{"line":14,"column":3}},"type":"if","locations":[{"start":{"line":11,"column":2},"end":{"line":14,"column":3}},{"start":{"line":11,"column":2},"end":{"line":14,"column":3}}],"line":11},"2":{"loc":{"start":{"line":12,"column":4},"end":{"line":12,"column":64}},"type":"if","locations":[{"start":{"line":12,"column":4},"end":{"line":12,"column":64}},{"start":{"line":12,"column":4},"end":{"line":12,"column":64}}],"line":12},"3":{"loc":{"start":{"line":13,"column":4},"end":{"line":13,"column":72}},"type":"if","locations":[{"start":{"line":13,"column":4},"end":{"line":13,"column":72}},{"start":{"line":13,"column":4},"end":{"line":13,"column":72}}],"line":13},"4":{"loc":{"start":{"line":16,"column":2},"end":{"line":18,"column":3}},"type":"if","locations":[{"start":{"line":16,"column":2},"end":{"line":18,"column":3}},{"start":{"line":16,"column":2},"end":{"line":18,"column":3}}],"line":16},"5":{"loc":{"start":{"line":22,"column":2},"end":{"line":32,"column":3}},"type":"if","locations":[{"start":{"line":22,"column":2},"end":{"line":32,"column":3}},{"start":{"line":22,"column":2},"end":{"line":32,"column":3}}],"line":22},"6":{"loc":{"start":{"line":29,"column":16},"end":{"line":29,"column":104}},"type":"cond-expr","locations":[{"start":{"line":29,"column":40},"end":{"line":29,"column":61}},{"start":{"line":29,"column":64},"end":{"line":29,"column":104}}],"line":29},"7":{"loc":{"start":{"line":38,"column":18},"end":{"line":38,"column":52}},"type":"binary-expr","locations":[{"start":{"line":38,"column":18},"end":{"line":38,"column":46}},{"start":{"line":38,"column":50},"end":{"line":38,"column":52}}],"line":38},"8":{"loc":{"start":{"line":48,"column":4},"end":{"line":56,"column":5}},"type":"if","locations":[{"start":{"line":48,"column":4},"end":{"line":56,"column":5}},{"start":{"line":48,"column":4},"end":{"line":56,"column":5}}],"line":48},"9":{"loc":{"start":{"line":62,"column":4},"end":{"line":64,"column":5}},"type":"if","locations":[{"start":{"line":62,"column":4},"end":{"line":64,"column":5}},{"start":{"line":62,"column":4},"end":{"line":64,"column":5}}],"line":62},"10":{"loc":{"start":{"line":67,"column":2},"end":{"line":69,"column":3}},"type":"if","locations":[{"start":{"line":67,"column":2},"end":{"line":69,"column":3}},{"start":{"line":67,"column":2},"end":{"line":69,"column":3}}],"line":67},"11":{"loc":{"start":{"line":71,"column":2},"end":{"line":73,"column":3}},"type":"if","locations":[{"start":{"line":71,"column":2},"end":{"line":73,"column":3}},{"start":{"line":71,"column":2},"end":{"line":73,"column":3}}],"line":71},"12":{"loc":{"start":{"line":77,"column":2},"end":{"line":79,"column":3}},"type":"if","locations":[{"start":{"line":77,"column":2},"end":{"line":79,"column":3}},{"start":{"line":77,"column":2},"end":{"line":79,"column":3}}],"line":77},"13":{"loc":{"start":{"line":77,"column":6},"end":{"line":77,"column":39}},"type":"binary-expr","locations":[{"start":{"line":77,"column":6},"end":{"line":77,"column":21}},{"start":{"line":77,"column":25},"end":{"line":77,"column":39}}],"line":77},"14":{"loc":{"start":{"line":106,"column":46},"end":{"line":106,"column":92}},"type":"cond-expr","locations":[{"start":{"line":106,"column":70},"end":{"line":106,"column":73}},{"start":{"line":106,"column":76},"end":{"line":106,"column":92}}],"line":106},"15":{"loc":{"start":{"line":106,"column":46},"end":{"line":106,"column":67}},"type":"binary-expr","locations":[{"start":{"line":106,"column":46},"end":{"line":106,"column":49}},{"start":{"line":106,"column":53},"end":{"line":106,"column":67}}],"line":106}},"s":{"0":1,"1":1,"2":5,"3":5,"4":0,"5":5,"6":0,"7":0,"8":0,"9":0,"10":5,"11":0,"12":5,"13":5,"14":0,"15":0,"16":0,"17":5,"18":5,"19":5,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":5,"27":45,"28":0,"29":5,"30":0,"31":5,"32":1,"33":4,"34":4,"35":3,"36":1,"37":1,"38":1,"39":1,"40":1,"41":1,"42":1,"43":1,"44":1,"45":1,"46":1,"47":1,"48":4,"49":1},"f":{"0":5,"1":0,"2":45,"3":4},"b":{"0":[0,5],"1":[0,5],"2":[0,0],"3":[0,0],"4":[0,5],"5":[0,5],"6":[0,0],"7":[5,5],"8":[0,0],"9":[0,45],"10":[0,5],"11":[1,4],"12":[3,1],"13":[4,2],"14":[3,1],"15":[4,4]},"inputSourceMap":{"version":3,"sources":["index.js"],"names":["config","errors","AUTH0_DOMAIN","push","AUTH0_ACCESS_TOKEN","AUTH0_CLIENT_ID","AUTH0_CLIENT_SECRET","length","Error","JSON","stringify","accessToken","authClient","AuthenticationClient","domain","clientId","clientSecret","clientCredentials","clientCredentialsGrant","audience","AUTH0_AUDIENCE","access_token","mgmtClient","ManagementClient","token","retry","maxRetries","AUTH0_API_MAX_RETRIES","enabled","headers","packageVersion","process","version","replace","inputFile","AUTH0_INPUT_FILE","ensureObject","key","value","parse","e","log","debug","message","nonPrimitiveProps","forEach","YAMLContext","DirectoryContext","ext","path","extname"],"mappings":"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","sourceRoot":"/home/circleci/repo/src/context/","sourcesContent":["import path from 'path';\nimport { AuthenticationClient, ManagementClient } from 'auth0';\nimport YAMLContext from './yaml';\nimport DirectoryContext from './directory';\n\nimport { isDirectory } from '../utils';\nimport { version as packageVersion } from '../../package.json';\nimport log from '../logger';\n\nconst nonPrimitiveProps = [\n  'AUTH0_KEYWORD_REPLACE_MAPPINGS',\n  'AUTH0_EXCLUDED_RULES',\n  'AUTH0_EXCLUDED_CLIENTS',\n  'AUTH0_EXCLUDED_DATABASES',\n  'AUTH0_EXCLUDED_CONNECTIONS',\n  'AUTH0_EXCLUDED_RESOURCE_SERVERS',\n  'AUTH0_EXCLUDED_DEFAULTS',\n  'EXCLUDED_PROPS',\n  'INCLUDED_PROPS'\n];\n\nexport default async function(config) {\n  // Validate config\n  const errors = [];\n\n  if (!config.AUTH0_DOMAIN) errors.push('AUTH0_DOMAIN');\n  if (!config.AUTH0_ACCESS_TOKEN) {\n    if (!config.AUTH0_CLIENT_ID) errors.push('AUTH0_CLIENT_ID');\n    if (!config.AUTH0_CLIENT_SECRET) errors.push('AUTH0_CLIENT_SECRET');\n  }\n\n  if (errors.length > 0) {\n    throw new Error(`The following parameters were missing. Please add them to your config.json or as an environment variable. ${JSON.stringify(errors)}`);\n  }\n\n  let accessToken = config.AUTH0_ACCESS_TOKEN;\n\n  if (!accessToken) {\n    const authClient = new AuthenticationClient({\n      domain: config.AUTH0_DOMAIN,\n      clientId: config.AUTH0_CLIENT_ID,\n      clientSecret: config.AUTH0_CLIENT_SECRET\n    });\n\n    const clientCredentials = await authClient.clientCredentialsGrant({\n      audience: config.AUTH0_AUDIENCE ? config.AUTH0_AUDIENCE : `https://${config.AUTH0_DOMAIN}/api/v2/`\n    });\n    accessToken = clientCredentials.access_token;\n  }\n\n  const mgmtClient = new ManagementClient({\n    domain: config.AUTH0_DOMAIN,\n    token: accessToken,\n    retry: { maxRetries: config.AUTH0_API_MAX_RETRIES || 10, enabled: true },\n    headers: {\n      'User-agent': `deploy-cli/${packageVersion} (node.js/${process.version.replace('v', '')})`\n    }\n  });\n\n  const inputFile = config.AUTH0_INPUT_FILE;\n\n  const ensureObject = (key, value) => {\n    if (typeof value === 'string') {\n      try {\n        return JSON.parse(value);\n      } catch (e) {\n        log.debug(`Cannot convert config.${key} to an object. Error: ${e.message}`);\n        return value;\n      }\n    }\n\n    return value;\n  };\n\n  nonPrimitiveProps.forEach((key) => {\n    if (config[key]) {\n      config[key] = ensureObject(key, config[key]);\n    }\n  });\n\n  if (typeof inputFile === 'object') {\n    return new YAMLContext(config, mgmtClient);\n  }\n\n  if (isDirectory(inputFile)) {\n    return new DirectoryContext(config, mgmtClient);\n  }\n\n  const ext = path.extname(inputFile);\n  if (ext === '.yaml' || ext === '.yml') {\n    return new YAMLContext(config, mgmtClient);\n  }\n\n  throw new Error(`Unable to determine context processor to load for file ${inputFile}, does it exist? `);\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"c176d1d1c932c1e37b5b29bfd8425020db622871","contentHash":"7ce8dcad2f7faac7e18154ad737e8c87a6fbce7b2a8343c9707b71ae1cbddb54"},"/home/circleci/repo/src/context/yaml/index.js":{"path":"/home/circleci/repo/src/context/yaml/index.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":15},"end":{"line":7,"column":34}},"2":{"start":{"line":9,"column":16},"end":{"line":9,"column":48}},"3":{"start":{"line":11,"column":14},"end":{"line":11,"column":32}},"4":{"start":{"line":13,"column":15},"end":{"line":13,"column":46}},"5":{"start":{"line":15,"column":12},"end":{"line":15,"column":27}},"6":{"start":{"line":17,"column":13},"end":{"line":17,"column":42}},"7":{"start":{"line":19,"column":13},"end":{"line":19,"column":35}},"8":{"start":{"line":21,"column":14},"end":{"line":21,"column":37}},"9":{"start":{"line":23,"column":15},"end":{"line":23,"column":46}},"10":{"start":{"line":25,"column":13},"end":{"line":25,"column":35}},"11":{"start":{"line":27,"column":16},"end":{"line":27,"column":37}},"12":{"start":{"line":29,"column":17},"end":{"line":29,"column":50}},"13":{"start":{"line":31,"column":16},"end":{"line":31,"column":41}},"14":{"start":{"line":33,"column":17},"end":{"line":33,"column":50}},"15":{"start":{"line":35,"column":39},"end":{"line":35,"column":93}},"16":{"start":{"line":37,"column":0},"end":{"line":148,"column":2}},"17":{"start":{"line":39,"column":4},"end":{"line":39,"column":46}},"18":{"start":{"line":40,"column":4},"end":{"line":40,"column":25}},"19":{"start":{"line":41,"column":4},"end":{"line":41,"column":58}},"20":{"start":{"line":42,"column":4},"end":{"line":42,"column":33}},"21":{"start":{"line":43,"column":4},"end":{"line":52,"column":6}},"22":{"start":{"line":53,"column":4},"end":{"line":53,"column":43}},"23":{"start":{"line":55,"column":4},"end":{"line":57,"column":5}},"24":{"start":{"line":56,"column":6},"end":{"line":56,"column":111}},"25":{"start":{"line":61,"column":17},"end":{"line":61,"column":54}},"26":{"start":{"line":63,"column":4},"end":{"line":65,"column":5}},"27":{"start":{"line":64,"column":6},"end":{"line":64,"column":17}},"28":{"start":{"line":67,"column":4},"end":{"line":67,"column":79}},"29":{"start":{"line":71,"column":4},"end":{"line":85,"column":5}},"30":{"start":{"line":72,"column":6},"end":{"line":72,"column":36}},"31":{"start":{"line":74,"column":6},"end":{"line":84,"column":7}},"32":{"start":{"line":75,"column":22},"end":{"line":75,"column":61}},"33":{"start":{"line":77,"column":8},"end":{"line":77,"column":61}},"34":{"start":{"line":79,"column":8},"end":{"line":79,"column":154}},"35":{"start":{"line":81,"column":8},"end":{"line":81,"column":42}},"36":{"start":{"line":83,"column":8},"end":{"line":83,"column":70}},"37":{"start":{"line":87,"column":18},"end":{"line":87,"column":101}},"38":{"start":{"line":88,"column":4},"end":{"line":88,"column":37}},"39":{"start":{"line":89,"column":4},"end":{"line":100,"column":8}},"40":{"start":{"line":90,"column":6},"end":{"line":99,"column":7}},"41":{"start":{"line":91,"column":23},"end":{"line":91,"column":48}},"42":{"start":{"line":92,"column":8},"end":{"line":94,"column":11}},"43":{"start":{"line":93,"column":10},"end":{"line":93,"column":29}},"44":{"start":{"line":96,"column":8},"end":{"line":96,"column":42}},"45":{"start":{"line":98,"column":8},"end":{"line":98,"column":53}},"46":{"start":{"line":104,"column":18},"end":{"line":104,"column":101}},"47":{"start":{"line":106,"column":4},"end":{"line":106,"column":55}},"48":{"start":{"line":108,"column":4},"end":{"line":115,"column":5}},"49":{"start":{"line":109,"column":6},"end":{"line":109,"column":28}},"50":{"start":{"line":110,"column":6},"end":{"line":110,"column":33}},"51":{"start":{"line":112,"column":21},"end":{"line":112,"column":153}},"52":{"start":{"line":113,"column":27},"end":{"line":113,"column":117}},"53":{"start":{"line":114,"column":6},"end":{"line":114,"column":86}},"54":{"start":{"line":117,"column":4},"end":{"line":133,"column":8}},"55":{"start":{"line":118,"column":6},"end":{"line":132,"column":7}},"56":{"start":{"line":119,"column":21},"end":{"line":119,"column":45}},"57":{"start":{"line":121,"column":8},"end":{"line":127,"column":9}},"58":{"start":{"line":122,"column":10},"end":{"line":122,"column":53}},"59":{"start":{"line":124,"column":10},"end":{"line":126,"column":13}},"60":{"start":{"line":125,"column":12},"end":{"line":125,"column":134}},"61":{"start":{"line":129,"column":8},"end":{"line":129,"column":42}},"62":{"start":{"line":131,"column":8},"end":{"line":131,"column":53}},"63":{"start":{"line":134,"column":18},"end":{"line":134,"column":67}},"64":{"start":{"line":135,"column":4},"end":{"line":135,"column":27}},"65":{"start":{"line":137,"column":4},"end":{"line":139,"column":5}},"66":{"start":{"line":138,"column":6},"end":{"line":138,"column":61}},"67":{"start":{"line":141,"column":16},"end":{"line":141,"column":46}},"68":{"start":{"line":143,"column":4},"end":{"line":143,"column":56}},"69":{"start":{"line":145,"column":4},"end":{"line":145,"column":58}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":35,"column":9},"end":{"line":35,"column":31}},"loc":{"start":{"line":35,"column":37},"end":{"line":35,"column":95}},"line":35},"1":{"name":"(anonymous_1)","decl":{"start":{"line":38,"column":2},"end":{"line":38,"column":3}},"loc":{"start":{"line":38,"column":34},"end":{"line":58,"column":3}},"line":38},"2":{"name":"(anonymous_2)","decl":{"start":{"line":60,"column":2},"end":{"line":60,"column":3}},"loc":{"start":{"line":60,"column":14},"end":{"line":68,"column":3}},"line":60},"3":{"name":"(anonymous_3)","decl":{"start":{"line":70,"column":2},"end":{"line":70,"column":3}},"loc":{"start":{"line":70,"column":15},"end":{"line":101,"column":3}},"line":70},"4":{"name":"(anonymous_4)","decl":{"start":{"line":89,"column":61},"end":{"line":89,"column":62}},"loc":{"start":{"line":89,"column":88},"end":{"line":100,"column":5}},"line":89},"5":{"name":"(anonymous_5)","decl":{"start":{"line":92,"column":39},"end":{"line":92,"column":40}},"loc":{"start":{"line":92,"column":51},"end":{"line":94,"column":9}},"line":92},"6":{"name":"(anonymous_6)","decl":{"start":{"line":103,"column":2},"end":{"line":103,"column":3}},"loc":{"start":{"line":103,"column":15},"end":{"line":146,"column":3}},"line":103},"7":{"name":"(anonymous_7)","decl":{"start":{"line":117,"column":61},"end":{"line":117,"column":62}},"loc":{"start":{"line":117,"column":88},"end":{"line":133,"column":5}},"line":117},"8":{"name":"(anonymous_8)","decl":{"start":{"line":124,"column":39},"end":{"line":124,"column":40}},"loc":{"start":{"line":124,"column":51},"end":{"line":126,"column":11}},"line":124}},"branchMap":{"0":{"loc":{"start":{"line":35,"column":46},"end":{"line":35,"column":92}},"type":"cond-expr","locations":[{"start":{"line":35,"column":70},"end":{"line":35,"column":73}},{"start":{"line":35,"column":76},"end":{"line":35,"column":92}}],"line":35},"1":{"loc":{"start":{"line":35,"column":46},"end":{"line":35,"column":67}},"type":"binary-expr","locations":[{"start":{"line":35,"column":46},"end":{"line":35,"column":49}},{"start":{"line":35,"column":53},"end":{"line":35,"column":67}}],"line":35},"2":{"loc":{"start":{"line":45,"column":15},"end":{"line":45,"column":48}},"type":"binary-expr","locations":[{"start":{"line":45,"column":15},"end":{"line":45,"column":42}},{"start":{"line":45,"column":46},"end":{"line":45,"column":48}}],"line":45},"3":{"loc":{"start":{"line":46,"column":17},"end":{"line":46,"column":52}},"type":"binary-expr","locations":[{"start":{"line":46,"column":17},"end":{"line":46,"column":46}},{"start":{"line":46,"column":50},"end":{"line":46,"column":52}}],"line":46},"4":{"loc":{"start":{"line":47,"column":19},"end":{"line":47,"column":56}},"type":"binary-expr","locations":[{"start":{"line":47,"column":19},"end":{"line":47,"column":50}},{"start":{"line":47,"column":54},"end":{"line":47,"column":56}}],"line":47},"5":{"loc":{"start":{"line":48,"column":21},"end":{"line":48,"column":60}},"type":"binary-expr","locations":[{"start":{"line":48,"column":21},"end":{"line":48,"column":54}},{"start":{"line":48,"column":58},"end":{"line":48,"column":60}}],"line":48},"6":{"loc":{"start":{"line":49,"column":25},"end":{"line":49,"column":69}},"type":"binary-expr","locations":[{"start":{"line":49,"column":25},"end":{"line":49,"column":63}},{"start":{"line":49,"column":67},"end":{"line":49,"column":69}}],"line":49},"7":{"loc":{"start":{"line":50,"column":18},"end":{"line":50,"column":54}},"type":"binary-expr","locations":[{"start":{"line":50,"column":18},"end":{"line":50,"column":48}},{"start":{"line":50,"column":52},"end":{"line":50,"column":54}}],"line":50},"8":{"loc":{"start":{"line":55,"column":4},"end":{"line":57,"column":5}},"type":"if","locations":[{"start":{"line":55,"column":4},"end":{"line":57,"column":5}},{"start":{"line":55,"column":4},"end":{"line":57,"column":5}}],"line":55},"9":{"loc":{"start":{"line":56,"column":22},"end":{"line":56,"column":110}},"type":"cond-expr","locations":[{"start":{"line":56,"column":55},"end":{"line":56,"column":68}},{"start":{"line":56,"column":71},"end":{"line":56,"column":110}}],"line":56},"10":{"loc":{"start":{"line":63,"column":4},"end":{"line":65,"column":5}},"type":"if","locations":[{"start":{"line":63,"column":4},"end":{"line":65,"column":5}},{"start":{"line":63,"column":4},"end":{"line":65,"column":5}}],"line":63},"11":{"loc":{"start":{"line":71,"column":4},"end":{"line":85,"column":5}},"type":"if","locations":[{"start":{"line":71,"column":4},"end":{"line":85,"column":5}},{"start":{"line":71,"column":4},"end":{"line":85,"column":5}}],"line":71},"12":{"loc":{"start":{"line":79,"column":35},"end":{"line":79,"column":152}},"type":"binary-expr","locations":[{"start":{"line":79,"column":35},"end":{"line":79,"column":146}},{"start":{"line":79,"column":150},"end":{"line":79,"column":152}}],"line":79},"13":{"loc":{"start":{"line":113,"column":27},"end":{"line":113,"column":117}},"type":"cond-expr","locations":[{"start":{"line":113,"column":74},"end":{"line":113,"column":112}},{"start":{"line":113,"column":115},"end":{"line":113,"column":117}}],"line":113},"14":{"loc":{"start":{"line":121,"column":8},"end":{"line":127,"column":9}},"type":"if","locations":[{"start":{"line":121,"column":8},"end":{"line":127,"column":9}},{"start":{"line":121,"column":8},"end":{"line":127,"column":9}}],"line":121},"15":{"loc":{"start":{"line":125,"column":29},"end":{"line":125,"column":133}},"type":"cond-expr","locations":[{"start":{"line":125,"column":48},"end":{"line":125,"column":102}},{"start":{"line":125,"column":105},"end":{"line":125,"column":133}}],"line":125},"16":{"loc":{"start":{"line":137,"column":4},"end":{"line":139,"column":5}},"type":"if","locations":[{"start":{"line":137,"column":4},"end":{"line":139,"column":5}},{"start":{"line":137,"column":4},"end":{"line":139,"column":5}}],"line":137}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":6,"16":1,"17":71,"18":71,"19":71,"20":71,"21":71,"22":71,"23":71,"24":71,"25":20,"26":20,"27":20,"28":20,"29":30,"30":0,"31":30,"32":30,"33":30,"34":30,"35":1,"36":1,"37":29,"38":29,"39":28,"40":644,"41":644,"42":644,"43":457,"44":0,"45":0,"46":4,"47":4,"48":4,"49":4,"50":4,"51":0,"52":0,"53":0,"54":4,"55":92,"56":92,"57":92,"58":92,"59":92,"60":92,"61":0,"62":0,"63":4,"64":3,"65":3,"66":3,"67":3,"68":3,"69":3},"f":{"0":6,"1":71,"2":20,"3":30,"4":644,"5":457,"6":4,"7":92,"8":92},"b":{"0":[3,3],"1":[6,6],"2":[71,70],"3":[71,70],"4":[71,70],"5":[71,70],"6":[71,70],"7":[71,69],"8":[71,0],"9":[0,71],"10":[20,0],"11":[0,30],"12":[30,2],"13":[0,0],"14":[92,0],"15":[68,24],"16":[3,0]},"inputSourceMap":{"version":3,"sources":["index.js"],"names":["constructor","config","mgmtClient","configFile","AUTH0_INPUT_FILE","mappings","AUTH0_KEYWORD_REPLACE_MAPPINGS","assets","exclude","rules","AUTH0_EXCLUDED_RULES","clients","AUTH0_EXCLUDED_CLIENTS","databases","AUTH0_EXCLUDED_DATABASES","connections","AUTH0_EXCLUDED_CONNECTIONS","resourceServers","AUTH0_EXCLUDED_RESOURCE_SERVERS","defaults","AUTH0_EXCLUDED_DEFAULTS","basePath","AUTH0_BASE_PATH","process","cwd","path","dirname","loadFile","f","toLoad","join","resolve","load","fPath","log","debug","Object","assign","yaml","fs","readFileSync","err","stack","Error","auth0","Auth0","validate","Promise","all","entries","handlers","map","name","handler","parsed","parse","forEach","k","v","dump","info","loadAll","docUrl","extraMessage","message","startsWith","data","Array","isArray","formatResults","sort","recordsSorter","cleaned","AUTH0_EXPORT_IDENTIFIERS","raw","writeFileSync"],"mappings":"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","sourceRoot":"/home/circleci/repo/src/context/yaml/","sourcesContent":["import fs from 'fs-extra';\nimport yaml from 'js-yaml';\nimport path from 'path';\nimport { loadFile, keywordReplace, Auth0 } from '../../tools';\n\nimport log from '../../logger';\nimport {\n  isFile, toConfigFn, stripIdentifiers, formatResults, recordsSorter\n} from '../../utils';\nimport handlers from './handlers';\nimport cleanAssets from '../../readonly';\n\nexport default class {\n  constructor(config, mgmtClient) {\n    this.configFile = config.AUTH0_INPUT_FILE;\n    this.config = config;\n    this.mappings = config.AUTH0_KEYWORD_REPLACE_MAPPINGS;\n    this.mgmtClient = mgmtClient;\n\n    // Get excluded rules\n    this.assets = {\n      exclude: {\n        rules: config.AUTH0_EXCLUDED_RULES || [],\n        clients: config.AUTH0_EXCLUDED_CLIENTS || [],\n        databases: config.AUTH0_EXCLUDED_DATABASES || [],\n        connections: config.AUTH0_EXCLUDED_CONNECTIONS || [],\n        resourceServers: config.AUTH0_EXCLUDED_RESOURCE_SERVERS || [],\n        defaults: config.AUTH0_EXCLUDED_DEFAULTS || []\n      }\n    };\n\n    this.basePath = config.AUTH0_BASE_PATH;\n    if (!this.basePath) {\n      this.basePath = (typeof configFile === 'object') ? process.cwd() : path.dirname(this.configFile);\n    }\n  }\n\n  loadFile(f) {\n    let toLoad = path.join(this.basePath, f);\n    if (!isFile(toLoad)) {\n      // try load not relative to yaml file\n      toLoad = f;\n    }\n    return loadFile(path.resolve(toLoad), this.mappings);\n  }\n\n  async load() {\n    // Allow to send object/json directly\n    if (typeof this.configFile === 'object') {\n      this.assets = this.configFile;\n    } else {\n      try {\n        const fPath = path.resolve(this.configFile);\n        log.debug(`Loading YAML from ${fPath}`);\n        Object.assign(this.assets, yaml.load(keywordReplace(fs.readFileSync(fPath, 'utf8'), this.mappings)) || {});\n      } catch (err) {\n        log.debug(err.stack);\n        throw new Error(`Problem loading ${this.configFile}\\n${err}`);\n      }\n    }\n\n    // Run initial schema check to ensure valid YAML\n    const auth0 = new Auth0(this.mgmtClient, this.assets, toConfigFn(this.config));\n    await auth0.validate('validate');\n\n    // Allow handlers to process the assets such as loading files etc\n    await Promise.all(Object.entries(handlers).map(async ([ name, handler ]) => {\n      try {\n        const parsed = await handler.parse(this);\n        Object.entries(parsed)\n          .forEach(([ k, v ]) => {\n            this.assets[k] = v;\n          });\n      } catch (err) {\n        log.debug(err.stack);\n        throw new Error(`Problem deploying ${name}`);\n      }\n    }));\n  }\n\n  async dump() {\n    const auth0 = new Auth0(this.mgmtClient, this.assets, toConfigFn(this.config));\n    log.info('Loading Auth0 Tenant Data');\n    try {\n      await auth0.loadAll();\n      this.assets = auth0.assets;\n    } catch (err) {\n      const docUrl = 'https://auth0.com/docs/deploy/deploy-cli-tool/create-and-configure-the-deploy-cli-application#modify-deploy-cli-application-scopes';\n      const extraMessage = err.message.startsWith('Insufficient scope') ? `\\nSee ${docUrl} for more information` : '';\n      throw new Error(`Problem loading tenant data from Auth0 ${err}${extraMessage}`);\n    }\n\n    await Promise.all(Object.entries(handlers).map(async ([ name, handler ]) => {\n      try {\n        const data = await handler.dump(this);\n        if (data) {\n          log.info(`Exporting ${name}`);\n          Object.entries(data)\n            .forEach(([ k, v ]) => {\n              this.assets[k] = Array.isArray(v) ? v.map(formatResults).sort(recordsSorter) : formatResults(v);\n            });\n        }\n      } catch (err) {\n        log.debug(err.stack);\n        throw new Error(`Problem exporting ${name}`);\n      }\n    }));\n\n    // Clean known read only fields\n    let cleaned = cleanAssets(this.assets, this.config);\n\n    // Delete exclude as it's not part of the auth0 tenant config\n    delete cleaned.exclude;\n\n    // Optionally Strip identifiers\n    if (!this.config.AUTH0_EXPORT_IDENTIFIERS) {\n      cleaned = stripIdentifiers(auth0, cleaned);\n    }\n\n    // Write YAML File\n    const raw = yaml.dump(cleaned);\n    log.info(`Writing ${this.configFile}`);\n    fs.writeFileSync(this.configFile, raw);\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"be7dd75d7f30f58b70f01337f2bf228844c8c9ae","contentHash":"2bcb842c7536f51a1fdde85d1a959b729795082dae5065c0cbea7d6a96e48868"},"/home/circleci/repo/src/tools/index.js":{"path":"/home/circleci/repo/src/tools/index.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":107}},"2":{"start":{"line":8,"column":17},"end":{"line":8,"column":39}},"3":{"start":{"line":10,"column":18},"end":{"line":10,"column":52}},"4":{"start":{"line":12,"column":14},"end":{"line":12,"column":33}},"5":{"start":{"line":14,"column":15},"end":{"line":14,"column":46}},"6":{"start":{"line":16,"column":12},"end":{"line":16,"column":30}},"7":{"start":{"line":18,"column":13},"end":{"line":18,"column":42}},"8":{"start":{"line":20,"column":13},"end":{"line":20,"column":31}},"9":{"start":{"line":22,"column":39},"end":{"line":22,"column":93}},"10":{"start":{"line":24,"column":0},"end":{"line":30,"column":2}},"11":{"start":{"line":31,"column":0},"end":{"line":31,"column":40}},"12":{"start":{"line":32,"column":0},"end":{"line":32,"column":34}},"13":{"start":{"line":33,"column":0},"end":{"line":33,"column":47}},"14":{"start":{"line":34,"column":0},"end":{"line":34,"column":35}},"15":{"start":{"line":35,"column":0},"end":{"line":35,"column":31}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":22,"column":9},"end":{"line":22,"column":31}},"loc":{"start":{"line":22,"column":37},"end":{"line":22,"column":95}},"line":22}},"branchMap":{"0":{"loc":{"start":{"line":22,"column":46},"end":{"line":22,"column":92}},"type":"cond-expr","locations":[{"start":{"line":22,"column":70},"end":{"line":22,"column":73}},{"start":{"line":22,"column":76},"end":{"line":22,"column":92}}],"line":22},"1":{"loc":{"start":{"line":22,"column":46},"end":{"line":22,"column":67}},"type":"binary-expr","locations":[{"start":{"line":22,"column":46},"end":{"line":22,"column":49}},{"start":{"line":22,"column":53},"end":{"line":22,"column":67}}],"line":22}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":3,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1},"f":{"0":3},"b":{"0":[3,0],"1":[3,3]},"inputSourceMap":{"version":3,"sources":["index.js"],"names":["constants","deploy","keywordReplace","loadFile","Auth0"],"mappings":";;;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;kBAEe;AACbA,EAAAA,SAAS,EAATA,mBADa;AAEbC,EAAAA,MAAM,EAANA,gBAFa;AAGbC,EAAAA,cAAc,EAAdA,qBAHa;AAIbC,EAAAA,QAAQ,EAARA,eAJa;AAKbC,EAAAA,KAAK,EAALA;AALa,C;QASbJ,S,GAAAA,mB;QACAC,M,GAAAA,gB;QACAC,c,GAAAA,qB;QACAC,Q,GAAAA,e;QACAC,K,GAAAA,c","sourceRoot":"/home/circleci/repo/src/tools/","sourcesContent":["import constants from './constants';\nimport deploy from './deploy';\nimport Auth0 from './auth0';\nimport { keywordReplace, loadFile } from './utils';\n\nexport default {\n  constants,\n  deploy,\n  keywordReplace,\n  loadFile,\n  Auth0\n};\n\nexport {\n  constants,\n  deploy,\n  keywordReplace,\n  loadFile,\n  Auth0\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"ebb2a82f3a056ebbcc2764ff8254b115e67c8475","contentHash":"181dd6f348ecc782578f1db5ba30078a2568d5cd4cf21e38d1f5a285ac8b5888"},"/home/circleci/repo/src/tools/constants.js":{"path":"/home/circleci/repo/src/tools/constants.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":18},"end":{"line":6,"column":20}},"2":{"start":{"line":7,"column":0},"end":{"line":7,"column":36}},"3":{"start":{"line":8,"column":0},"end":{"line":8,"column":43}},"4":{"start":{"line":9,"column":0},"end":{"line":9,"column":57}},"5":{"start":{"line":10,"column":0},"end":{"line":10,"column":58}},"6":{"start":{"line":11,"column":0},"end":{"line":11,"column":36}},"7":{"start":{"line":12,"column":0},"end":{"line":12,"column":40}},"8":{"start":{"line":13,"column":0},"end":{"line":13,"column":42}},"9":{"start":{"line":14,"column":0},"end":{"line":14,"column":52}},"10":{"start":{"line":15,"column":0},"end":{"line":15,"column":36}},"11":{"start":{"line":16,"column":0},"end":{"line":16,"column":31}},"12":{"start":{"line":17,"column":0},"end":{"line":17,"column":49}},"13":{"start":{"line":18,"column":0},"end":{"line":18,"column":61}},"14":{"start":{"line":19,"column":0},"end":{"line":19,"column":36}},"15":{"start":{"line":20,"column":0},"end":{"line":20,"column":328}},"16":{"start":{"line":21,"column":0},"end":{"line":21,"column":66}},"17":{"start":{"line":22,"column":0},"end":{"line":22,"column":57}},"18":{"start":{"line":23,"column":0},"end":{"line":23,"column":49}},"19":{"start":{"line":24,"column":0},"end":{"line":24,"column":166}},"20":{"start":{"line":25,"column":0},"end":{"line":25,"column":135}},"21":{"start":{"line":26,"column":0},"end":{"line":26,"column":83}},"22":{"start":{"line":27,"column":0},"end":{"line":27,"column":47}},"23":{"start":{"line":28,"column":0},"end":{"line":28,"column":40}},"24":{"start":{"line":29,"column":0},"end":{"line":29,"column":56}},"25":{"start":{"line":30,"column":0},"end":{"line":30,"column":38}},"26":{"start":{"line":31,"column":0},"end":{"line":31,"column":42}},"27":{"start":{"line":32,"column":0},"end":{"line":32,"column":44}},"28":{"start":{"line":33,"column":0},"end":{"line":33,"column":58}},"29":{"start":{"line":34,"column":0},"end":{"line":34,"column":48}},"30":{"start":{"line":35,"column":0},"end":{"line":35,"column":52}},"31":{"start":{"line":36,"column":0},"end":{"line":36,"column":50}},"32":{"start":{"line":37,"column":0},"end":{"line":37,"column":46}},"33":{"start":{"line":38,"column":0},"end":{"line":38,"column":52}},"34":{"start":{"line":39,"column":0},"end":{"line":39,"column":897}},"35":{"start":{"line":40,"column":0},"end":{"line":40,"column":240}},"36":{"start":{"line":41,"column":0},"end":{"line":41,"column":165}},"37":{"start":{"line":42,"column":0},"end":{"line":42,"column":42}},"38":{"start":{"line":43,"column":0},"end":{"line":43,"column":49}},"39":{"start":{"line":44,"column":0},"end":{"line":44,"column":53}},"40":{"start":{"line":45,"column":0},"end":{"line":45,"column":53}},"41":{"start":{"line":46,"column":0},"end":{"line":46,"column":139}},"42":{"start":{"line":47,"column":0},"end":{"line":47,"column":71}},"43":{"start":{"line":48,"column":0},"end":{"line":48,"column":79}},"44":{"start":{"line":49,"column":0},"end":{"line":49,"column":58}},"45":{"start":{"line":50,"column":0},"end":{"line":50,"column":46}},"46":{"start":{"line":51,"column":0},"end":{"line":54,"column":2}},"47":{"start":{"line":55,"column":0},"end":{"line":55,"column":58}},"48":{"start":{"line":56,"column":0},"end":{"line":56,"column":59}},"49":{"start":{"line":57,"column":0},"end":{"line":57,"column":72}},"50":{"start":{"line":58,"column":0},"end":{"line":58,"column":42}},"51":{"start":{"line":59,"column":0},"end":{"line":59,"column":40}},"52":{"start":{"line":60,"column":0},"end":{"line":60,"column":46}},"53":{"start":{"line":61,"column":0},"end":{"line":61,"column":42}},"54":{"start":{"line":62,"column":0},"end":{"line":62,"column":47}},"55":{"start":{"line":63,"column":0},"end":{"line":63,"column":48}},"56":{"start":{"line":64,"column":0},"end":{"line":64,"column":50}},"57":{"start":{"line":65,"column":0},"end":{"line":65,"column":37}},"58":{"start":{"line":66,"column":0},"end":{"line":66,"column":31}},"59":{"start":{"line":67,"column":0},"end":{"line":67,"column":36}},"60":{"start":{"line":68,"column":0},"end":{"line":68,"column":28}}},"fnMap":{},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1,"24":1,"25":1,"26":1,"27":1,"28":1,"29":1,"30":1,"31":1,"32":1,"33":1,"34":1,"35":1,"36":1,"37":1,"38":1,"39":1,"40":1,"41":1,"42":1,"43":1,"44":1,"45":1,"46":1,"47":1,"48":1,"49":1,"50":1,"51":1,"52":1,"53":1,"54":1,"55":1,"56":1,"57":1,"58":1,"59":1,"60":1},"f":{},"b":{},"inputSourceMap":{"version":3,"sources":["constants.js"],"names":["constants","RULES_DIRECTORY","RULES_STAGES","DEFAULT_RULE_STAGE","HOOKS_HIDDEN_SECRET_VALUE","HOOKS_DIRECTORY","ACTIONS_DIRECTORY","TRIGGERS_DIRECTORY","RULES_CONFIGS_DIRECTORY","PAGES_DIRECTORY","PAGE_LOGIN","PAGE_PASSWORD_RESET","PAGE_GUARDIAN_MULTIFACTOR","PAGE_ERROR","PAGE_NAMES","DATABASE_CONNECTIONS_DIRECTORY","DATABASE_SCRIPTS_CHANGE_EMAIL","DATABASE_SCRIPTS_GET_USER","DATABASE_SCRIPTS","DATABASE_SCRIPTS_NO_IMPORT","DATABASE_SCRIPTS_IMPORT","EMAIL_TEMPLATES_DIRECTORY","EMAIL_VERIFY","EMAIL_VERIFY_BY_CODE","EMAIL_RESET","EMAIL_WELCOME","EMAIL_BLOCKED","EMAIL_STOLEN_CREDENTIALS","EMAIL_ENROLLMENT","EMAIL_CHANGE_PASSWORD","EMAIL_PASSWORD_RESET","EMAIL_MFA_OOB_CODE","EMAIL_USER_INVITATION","EMAIL_TEMPLATES_NAMES","EMAIL_TEMPLATES_TYPES","ACTIONS_TRIGGERS","GUARDIAN_DIRECTORY","GUARDIAN_FACTORS_DIRECTORY","GUARDIAN_PROVIDERS_DIRECTORY","GUARDIAN_TEMPLATES_DIRECTORY","GUARDIAN_FACTORS","GUARDIAN_POLICIES","GUARDIAN_PHONE_PROVIDERS","GUARDIAN_PHONE_MESSAGE_TYPES","GUARDIAN_FACTOR_TEMPLATES","GUARDIAN_FACTOR_PROVIDERS","sms","RESOURCE_SERVERS_DIRECTORY","RESOURCE_SERVERS_CLIENT_NAME","RESOURCE_SERVERS_MANAGEMENT_API_NAME","RESOURCE_SERVERS_ID_NAME","CLIENTS_DIRECTORY","CLIENTS_GRANTS_DIRECTORY","CLIENTS_CLIENT_NAME","CLIENTS_CLIENT_ID_NAME","CONNECTIONS_DIRECTORY","CONNECTIONS_CLIENT_NAME","CONNECTIONS_ID_NAME","CONCURRENT_CALLS","ROLES_DIRECTORY"],"mappings":"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","sourceRoot":"/home/circleci/repo/src/tools/","sourcesContent":["const constants = {};\n\nconstants.RULES_DIRECTORY = 'rules';\nconstants.RULES_STAGES = [\n  'login_success'\n];\n\nconstants.DEFAULT_RULE_STAGE = constants.RULES_STAGES[0];  // eslint-disable-line\nconstants.HOOKS_HIDDEN_SECRET_VALUE = '_VALUE_NOT_SHOWN_';\n\nconstants.HOOKS_DIRECTORY = 'hooks';\nconstants.ACTIONS_DIRECTORY = 'actions';\nconstants.TRIGGERS_DIRECTORY = 'triggers';\n\nconstants.RULES_CONFIGS_DIRECTORY = 'rules-configs';\n\nconstants.PAGES_DIRECTORY = 'pages';\nconstants.PAGE_LOGIN = 'login';\nconstants.PAGE_PASSWORD_RESET = 'password_reset';\nconstants.PAGE_GUARDIAN_MULTIFACTOR = 'guardian_multifactor';\nconstants.PAGE_ERROR = 'error_page';\n\nconstants.PAGE_NAMES = [\n  constants.PAGE_GUARDIAN_MULTIFACTOR + '.html',\n  constants.PAGE_GUARDIAN_MULTIFACTOR + '.json',\n  constants.PAGE_PASSWORD_RESET + '.html',\n  constants.PAGE_PASSWORD_RESET + '.json',\n  constants.PAGE_LOGIN + '.html',\n  constants.PAGE_LOGIN + '.json',\n  constants.PAGE_ERROR + '.html',\n  constants.PAGE_ERROR + '.json'\n];\n\nconstants.DATABASE_CONNECTIONS_DIRECTORY = 'database-connections';\nconstants.DATABASE_SCRIPTS_CHANGE_EMAIL = 'change_email';\nconstants.DATABASE_SCRIPTS_GET_USER = 'get_user';\nconstants.DATABASE_SCRIPTS = [\n  constants.DATABASE_SCRIPTS_GET_USER,\n  'create',\n  'verify',\n  'login',\n  'change_password',\n  'delete',\n  constants.DATABASE_SCRIPTS_CHANGE_EMAIL\n];\nconstants.DATABASE_SCRIPTS_NO_IMPORT = [\n  constants.DATABASE_SCRIPTS_GET_USER,\n  'create',\n  'verify',\n  'login',\n  'change_password',\n  'delete'\n];\nconstants.DATABASE_SCRIPTS_IMPORT = [\n  constants.DATABASE_SCRIPTS_GET_USER,\n  'login'\n];\n\nconstants.EMAIL_TEMPLATES_DIRECTORY = 'emails';\n\nconstants.EMAIL_VERIFY = 'verify_email';\nconstants.EMAIL_VERIFY_BY_CODE = 'verify_email_by_code';\nconstants.EMAIL_RESET = 'reset_email';\nconstants.EMAIL_WELCOME = 'welcome_email';\nconstants.EMAIL_BLOCKED = 'blocked_account';\nconstants.EMAIL_STOLEN_CREDENTIALS = 'stolen_credentials';\nconstants.EMAIL_ENROLLMENT = 'enrollment_email';\nconstants.EMAIL_CHANGE_PASSWORD = 'change_password';\nconstants.EMAIL_PASSWORD_RESET = 'password_reset';\nconstants.EMAIL_MFA_OOB_CODE = 'mfa_oob_code';\nconstants.EMAIL_USER_INVITATION = 'user_invitation';\n\nconstants.EMAIL_TEMPLATES_NAMES = [\n  constants.EMAIL_VERIFY + '.json',\n  constants.EMAIL_VERIFY + '.html',\n  constants.EMAIL_VERIFY_BY_CODE + '.json',\n  constants.EMAIL_VERIFY_BY_CODE + '.html',\n  constants.EMAIL_RESET + '.json',\n  constants.EMAIL_RESET + '.html',\n  constants.EMAIL_WELCOME + '.json',\n  constants.EMAIL_WELCOME + '.html',\n  constants.EMAIL_BLOCKED + '.json',\n  constants.EMAIL_BLOCKED + '.html',\n  constants.EMAIL_STOLEN_CREDENTIALS + '.json',\n  constants.EMAIL_STOLEN_CREDENTIALS + '.html',\n  constants.EMAIL_ENROLLMENT + '.json',\n  constants.EMAIL_ENROLLMENT + '.html',\n  constants.EMAIL_CHANGE_PASSWORD + '.json',\n  constants.EMAIL_CHANGE_PASSWORD + '.html',\n  constants.EMAIL_PASSWORD_RESET + '.json',\n  constants.EMAIL_PASSWORD_RESET + '.html',\n  constants.EMAIL_MFA_OOB_CODE + '.json',\n  constants.EMAIL_MFA_OOB_CODE + '.html',\n  constants.EMAIL_USER_INVITATION + '.json',\n  constants.EMAIL_USER_INVITATION + '.html'\n];\n\nconstants.EMAIL_TEMPLATES_TYPES = [\n  'verify_email',\n  'verify_email_by_code',\n  'reset_email',\n  'welcome_email',\n  'blocked_account',\n  'stolen_credentials',\n  'enrollment_email',\n  'mfa_oob_code',\n  'change_password',\n  'password_reset',\n  'user_invitation'\n];\n\nconstants.ACTIONS_TRIGGERS = [\n  'post-login',\n  'credentials-exchange',\n  'pre-user-registration',\n  'post-user-registration',\n  'post-change-password',\n  'send-phone-message'\n];\n\nconstants.GUARDIAN_DIRECTORY = 'guardian';\nconstants.GUARDIAN_FACTORS_DIRECTORY = 'factors';\nconstants.GUARDIAN_PROVIDERS_DIRECTORY = 'providers';\nconstants.GUARDIAN_TEMPLATES_DIRECTORY = 'templates';\nconstants.GUARDIAN_FACTORS = [\n  'sms',\n  'push-notification',\n  'otp',\n  'email',\n  'duo',\n  'webauthn-roaming',\n  'webauthn-platform',\n  'recovery-code'\n];\nconstants.GUARDIAN_POLICIES = [\n  'all-applications',\n  'confidence-score'\n];\nconstants.GUARDIAN_PHONE_PROVIDERS = [\n  'auth0',\n  'twilio',\n  'phone-message-hook'\n];\nconstants.GUARDIAN_PHONE_MESSAGE_TYPES = [\n  'sms',\n  'voice'\n];\n\nconstants.GUARDIAN_FACTOR_TEMPLATES = [\n  'sms'\n];\n\nconstants.GUARDIAN_FACTOR_PROVIDERS = {\n  sms: [ 'twilio' ],\n  'push-notification': [ 'sns' ]\n};\n\nconstants.RESOURCE_SERVERS_DIRECTORY = 'resource-servers';\nconstants.RESOURCE_SERVERS_CLIENT_NAME = 'resourceServers';\nconstants.RESOURCE_SERVERS_MANAGEMENT_API_NAME = 'Auth0 Management API';\nconstants.RESOURCE_SERVERS_ID_NAME = 'id';\n\nconstants.CLIENTS_DIRECTORY = 'clients';\nconstants.CLIENTS_GRANTS_DIRECTORY = 'grants';\nconstants.CLIENTS_CLIENT_NAME = 'clients';\nconstants.CLIENTS_CLIENT_ID_NAME = 'client_id';\n\nconstants.CONNECTIONS_DIRECTORY = 'connections';\nconstants.CONNECTIONS_CLIENT_NAME = 'connections';\nconstants.CONNECTIONS_ID_NAME = 'id';\n\nconstants.CONCURRENT_CALLS = 5;\nconstants.ROLES_DIRECTORY = 'roles';\n\nexport default constants;\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"e0d5b093c175be9439f5746e0d2ed23aa48d2818","contentHash":"a3383774017e6a228c49bd8718de2b2ac31f5b4c68d8dd9ead4182e1347ae5a6"},"/home/circleci/repo/src/tools/deploy.js":{"path":"/home/circleci/repo/src/tools/deploy.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":25}},"2":{"start":{"line":8,"column":12},"end":{"line":8,"column":30}},"3":{"start":{"line":10,"column":13},"end":{"line":10,"column":42}},"4":{"start":{"line":12,"column":14},"end":{"line":12,"column":33}},"5":{"start":{"line":14,"column":15},"end":{"line":14,"column":46}},"6":{"start":{"line":16,"column":39},"end":{"line":16,"column":93}},"7":{"start":{"line":19,"column":2},"end":{"line":19,"column":100}},"8":{"start":{"line":21,"column":2},"end":{"line":21,"column":112}},"9":{"start":{"line":23,"column":16},"end":{"line":23,"column":58}},"10":{"start":{"line":24,"column":2},"end":{"line":24,"column":25}},"11":{"start":{"line":25,"column":2},"end":{"line":25,"column":31}},"12":{"start":{"line":26,"column":2},"end":{"line":33,"column":9}},"13":{"start":{"line":27,"column":4},"end":{"line":31,"column":6}},"14":{"start":{"line":32,"column":4},"end":{"line":32,"column":17}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":16,"column":9},"end":{"line":16,"column":31}},"loc":{"start":{"line":16,"column":37},"end":{"line":16,"column":95}},"line":16},"1":{"name":"deploy","decl":{"start":{"line":18,"column":15},"end":{"line":18,"column":21}},"loc":{"start":{"line":18,"column":46},"end":{"line":34,"column":1}},"line":18},"2":{"name":"(anonymous_2)","decl":{"start":{"line":26,"column":31},"end":{"line":26,"column":32}},"loc":{"start":{"line":26,"column":45},"end":{"line":33,"column":3}},"line":26}},"branchMap":{"0":{"loc":{"start":{"line":16,"column":46},"end":{"line":16,"column":92}},"type":"cond-expr","locations":[{"start":{"line":16,"column":70},"end":{"line":16,"column":73}},{"start":{"line":16,"column":76},"end":{"line":16,"column":92}}],"line":16},"1":{"loc":{"start":{"line":16,"column":46},"end":{"line":16,"column":67}},"type":"binary-expr","locations":[{"start":{"line":16,"column":46},"end":{"line":16,"column":49}},{"start":{"line":16,"column":53},"end":{"line":16,"column":67}}],"line":16},"2":{"loc":{"start":{"line":19,"column":46},"end":{"line":19,"column":99}},"type":"cond-expr","locations":[{"start":{"line":19,"column":83},"end":{"line":19,"column":90}},{"start":{"line":19,"column":93},"end":{"line":19,"column":99}}],"line":19}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":2,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0},"f":{"0":2,"1":0,"2":0},"b":{"0":[1,1],"1":[2,2],"2":[0,0]},"inputSourceMap":{"version":3,"sources":["deploy.js"],"names":["deploy","assets","client","config","log","transports","console","level","process","env","AUTH0_DEBUG","info","auth0","Auth0","validate","processChanges","handlers","reduce","accum","h","type","deleted","created","updated"],"mappings":";;;;;kBAG8BA,M;;AAH9B;;;;AACA;;;;;;AAEe,eAAeA,MAAf,CAAsBC,MAAtB,EAA8BC,MAA9B,EAAsCC,MAAtC,EAA8C;AAE3DC,mBAAIC,UAAJ,CAAeC,OAAf,CAAuBC,KAAvB,GAA+BC,OAAO,CAACC,GAAR,CAAYC,WAAZ,KAA4B,MAA5B,GAAqC,OAArC,GAA+C,MAA9E;;AAEAN,mBAAIO,IAAJ,CAAS,8BAA8BR,MAAM,CAAC,iBAAD,CAApC,GAA0D,GAA1D,GAAgEA,MAAM,CAAC,cAAD,CAA/E;;AAEA,QAAMS,KAAK,GAAG,IAAIC,cAAJ,CAAUX,MAAV,EAAkBD,MAAlB,EAA0BE,MAA1B,CAAd;AAGA,QAAMS,KAAK,CAACE,QAAN,EAAN;AAGA,QAAMF,KAAK,CAACG,cAAN,EAAN;AAEA,SAAOH,KAAK,CAACI,QAAN,CAAeC,MAAf,CAAsB,CAACC,KAAD,EAAQC,CAAR,KAAc;AACzCD,IAAAA,KAAK,CAACC,CAAC,CAACC,IAAH,CAAL,GAAgB;AACdC,MAAAA,OAAO,EAAEF,CAAC,CAACE,OADG;AAEdC,MAAAA,OAAO,EAAEH,CAAC,CAACG,OAFG;AAGdC,MAAAA,OAAO,EAAEJ,CAAC,CAACI;AAHG,KAAhB;AAKA,WAAOL,KAAP;AACD,GAPM,EAOJ,EAPI,CAAP;AAQD","sourceRoot":"/home/circleci/repo/src/tools/","sourcesContent":["import Auth0 from './auth0';\nimport log from './logger';\n\nexport default async function deploy(assets, client, config) {\n  // Setup log level\n  log.transports.console.level = process.env.AUTH0_DEBUG === 'true' ? 'debug' : 'info';\n\n  log.info('Getting access token for ' + config('AUTH0_CLIENT_ID') + '/' + config('AUTH0_DOMAIN'));\n\n  const auth0 = new Auth0(client, assets, config);\n\n  // Validate Assets\n  await auth0.validate();\n\n  // Process changes\n  await auth0.processChanges();\n\n  return auth0.handlers.reduce((accum, h) => {\n    accum[h.type] = {\n      deleted: h.deleted,\n      created: h.created,\n      updated: h.updated\n    };\n    return accum;\n  }, {});\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"6bae8ca6435eaab5fc6c5ae12a6f1523eac9c29b","contentHash":"90c7f090942a44585d8113e050fecf6a644229c8feb25e0c22f1f5a6e0dad214"},"/home/circleci/repo/src/tools/auth0/index.js":{"path":"/home/circleci/repo/src/tools/auth0/index.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":11},"end":{"line":7,"column":33}},"2":{"start":{"line":9,"column":12},"end":{"line":9,"column":40}},"3":{"start":{"line":11,"column":14},"end":{"line":11,"column":33}},"4":{"start":{"line":13,"column":15},"end":{"line":13,"column":46}},"5":{"start":{"line":15,"column":14},"end":{"line":15,"column":33}},"6":{"start":{"line":17,"column":15},"end":{"line":17,"column":46}},"7":{"start":{"line":19,"column":16},"end":{"line":19,"column":37}},"8":{"start":{"line":21,"column":15},"end":{"line":21,"column":49}},"9":{"start":{"line":23,"column":49},"end":{"line":23,"column":96}},"10":{"start":{"line":23,"column":84},"end":{"line":23,"column":96}},"11":{"start":{"line":23,"column":121},"end":{"line":23,"column":134}},"12":{"start":{"line":23,"column":159},"end":{"line":23,"column":172}},"13":{"start":{"line":23,"column":174},"end":{"line":23,"column":309}},"14":{"start":{"line":23,"column":234},"end":{"line":23,"column":292}},"15":{"start":{"line":25,"column":53},"end":{"line":25,"column":111}},"16":{"start":{"line":25,"column":98},"end":{"line":25,"column":109}},"17":{"start":{"line":25,"column":112},"end":{"line":25,"column":214}},"18":{"start":{"line":25,"column":188},"end":{"line":25,"column":212}},"19":{"start":{"line":25,"column":227},"end":{"line":25,"column":264}},"20":{"start":{"line":25,"column":266},"end":{"line":25,"column":321}},"21":{"start":{"line":25,"column":297},"end":{"line":25,"column":319}},"22":{"start":{"line":25,"column":335},"end":{"line":25,"column":337}},"23":{"start":{"line":25,"column":367},"end":{"line":25,"column":423}},"24":{"start":{"line":25,"column":425},"end":{"line":25,"column":726}},"25":{"start":{"line":25,"column":448},"end":{"line":25,"column":724}},"26":{"start":{"line":25,"column":534},"end":{"line":25,"column":606}},"27":{"start":{"line":25,"column":608},"end":{"line":25,"column":722}},"28":{"start":{"line":25,"column":646},"end":{"line":25,"column":687}},"29":{"start":{"line":25,"column":697},"end":{"line":25,"column":720}},"30":{"start":{"line":25,"column":727},"end":{"line":25,"column":748}},"31":{"start":{"line":25,"column":749},"end":{"line":25,"column":787}},"32":{"start":{"line":25,"column":762},"end":{"line":25,"column":785}},"33":{"start":{"line":25,"column":788},"end":{"line":25,"column":802}},"34":{"start":{"line":27,"column":39},"end":{"line":27,"column":93}},"35":{"start":{"line":29,"column":21},"end":{"line":29,"column":23}},"36":{"start":{"line":32,"column":17},"end":{"line":32,"column":28}},"37":{"start":{"line":33,"column":2},"end":{"line":37,"column":5}},"38":{"start":{"line":34,"column":19},"end":{"line":34,"column":49}},"39":{"start":{"line":35,"column":19},"end":{"line":35,"column":49}},"40":{"start":{"line":36,"column":4},"end":{"line":36,"column":27}},"41":{"start":{"line":38,"column":2},"end":{"line":38,"column":16}},"42":{"start":{"line":43,"column":4},"end":{"line":43,"column":48}},"43":{"start":{"line":44,"column":4},"end":{"line":44,"column":25}},"44":{"start":{"line":45,"column":4},"end":{"line":45,"column":25}},"45":{"start":{"line":46,"column":4},"end":{"line":46,"column":23}},"46":{"start":{"line":47,"column":4},"end":{"line":53,"column":7}},"47":{"start":{"line":48,"column":22},"end":{"line":51,"column":8}},"48":{"start":{"line":52,"column":6},"end":{"line":52,"column":34}},"49":{"start":{"line":57,"column":4},"end":{"line":68,"column":5}},"50":{"start":{"line":58,"column":6},"end":{"line":67,"column":7}},"51":{"start":{"line":59,"column":24},"end":{"line":59,"column":61}},"52":{"start":{"line":60,"column":8},"end":{"line":62,"column":10}},"53":{"start":{"line":64,"column":8},"end":{"line":64,"column":32}},"54":{"start":{"line":65,"column":8},"end":{"line":65,"column":26}},"55":{"start":{"line":66,"column":8},"end":{"line":66,"column":18}},"56":{"start":{"line":72,"column":16},"end":{"line":74,"column":6}},"57":{"start":{"line":75,"column":18},"end":{"line":75,"column":61}},"58":{"start":{"line":77,"column":4},"end":{"line":79,"column":5}},"59":{"start":{"line":78,"column":6},"end":{"line":78,"column":97}},"60":{"start":{"line":81,"column":4},"end":{"line":81,"column":36}},"61":{"start":{"line":85,"column":4},"end":{"line":85,"column":32}},"62":{"start":{"line":89,"column":4},"end":{"line":89,"column":42}},"63":{"start":{"line":94,"column":0},"end":{"line":94,"column":24}}},"fnMap":{"0":{"name":"_getRequireWildcardCache","decl":{"start":{"line":23,"column":9},"end":{"line":23,"column":33}},"loc":{"start":{"line":23,"column":47},"end":{"line":23,"column":311}},"line":23},"1":{"name":"(anonymous_1)","decl":{"start":{"line":23,"column":209},"end":{"line":23,"column":210}},"loc":{"start":{"line":23,"column":232},"end":{"line":23,"column":294}},"line":23},"2":{"name":"_interopRequireWildcard","decl":{"start":{"line":25,"column":9},"end":{"line":25,"column":32}},"loc":{"start":{"line":25,"column":51},"end":{"line":25,"column":804}},"line":25},"3":{"name":"_interopRequireDefault","decl":{"start":{"line":27,"column":9},"end":{"line":27,"column":31}},"loc":{"start":{"line":27,"column":37},"end":{"line":27,"column":95}},"line":27},"4":{"name":"sortByOrder","decl":{"start":{"line":31,"column":9},"end":{"line":31,"column":20}},"loc":{"start":{"line":31,"column":36},"end":{"line":39,"column":1}},"line":31},"5":{"name":"(anonymous_5)","decl":{"start":{"line":33,"column":14},"end":{"line":33,"column":15}},"loc":{"start":{"line":33,"column":24},"end":{"line":37,"column":3}},"line":33},"6":{"name":"(anonymous_6)","decl":{"start":{"line":42,"column":2},"end":{"line":42,"column":3}},"loc":{"start":{"line":42,"column":38},"end":{"line":54,"column":3}},"line":42},"7":{"name":"(anonymous_7)","decl":{"start":{"line":47,"column":36},"end":{"line":47,"column":37}},"loc":{"start":{"line":47,"column":41},"end":{"line":53,"column":5}},"line":47},"8":{"name":"(anonymous_8)","decl":{"start":{"line":56,"column":2},"end":{"line":56,"column":3}},"loc":{"start":{"line":56,"column":24},"end":{"line":69,"column":3}},"line":56},"9":{"name":"(anonymous_9)","decl":{"start":{"line":71,"column":2},"end":{"line":71,"column":3}},"loc":{"start":{"line":71,"column":19},"end":{"line":82,"column":3}},"line":71},"10":{"name":"(anonymous_10)","decl":{"start":{"line":84,"column":2},"end":{"line":84,"column":3}},"loc":{"start":{"line":84,"column":18},"end":{"line":86,"column":3}},"line":84},"11":{"name":"(anonymous_11)","decl":{"start":{"line":88,"column":2},"end":{"line":88,"column":3}},"loc":{"start":{"line":88,"column":25},"end":{"line":90,"column":3}},"line":88}},"branchMap":{"0":{"loc":{"start":{"line":23,"column":49},"end":{"line":23,"column":96}},"type":"if","locations":[{"start":{"line":23,"column":49},"end":{"line":23,"column":96}},{"start":{"line":23,"column":49},"end":{"line":23,"column":96}}],"line":23},"1":{"loc":{"start":{"line":23,"column":241},"end":{"line":23,"column":291}},"type":"cond-expr","locations":[{"start":{"line":23,"column":255},"end":{"line":23,"column":271}},{"start":{"line":23,"column":274},"end":{"line":23,"column":291}}],"line":23},"2":{"loc":{"start":{"line":25,"column":53},"end":{"line":25,"column":111}},"type":"if","locations":[{"start":{"line":25,"column":53},"end":{"line":25,"column":111}},{"start":{"line":25,"column":53},"end":{"line":25,"column":111}}],"line":25},"3":{"loc":{"start":{"line":25,"column":57},"end":{"line":25,"column":94}},"type":"binary-expr","locations":[{"start":{"line":25,"column":57},"end":{"line":25,"column":69}},{"start":{"line":25,"column":73},"end":{"line":25,"column":76}},{"start":{"line":25,"column":80},"end":{"line":25,"column":94}}],"line":25},"4":{"loc":{"start":{"line":25,"column":112},"end":{"line":25,"column":214}},"type":"if","locations":[{"start":{"line":25,"column":112},"end":{"line":25,"column":214}},{"start":{"line":25,"column":112},"end":{"line":25,"column":214}}],"line":25},"5":{"loc":{"start":{"line":25,"column":116},"end":{"line":25,"column":184}},"type":"binary-expr","locations":[{"start":{"line":25,"column":116},"end":{"line":25,"column":128}},{"start":{"line":25,"column":132},"end":{"line":25,"column":155}},{"start":{"line":25,"column":159},"end":{"line":25,"column":184}}],"line":25},"6":{"loc":{"start":{"line":25,"column":266},"end":{"line":25,"column":321}},"type":"if","locations":[{"start":{"line":25,"column":266},"end":{"line":25,"column":321}},{"start":{"line":25,"column":266},"end":{"line":25,"column":321}}],"line":25},"7":{"loc":{"start":{"line":25,"column":270},"end":{"line":25,"column":293}},"type":"binary-expr","locations":[{"start":{"line":25,"column":270},"end":{"line":25,"column":275}},{"start":{"line":25,"column":279},"end":{"line":25,"column":293}}],"line":25},"8":{"loc":{"start":{"line":25,"column":367},"end":{"line":25,"column":423}},"type":"binary-expr","locations":[{"start":{"line":25,"column":367},"end":{"line":25,"column":388}},{"start":{"line":25,"column":392},"end":{"line":25,"column":423}}],"line":25},"9":{"loc":{"start":{"line":25,"column":448},"end":{"line":25,"column":724}},"type":"if","locations":[{"start":{"line":25,"column":448},"end":{"line":25,"column":724}},{"start":{"line":25,"column":448},"end":{"line":25,"column":724}}],"line":25},"10":{"loc":{"start":{"line":25,"column":452},"end":{"line":25,"column":519}},"type":"binary-expr","locations":[{"start":{"line":25,"column":452},"end":{"line":25,"column":469}},{"start":{"line":25,"column":473},"end":{"line":25,"column":519}}],"line":25},"11":{"loc":{"start":{"line":25,"column":534},"end":{"line":25,"column":606}},"type":"cond-expr","locations":[{"start":{"line":25,"column":558},"end":{"line":25,"column":599}},{"start":{"line":25,"column":602},"end":{"line":25,"column":606}}],"line":25},"12":{"loc":{"start":{"line":25,"column":608},"end":{"line":25,"column":722}},"type":"if","locations":[{"start":{"line":25,"column":608},"end":{"line":25,"column":722}},{"start":{"line":25,"column":608},"end":{"line":25,"column":722}}],"line":25},"13":{"loc":{"start":{"line":25,"column":612},"end":{"line":25,"column":642}},"type":"binary-expr","locations":[{"start":{"line":25,"column":612},"end":{"line":25,"column":616}},{"start":{"line":25,"column":621},"end":{"line":25,"column":629}},{"start":{"line":25,"column":633},"end":{"line":25,"column":641}}],"line":25},"14":{"loc":{"start":{"line":25,"column":749},"end":{"line":25,"column":787}},"type":"if","locations":[{"start":{"line":25,"column":749},"end":{"line":25,"column":787}},{"start":{"line":25,"column":749},"end":{"line":25,"column":787}}],"line":25},"15":{"loc":{"start":{"line":27,"column":46},"end":{"line":27,"column":92}},"type":"cond-expr","locations":[{"start":{"line":27,"column":70},"end":{"line":27,"column":73}},{"start":{"line":27,"column":76},"end":{"line":27,"column":92}}],"line":27},"16":{"loc":{"start":{"line":27,"column":46},"end":{"line":27,"column":67}},"type":"binary-expr","locations":[{"start":{"line":27,"column":46},"end":{"line":27,"column":49}},{"start":{"line":27,"column":53},"end":{"line":27,"column":67}}],"line":27},"17":{"loc":{"start":{"line":34,"column":19},"end":{"line":34,"column":49}},"type":"binary-expr","locations":[{"start":{"line":34,"column":19},"end":{"line":34,"column":33}},{"start":{"line":34,"column":37},"end":{"line":34,"column":49}}],"line":34},"18":{"loc":{"start":{"line":35,"column":19},"end":{"line":35,"column":49}},"type":"binary-expr","locations":[{"start":{"line":35,"column":19},"end":{"line":35,"column":33}},{"start":{"line":35,"column":37},"end":{"line":35,"column":49}}],"line":35},"19":{"loc":{"start":{"line":61,"column":14},"end":{"line":61,"column":65}},"type":"binary-expr","locations":[{"start":{"line":61,"column":15},"end":{"line":61,"column":58}},{"start":{"line":61,"column":63},"end":{"line":61,"column":65}}],"line":61},"20":{"loc":{"start":{"line":77,"column":4},"end":{"line":79,"column":5}},"type":"if","locations":[{"start":{"line":77,"column":4},"end":{"line":79,"column":5}},{"start":{"line":77,"column":4},"end":{"line":79,"column":5}}],"line":77}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":1,"16":1,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":3,"35":1,"36":63,"37":63,"38":1512,"39":1512,"40":1512,"41":63,"42":108,"43":108,"44":108,"45":108,"46":108,"47":2700,"48":2700,"49":63,"50":1575,"51":1575,"52":1575,"53":0,"54":0,"55":0,"56":103,"57":103,"58":103,"59":44,"60":59,"61":4,"62":0,"63":1},"f":{"0":0,"1":0,"2":1,"3":3,"4":63,"5":1512,"6":108,"7":2700,"8":63,"9":103,"10":4,"11":0},"b":{"0":[0,0],"1":[0,0],"2":[1,0],"3":[1,1,1],"4":[0,0],"5":[0,0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0,0],"14":[0,0],"15":[2,1],"16":[3,3],"17":[1512,1512],"18":[1512,1512],"19":[1575,1475],"20":[44,59]},"inputSourceMap":{"version":3,"sources":["index.js"],"names":["handlers","defaultOrder","sortByOrder","toSort","stage","sorted","sort","a","b","aOrder","order","bOrder","Auth0","constructor","client","assets","config","Object","values","forEach","h","handler","default","push","runStage","stageFn","getPrototypeOf","apply","err","type","validate","ajv","Ajv","useDefaults","valid","schema","Error","JSON","stringify","errors","loadAll","processChanges"],"mappings":";;;;;;AAAA;;;;AAEA;;;;AACA;;;;AACA;;IAAYA,Q;;;;;;;;AAEZ,MAAMC,YAAY,GAAG,EAArB;;AAEA,SAASC,WAAT,CAAqBC,MAArB,EAA6BC,KAA7B,EAAoC;AAClC,QAAMC,MAAM,GAAG,CAAE,GAAGF,MAAL,CAAf;AACAE,EAAAA,MAAM,CAACC,IAAP,CAAY,CAACC,CAAD,EAAIC,CAAJ,KAAU;AACpB,UAAMC,MAAM,GAAGF,CAAC,CAACH,KAAD,CAAD,CAASM,KAAT,IAAkBT,YAAjC;AACA,UAAMU,MAAM,GAAGH,CAAC,CAACJ,KAAD,CAAD,CAASM,KAAT,IAAkBT,YAAjC;AACA,WAAOQ,MAAM,GAAGE,MAAhB;AACD,GAJD;AAKA,SAAON,MAAP;AACD;;AAEc,MAAMO,KAAN,CAAY;AACzBC,EAAAA,WAAW,CAACC,MAAD,EAASC,MAAT,EAAiBC,MAAjB,EAAyB;AAClC,SAAKF,MAAL,GAAc,sBAAYA,MAAZ,CAAd;AACA,SAAKE,MAAL,GAAcA,MAAd;AACA,SAAKD,MAAL,GAAcA,MAAd;AACA,SAAKf,QAAL,GAAgB,EAAhB;AACAiB,IAAAA,MAAM,CAACC,MAAP,CAAclB,QAAd,EAAwBmB,OAAxB,CAAiCC,CAAD,IAAO;AACrC,YAAMC,OAAO,GAAG,IAAID,CAAC,CAACE,OAAN,CAAc;AAAER,QAAAA,MAAM,EAAE,KAAKA,MAAf;AAAuBE,QAAAA;AAAvB,OAAd,CAAhB;AACA,WAAKhB,QAAL,CAAcuB,IAAd,CAAmBF,OAAnB;AACD,KAHD;AAID;;AAEa,QAARG,QAAQ,CAACpB,KAAD,EAAQ;AAEpB,SAAK,MAAMiB,OAAX,IAAsBnB,WAAW,CAAC,KAAKF,QAAN,EAAgBI,KAAhB,CAAjC,EAAyD;AACvD,UAAI;AACF,cAAMqB,OAAO,GAAGR,MAAM,CAACS,cAAP,CAAsBL,OAAtB,EAA+BjB,KAA/B,CAAhB;AACA,aAAKW,MAAL,GAAc,EACZ,GAAG,KAAKA,MADI;AAEZ,cAAG,OAAMU,OAAO,CAACE,KAAR,CAAcN,OAAd,EAAuB,CAAE,KAAKN,MAAP,CAAvB,CAAN,KAAiD,EAApD;AAFY,SAAd;AAID,OAND,CAME,OAAOa,GAAP,EAAY;AACZA,QAAAA,GAAG,CAACC,IAAJ,GAAWR,OAAO,CAACQ,IAAnB;AACAD,QAAAA,GAAG,CAACxB,KAAJ,GAAYA,KAAZ;AACA,cAAMwB,GAAN;AACD;AACF;AACF;;AAEa,QAARE,QAAQ,GAAG;AACf,UAAMC,GAAG,GAAG,IAAIC,aAAJ,CAAQ;AAAEC,MAAAA,WAAW,EAAE;AAAf,KAAR,CAAZ;AACA,UAAMC,KAAK,GAAGH,GAAG,CAACD,QAAJ,CAAaK,gBAAb,EAAqB,KAAKpB,MAA1B,CAAd;;AACA,QAAI,CAACmB,KAAL,EAAY;AACV,YAAM,IAAIE,KAAJ,CAAW,oCAAmCC,IAAI,CAACC,SAAL,CAAeP,GAAG,CAACQ,MAAnB,EAA2B,IAA3B,EAAiC,CAAjC,CAAoC,EAAlF,CAAN;AACD;;AAED,UAAM,KAAKf,QAAL,CAAc,UAAd,CAAN;AACD;;AAEY,QAAPgB,OAAO,GAAG;AAEd,UAAM,KAAKhB,QAAL,CAAc,MAAd,CAAN;AACD;;AAEmB,QAAdiB,cAAc,GAAG;AACrB,UAAM,KAAKjB,QAAL,CAAc,gBAAd,CAAN;AACD;;AA9CwB;;kBAANZ,K","sourceRoot":"/home/circleci/repo/src/tools/auth0/","sourcesContent":["import Ajv from 'ajv/lib/ajv';\n\nimport pagedClient from './client';\nimport schema from './schema';\nimport * as handlers from './handlers';\n\nconst defaultOrder = 50;\n\nfunction sortByOrder(toSort, stage) {\n  const sorted = [ ...toSort ];\n  sorted.sort((a, b) => {\n    const aOrder = a[stage].order || defaultOrder;\n    const bOrder = b[stage].order || defaultOrder;\n    return aOrder - bOrder;\n  });\n  return sorted;\n}\n\nexport default class Auth0 {\n  constructor(client, assets, config) {\n    this.client = pagedClient(client);\n    this.config = config;\n    this.assets = assets;\n    this.handlers = [];\n    Object.values(handlers).forEach((h) => {\n      const handler = new h.default({ client: this.client, config });\n      this.handlers.push(handler);\n    });\n  }\n\n  async runStage(stage) {\n    // Sort by priority\n    for (const handler of sortByOrder(this.handlers, stage)) { // eslint-disable-line\n      try {\n        const stageFn = Object.getPrototypeOf(handler)[stage];\n        this.assets = {\n          ...this.assets,\n          ...await stageFn.apply(handler, [ this.assets ]) || {}\n        };\n      } catch (err) {\n        err.type = handler.type;\n        err.stage = stage;\n        throw err;\n      }\n    }\n  }\n\n  async validate() {\n    const ajv = new Ajv({ useDefaults: true });\n    const valid = ajv.validate(schema, this.assets);\n    if (!valid) {\n      throw new Error(`Schema validation failed loading ${JSON.stringify(ajv.errors, null, 4)}`);\n    }\n\n    await this.runStage('validate');\n  }\n\n  async loadAll() {\n    // Populate assets from auth0 tenant\n    await this.runStage('load');\n  }\n\n  async processChanges() {\n    await this.runStage('processChanges');\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"6df0e9453166f51a6a5a69c6fd43edb09aede5b2","contentHash":"72ed4c9e9d815bc5129e57f6709a6f1c451194f6b39763a9be2fdd33ccdfd1a4"},"/home/circleci/repo/src/tools/auth0/client.js":{"path":"/home/circleci/repo/src/tools/auth0/client.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":30}},"2":{"start":{"line":8,"column":27},"end":{"line":8,"column":59}},"3":{"start":{"line":10,"column":14},"end":{"line":10,"column":31}},"4":{"start":{"line":12,"column":15},"end":{"line":12,"column":46}},"5":{"start":{"line":14,"column":13},"end":{"line":14,"column":32}},"6":{"start":{"line":16,"column":39},"end":{"line":16,"column":93}},"7":{"start":{"line":18,"column":24},"end":{"line":18,"column":25}},"8":{"start":{"line":19,"column":33},"end":{"line":19,"column":34}},"9":{"start":{"line":20,"column":22},"end":{"line":20,"column":25}},"10":{"start":{"line":23,"column":16},"end":{"line":23,"column":64}},"11":{"start":{"line":23,"column":47},"end":{"line":23,"column":63}},"12":{"start":{"line":25,"column":2},"end":{"line":27,"column":3}},"13":{"start":{"line":26,"column":4},"end":{"line":26,"column":20}},"14":{"start":{"line":29,"column":2},"end":{"line":29,"column":82}},"15":{"start":{"line":33,"column":2},"end":{"line":87,"column":5}},"16":{"start":{"line":35,"column":6},"end":{"line":77,"column":7}},"17":{"start":{"line":36,"column":8},"end":{"line":76,"column":10}},"18":{"start":{"line":37,"column":10},"end":{"line":73,"column":11}},"19":{"start":{"line":38,"column":27},"end":{"line":38,"column":31}},"20":{"start":{"line":39,"column":25},"end":{"line":39,"column":27}},"21":{"start":{"line":40,"column":28},"end":{"line":40,"column":37}},"22":{"start":{"line":41,"column":12},"end":{"line":43,"column":14}},"23":{"start":{"line":44,"column":28},"end":{"line":44,"column":64}},"24":{"start":{"line":45,"column":12},"end":{"line":45,"column":42}},"25":{"start":{"line":46,"column":12},"end":{"line":46,"column":39}},"26":{"start":{"line":47,"column":24},"end":{"line":50,"column":24}},"27":{"start":{"line":49,"column":37},"end":{"line":49,"column":64}},"28":{"start":{"line":51,"column":12},"end":{"line":51,"column":41}},"29":{"start":{"line":52,"column":26},"end":{"line":52,"column":40}},"30":{"start":{"line":53,"column":30},"end":{"line":53,"column":60}},"31":{"start":{"line":55,"column":12},"end":{"line":70,"column":13}},"32":{"start":{"line":56,"column":28},"end":{"line":64,"column":26}},"33":{"start":{"line":59,"column":35},"end":{"line":59,"column":70}},"34":{"start":{"line":61,"column":18},"end":{"line":61,"column":46}},"35":{"start":{"line":62,"column":18},"end":{"line":62,"column":77}},"36":{"start":{"line":62,"column":63},"end":{"line":62,"column":75}},"37":{"start":{"line":65,"column":14},"end":{"line":65,"column":55}},"38":{"start":{"line":67,"column":14},"end":{"line":69,"column":15}},"39":{"start":{"line":68,"column":16},"end":{"line":68,"column":65}},"40":{"start":{"line":72,"column":12},"end":{"line":72,"column":24}},"41":{"start":{"line":75,"column":10},"end":{"line":75,"column":39}},"42":{"start":{"line":79,"column":28},"end":{"line":79,"column":63}},"43":{"start":{"line":81,"column":6},"end":{"line":83,"column":7}},"44":{"start":{"line":82,"column":8},"end":{"line":82,"column":51}},"45":{"start":{"line":85,"column":6},"end":{"line":85,"column":27}},"46":{"start":{"line":91,"column":2},"end":{"line":95,"column":5}},"47":{"start":{"line":96,"column":2},"end":{"line":96,"column":38}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":16,"column":9},"end":{"line":16,"column":31}},"loc":{"start":{"line":16,"column":37},"end":{"line":16,"column":95}},"line":16},"1":{"name":"getEntity","decl":{"start":{"line":22,"column":9},"end":{"line":22,"column":18}},"loc":{"start":{"line":22,"column":24},"end":{"line":30,"column":1}},"line":22},"2":{"name":"(anonymous_2)","decl":{"start":{"line":23,"column":42},"end":{"line":23,"column":43}},"loc":{"start":{"line":23,"column":47},"end":{"line":23,"column":63}},"line":23},"3":{"name":"pagedManager","decl":{"start":{"line":32,"column":9},"end":{"line":32,"column":21}},"loc":{"start":{"line":32,"column":39},"end":{"line":88,"column":1}},"line":32},"4":{"name":"(anonymous_4)","decl":{"start":{"line":34,"column":9},"end":{"line":34,"column":10}},"loc":{"start":{"line":34,"column":43},"end":{"line":86,"column":5}},"line":34},"5":{"name":"(anonymous_5)","decl":{"start":{"line":36,"column":15},"end":{"line":36,"column":16}},"loc":{"start":{"line":36,"column":40},"end":{"line":76,"column":9}},"line":36},"6":{"name":"(anonymous_6)","decl":{"start":{"line":49,"column":25},"end":{"line":49,"column":26}},"loc":{"start":{"line":49,"column":37},"end":{"line":49,"column":64}},"line":49},"7":{"name":"(anonymous_7)","decl":{"start":{"line":58,"column":27},"end":{"line":58,"column":28}},"loc":{"start":{"line":58,"column":35},"end":{"line":63,"column":17}},"line":58},"8":{"name":"(anonymous_8)","decl":{"start":{"line":62,"column":58},"end":{"line":62,"column":59}},"loc":{"start":{"line":62,"column":63},"end":{"line":62,"column":75}},"line":62},"9":{"name":"pagedClient","decl":{"start":{"line":90,"column":9},"end":{"line":90,"column":20}},"loc":{"start":{"line":90,"column":29},"end":{"line":97,"column":1}},"line":90}},"branchMap":{"0":{"loc":{"start":{"line":16,"column":46},"end":{"line":16,"column":92}},"type":"cond-expr","locations":[{"start":{"line":16,"column":70},"end":{"line":16,"column":73}},{"start":{"line":16,"column":76},"end":{"line":16,"column":92}}],"line":16},"1":{"loc":{"start":{"line":16,"column":46},"end":{"line":16,"column":67}},"type":"binary-expr","locations":[{"start":{"line":16,"column":46},"end":{"line":16,"column":49}},{"start":{"line":16,"column":53},"end":{"line":16,"column":67}}],"line":16},"2":{"loc":{"start":{"line":25,"column":2},"end":{"line":27,"column":3}},"type":"if","locations":[{"start":{"line":25,"column":2},"end":{"line":27,"column":3}},{"start":{"line":25,"column":2},"end":{"line":27,"column":3}}],"line":25},"3":{"loc":{"start":{"line":35,"column":6},"end":{"line":77,"column":7}},"type":"if","locations":[{"start":{"line":35,"column":6},"end":{"line":77,"column":7}},{"start":{"line":35,"column":6},"end":{"line":77,"column":7}}],"line":35},"4":{"loc":{"start":{"line":37,"column":10},"end":{"line":73,"column":11}},"type":"if","locations":[{"start":{"line":37,"column":10},"end":{"line":73,"column":11}},{"start":{"line":37,"column":10},"end":{"line":73,"column":11}}],"line":37},"5":{"loc":{"start":{"line":37,"column":14},"end":{"line":37,"column":72}},"type":"binary-expr","locations":[{"start":{"line":37,"column":14},"end":{"line":37,"column":21}},{"start":{"line":37,"column":25},"end":{"line":37,"column":52}},{"start":{"line":37,"column":56},"end":{"line":37,"column":72}}],"line":37},"6":{"loc":{"start":{"line":44,"column":28},"end":{"line":44,"column":64}},"type":"binary-expr","locations":[{"start":{"line":44,"column":28},"end":{"line":44,"column":47}},{"start":{"line":44,"column":51},"end":{"line":44,"column":64}}],"line":44},"7":{"loc":{"start":{"line":52,"column":26},"end":{"line":52,"column":40}},"type":"binary-expr","locations":[{"start":{"line":52,"column":26},"end":{"line":52,"column":35}},{"start":{"line":52,"column":39},"end":{"line":52,"column":40}}],"line":52},"8":{"loc":{"start":{"line":55,"column":12},"end":{"line":70,"column":13}},"type":"if","locations":[{"start":{"line":55,"column":12},"end":{"line":70,"column":13}},{"start":{"line":55,"column":12},"end":{"line":70,"column":13}}],"line":55},"9":{"loc":{"start":{"line":67,"column":14},"end":{"line":69,"column":15}},"type":"if","locations":[{"start":{"line":67,"column":14},"end":{"line":69,"column":15}},{"start":{"line":67,"column":14},"end":{"line":69,"column":15}}],"line":67},"10":{"loc":{"start":{"line":81,"column":6},"end":{"line":83,"column":7}},"type":"if","locations":[{"start":{"line":81,"column":6},"end":{"line":83,"column":7}},{"start":{"line":81,"column":6},"end":{"line":83,"column":7}}],"line":81},"11":{"loc":{"start":{"line":81,"column":10},"end":{"line":81,"column":69}},"type":"binary-expr","locations":[{"start":{"line":81,"column":10},"end":{"line":81,"column":43}},{"start":{"line":81,"column":47},"end":{"line":81,"column":69}}],"line":81}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":59,"11":101,"12":59,"13":59,"14":0,"15":311,"16":381,"17":64,"18":52,"19":48,"20":48,"21":48,"22":48,"23":48,"24":48,"25":48,"26":48,"27":48,"28":48,"29":48,"30":48,"31":48,"32":2,"33":11,"34":11,"35":11,"36":11,"37":2,"38":2,"39":0,"40":48,"41":4,"42":317,"43":317,"44":201,"45":116,"46":110,"47":110},"f":{"0":1,"1":59,"2":101,"3":311,"4":381,"5":52,"6":48,"7":11,"8":11,"9":110},"b":{"0":[0,1],"1":[1,1],"2":[59,0],"3":[64,317],"4":[48,4],"5":[52,48,48],"6":[48,48],"7":[48,38],"8":[2,46],"9":[0,2],"10":[201,116],"11":[317,201]},"inputSourceMap":{"version":3,"sources":["client.js"],"names":["pagedClient","API_CONCURRENCY","API_FREQUENCY_PER_SECOND","MAX_PAGE_SIZE","getEntity","rsp","found","Object","values","filter","a","Array","isArray","length","Error","pagedManager","client","manager","Proxy","get","target","name","receiver","args","paginate","fnName","data","newArgs","page","perPage","per_page","pool","addSingleTask","_","cloneDeep","generator","pageArgs","promise","push","total","pagesLeft","Math","ceil","pages","addEachTask","from","keys","then","r","nestedManager","Reflect","PromisePoolExecutor","concurrencyLimit","frequencyLimit","frequencyWindow"],"mappings":"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","sourceRoot":"/home/circleci/repo/src/tools/auth0/","sourcesContent":["import { PromisePoolExecutor } from 'promise-pool-executor';\nimport _ from 'lodash';\n\nimport { flatten } from '../utils';\n\nconst API_CONCURRENCY = 3;\n// To ensure a complete deployment, limit the API requests generated to be 80% of the capacity\n// https://auth0.com/docs/policies/rate-limits#management-api-v2\nconst API_FREQUENCY_PER_SECOND = 8;\n\nconst MAX_PAGE_SIZE = 100;\n\nfunction getEntity(rsp) {\n  const found = Object.values(rsp).filter((a) => Array.isArray(a));\n  if (found.length === 1) {\n    return found[0];\n  }\n  throw new Error('There was an error trying to find the entity within paginate');\n}\n\n// Warp around a <resource>Manager and detect when requesting specific pages to return all\nfunction pagedManager(client, manager) {\n  return new Proxy(manager, {\n    get: function(target, name, receiver) {\n      if (name === 'getAll') {\n        return async function(...args) {\n          // If the function was called with object params and paginate (entity) then handle pagination\n          if (args[0] && typeof args[0] === 'object' && args[0].paginate) {\n            const fnName = name;\n\n            // Where the entity data will be collected\n            const data = [];\n\n            // Create new args and inject the properties we require for pagination automation\n            const newArgs = [ ...args ];\n            newArgs[0] = { ...newArgs[0], page: 0 };\n\n            // Grab data we need from the request then delete the keys as they are only needed for this automation function to work\n            const perPage = newArgs[0].per_page || MAX_PAGE_SIZE;\n            newArgs[0].per_page = perPage;\n            delete newArgs[0].paginate;\n\n            // Run the first request to get the total number of entity items\n            const rsp = await client.pool.addSingleTask({\n              data: _.cloneDeep(newArgs),\n              generator: (pageArgs) => target[fnName](...pageArgs)\n            }).promise();\n\n            data.push(...getEntity(rsp));\n            const total = rsp.total || 0;\n            const pagesLeft = Math.ceil(total / perPage) - 1;\n            // Setup pool to get the rest of the pages\n            if (pagesLeft > 0) {\n              const pages = await client.pool.addEachTask({\n                data: Array.from(Array(pagesLeft).keys()),\n                generator: (page) => {\n                  const pageArgs = _.cloneDeep(newArgs);\n                  pageArgs[0].page = page + 1;\n\n                  return target[fnName](...pageArgs).then((r) => getEntity(r));\n                }\n              }).promise();\n\n              data.push(...flatten(pages));\n\n              if (data.length !== total) {\n                throw new Error('Fail to load data from tenant');\n              }\n            }\n            return data;\n          }\n\n          return target[name](...args);\n        };\n      }\n\n      const nestedManager = Reflect.get(target, name, receiver);\n\n      if (typeof nestedManager === 'object' && nestedManager !== null) {\n        return pagedManager(client, nestedManager);\n      }\n\n      return nestedManager;\n    }\n  });\n}\n\n// Warp around the ManagementClient and detect when requesting specific pages to return all\nexport default function pagedClient(client) {\n  client.pool = new PromisePoolExecutor({\n    concurrencyLimit: API_CONCURRENCY,\n    frequencyLimit: API_FREQUENCY_PER_SECOND,\n    frequencyWindow: 1000 // 1 sec\n  });\n\n  return pagedManager(client, client);\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"743a19b411098ba64073cbcfc066194e0ff540c5","contentHash":"acbacfebadbb90dbbcfc26f0882733dbb909b7e1088b8534cf5ae5e36127bf45"},"/home/circleci/repo/src/tools/utils.js":{"path":"/home/circleci/repo/src/tools/utils.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":40}},"2":{"start":{"line":7,"column":0},"end":{"line":7,"column":54}},"3":{"start":{"line":8,"column":0},"end":{"line":8,"column":58}},"4":{"start":{"line":9,"column":0},"end":{"line":9,"column":28}},"5":{"start":{"line":10,"column":0},"end":{"line":10,"column":26}},"6":{"start":{"line":11,"column":0},"end":{"line":11,"column":28}},"7":{"start":{"line":12,"column":0},"end":{"line":12,"column":34}},"8":{"start":{"line":13,"column":0},"end":{"line":13,"column":34}},"9":{"start":{"line":14,"column":0},"end":{"line":14,"column":46}},"10":{"start":{"line":15,"column":0},"end":{"line":15,"column":40}},"11":{"start":{"line":16,"column":0},"end":{"line":16,"column":40}},"12":{"start":{"line":17,"column":0},"end":{"line":17,"column":42}},"13":{"start":{"line":19,"column":12},"end":{"line":19,"column":27}},"14":{"start":{"line":21,"column":13},"end":{"line":21,"column":42}},"15":{"start":{"line":23,"column":10},"end":{"line":23,"column":23}},"16":{"start":{"line":25,"column":11},"end":{"line":25,"column":38}},"17":{"start":{"line":27,"column":15},"end":{"line":27,"column":34}},"18":{"start":{"line":29,"column":16},"end":{"line":29,"column":48}},"19":{"start":{"line":31,"column":14},"end":{"line":31,"column":31}},"20":{"start":{"line":33,"column":15},"end":{"line":33,"column":46}},"21":{"start":{"line":35,"column":14},"end":{"line":35,"column":33}},"22":{"start":{"line":37,"column":15},"end":{"line":37,"column":46}},"23":{"start":{"line":39,"column":39},"end":{"line":39,"column":93}},"24":{"start":{"line":42,"column":2},"end":{"line":51,"column":3}},"25":{"start":{"line":43,"column":4},"end":{"line":46,"column":7}},"26":{"start":{"line":44,"column":17},"end":{"line":44,"column":46}},"27":{"start":{"line":45,"column":6},"end":{"line":45,"column":47}},"28":{"start":{"line":47,"column":4},"end":{"line":50,"column":7}},"29":{"start":{"line":48,"column":17},"end":{"line":48,"column":46}},"30":{"start":{"line":49,"column":6},"end":{"line":49,"column":63}},"31":{"start":{"line":53,"column":2},"end":{"line":53,"column":15}},"32":{"start":{"line":57,"column":16},"end":{"line":57,"column":50}},"33":{"start":{"line":57,"column":34},"end":{"line":57,"column":49}},"34":{"start":{"line":58,"column":2},"end":{"line":58,"column":42}},"35":{"start":{"line":62,"column":24},"end":{"line":65,"column":5}},"36":{"start":{"line":62,"column":43},"end":{"line":65,"column":3}},"37":{"start":{"line":66,"column":17},"end":{"line":74,"column":8}},"38":{"start":{"line":67,"column":4},"end":{"line":71,"column":5}},"39":{"start":{"line":68,"column":20},"end":{"line":68,"column":78}},"40":{"start":{"line":68,"column":52},"end":{"line":68,"column":77}},"41":{"start":{"line":69,"column":6},"end":{"line":69,"column":43}},"42":{"start":{"line":70,"column":6},"end":{"line":70,"column":33}},"43":{"start":{"line":73,"column":4},"end":{"line":73,"column":15}},"44":{"start":{"line":75,"column":21},"end":{"line":75,"column":88}},"45":{"start":{"line":75,"column":50},"end":{"line":75,"column":64}},"46":{"start":{"line":75,"column":78},"end":{"line":75,"column":87}},"47":{"start":{"line":76,"column":2},"end":{"line":76,"column":36}},"48":{"start":{"line":80,"column":12},"end":{"line":80,"column":40}},"49":{"start":{"line":82,"column":2},"end":{"line":92,"column":3}},"50":{"start":{"line":83,"column":4},"end":{"line":83,"column":50}},"51":{"start":{"line":85,"column":4},"end":{"line":87,"column":5}},"52":{"start":{"line":86,"column":6},"end":{"line":86,"column":76}},"53":{"start":{"line":89,"column":4},"end":{"line":89,"column":48}},"54":{"start":{"line":91,"column":4},"end":{"line":91,"column":64}},"55":{"start":{"line":96,"column":2},"end":{"line":96,"column":80}},"56":{"start":{"line":96,"column":31},"end":{"line":96,"column":74}},"57":{"start":{"line":100,"column":2},"end":{"line":100,"column":44}},"58":{"start":{"line":104,"column":39},"end":{"line":105,"column":3}},"59":{"start":{"line":107,"column":2},"end":{"line":127,"column":3}},"60":{"start":{"line":108,"column":4},"end":{"line":126,"column":5}},"61":{"start":{"line":109,"column":6},"end":{"line":119,"column":7}},"62":{"start":{"line":110,"column":8},"end":{"line":118,"column":9}},"63":{"start":{"line":111,"column":10},"end":{"line":117,"column":11}},"64":{"start":{"line":112,"column":12},"end":{"line":116,"column":13}},"65":{"start":{"line":113,"column":14},"end":{"line":113,"column":93}},"66":{"start":{"line":115,"column":14},"end":{"line":115,"column":270}},"67":{"start":{"line":120,"column":11},"end":{"line":126,"column":5}},"68":{"start":{"line":121,"column":6},"end":{"line":121,"column":51}},"69":{"start":{"line":123,"column":6},"end":{"line":123,"column":53}},"70":{"start":{"line":125,"column":6},"end":{"line":125,"column":262}},"71":{"start":{"line":129,"column":2},"end":{"line":129,"column":38}},"72":{"start":{"line":133,"column":17},"end":{"line":133,"column":19}},"73":{"start":{"line":134,"column":12},"end":{"line":134,"column":25}},"74":{"start":{"line":135,"column":15},"end":{"line":135,"column":26}},"75":{"start":{"line":136,"column":20},"end":{"line":136,"column":22}},"76":{"start":{"line":138,"column":25},"end":{"line":150,"column":4}},"77":{"start":{"line":138,"column":46},"end":{"line":150,"column":4}},"78":{"start":{"line":139,"column":4},"end":{"line":147,"column":5}},"79":{"start":{"line":140,"column":21},"end":{"line":140,"column":39}},"80":{"start":{"line":140,"column":34},"end":{"line":140,"column":38}},"81":{"start":{"line":142,"column":6},"end":{"line":144,"column":7}},"82":{"start":{"line":142,"column":28},"end":{"line":142,"column":29}},"83":{"start":{"line":143,"column":8},"end":{"line":143,"column":42}},"84":{"start":{"line":146,"column":6},"end":{"line":146,"column":30}},"85":{"start":{"line":149,"column":4},"end":{"line":149,"column":17}},"86":{"start":{"line":152,"column":24},"end":{"line":181,"column":3}},"87":{"start":{"line":153,"column":4},"end":{"line":180,"column":7}},"88":{"start":{"line":156,"column":6},"end":{"line":164,"column":7}},"89":{"start":{"line":157,"column":23},"end":{"line":157,"column":44}},"90":{"start":{"line":157,"column":35},"end":{"line":157,"column":43}},"91":{"start":{"line":159,"column":8},"end":{"line":161,"column":9}},"92":{"start":{"line":159,"column":30},"end":{"line":159,"column":31}},"93":{"start":{"line":160,"column":10},"end":{"line":160,"column":42}},"94":{"start":{"line":163,"column":8},"end":{"line":163,"column":33}},"95":{"start":{"line":166,"column":6},"end":{"line":179,"column":7}},"96":{"start":{"line":167,"column":22},"end":{"line":167,"column":59}},"97":{"start":{"line":169,"column":8},"end":{"line":178,"column":9}},"98":{"start":{"line":170,"column":10},"end":{"line":170,"column":45}},"99":{"start":{"line":170,"column":32},"end":{"line":170,"column":43}},"100":{"start":{"line":171,"column":10},"end":{"line":171,"column":51}},"101":{"start":{"line":171,"column":38},"end":{"line":171,"column":49}},"102":{"start":{"line":172,"column":10},"end":{"line":177,"column":13}},"103":{"start":{"line":173,"column":14},"end":{"line":173,"column":46}},"104":{"start":{"line":173,"column":28},"end":{"line":173,"column":46}},"105":{"start":{"line":174,"column":14},"end":{"line":174,"column":25}},"106":{"start":{"line":183,"column":2},"end":{"line":185,"column":3}},"107":{"start":{"line":184,"column":4},"end":{"line":184,"column":35}},"108":{"start":{"line":187,"column":2},"end":{"line":204,"column":3}},"109":{"start":{"line":188,"column":21},"end":{"line":188,"column":35}},"110":{"start":{"line":189,"column":25},"end":{"line":189,"column":47}},"111":{"start":{"line":190,"column":4},"end":{"line":203,"column":7}},"112":{"start":{"line":191,"column":24},"end":{"line":191,"column":92}},"113":{"start":{"line":191,"column":40},"end":{"line":191,"column":88}},"114":{"start":{"line":193,"column":6},"end":{"line":202,"column":7}},"115":{"start":{"line":194,"column":25},"end":{"line":194,"column":98}},"116":{"start":{"line":194,"column":46},"end":{"line":194,"column":94}},"117":{"start":{"line":196,"column":8},"end":{"line":201,"column":9}},"118":{"start":{"line":197,"column":23},"end":{"line":197,"column":62}},"119":{"start":{"line":198,"column":10},"end":{"line":200,"column":13}},"120":{"start":{"line":206,"column":2},"end":{"line":211,"column":4}},"121":{"start":{"line":215,"column":19},"end":{"line":215,"column":21}},"122":{"start":{"line":216,"column":17},"end":{"line":217,"column":3}},"123":{"start":{"line":218,"column":2},"end":{"line":224,"column":5}},"124":{"start":{"line":219,"column":4},"end":{"line":223,"column":5}},"125":{"start":{"line":220,"column":6},"end":{"line":220,"column":42}},"126":{"start":{"line":222,"column":6},"end":{"line":222,"column":23}},"127":{"start":{"line":226,"column":2},"end":{"line":230,"column":3}},"128":{"start":{"line":227,"column":17},"end":{"line":227,"column":93}},"129":{"start":{"line":227,"column":74},"end":{"line":227,"column":88}},"130":{"start":{"line":229,"column":4},"end":{"line":229,"column":95}},"131":{"start":{"line":232,"column":2},"end":{"line":232,"column":16}},"132":{"start":{"line":236,"column":33},"end":{"line":236,"column":79}},"133":{"start":{"line":237,"column":26},"end":{"line":237,"column":82}},"134":{"start":{"line":238,"column":25},"end":{"line":238,"column":176}},"135":{"start":{"line":238,"column":111},"end":{"line":238,"column":174}},"136":{"start":{"line":239,"column":2},"end":{"line":247,"column":5}},"137":{"start":{"line":240,"column":4},"end":{"line":246,"column":5}},"138":{"start":{"line":241,"column":6},"end":{"line":245,"column":9}},"139":{"start":{"line":242,"column":8},"end":{"line":244,"column":9}},"140":{"start":{"line":243,"column":10},"end":{"line":243,"column":46}},"141":{"start":{"line":248,"column":2},"end":{"line":248,"column":24}},"142":{"start":{"line":252,"column":21},"end":{"line":261,"column":8}},"143":{"start":{"line":253,"column":21},"end":{"line":253,"column":29}},"144":{"start":{"line":255,"column":4},"end":{"line":258,"column":5}},"145":{"start":{"line":256,"column":6},"end":{"line":256,"column":53}},"146":{"start":{"line":256,"column":32},"end":{"line":256,"column":53}},"147":{"start":{"line":257,"column":6},"end":{"line":257,"column":32}},"148":{"start":{"line":260,"column":4},"end":{"line":260,"column":17}},"149":{"start":{"line":262,"column":2},"end":{"line":262,"column":61}},"150":{"start":{"line":262,"column":47},"end":{"line":262,"column":59}},"151":{"start":{"line":271,"column":6},"end":{"line":271,"column":13}},"152":{"start":{"line":273,"column":2},"end":{"line":275,"column":3}},"153":{"start":{"line":274,"column":4},"end":{"line":274,"column":19}},"154":{"start":{"line":277,"column":17},"end":{"line":277,"column":74}},"155":{"start":{"line":277,"column":25},"end":{"line":277,"column":74}},"156":{"start":{"line":277,"column":45},"end":{"line":277,"column":73}},"157":{"start":{"line":279,"column":2},"end":{"line":284,"column":4}},"158":{"start":{"line":288,"column":2},"end":{"line":288,"column":64}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":39,"column":9},"end":{"line":39,"column":31}},"loc":{"start":{"line":39,"column":37},"end":{"line":39,"column":95}},"line":39},"1":{"name":"keywordReplace","decl":{"start":{"line":41,"column":9},"end":{"line":41,"column":23}},"loc":{"start":{"line":41,"column":41},"end":{"line":54,"column":1}},"line":41},"2":{"name":"(anonymous_2)","decl":{"start":{"line":43,"column":34},"end":{"line":43,"column":35}},"loc":{"start":{"line":43,"column":49},"end":{"line":46,"column":5}},"line":43},"3":{"name":"(anonymous_3)","decl":{"start":{"line":47,"column":34},"end":{"line":47,"column":35}},"loc":{"start":{"line":47,"column":49},"end":{"line":50,"column":5}},"line":47},"4":{"name":"convertClientNameToId","decl":{"start":{"line":56,"column":9},"end":{"line":56,"column":30}},"loc":{"start":{"line":56,"column":46},"end":{"line":59,"column":1}},"line":56},"5":{"name":"(anonymous_5)","decl":{"start":{"line":57,"column":29},"end":{"line":57,"column":30}},"loc":{"start":{"line":57,"column":34},"end":{"line":57,"column":49}},"line":57},"6":{"name":"convertClientNamesToIds","decl":{"start":{"line":61,"column":9},"end":{"line":61,"column":32}},"loc":{"start":{"line":61,"column":49},"end":{"line":77,"column":1}},"line":61},"7":{"name":"(anonymous_7)","decl":{"start":{"line":62,"column":34},"end":{"line":62,"column":35}},"loc":{"start":{"line":62,"column":43},"end":{"line":65,"column":3}},"line":62},"8":{"name":"(anonymous_8)","decl":{"start":{"line":66,"column":32},"end":{"line":66,"column":33}},"loc":{"start":{"line":66,"column":49},"end":{"line":74,"column":3}},"line":66},"9":{"name":"(anonymous_9)","decl":{"start":{"line":68,"column":44},"end":{"line":68,"column":45}},"loc":{"start":{"line":68,"column":52},"end":{"line":68,"column":77}},"line":68},"10":{"name":"(anonymous_10)","decl":{"start":{"line":75,"column":42},"end":{"line":75,"column":43}},"loc":{"start":{"line":75,"column":50},"end":{"line":75,"column":64}},"line":75},"11":{"name":"(anonymous_11)","decl":{"start":{"line":75,"column":70},"end":{"line":75,"column":71}},"loc":{"start":{"line":75,"column":78},"end":{"line":75,"column":87}},"line":75},"12":{"name":"loadFile","decl":{"start":{"line":79,"column":9},"end":{"line":79,"column":17}},"loc":{"start":{"line":79,"column":34},"end":{"line":93,"column":1}},"line":79},"13":{"name":"flatten","decl":{"start":{"line":95,"column":9},"end":{"line":95,"column":16}},"loc":{"start":{"line":95,"column":23},"end":{"line":97,"column":1}},"line":95},"14":{"name":"(anonymous_14)","decl":{"start":{"line":96,"column":21},"end":{"line":96,"column":22}},"loc":{"start":{"line":96,"column":31},"end":{"line":96,"column":74}},"line":96},"15":{"name":"dumpJSON","decl":{"start":{"line":99,"column":9},"end":{"line":99,"column":17}},"loc":{"start":{"line":99,"column":36},"end":{"line":101,"column":1}},"line":99},"16":{"name":"processChangedObjectFields","decl":{"start":{"line":103,"column":9},"end":{"line":103,"column":35}},"loc":{"start":{"line":103,"column":123},"end":{"line":130,"column":1}},"line":103},"17":{"name":"calcChanges","decl":{"start":{"line":132,"column":9},"end":{"line":132,"column":20}},"loc":{"start":{"line":132,"column":118},"end":{"line":212,"column":1}},"line":132},"18":{"name":"(anonymous_18)","decl":{"start":{"line":138,"column":25},"end":{"line":138,"column":26}},"loc":{"start":{"line":138,"column":46},"end":{"line":150,"column":4}},"line":138},"19":{"name":"(anonymous_19)","decl":{"start":{"line":138,"column":55},"end":{"line":138,"column":56}},"loc":{"start":{"line":138,"column":60},"end":{"line":150,"column":3}},"line":138},"20":{"name":"(anonymous_20)","decl":{"start":{"line":140,"column":29},"end":{"line":140,"column":30}},"loc":{"start":{"line":140,"column":34},"end":{"line":140,"column":38}},"line":140},"21":{"name":"(anonymous_21)","decl":{"start":{"line":142,"column":23},"end":{"line":142,"column":24}},"loc":{"start":{"line":142,"column":28},"end":{"line":142,"column":29}},"line":142},"22":{"name":"(anonymous_22)","decl":{"start":{"line":152,"column":24},"end":{"line":152,"column":25}},"loc":{"start":{"line":152,"column":37},"end":{"line":181,"column":3}},"line":152},"23":{"name":"(anonymous_23)","decl":{"start":{"line":153,"column":16},"end":{"line":153,"column":17}},"loc":{"start":{"line":153,"column":25},"end":{"line":180,"column":5}},"line":153},"24":{"name":"(anonymous_24)","decl":{"start":{"line":157,"column":30},"end":{"line":157,"column":31}},"loc":{"start":{"line":157,"column":35},"end":{"line":157,"column":43}},"line":157},"25":{"name":"(anonymous_25)","decl":{"start":{"line":159,"column":25},"end":{"line":159,"column":26}},"loc":{"start":{"line":159,"column":30},"end":{"line":159,"column":31}},"line":159},"26":{"name":"(anonymous_26)","decl":{"start":{"line":170,"column":27},"end":{"line":170,"column":28}},"loc":{"start":{"line":170,"column":32},"end":{"line":170,"column":43}},"line":170},"27":{"name":"(anonymous_27)","decl":{"start":{"line":171,"column":33},"end":{"line":171,"column":34}},"loc":{"start":{"line":171,"column":38},"end":{"line":171,"column":49}},"line":171},"28":{"name":"(anonymous_28)","decl":{"start":{"line":172,"column":46},"end":{"line":172,"column":47}},"loc":{"start":{"line":172,"column":58},"end":{"line":175,"column":13}},"line":172},"29":{"name":"(anonymous_29)","decl":{"start":{"line":190,"column":25},"end":{"line":190,"column":26}},"loc":{"start":{"line":190,"column":30},"end":{"line":203,"column":5}},"line":190},"30":{"name":"(anonymous_30)","decl":{"start":{"line":191,"column":35},"end":{"line":191,"column":36}},"loc":{"start":{"line":191,"column":40},"end":{"line":191,"column":88}},"line":191},"31":{"name":"(anonymous_31)","decl":{"start":{"line":194,"column":41},"end":{"line":194,"column":42}},"loc":{"start":{"line":194,"column":46},"end":{"line":194,"column":94}},"line":194},"32":{"name":"stripFields","decl":{"start":{"line":214,"column":9},"end":{"line":214,"column":20}},"loc":{"start":{"line":214,"column":34},"end":{"line":233,"column":1}},"line":214},"33":{"name":"(anonymous_33)","decl":{"start":{"line":218,"column":17},"end":{"line":218,"column":18}},"loc":{"start":{"line":218,"column":22},"end":{"line":224,"column":3}},"line":218},"34":{"name":"(anonymous_34)","decl":{"start":{"line":227,"column":64},"end":{"line":227,"column":65}},"loc":{"start":{"line":227,"column":74},"end":{"line":227,"column":88}},"line":227},"35":{"name":"getEnabledClients","decl":{"start":{"line":235,"column":9},"end":{"line":235,"column":26}},"loc":{"start":{"line":235,"column":66},"end":{"line":249,"column":1}},"line":235},"36":{"name":"(anonymous_36)","decl":{"start":{"line":238,"column":103},"end":{"line":238,"column":104}},"loc":{"start":{"line":238,"column":111},"end":{"line":238,"column":174}},"line":238},"37":{"name":"(anonymous_37)","decl":{"start":{"line":239,"column":19},"end":{"line":239,"column":20}},"loc":{"start":{"line":239,"column":27},"end":{"line":247,"column":3}},"line":239},"38":{"name":"(anonymous_38)","decl":{"start":{"line":241,"column":30},"end":{"line":241,"column":31}},"loc":{"start":{"line":241,"column":48},"end":{"line":245,"column":7}},"line":241},"39":{"name":"duplicateItems","decl":{"start":{"line":251,"column":9},"end":{"line":251,"column":23}},"loc":{"start":{"line":251,"column":34},"end":{"line":263,"column":1}},"line":251},"40":{"name":"(anonymous_40)","decl":{"start":{"line":252,"column":32},"end":{"line":252,"column":33}},"loc":{"start":{"line":252,"column":48},"end":{"line":261,"column":3}},"line":252},"41":{"name":"(anonymous_41)","decl":{"start":{"line":262,"column":42},"end":{"line":262,"column":43}},"loc":{"start":{"line":262,"column":47},"end":{"line":262,"column":59}},"line":262},"42":{"name":"filterExcluded","decl":{"start":{"line":265,"column":9},"end":{"line":265,"column":23}},"loc":{"start":{"line":265,"column":42},"end":{"line":285,"column":1}},"line":265},"43":{"name":"(anonymous_43)","decl":{"start":{"line":277,"column":17},"end":{"line":277,"column":18}},"loc":{"start":{"line":277,"column":25},"end":{"line":277,"column":74}},"line":277},"44":{"name":"(anonymous_44)","decl":{"start":{"line":277,"column":37},"end":{"line":277,"column":38}},"loc":{"start":{"line":277,"column":45},"end":{"line":277,"column":73}},"line":277},"45":{"name":"areArraysEquals","decl":{"start":{"line":287,"column":9},"end":{"line":287,"column":24}},"loc":{"start":{"line":287,"column":31},"end":{"line":289,"column":1}},"line":287}},"branchMap":{"0":{"loc":{"start":{"line":39,"column":46},"end":{"line":39,"column":92}},"type":"cond-expr","locations":[{"start":{"line":39,"column":70},"end":{"line":39,"column":73}},{"start":{"line":39,"column":76},"end":{"line":39,"column":92}}],"line":39},"1":{"loc":{"start":{"line":39,"column":46},"end":{"line":39,"column":67}},"type":"binary-expr","locations":[{"start":{"line":39,"column":46},"end":{"line":39,"column":49}},{"start":{"line":39,"column":53},"end":{"line":39,"column":67}}],"line":39},"2":{"loc":{"start":{"line":42,"column":2},"end":{"line":51,"column":3}},"type":"if","locations":[{"start":{"line":42,"column":2},"end":{"line":51,"column":3}},{"start":{"line":42,"column":2},"end":{"line":51,"column":3}}],"line":42},"3":{"loc":{"start":{"line":42,"column":6},"end":{"line":42,"column":50}},"type":"binary-expr","locations":[{"start":{"line":42,"column":6},"end":{"line":42,"column":14}},{"start":{"line":42,"column":18},"end":{"line":42,"column":50}}],"line":42},"4":{"loc":{"start":{"line":58,"column":9},"end":{"line":58,"column":41}},"type":"binary-expr","locations":[{"start":{"line":58,"column":9},"end":{"line":58,"column":14}},{"start":{"line":58,"column":18},"end":{"line":58,"column":33}},{"start":{"line":58,"column":37},"end":{"line":58,"column":41}}],"line":58},"5":{"loc":{"start":{"line":67,"column":4},"end":{"line":71,"column":5}},"type":"if","locations":[{"start":{"line":67,"column":4},"end":{"line":71,"column":5}},{"start":{"line":67,"column":4},"end":{"line":71,"column":5}}],"line":67},"6":{"loc":{"start":{"line":85,"column":4},"end":{"line":87,"column":5}},"type":"if","locations":[{"start":{"line":85,"column":4},"end":{"line":87,"column":5}},{"start":{"line":85,"column":4},"end":{"line":87,"column":5}}],"line":85},"7":{"loc":{"start":{"line":96,"column":40},"end":{"line":96,"column":73}},"type":"cond-expr","locations":[{"start":{"line":96,"column":59},"end":{"line":96,"column":69}},{"start":{"line":96,"column":72},"end":{"line":96,"column":73}}],"line":96},"8":{"loc":{"start":{"line":99,"column":23},"end":{"line":99,"column":34}},"type":"default-arg","locations":[{"start":{"line":99,"column":33},"end":{"line":99,"column":34}}],"line":99},"9":{"loc":{"start":{"line":103,"column":83},"end":{"line":103,"column":100}},"type":"default-arg","locations":[{"start":{"line":103,"column":98},"end":{"line":103,"column":100}}],"line":103},"10":{"loc":{"start":{"line":103,"column":102},"end":{"line":103,"column":121}},"type":"default-arg","locations":[{"start":{"line":103,"column":116},"end":{"line":103,"column":121}}],"line":103},"11":{"loc":{"start":{"line":108,"column":4},"end":{"line":126,"column":5}},"type":"if","locations":[{"start":{"line":108,"column":4},"end":{"line":126,"column":5}},{"start":{"line":108,"column":4},"end":{"line":126,"column":5}}],"line":108},"12":{"loc":{"start":{"line":108,"column":8},"end":{"line":108,"column":88}},"type":"binary-expr","locations":[{"start":{"line":108,"column":8},"end":{"line":108,"column":36}},{"start":{"line":108,"column":40},"end":{"line":108,"column":88}}],"line":108},"13":{"loc":{"start":{"line":109,"column":6},"end":{"line":119,"column":7}},"type":"if","locations":[{"start":{"line":109,"column":6},"end":{"line":119,"column":7}},{"start":{"line":109,"column":6},"end":{"line":119,"column":7}}],"line":109},"14":{"loc":{"start":{"line":111,"column":10},"end":{"line":117,"column":11}},"type":"if","locations":[{"start":{"line":111,"column":10},"end":{"line":117,"column":11}},{"start":{"line":111,"column":10},"end":{"line":117,"column":11}}],"line":111},"15":{"loc":{"start":{"line":112,"column":12},"end":{"line":116,"column":13}},"type":"if","locations":[{"start":{"line":112,"column":12},"end":{"line":116,"column":13}},{"start":{"line":112,"column":12},"end":{"line":116,"column":13}}],"line":112},"16":{"loc":{"start":{"line":120,"column":11},"end":{"line":126,"column":5}},"type":"if","locations":[{"start":{"line":120,"column":11},"end":{"line":126,"column":5}},{"start":{"line":120,"column":11},"end":{"line":126,"column":5}}],"line":120},"17":{"loc":{"start":{"line":132,"column":48},"end":{"line":132,"column":76}},"type":"default-arg","locations":[{"start":{"line":132,"column":62},"end":{"line":132,"column":76}}],"line":132},"18":{"loc":{"start":{"line":132,"column":78},"end":{"line":132,"column":95}},"type":"default-arg","locations":[{"start":{"line":132,"column":93},"end":{"line":132,"column":95}}],"line":132},"19":{"loc":{"start":{"line":132,"column":97},"end":{"line":132,"column":116}},"type":"default-arg","locations":[{"start":{"line":132,"column":111},"end":{"line":132,"column":116}}],"line":132},"20":{"loc":{"start":{"line":139,"column":4},"end":{"line":147,"column":5}},"type":"if","locations":[{"start":{"line":139,"column":4},"end":{"line":147,"column":5}},{"start":{"line":139,"column":4},"end":{"line":147,"column":5}}],"line":139},"21":{"loc":{"start":{"line":142,"column":6},"end":{"line":144,"column":7}},"type":"if","locations":[{"start":{"line":142,"column":6},"end":{"line":144,"column":7}},{"start":{"line":142,"column":6},"end":{"line":144,"column":7}}],"line":142},"22":{"loc":{"start":{"line":156,"column":6},"end":{"line":164,"column":7}},"type":"if","locations":[{"start":{"line":156,"column":6},"end":{"line":164,"column":7}},{"start":{"line":156,"column":6},"end":{"line":164,"column":7}}],"line":156},"23":{"loc":{"start":{"line":159,"column":8},"end":{"line":161,"column":9}},"type":"if","locations":[{"start":{"line":159,"column":8},"end":{"line":161,"column":9}},{"start":{"line":159,"column":8},"end":{"line":161,"column":9}}],"line":159},"24":{"loc":{"start":{"line":166,"column":6},"end":{"line":179,"column":7}},"type":"if","locations":[{"start":{"line":166,"column":6},"end":{"line":179,"column":7}},{"start":{"line":166,"column":6},"end":{"line":179,"column":7}}],"line":166},"25":{"loc":{"start":{"line":169,"column":8},"end":{"line":178,"column":9}},"type":"if","locations":[{"start":{"line":169,"column":8},"end":{"line":178,"column":9}},{"start":{"line":169,"column":8},"end":{"line":178,"column":9}}],"line":169},"26":{"loc":{"start":{"line":173,"column":14},"end":{"line":173,"column":46}},"type":"if","locations":[{"start":{"line":173,"column":14},"end":{"line":173,"column":46}},{"start":{"line":173,"column":14},"end":{"line":173,"column":46}}],"line":173},"27":{"loc":{"start":{"line":176,"column":16},"end":{"line":176,"column":122}},"type":"cond-expr","locations":[{"start":{"line":176,"column":38},"end":{"line":176,"column":114}},{"start":{"line":176,"column":117},"end":{"line":176,"column":122}}],"line":176},"28":{"loc":{"start":{"line":187,"column":2},"end":{"line":204,"column":3}},"type":"if","locations":[{"start":{"line":187,"column":2},"end":{"line":204,"column":3}},{"start":{"line":187,"column":2},"end":{"line":204,"column":3}}],"line":187},"29":{"loc":{"start":{"line":191,"column":40},"end":{"line":191,"column":88}},"type":"binary-expr","locations":[{"start":{"line":191,"column":40},"end":{"line":191,"column":57}},{"start":{"line":191,"column":61},"end":{"line":191,"column":88}}],"line":191},"30":{"loc":{"start":{"line":193,"column":6},"end":{"line":202,"column":7}},"type":"if","locations":[{"start":{"line":193,"column":6},"end":{"line":202,"column":7}},{"start":{"line":193,"column":6},"end":{"line":202,"column":7}}],"line":193},"31":{"loc":{"start":{"line":194,"column":46},"end":{"line":194,"column":94}},"type":"binary-expr","locations":[{"start":{"line":194,"column":46},"end":{"line":194,"column":63}},{"start":{"line":194,"column":67},"end":{"line":194,"column":94}}],"line":194},"32":{"loc":{"start":{"line":196,"column":8},"end":{"line":201,"column":9}},"type":"if","locations":[{"start":{"line":196,"column":8},"end":{"line":201,"column":9}},{"start":{"line":196,"column":8},"end":{"line":201,"column":9}}],"line":196},"33":{"loc":{"start":{"line":219,"column":4},"end":{"line":223,"column":5}},"type":"if","locations":[{"start":{"line":219,"column":4},"end":{"line":223,"column":5}},{"start":{"line":219,"column":4},"end":{"line":223,"column":5}}],"line":219},"34":{"loc":{"start":{"line":226,"column":2},"end":{"line":230,"column":3}},"type":"if","locations":[{"start":{"line":226,"column":2},"end":{"line":230,"column":3}},{"start":{"line":226,"column":2},"end":{"line":230,"column":3}}],"line":226},"35":{"loc":{"start":{"line":227,"column":74},"end":{"line":227,"column":88}},"type":"binary-expr","locations":[{"start":{"line":227,"column":74},"end":{"line":227,"column":83}},{"start":{"line":227,"column":87},"end":{"line":227,"column":88}}],"line":227},"36":{"loc":{"start":{"line":236,"column":33},"end":{"line":236,"column":79}},"type":"binary-expr","locations":[{"start":{"line":236,"column":33},"end":{"line":236,"column":47}},{"start":{"line":236,"column":51},"end":{"line":236,"column":73}},{"start":{"line":236,"column":77},"end":{"line":236,"column":79}}],"line":236},"37":{"loc":{"start":{"line":238,"column":53},"end":{"line":238,"column":85}},"type":"binary-expr","locations":[{"start":{"line":238,"column":53},"end":{"line":238,"column":79}},{"start":{"line":238,"column":83},"end":{"line":238,"column":85}}],"line":238},"38":{"loc":{"start":{"line":240,"column":4},"end":{"line":246,"column":5}},"type":"if","locations":[{"start":{"line":240,"column":4},"end":{"line":246,"column":5}},{"start":{"line":240,"column":4},"end":{"line":246,"column":5}}],"line":240},"39":{"loc":{"start":{"line":242,"column":8},"end":{"line":244,"column":9}},"type":"if","locations":[{"start":{"line":242,"column":8},"end":{"line":244,"column":9}},{"start":{"line":242,"column":8},"end":{"line":244,"column":9}}],"line":242},"40":{"loc":{"start":{"line":255,"column":4},"end":{"line":258,"column":5}},"type":"if","locations":[{"start":{"line":255,"column":4},"end":{"line":258,"column":5}},{"start":{"line":255,"column":4},"end":{"line":258,"column":5}}],"line":255},"41":{"loc":{"start":{"line":256,"column":6},"end":{"line":256,"column":53}},"type":"if","locations":[{"start":{"line":256,"column":6},"end":{"line":256,"column":53}},{"start":{"line":256,"column":6},"end":{"line":256,"column":53}}],"line":256},"42":{"loc":{"start":{"line":273,"column":2},"end":{"line":275,"column":3}},"type":"if","locations":[{"start":{"line":273,"column":2},"end":{"line":275,"column":3}},{"start":{"line":273,"column":2},"end":{"line":275,"column":3}}],"line":273},"43":{"loc":{"start":{"line":288,"column":34},"end":{"line":288,"column":47}},"type":"binary-expr","locations":[{"start":{"line":288,"column":34},"end":{"line":288,"column":35}},{"start":{"line":288,"column":39},"end":{"line":288,"column":47}}],"line":288},"44":{"loc":{"start":{"line":288,"column":49},"end":{"line":288,"column":62}},"type":"binary-expr","locations":[{"start":{"line":288,"column":49},"end":{"line":288,"column":50}},{"start":{"line":288,"column":54},"end":{"line":288,"column":62}}],"line":288}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":1,"21":1,"22":1,"23":5,"24":138,"25":130,"26":160,"27":160,"28":130,"29":160,"30":160,"31":138,"32":4,"33":7,"34":4,"35":34,"36":23,"37":34,"38":42,"39":23,"40":37,"41":23,"42":23,"43":42,"44":34,"45":23,"46":1,"47":34,"48":170,"49":170,"50":170,"51":168,"52":108,"53":60,"54":2,"55":16,"56":996,"57":123,"58":8,"59":8,"60":8,"61":2,"62":2,"63":6,"64":2,"65":1,"66":1,"67":6,"68":2,"69":4,"70":4,"71":8,"72":81,"73":81,"74":81,"75":81,"76":81,"77":81,"78":92,"79":31,"80":62,"81":31,"82":62,"83":31,"84":61,"85":0,"86":81,"87":158,"88":151,"89":14,"90":28,"91":14,"92":27,"93":12,"94":137,"95":151,"96":81,"97":81,"98":32,"99":38,"100":32,"101":39,"102":32,"103":58,"104":54,"105":58,"106":81,"107":158,"108":81,"109":59,"110":59,"111":59,"112":57,"113":27,"114":57,"115":57,"116":53,"117":57,"118":3,"119":3,"120":81,"121":16,"122":16,"123":16,"124":47,"125":37,"126":37,"127":16,"128":16,"129":64,"130":16,"131":16,"132":12,"133":12,"134":12,"135":12,"136":12,"137":12,"138":6,"139":4,"140":2,"141":12,"142":124,"143":188,"144":188,"145":130,"146":114,"147":130,"148":188,"149":124,"150":114,"151":20,"152":20,"153":17,"154":3,"155":12,"156":14,"157":3,"158":0},"f":{"0":5,"1":138,"2":160,"3":160,"4":4,"5":7,"6":34,"7":23,"8":42,"9":37,"10":23,"11":1,"12":170,"13":16,"14":996,"15":123,"16":8,"17":81,"18":81,"19":92,"20":62,"21":62,"22":158,"23":151,"24":28,"25":27,"26":38,"27":39,"28":58,"29":57,"30":27,"31":53,"32":16,"33":47,"34":64,"35":12,"36":12,"37":12,"38":4,"39":124,"40":188,"41":114,"42":20,"43":12,"44":14,"45":0},"b":{"0":[0,5],"1":[5,5],"2":[130,8],"3":[138,130],"4":[4,2,2],"5":[23,19],"6":[108,60],"7":[13,983],"8":[122],"9":[0],"10":[0],"11":[2,6],"12":[8,4],"13":[2,0],"14":[2,4],"15":[1,1],"16":[2,4],"17":[0],"18":[35],"19":[77],"20":[31,61],"21":[31,0],"22":[14,137],"23":[12,2],"24":[81,70],"25":[32,49],"26":[54,4],"27":[8,24],"28":[59,22],"29":[27,0],"30":[57,0],"31":[53,22],"32":[3,54],"33":[37,10],"34":[16,0],"35":[64,58],"36":[12,3,10],"37":[12,4],"38":[6,6],"39":[2,2],"40":[130,58],"41":[114,16],"42":[17,3],"43":[0,0],"44":[0,0]},"inputSourceMap":{"version":3,"sources":["utils.js"],"names":["keywordReplace","convertClientNameToId","convertClientNamesToIds","loadFile","flatten","dumpJSON","calcChanges","stripFields","getEnabledClients","duplicateItems","filterExcluded","areArraysEquals","input","mappings","Object","keys","length","forEach","key","re","RegExp","replace","JSON","stringify","name","clients","found","find","c","client_id","names","resolvedNames","map","resolved","result","reduce","acc","client","includes","index","findIndex","item","push","unresolved","filter","file","f","path","resolve","fs","accessSync","F_OK","readFileSync","error","Error","list","a","b","concat","Array","isArray","obj","spacing","processChangedObjectFields","handler","desiredAssetState","currentAssetState","objectFields","allowDelete","desiredAssetStateWithChanges","fieldName","currentObjectFieldPropertyName","undefined","log","warn","objString","assets","existing","identifiers","update","del","create","conflicts","findByKeyValue","value","arr","e","values","k","every","v","join","processAssets","id","asset","assetIdValue","i","uniqueID","futureAssets","inDeleted","conflict","temp","Math","random","toString","substr","fields","stripped","newObj","dotProp","get","delete","n","debug","connection","excludedClientsByNames","exclude","excludedClients","enabledClients","enabled_clients","conn","excludedClient","duplicates","accum","keyValue","g","changes","x","y","_","isEqual","sort"],"mappings":"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","sourceRoot":"/home/circleci/repo/src/tools/","sourcesContent":["import path from 'path';\nimport fs from 'fs';\nimport dotProp from 'dot-prop';\nimport _ from 'lodash';\nimport log from './logger';\n\nexport function keywordReplace(input, mappings) {\n  // Replace keywords with mappings within input.\n  if (mappings && Object.keys(mappings).length > 0) {\n    Object.keys(mappings).forEach(function(key) {\n      const re = new RegExp(`##${key}##`, 'g');\n      input = input.replace(re, mappings[key]);\n    });\n\n    Object.keys(mappings).forEach(function(key) {\n      const re = new RegExp(`@@${key}@@`, 'g');\n      input = input.replace(re, JSON.stringify(mappings[key]));\n    });\n  }\n  return input;\n}\n\nexport function convertClientNameToId(name, clients) {\n  const found = clients.find((c) => c.name === name);\n  return (found && found.client_id) || name;\n}\n\nexport function convertClientNamesToIds(names, clients) {\n  const resolvedNames = names.map((name) => ({ name, resolved: false }));\n  const result = clients.reduce((acc, client) => {\n    if (names.includes(client.name)) {\n      const index = resolvedNames.findIndex((item) => item.name === client.name);\n      resolvedNames[index].resolved = true;\n      acc.push(client.client_id);\n    }\n    return acc;\n  }, []);\n  const unresolved = resolvedNames.filter((item) => !item.resolved).map((item) => item.name);\n  return [ ...unresolved, ...result ];\n}\n\nexport function loadFile(file, mappings) {\n  // Load file and replace keyword mappings\n  const f = path.resolve(file);\n  try {\n    fs.accessSync(f, fs.F_OK);\n    if (mappings) {\n      return keywordReplace(fs.readFileSync(f, 'utf8'), mappings);\n    }\n    return fs.readFileSync(f, 'utf8');\n  } catch (error) {\n    throw new Error(`Unable to load file ${f} due to ${error}`);\n  }\n}\n\nexport function flatten(list) {\n  // Flatten an multiple arrays to single array\n  return list.reduce((a, b) => a.concat(Array.isArray(b) ? flatten(b) : b), []);\n}\n\nexport function dumpJSON(obj, spacing = 0) {\n  return JSON.stringify(obj, null, spacing);\n}\n\n/**\n * @template T\n * @param {typeof import('./auth0/handlers/default').default} handler\n * @param {T} desiredAssetState\n * @param {T} currentAssetState\n * @param {string[]} [objectFields=[]]\n * @param {boolean} [allowDelete=false]\n * @returns T\n */\nfunction processChangedObjectFields(handler, desiredAssetState, currentAssetState, objectFields = [], allowDelete = false) {\n  const desiredAssetStateWithChanges = { ...desiredAssetState };\n\n  // eslint-disable-next-line no-restricted-syntax\n  for (const fieldName of objectFields) {\n    // A desired state that omits the objectField OR that has it as an empty object should\n    // signal that all fields should be removed (subject to ALLOW_DELETE).\n    if (desiredAssetState[fieldName] && Object.keys(desiredAssetState[fieldName]).length) {\n      // Both the current and desired state have the object field. Here's where we need to map\n      // to the APIv2 protocol of setting `null` values for deleted fields.\n      // For new and modified properties of the object field, we can just pass them through to\n      // APIv2.\n      if (currentAssetState[fieldName]) {\n        // eslint-disable-next-line no-restricted-syntax\n        for (const currentObjectFieldPropertyName of Object.keys(\n          currentAssetState[fieldName]\n        )) {\n          if (desiredAssetState[fieldName][currentObjectFieldPropertyName] === undefined) {\n            if (allowDelete) {\n              desiredAssetStateWithChanges[fieldName][\n                currentObjectFieldPropertyName\n              ] = null;\n            } else {\n              log.warn(\n                `Detected that the ${fieldName} of the following ${\n                  handler.name\n                } should be deleted. Doing so may be destructive.\\nYou can enable deletes by setting 'AUTH0_ALLOW_DELETE' to true in the config\\n${handler.objString(\n                  currentAssetState\n                )}`\n              );\n            }\n          }\n        }\n      }\n    } else if (allowDelete) {\n      // If the desired state does not have the object field and the current state does, we\n      // should mark *all* properties for deletion by specifying an empty object.\n      //\n      // See: https://auth0.com/docs/users/metadata/manage-metadata-api#delete-user-metadata\n      desiredAssetStateWithChanges[fieldName] = {};\n    } else {\n      delete desiredAssetStateWithChanges[fieldName];\n      log.warn(\n        `Detected that the ${fieldName} of the following ${\n          handler.name\n        } should be emptied. Doing so may be destructive.\\nYou can enable deletes by setting 'AUTH0_ALLOW_DELETE' to true in the config\\n${handler.objString(\n          currentAssetState\n        )}`\n      );\n    }\n  }\n\n  return desiredAssetStateWithChanges;\n}\n\nexport function calcChanges(handler, assets, existing, identifiers = [ 'id', 'name' ], objectFields = [], allowDelete = false) {\n  // Calculate the changes required between two sets of assets.\n  const update = [];\n  let del = [ ...existing ];\n  let create = [ ...assets ];\n  const conflicts = [];\n\n  const findByKeyValue = (key, value, arr) => arr.find((e) => {\n    if (Array.isArray(key)) {\n      const values = key.map((k) => e[k]);\n      if (values.every((v) => v)) {\n        return value === values.join('-');\n      }\n    } else {\n      return e[key] === value;\n    }\n    return false;\n  });\n\n  const processAssets = (id, arr) => {\n    arr.forEach((asset) => {\n      let assetIdValue;\n      if (Array.isArray(id)) {\n        const values = id.map((i) => asset[i]);\n        if (values.every((v) => v)) {\n          assetIdValue = values.join('-');\n        }\n      } else {\n        assetIdValue = asset[id];\n      }\n\n      if (assetIdValue) {\n        const found = findByKeyValue(id, assetIdValue, del);\n        if (found) {\n          // Delete from existing\n          del = del.filter((e) => e !== found);\n\n          // Delete from create as it's an update\n          create = create.filter((e) => e !== asset);\n\n          // Append identifiers to asset\n          update.push({\n            ...identifiers.reduce((obj, i) => {\n              if (found[i]) obj[i] = found[i];\n              return obj;\n            }, {}),\n            // If we have any object fields, we need to make sure that they get\n            // special treatment. When different metadata objects are passed to APIv2\n            // properties must explicitly be marked for deletion by indicating a `null`\n            // value.\n            ...(objectFields.length\n              ? processChangedObjectFields(handler, asset, found, objectFields, allowDelete)\n              : asset)\n          });\n        }\n      }\n    });\n  };\n\n  // Loop through identifiers (in order) to try match assets to existing\n  // If existing then update if not create\n  // The remainder will be deleted\n  for (const id of identifiers) { // eslint-disable-line\n    processAssets(id, [ ...create ]);\n  }\n\n  // Check if there are assets with names that will conflict with existing names during the update process\n  // This will rename those assets to a temp random name first\n  // This assumes the first identifiers is the unique identifier\n  if (identifiers.includes('name')) {\n    const uniqueID = identifiers[0];\n    const futureAssets = [ ...create, ...update ];\n    futureAssets.forEach((a) => {\n      // If the conflicting item is going to be deleted then skip\n      const inDeleted = del.filter((e) => e.name === a.name && e[uniqueID] !== a[uniqueID])[0];\n      if (!inDeleted) {\n        const conflict = existing.filter((e) => e.name === a.name && e[uniqueID] !== a[uniqueID])[0];\n        if (conflict) {\n          const temp = Math.random().toString(36).substr(2, 5);\n          conflicts.push({\n            ...conflict,\n            name: `${conflict.name}-${temp}`\n          });\n        }\n      }\n    });\n  }\n\n  return {\n    del,\n    update,\n    conflicts,\n    create\n  };\n}\n\nexport function stripFields(obj, fields) {\n  // Strip object fields supporting dot notation (ie: a.deep.field)\n  const stripped = [];\n\n  const newObj = { ...obj };\n  fields.forEach((f) => {\n    if (dotProp.get(newObj, f) !== undefined) {\n      dotProp.delete(newObj, f);\n      stripped.push(f);\n    }\n  });\n\n  if (stripped) {\n    const name = [ 'id', 'client_id', 'template', 'name' ].reduce((n, k) => newObj[k] || n, '');\n    log.debug(`Stripping \"${name}\" read-only fields ${JSON.stringify(stripped)}`);\n  }\n  return newObj;\n}\n\nexport function getEnabledClients(assets, connection, existing, clients) {\n  // Convert enabled_clients by name to the id\n  const excludedClientsByNames = (assets.exclude && assets.exclude.clients) || [];\n  const excludedClients = convertClientNamesToIds(excludedClientsByNames, clients);\n  const enabledClients = [\n    ...convertClientNamesToIds(\n      connection.enabled_clients || [],\n      clients\n    ).filter(\n      (item) => ![ ...excludedClientsByNames, ...excludedClients ].includes(item)\n    )\n  ];\n  // If client is excluded and in the existing connection this client is enabled, it should keep enabled\n  // If client is excluded and in the existing connection this client is disabled, it should keep disabled\n  existing.forEach((conn) => {\n    if (conn.name === connection.name) {\n      excludedClients.forEach((excludedClient) => {\n        if (conn.enabled_clients.includes(excludedClient)) {\n          enabledClients.push(excludedClient);\n        }\n      });\n    }\n  });\n  return enabledClients;\n}\n\nexport function duplicateItems(arr, key) {\n  // Find duplicates objects within array that have the same key value\n  const duplicates = arr.reduce((accum, obj) => {\n    const keyValue = obj[key];\n    if (keyValue) {\n      if (!(keyValue in accum)) accum[keyValue] = [];\n      accum[keyValue].push(obj);\n    }\n    return accum;\n  }, {});\n  return Object.values(duplicates).filter((g) => g.length > 1);\n}\n\nexport function filterExcluded(changes, exclude) {\n  const {\n    del, update, create, conflicts\n  } = changes;\n\n  if (!exclude.length) {\n    return changes;\n  }\n\n  const filter = (list) => list.filter((item) => !exclude.includes(item.name));\n\n  return {\n    del: filter(del),\n    update: filter(update),\n    create: filter(create),\n    conflicts: filter(conflicts)\n  };\n}\n\nexport function areArraysEquals(x, y) {\n  return _.isEqual(x && x.sort(), y && y.sort());\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"ccc5189437e780df49b3b0937d51fad1dc0cd559","contentHash":"65e3bd652bce2401a859b61399ca562f53598b2262164ecd467a31fc98b0b258"},"/home/circleci/repo/src/tools/logger.js":{"path":"/home/circleci/repo/src/tools/logger.js","statementMap":{"0":{"start":{"line":3,"column":16},"end":{"line":3,"column":34}},"1":{"start":{"line":5,"column":0},"end":{"line":5,"column":24}},"2":{"start":{"line":6,"column":15},"end":{"line":15,"column":2}},"3":{"start":{"line":16,"column":0},"end":{"line":16,"column":24}}},"fnMap":{},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":1},"f":{},"b":{},"inputSourceMap":{"version":3,"sources":["logger.js"],"names":["winston","require","emitErrs","logger","Logger","transports","Console","timestamp","level","handleExceptions","json","colorize","exitOnError","module","exports"],"mappings":";;AAAA,MAAMA,OAAO,GAAGC,OAAO,CAAC,SAAD,CAAvB;;AAEAD,OAAO,CAACE,QAAR,GAAmB,IAAnB;AAEA,MAAMC,MAAM,GAAG,IAAIH,OAAO,CAACI,MAAZ,CAAmB;AAChCC,EAAAA,UAAU,EAAE,CACV,IAAIL,OAAO,CAACK,UAAR,CAAmBC,OAAvB,CAA+B;AAC7BC,IAAAA,SAAS,EAAE,IADkB;AAE7BC,IAAAA,KAAK,EAAE,MAFsB;AAG7BC,IAAAA,gBAAgB,EAAE,IAHW;AAI7BC,IAAAA,IAAI,EAAE,KAJuB;AAK7BC,IAAAA,QAAQ,EAAE;AALmB,GAA/B,CADU,CADoB;AAUhCC,EAAAA,WAAW,EAAE;AAVmB,CAAnB,CAAf;AAaAC,MAAM,CAACC,OAAP,GAAiBX,MAAjB","sourceRoot":"/home/circleci/repo/src/tools/","sourcesContent":["const winston = require('winston');\n\nwinston.emitErrs = true;\n\nconst logger = new winston.Logger({\n  transports: [\n    new winston.transports.Console({\n      timestamp: true,\n      level: 'info',\n      handleExceptions: true,\n      json: false,\n      colorize: true\n    })\n  ],\n  exitOnError: false\n});\n\nmodule.exports = logger;\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"36155df23af5eddb652c81eea6cbb2f760da94e6","contentHash":"242b9b626263c438ee828825f5800fd2e410ea0e9cebce1fb2ec2760cffab3ca"},"/home/circleci/repo/src/tools/auth0/schema.js":{"path":"/home/circleci/repo/src/tools/auth0/schema.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":16},"end":{"line":7,"column":37}},"2":{"start":{"line":9,"column":15},"end":{"line":9,"column":49}},"3":{"start":{"line":11,"column":49},"end":{"line":11,"column":96}},"4":{"start":{"line":11,"column":84},"end":{"line":11,"column":96}},"5":{"start":{"line":11,"column":121},"end":{"line":11,"column":134}},"6":{"start":{"line":11,"column":159},"end":{"line":11,"column":172}},"7":{"start":{"line":11,"column":174},"end":{"line":11,"column":309}},"8":{"start":{"line":11,"column":234},"end":{"line":11,"column":292}},"9":{"start":{"line":13,"column":53},"end":{"line":13,"column":111}},"10":{"start":{"line":13,"column":98},"end":{"line":13,"column":109}},"11":{"start":{"line":13,"column":112},"end":{"line":13,"column":214}},"12":{"start":{"line":13,"column":188},"end":{"line":13,"column":212}},"13":{"start":{"line":13,"column":227},"end":{"line":13,"column":264}},"14":{"start":{"line":13,"column":266},"end":{"line":13,"column":321}},"15":{"start":{"line":13,"column":297},"end":{"line":13,"column":319}},"16":{"start":{"line":13,"column":335},"end":{"line":13,"column":337}},"17":{"start":{"line":13,"column":367},"end":{"line":13,"column":423}},"18":{"start":{"line":13,"column":425},"end":{"line":13,"column":726}},"19":{"start":{"line":13,"column":448},"end":{"line":13,"column":724}},"20":{"start":{"line":13,"column":534},"end":{"line":13,"column":606}},"21":{"start":{"line":13,"column":608},"end":{"line":13,"column":722}},"22":{"start":{"line":13,"column":646},"end":{"line":13,"column":687}},"23":{"start":{"line":13,"column":697},"end":{"line":13,"column":720}},"24":{"start":{"line":13,"column":727},"end":{"line":13,"column":748}},"25":{"start":{"line":13,"column":749},"end":{"line":13,"column":787}},"26":{"start":{"line":13,"column":762},"end":{"line":13,"column":785}},"27":{"start":{"line":13,"column":788},"end":{"line":13,"column":802}},"28":{"start":{"line":15,"column":20},"end":{"line":18,"column":6}},"29":{"start":{"line":16,"column":2},"end":{"line":16,"column":25}},"30":{"start":{"line":17,"column":2},"end":{"line":17,"column":13}},"31":{"start":{"line":19,"column":22},"end":{"line":25,"column":6}},"32":{"start":{"line":20,"column":2},"end":{"line":22,"column":3}},"33":{"start":{"line":21,"column":4},"end":{"line":21,"column":34}},"34":{"start":{"line":24,"column":2},"end":{"line":24,"column":13}},"35":{"start":{"line":26,"column":0},"end":{"line":38,"column":2}}},"fnMap":{"0":{"name":"_getRequireWildcardCache","decl":{"start":{"line":11,"column":9},"end":{"line":11,"column":33}},"loc":{"start":{"line":11,"column":47},"end":{"line":11,"column":311}},"line":11},"1":{"name":"(anonymous_1)","decl":{"start":{"line":11,"column":209},"end":{"line":11,"column":210}},"loc":{"start":{"line":11,"column":232},"end":{"line":11,"column":294}},"line":11},"2":{"name":"_interopRequireWildcard","decl":{"start":{"line":13,"column":9},"end":{"line":13,"column":32}},"loc":{"start":{"line":13,"column":51},"end":{"line":13,"column":804}},"line":13},"3":{"name":"(anonymous_3)","decl":{"start":{"line":15,"column":52},"end":{"line":15,"column":53}},"loc":{"start":{"line":15,"column":74},"end":{"line":18,"column":1}},"line":15},"4":{"name":"(anonymous_4)","decl":{"start":{"line":19,"column":54},"end":{"line":19,"column":55}},"loc":{"start":{"line":19,"column":76},"end":{"line":25,"column":1}},"line":19}},"branchMap":{"0":{"loc":{"start":{"line":11,"column":49},"end":{"line":11,"column":96}},"type":"if","locations":[{"start":{"line":11,"column":49},"end":{"line":11,"column":96}},{"start":{"line":11,"column":49},"end":{"line":11,"column":96}}],"line":11},"1":{"loc":{"start":{"line":11,"column":241},"end":{"line":11,"column":291}},"type":"cond-expr","locations":[{"start":{"line":11,"column":255},"end":{"line":11,"column":271}},{"start":{"line":11,"column":274},"end":{"line":11,"column":291}}],"line":11},"2":{"loc":{"start":{"line":13,"column":53},"end":{"line":13,"column":111}},"type":"if","locations":[{"start":{"line":13,"column":53},"end":{"line":13,"column":111}},{"start":{"line":13,"column":53},"end":{"line":13,"column":111}}],"line":13},"3":{"loc":{"start":{"line":13,"column":57},"end":{"line":13,"column":94}},"type":"binary-expr","locations":[{"start":{"line":13,"column":57},"end":{"line":13,"column":69}},{"start":{"line":13,"column":73},"end":{"line":13,"column":76}},{"start":{"line":13,"column":80},"end":{"line":13,"column":94}}],"line":13},"4":{"loc":{"start":{"line":13,"column":112},"end":{"line":13,"column":214}},"type":"if","locations":[{"start":{"line":13,"column":112},"end":{"line":13,"column":214}},{"start":{"line":13,"column":112},"end":{"line":13,"column":214}}],"line":13},"5":{"loc":{"start":{"line":13,"column":116},"end":{"line":13,"column":184}},"type":"binary-expr","locations":[{"start":{"line":13,"column":116},"end":{"line":13,"column":128}},{"start":{"line":13,"column":132},"end":{"line":13,"column":155}},{"start":{"line":13,"column":159},"end":{"line":13,"column":184}}],"line":13},"6":{"loc":{"start":{"line":13,"column":266},"end":{"line":13,"column":321}},"type":"if","locations":[{"start":{"line":13,"column":266},"end":{"line":13,"column":321}},{"start":{"line":13,"column":266},"end":{"line":13,"column":321}}],"line":13},"7":{"loc":{"start":{"line":13,"column":270},"end":{"line":13,"column":293}},"type":"binary-expr","locations":[{"start":{"line":13,"column":270},"end":{"line":13,"column":275}},{"start":{"line":13,"column":279},"end":{"line":13,"column":293}}],"line":13},"8":{"loc":{"start":{"line":13,"column":367},"end":{"line":13,"column":423}},"type":"binary-expr","locations":[{"start":{"line":13,"column":367},"end":{"line":13,"column":388}},{"start":{"line":13,"column":392},"end":{"line":13,"column":423}}],"line":13},"9":{"loc":{"start":{"line":13,"column":448},"end":{"line":13,"column":724}},"type":"if","locations":[{"start":{"line":13,"column":448},"end":{"line":13,"column":724}},{"start":{"line":13,"column":448},"end":{"line":13,"column":724}}],"line":13},"10":{"loc":{"start":{"line":13,"column":452},"end":{"line":13,"column":519}},"type":"binary-expr","locations":[{"start":{"line":13,"column":452},"end":{"line":13,"column":469}},{"start":{"line":13,"column":473},"end":{"line":13,"column":519}}],"line":13},"11":{"loc":{"start":{"line":13,"column":534},"end":{"line":13,"column":606}},"type":"cond-expr","locations":[{"start":{"line":13,"column":558},"end":{"line":13,"column":599}},{"start":{"line":13,"column":602},"end":{"line":13,"column":606}}],"line":13},"12":{"loc":{"start":{"line":13,"column":608},"end":{"line":13,"column":722}},"type":"if","locations":[{"start":{"line":13,"column":608},"end":{"line":13,"column":722}},{"start":{"line":13,"column":608},"end":{"line":13,"column":722}}],"line":13},"13":{"loc":{"start":{"line":13,"column":612},"end":{"line":13,"column":642}},"type":"binary-expr","locations":[{"start":{"line":13,"column":612},"end":{"line":13,"column":616}},{"start":{"line":13,"column":621},"end":{"line":13,"column":629}},{"start":{"line":13,"column":633},"end":{"line":13,"column":641}}],"line":13},"14":{"loc":{"start":{"line":13,"column":749},"end":{"line":13,"column":787}},"type":"if","locations":[{"start":{"line":13,"column":749},"end":{"line":13,"column":787}},{"start":{"line":13,"column":749},"end":{"line":13,"column":787}}],"line":13},"15":{"loc":{"start":{"line":20,"column":2},"end":{"line":22,"column":3}},"type":"if","locations":[{"start":{"line":20,"column":2},"end":{"line":22,"column":3}},{"start":{"line":20,"column":2},"end":{"line":22,"column":3}}],"line":20}},"s":{"0":1,"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":1,"10":1,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":1,"29":25,"30":25,"31":1,"32":25,"33":3,"34":25,"35":1},"f":{"0":0,"1":0,"2":1,"3":25,"4":25},"b":{"0":[0,0],"1":[0,0],"2":[1,0],"3":[1,1,1],"4":[0,0],"5":[0,0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0,0],"14":[0,0],"15":[3,22]},"inputSourceMap":{"version":3,"sources":["schema.js"],"names":["handlers","typesSchema","Object","entries","reduce","map","name","obj","schema","excludeSchema","type","$schema","properties","exclude","default","additionalProperties"],"mappings":";;;;;;AAAA;;IAAYA,Q;;;;;;AAEZ,MAAMC,WAAW,GAAGC,MAAM,CAACC,OAAP,CAAeH,QAAf,EAAyBI,MAAzB,CAAgC,CAACC,GAAD,EAAM,CAAEC,IAAF,EAAQC,GAAR,CAAN,KAAwB;AAC1EF,EAAAA,GAAG,CAACC,IAAD,CAAH,GAAYC,GAAG,CAACC,MAAhB;AACA,SAAOH,GAAP;AACD,CAHmB,EAGjB,EAHiB,CAApB;AAKA,MAAMI,aAAa,GAAGP,MAAM,CAACC,OAAP,CAAeH,QAAf,EAAyBI,MAAzB,CAAgC,CAACC,GAAD,EAAM,CAAEC,IAAF,EAAQC,GAAR,CAAN,KAAwB;AAC5E,MAAIA,GAAG,CAACE,aAAR,EAAuB;AACrBJ,IAAAA,GAAG,CAACC,IAAD,CAAH,GAAYC,GAAG,CAACE,aAAhB;AACD;;AACD,SAAOJ,GAAP;AACD,CALqB,EAKnB,EALmB,CAAtB;kBAOe;AACbK,EAAAA,IAAI,EAAE,QADO;AAEbC,EAAAA,OAAO,EAAE,yCAFI;AAGbC,EAAAA,UAAU,EAAE,EACV,GAAGX,WADO;AAEVY,IAAAA,OAAO,EAAE;AACPH,MAAAA,IAAI,EAAE,QADC;AAEPE,MAAAA,UAAU,EAAE,EAAE,GAAGH;AAAL,OAFL;AAGPK,MAAAA,OAAO,EAAE;AAHF;AAFC,GAHC;AAWbC,EAAAA,oBAAoB,EAAE;AAXT,C","sourceRoot":"/home/circleci/repo/src/tools/auth0/","sourcesContent":["import * as handlers from './handlers';\n\nconst typesSchema = Object.entries(handlers).reduce((map, [ name, obj ]) => {\n  map[name] = obj.schema; //eslint-disable-line\n  return map;\n}, {});\n\nconst excludeSchema = Object.entries(handlers).reduce((map, [ name, obj ]) => {\n  if (obj.excludeSchema) {\n    map[name] = obj.excludeSchema;\n  }\n  return map;\n}, {});\n\nexport default {\n  type: 'object',\n  $schema: 'http://json-schema.org/draft-07/schema#',\n  properties: {\n    ...typesSchema,\n    exclude: {\n      type: 'object',\n      properties: { ...excludeSchema },\n      default: {}\n    }\n  },\n  additionalProperties: false\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"5f8042b3194ef9f792f73c434f9ecedf69fddcfe","contentHash":"cf765bd3ecaea640d51640648363093636ef3929b59291e6f575f5a2e07092d1"},"/home/circleci/repo/src/tools/auth0/handlers/index.js":{"path":"/home/circleci/repo/src/tools/auth0/handlers/index.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":600}},"2":{"start":{"line":8,"column":13},"end":{"line":8,"column":31}},"3":{"start":{"line":10,"column":12},"end":{"line":10,"column":43}},"4":{"start":{"line":12,"column":20},"end":{"line":12,"column":45}},"5":{"start":{"line":14,"column":19},"end":{"line":14,"column":57}},"6":{"start":{"line":16,"column":13},"end":{"line":16,"column":31}},"7":{"start":{"line":18,"column":12},"end":{"line":18,"column":43}},"8":{"start":{"line":20,"column":13},"end":{"line":20,"column":31}},"9":{"start":{"line":22,"column":12},"end":{"line":22,"column":43}},"10":{"start":{"line":24,"column":23},"end":{"line":24,"column":51}},"11":{"start":{"line":26,"column":22},"end":{"line":26,"column":63}},"12":{"start":{"line":28,"column":17},"end":{"line":28,"column":39}},"13":{"start":{"line":30,"column":16},"end":{"line":30,"column":51}},"14":{"start":{"line":32,"column":19},"end":{"line":32,"column":43}},"15":{"start":{"line":34,"column":18},"end":{"line":34,"column":55}},"16":{"start":{"line":36,"column":15},"end":{"line":36,"column":35}},"17":{"start":{"line":38,"column":14},"end":{"line":38,"column":47}},"18":{"start":{"line":40,"column":14},"end":{"line":40,"column":33}},"19":{"start":{"line":42,"column":13},"end":{"line":42,"column":45}},"20":{"start":{"line":44,"column":21},"end":{"line":44,"column":47}},"21":{"start":{"line":46,"column":20},"end":{"line":46,"column":59}},"22":{"start":{"line":48,"column":22},"end":{"line":48,"column":49}},"23":{"start":{"line":50,"column":21},"end":{"line":50,"column":61}},"24":{"start":{"line":52,"column":20},"end":{"line":52,"column":45}},"25":{"start":{"line":54,"column":19},"end":{"line":54,"column":57}},"26":{"start":{"line":56,"column":23},"end":{"line":56,"column":51}},"27":{"start":{"line":58,"column":22},"end":{"line":58,"column":63}},"28":{"start":{"line":60,"column":31},"end":{"line":60,"column":67}},"29":{"start":{"line":62,"column":30},"end":{"line":62,"column":79}},"30":{"start":{"line":64,"column":31},"end":{"line":64,"column":67}},"31":{"start":{"line":66,"column":30},"end":{"line":66,"column":79}},"32":{"start":{"line":68,"column":24},"end":{"line":68,"column":53}},"33":{"start":{"line":70,"column":23},"end":{"line":70,"column":65}},"34":{"start":{"line":72,"column":43},"end":{"line":72,"column":91}},"35":{"start":{"line":74,"column":42},"end":{"line":74,"column":103}},"36":{"start":{"line":76,"column":39},"end":{"line":76,"column":83}},"37":{"start":{"line":78,"column":38},"end":{"line":78,"column":95}},"38":{"start":{"line":80,"column":13},"end":{"line":80,"column":31}},"39":{"start":{"line":82,"column":12},"end":{"line":82,"column":43}},"40":{"start":{"line":84,"column":16},"end":{"line":84,"column":37}},"41":{"start":{"line":86,"column":15},"end":{"line":86,"column":49}},"42":{"start":{"line":88,"column":15},"end":{"line":88,"column":35}},"43":{"start":{"line":90,"column":14},"end":{"line":90,"column":47}},"44":{"start":{"line":92,"column":18},"end":{"line":92,"column":41}},"45":{"start":{"line":94,"column":17},"end":{"line":94,"column":53}},"46":{"start":{"line":96,"column":15},"end":{"line":96,"column":35}},"47":{"start":{"line":98,"column":14},"end":{"line":98,"column":47}},"48":{"start":{"line":100,"column":16},"end":{"line":100,"column":37}},"49":{"start":{"line":102,"column":15},"end":{"line":102,"column":49}},"50":{"start":{"line":104,"column":21},"end":{"line":104,"column":47}},"51":{"start":{"line":106,"column":20},"end":{"line":106,"column":59}},"52":{"start":{"line":108,"column":49},"end":{"line":108,"column":96}},"53":{"start":{"line":108,"column":84},"end":{"line":108,"column":96}},"54":{"start":{"line":108,"column":121},"end":{"line":108,"column":134}},"55":{"start":{"line":108,"column":159},"end":{"line":108,"column":172}},"56":{"start":{"line":108,"column":174},"end":{"line":108,"column":309}},"57":{"start":{"line":108,"column":234},"end":{"line":108,"column":292}},"58":{"start":{"line":110,"column":53},"end":{"line":110,"column":111}},"59":{"start":{"line":110,"column":98},"end":{"line":110,"column":109}},"60":{"start":{"line":110,"column":112},"end":{"line":110,"column":214}},"61":{"start":{"line":110,"column":188},"end":{"line":110,"column":212}},"62":{"start":{"line":110,"column":227},"end":{"line":110,"column":264}},"63":{"start":{"line":110,"column":266},"end":{"line":110,"column":321}},"64":{"start":{"line":110,"column":297},"end":{"line":110,"column":319}},"65":{"start":{"line":110,"column":335},"end":{"line":110,"column":337}},"66":{"start":{"line":110,"column":367},"end":{"line":110,"column":423}},"67":{"start":{"line":110,"column":425},"end":{"line":110,"column":726}},"68":{"start":{"line":110,"column":448},"end":{"line":110,"column":724}},"69":{"start":{"line":110,"column":534},"end":{"line":110,"column":606}},"70":{"start":{"line":110,"column":608},"end":{"line":110,"column":722}},"71":{"start":{"line":110,"column":646},"end":{"line":110,"column":687}},"72":{"start":{"line":110,"column":697},"end":{"line":110,"column":720}},"73":{"start":{"line":110,"column":727},"end":{"line":110,"column":748}},"74":{"start":{"line":110,"column":749},"end":{"line":110,"column":787}},"75":{"start":{"line":110,"column":762},"end":{"line":110,"column":785}},"76":{"start":{"line":110,"column":788},"end":{"line":110,"column":802}},"77":{"start":{"line":112,"column":0},"end":{"line":112,"column":22}},"78":{"start":{"line":113,"column":0},"end":{"line":113,"column":36}},"79":{"start":{"line":114,"column":0},"end":{"line":114,"column":22}},"80":{"start":{"line":115,"column":0},"end":{"line":115,"column":22}},"81":{"start":{"line":116,"column":0},"end":{"line":116,"column":42}},"82":{"start":{"line":117,"column":0},"end":{"line":117,"column":26}},"83":{"start":{"line":118,"column":0},"end":{"line":118,"column":30}},"84":{"start":{"line":119,"column":0},"end":{"line":119,"column":34}},"85":{"start":{"line":120,"column":0},"end":{"line":120,"column":24}},"86":{"start":{"line":121,"column":0},"end":{"line":121,"column":38}},"87":{"start":{"line":122,"column":0},"end":{"line":122,"column":40}},"88":{"start":{"line":123,"column":0},"end":{"line":123,"column":36}},"89":{"start":{"line":124,"column":0},"end":{"line":124,"column":42}},"90":{"start":{"line":125,"column":0},"end":{"line":125,"column":58}},"91":{"start":{"line":126,"column":0},"end":{"line":126,"column":58}},"92":{"start":{"line":127,"column":0},"end":{"line":127,"column":44}},"93":{"start":{"line":128,"column":0},"end":{"line":128,"column":82}},"94":{"start":{"line":129,"column":0},"end":{"line":129,"column":74}},"95":{"start":{"line":130,"column":0},"end":{"line":130,"column":22}},"96":{"start":{"line":131,"column":0},"end":{"line":131,"column":28}},"97":{"start":{"line":132,"column":0},"end":{"line":132,"column":26}},"98":{"start":{"line":133,"column":0},"end":{"line":133,"column":32}},"99":{"start":{"line":134,"column":0},"end":{"line":134,"column":26}},"100":{"start":{"line":135,"column":0},"end":{"line":135,"column":28}},"101":{"start":{"line":136,"column":0},"end":{"line":136,"column":38}}},"fnMap":{"0":{"name":"_getRequireWildcardCache","decl":{"start":{"line":108,"column":9},"end":{"line":108,"column":33}},"loc":{"start":{"line":108,"column":47},"end":{"line":108,"column":311}},"line":108},"1":{"name":"(anonymous_1)","decl":{"start":{"line":108,"column":209},"end":{"line":108,"column":210}},"loc":{"start":{"line":108,"column":232},"end":{"line":108,"column":294}},"line":108},"2":{"name":"_interopRequireWildcard","decl":{"start":{"line":110,"column":9},"end":{"line":110,"column":32}},"loc":{"start":{"line":110,"column":51},"end":{"line":110,"column":804}},"line":110}},"branchMap":{"0":{"loc":{"start":{"line":108,"column":49},"end":{"line":108,"column":96}},"type":"if","locations":[{"start":{"line":108,"column":49},"end":{"line":108,"column":96}},{"start":{"line":108,"column":49},"end":{"line":108,"column":96}}],"line":108},"1":{"loc":{"start":{"line":108,"column":241},"end":{"line":108,"column":291}},"type":"cond-expr","locations":[{"start":{"line":108,"column":255},"end":{"line":108,"column":271}},{"start":{"line":108,"column":274},"end":{"line":108,"column":291}}],"line":108},"2":{"loc":{"start":{"line":110,"column":53},"end":{"line":110,"column":111}},"type":"if","locations":[{"start":{"line":110,"column":53},"end":{"line":110,"column":111}},{"start":{"line":110,"column":53},"end":{"line":110,"column":111}}],"line":110},"3":{"loc":{"start":{"line":110,"column":57},"end":{"line":110,"column":94}},"type":"binary-expr","locations":[{"start":{"line":110,"column":57},"end":{"line":110,"column":69}},{"start":{"line":110,"column":73},"end":{"line":110,"column":76}},{"start":{"line":110,"column":80},"end":{"line":110,"column":94}}],"line":110},"4":{"loc":{"start":{"line":110,"column":112},"end":{"line":110,"column":214}},"type":"if","locations":[{"start":{"line":110,"column":112},"end":{"line":110,"column":214}},{"start":{"line":110,"column":112},"end":{"line":110,"column":214}}],"line":110},"5":{"loc":{"start":{"line":110,"column":116},"end":{"line":110,"column":184}},"type":"binary-expr","locations":[{"start":{"line":110,"column":116},"end":{"line":110,"column":128}},{"start":{"line":110,"column":132},"end":{"line":110,"column":155}},{"start":{"line":110,"column":159},"end":{"line":110,"column":184}}],"line":110},"6":{"loc":{"start":{"line":110,"column":266},"end":{"line":110,"column":321}},"type":"if","locations":[{"start":{"line":110,"column":266},"end":{"line":110,"column":321}},{"start":{"line":110,"column":266},"end":{"line":110,"column":321}}],"line":110},"7":{"loc":{"start":{"line":110,"column":270},"end":{"line":110,"column":293}},"type":"binary-expr","locations":[{"start":{"line":110,"column":270},"end":{"line":110,"column":275}},{"start":{"line":110,"column":279},"end":{"line":110,"column":293}}],"line":110},"8":{"loc":{"start":{"line":110,"column":367},"end":{"line":110,"column":423}},"type":"binary-expr","locations":[{"start":{"line":110,"column":367},"end":{"line":110,"column":388}},{"start":{"line":110,"column":392},"end":{"line":110,"column":423}}],"line":110},"9":{"loc":{"start":{"line":110,"column":448},"end":{"line":110,"column":724}},"type":"if","locations":[{"start":{"line":110,"column":448},"end":{"line":110,"column":724}},{"start":{"line":110,"column":448},"end":{"line":110,"column":724}}],"line":110},"10":{"loc":{"start":{"line":110,"column":452},"end":{"line":110,"column":519}},"type":"binary-expr","locations":[{"start":{"line":110,"column":452},"end":{"line":110,"column":469}},{"start":{"line":110,"column":473},"end":{"line":110,"column":519}}],"line":110},"11":{"loc":{"start":{"line":110,"column":534},"end":{"line":110,"column":606}},"type":"cond-expr","locations":[{"start":{"line":110,"column":558},"end":{"line":110,"column":599}},{"start":{"line":110,"column":602},"end":{"line":110,"column":606}}],"line":110},"12":{"loc":{"start":{"line":110,"column":608},"end":{"line":110,"column":722}},"type":"if","locations":[{"start":{"line":110,"column":608},"end":{"line":110,"column":722}},{"start":{"line":110,"column":608},"end":{"line":110,"column":722}}],"line":110},"13":{"loc":{"start":{"line":110,"column":612},"end":{"line":110,"column":642}},"type":"binary-expr","locations":[{"start":{"line":110,"column":612},"end":{"line":110,"column":616}},{"start":{"line":110,"column":621},"end":{"line":110,"column":629}},{"start":{"line":110,"column":633},"end":{"line":110,"column":641}}],"line":110},"14":{"loc":{"start":{"line":110,"column":749},"end":{"line":110,"column":787}},"type":"if","locations":[{"start":{"line":110,"column":749},"end":{"line":110,"column":787}},{"start":{"line":110,"column":749},"end":{"line":110,"column":787}}],"line":110}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1,"24":1,"25":1,"26":1,"27":1,"28":1,"29":1,"30":1,"31":1,"32":1,"33":1,"34":1,"35":1,"36":1,"37":1,"38":1,"39":1,"40":1,"41":1,"42":1,"43":1,"44":1,"45":1,"46":1,"47":1,"48":1,"49":1,"50":1,"51":1,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":25,"59":25,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":1,"78":1,"79":1,"80":1,"81":1,"82":1,"83":1,"84":1,"85":1,"86":1,"87":1,"88":1,"89":1,"90":1,"91":1,"92":1,"93":1,"94":1,"95":1,"96":1,"97":1,"98":1,"99":1,"100":1,"101":1},"f":{"0":0,"1":0,"2":25},"b":{"0":[0,0],"1":[0,0],"2":[25,0],"3":[25,25,25],"4":[0,0],"5":[0,0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0,0],"14":[0,0]},"inputSourceMap":{"version":3,"sources":["index.js"],"names":["rules","rulesConfigs","hooks","pages","resourceServers","databases","connections","clients","tenant","emailProvider","emailTemplates","clientGrants","guardianFactors","guardianFactorProviders","guardianFactorTemplates","guardianPolicies","guardianPhoneFactorSelectedProvider","guardianPhoneFactorMessageTypes","roles","branding","prompts","migrations","actions","triggers","organizations"],"mappings":";;;;;;;AAAA;;IAAYA,K;;AACZ;;IAAYC,Y;;AACZ;;IAAYC,K;;AACZ;;IAAYC,K;;AACZ;;IAAYC,e;;AACZ;;IAAYC,S;;AACZ;;IAAYC,W;;AACZ;;IAAYC,O;;AACZ;;IAAYC,M;;AACZ;;IAAYC,a;;AACZ;;IAAYC,c;;AACZ;;IAAYC,Y;;AACZ;;IAAYC,e;;AACZ;;IAAYC,uB;;AACZ;;IAAYC,uB;;AACZ;;IAAYC,gB;;AACZ;;IAAYC,mC;;AACZ;;IAAYC,+B;;AACZ;;IAAYC,K;;AACZ;;IAAYC,Q;;AACZ;;IAAYC,O;;AACZ;;IAAYC,U;;AACZ;;IAAYC,O;;AACZ;;IAAYC,Q;;AACZ;;IAAYC,a;;;;;;QAGVxB,K,GAAAA,K;QACAC,Y,GAAAA,Y;QACAC,K,GAAAA,K;QACAC,K,GAAAA,K;QACAC,e,GAAAA,e;QACAG,O,GAAAA,O;QACAF,S,GAAAA,S;QACAC,W,GAAAA,W;QACAE,M,GAAAA,M;QACAC,a,GAAAA,a;QACAC,c,GAAAA,c;QACAC,Y,GAAAA,Y;QACAC,e,GAAAA,e;QACAC,uB,GAAAA,uB;QACAC,uB,GAAAA,uB;QACAC,gB,GAAAA,gB;QACAC,mC,GAAAA,mC;QACAC,+B,GAAAA,+B;QACAC,K,GAAAA,K;QACAC,Q,GAAAA,Q;QACAC,O,GAAAA,O;QACAC,U,GAAAA,U;QACAC,O,GAAAA,O;QACAC,Q,GAAAA,Q;QACAC,a,GAAAA,a","sourceRoot":"/home/circleci/repo/src/tools/auth0/handlers/","sourcesContent":["import * as rules from './rules';\nimport * as rulesConfigs from './rulesConfigs';\nimport * as hooks from './hooks';\nimport * as pages from './pages';\nimport * as resourceServers from './resourceServers';\nimport * as databases from './databases';\nimport * as connections from './connections';\nimport * as clients from './clients';\nimport * as tenant from './tenant';\nimport * as emailProvider from './emailProvider';\nimport * as emailTemplates from './emailTemplates';\nimport * as clientGrants from './clientGrants';\nimport * as guardianFactors from './guardianFactors';\nimport * as guardianFactorProviders from './guardianFactorProviders';\nimport * as guardianFactorTemplates from './guardianFactorTemplates';\nimport * as guardianPolicies from './guardianPolicies';\nimport * as guardianPhoneFactorSelectedProvider from './guardianPhoneFactorSelectedProvider';\nimport * as guardianPhoneFactorMessageTypes from './guardianPhoneFactorMessageTypes';\nimport * as roles from './roles';\nimport * as branding from './branding';\nimport * as prompts from './prompts';\nimport * as migrations from './migrations';\nimport * as actions from './actions';\nimport * as triggers from './triggers';\nimport * as organizations from './organizations';\n\nexport {\n  rules,\n  rulesConfigs,\n  hooks,\n  pages,\n  resourceServers,\n  clients,\n  databases,\n  connections,\n  tenant,\n  emailProvider,\n  emailTemplates,\n  clientGrants,\n  guardianFactors,\n  guardianFactorProviders,\n  guardianFactorTemplates,\n  guardianPolicies,\n  guardianPhoneFactorSelectedProvider,\n  guardianPhoneFactorMessageTypes,\n  roles,\n  branding,\n  prompts,\n  migrations,\n  actions,\n  triggers,\n  organizations\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"bddf43a65e5b58c48f32b5a77dcf0bf56e6a8702","contentHash":"812d47ffe87f510a1e6283a74abc033c324d5ca9af7753d81a7b40566571888a"},"/home/circleci/repo/src/tools/auth0/handlers/rules.js":{"path":"/home/circleci/repo/src/tools/auth0/handlers/rules.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":51}},"2":{"start":{"line":8,"column":23},"end":{"line":8,"column":55}},"3":{"start":{"line":10,"column":24},"end":{"line":10,"column":64}},"4":{"start":{"line":12,"column":13},"end":{"line":12,"column":35}},"5":{"start":{"line":14,"column":15},"end":{"line":14,"column":35}},"6":{"start":{"line":16,"column":16},"end":{"line":16,"column":48}},"7":{"start":{"line":18,"column":14},"end":{"line":18,"column":37}},"8":{"start":{"line":20,"column":15},"end":{"line":20,"column":46}},"9":{"start":{"line":22,"column":39},"end":{"line":22,"column":93}},"10":{"start":{"line":24,"column":22},"end":{"line":29,"column":1}},"11":{"start":{"line":30,"column":15},"end":{"line":65,"column":1}},"12":{"start":{"line":69,"column":4},"end":{"line":72,"column":7}},"13":{"start":{"line":76,"column":4},"end":{"line":76,"column":44}},"14":{"start":{"line":76,"column":23},"end":{"line":76,"column":44}},"15":{"start":{"line":77,"column":4},"end":{"line":80,"column":7}},"16":{"start":{"line":81,"column":4},"end":{"line":81,"column":25}},"17":{"start":{"line":85,"column":4},"end":{"line":88,"column":7}},"18":{"start":{"line":94,"column":8},"end":{"line":94,"column":14}},"19":{"start":{"line":95,"column":26},"end":{"line":95,"column":70}},"20":{"start":{"line":96,"column":19},"end":{"line":96,"column":39}},"21":{"start":{"line":98,"column":4},"end":{"line":101,"column":5}},"22":{"start":{"line":99,"column":6},"end":{"line":99,"column":65}},"23":{"start":{"line":99,"column":32},"end":{"line":99,"column":63}},"24":{"start":{"line":100,"column":6},"end":{"line":100,"column":71}},"25":{"start":{"line":100,"column":38},"end":{"line":100,"column":69}},"26":{"start":{"line":108,"column":8},"end":{"line":108,"column":70}},"27":{"start":{"line":109,"column":24},"end":{"line":109,"column":46}},"28":{"start":{"line":110,"column":27},"end":{"line":110,"column":69}},"29":{"start":{"line":110,"column":60},"end":{"line":110,"column":67}},"30":{"start":{"line":111,"column":29},"end":{"line":111,"column":68}},"31":{"start":{"line":111,"column":59},"end":{"line":111,"column":66}},"32":{"start":{"line":112,"column":22},"end":{"line":112,"column":64}},"33":{"start":{"line":113,"column":20},"end":{"line":124,"column":10}},"34":{"start":{"line":114,"column":23},"end":{"line":114,"column":83}},"35":{"start":{"line":114,"column":42},"end":{"line":114,"column":82}},"36":{"start":{"line":116,"column":6},"end":{"line":121,"column":7}},"37":{"start":{"line":117,"column":8},"end":{"line":117,"column":25}},"38":{"start":{"line":118,"column":8},"end":{"line":120,"column":11}},"39":{"start":{"line":123,"column":6},"end":{"line":123,"column":19}},"40":{"start":{"line":125,"column":4},"end":{"line":131,"column":6}},"41":{"start":{"line":137,"column":8},"end":{"line":137,"column":14}},"42":{"start":{"line":138,"column":4},"end":{"line":138,"column":23}},"43":{"start":{"line":138,"column":16},"end":{"line":138,"column":23}},"44":{"start":{"line":139,"column":26},"end":{"line":139,"column":70}},"45":{"start":{"line":144,"column":8},"end":{"line":144,"column":44}},"46":{"start":{"line":145,"column":24},"end":{"line":145,"column":98}},"47":{"start":{"line":145,"column":66},"end":{"line":145,"column":96}},"48":{"start":{"line":146,"column":27},"end":{"line":146,"column":75}},"49":{"start":{"line":148,"column":4},"end":{"line":153,"column":5}},"50":{"start":{"line":149,"column":24},"end":{"line":149,"column":78}},"51":{"start":{"line":149,"column":51},"end":{"line":149,"column":77}},"52":{"start":{"line":149,"column":65},"end":{"line":149,"column":76}},"53":{"start":{"line":150,"column":6},"end":{"line":152,"column":77}},"54":{"start":{"line":155,"column":21},"end":{"line":155,"column":41}},"55":{"start":{"line":156,"column":25},"end":{"line":156,"column":198}},"56":{"start":{"line":156,"column":63},"end":{"line":156,"column":176}},"57":{"start":{"line":156,"column":100},"end":{"line":156,"column":174}},"58":{"start":{"line":156,"column":191},"end":{"line":156,"column":197}},"59":{"start":{"line":158,"column":4},"end":{"line":162,"column":5}},"60":{"start":{"line":159,"column":6},"end":{"line":161,"column":64}},"61":{"start":{"line":164,"column":4},"end":{"line":164,"column":33}},"62":{"start":{"line":170,"column":8},"end":{"line":170,"column":14}},"63":{"start":{"line":171,"column":4},"end":{"line":171,"column":23}},"64":{"start":{"line":171,"column":16},"end":{"line":171,"column":23}},"65":{"start":{"line":172,"column":20},"end":{"line":172,"column":50}},"66":{"start":{"line":173,"column":4},"end":{"line":187,"column":17}},"67":{"start":{"line":175,"column":25},"end":{"line":186,"column":8}},"68":{"start":{"line":178,"column":24},"end":{"line":183,"column":9}},"69":{"start":{"line":185,"column":8},"end":{"line":185,"column":91}},"70":{"start":{"line":188,"column":4},"end":{"line":193,"column":7}},"71":{"start":{"line":198,"column":0},"end":{"line":198,"column":31}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":22,"column":9},"end":{"line":22,"column":31}},"loc":{"start":{"line":22,"column":37},"end":{"line":22,"column":95}},"line":22},"1":{"name":"(anonymous_1)","decl":{"start":{"line":68,"column":2},"end":{"line":68,"column":3}},"loc":{"start":{"line":68,"column":23},"end":{"line":73,"column":3}},"line":68},"2":{"name":"(anonymous_2)","decl":{"start":{"line":75,"column":2},"end":{"line":75,"column":3}},"loc":{"start":{"line":75,"column":18},"end":{"line":82,"column":3}},"line":75},"3":{"name":"(anonymous_3)","decl":{"start":{"line":84,"column":2},"end":{"line":84,"column":3}},"loc":{"start":{"line":84,"column":18},"end":{"line":89,"column":3}},"line":84},"4":{"name":"(anonymous_4)","decl":{"start":{"line":91,"column":2},"end":{"line":91,"column":3}},"loc":{"start":{"line":91,"column":53},"end":{"line":132,"column":3}},"line":91},"5":{"name":"(anonymous_5)","decl":{"start":{"line":99,"column":27},"end":{"line":99,"column":28}},"loc":{"start":{"line":99,"column":32},"end":{"line":99,"column":63}},"line":99},"6":{"name":"(anonymous_6)","decl":{"start":{"line":100,"column":33},"end":{"line":100,"column":34}},"loc":{"start":{"line":100,"column":38},"end":{"line":100,"column":69}},"line":100},"7":{"name":"(anonymous_7)","decl":{"start":{"line":110,"column":55},"end":{"line":110,"column":56}},"loc":{"start":{"line":110,"column":60},"end":{"line":110,"column":67}},"line":110},"8":{"name":"(anonymous_8)","decl":{"start":{"line":111,"column":54},"end":{"line":111,"column":55}},"loc":{"start":{"line":111,"column":59},"end":{"line":111,"column":66}},"line":111},"9":{"name":"(anonymous_9)","decl":{"start":{"line":113,"column":39},"end":{"line":113,"column":40}},"loc":{"start":{"line":113,"column":53},"end":{"line":124,"column":5}},"line":113},"10":{"name":"(anonymous_10)","decl":{"start":{"line":114,"column":37},"end":{"line":114,"column":38}},"loc":{"start":{"line":114,"column":42},"end":{"line":114,"column":82}},"line":114},"11":{"name":"(anonymous_11)","decl":{"start":{"line":134,"column":2},"end":{"line":134,"column":3}},"loc":{"start":{"line":134,"column":25},"end":{"line":165,"column":3}},"line":134},"12":{"name":"(anonymous_12)","decl":{"start":{"line":145,"column":61},"end":{"line":145,"column":62}},"loc":{"start":{"line":145,"column":66},"end":{"line":145,"column":96}},"line":145},"13":{"name":"(anonymous_13)","decl":{"start":{"line":149,"column":43},"end":{"line":149,"column":44}},"loc":{"start":{"line":149,"column":51},"end":{"line":149,"column":77}},"line":149},"14":{"name":"(anonymous_14)","decl":{"start":{"line":149,"column":60},"end":{"line":149,"column":61}},"loc":{"start":{"line":149,"column":65},"end":{"line":149,"column":76}},"line":149},"15":{"name":"(anonymous_15)","decl":{"start":{"line":156,"column":44},"end":{"line":156,"column":45}},"loc":{"start":{"line":156,"column":63},"end":{"line":156,"column":176}},"line":156},"16":{"name":"(anonymous_16)","decl":{"start":{"line":156,"column":95},"end":{"line":156,"column":96}},"loc":{"start":{"line":156,"column":100},"end":{"line":156,"column":174}},"line":156},"17":{"name":"(anonymous_17)","decl":{"start":{"line":156,"column":186},"end":{"line":156,"column":187}},"loc":{"start":{"line":156,"column":191},"end":{"line":156,"column":197}},"line":156},"18":{"name":"(anonymous_18)","decl":{"start":{"line":167,"column":2},"end":{"line":167,"column":3}},"loc":{"start":{"line":167,"column":31},"end":{"line":194,"column":3}},"line":167},"19":{"name":"(anonymous_19)","decl":{"start":{"line":175,"column":17},"end":{"line":175,"column":18}},"loc":{"start":{"line":175,"column":25},"end":{"line":186,"column":8}},"line":175},"20":{"name":"(anonymous_20)","decl":{"start":{"line":177,"column":69},"end":{"line":177,"column":70}},"loc":{"start":{"line":177,"column":75},"end":{"line":186,"column":7}},"line":177}},"branchMap":{"0":{"loc":{"start":{"line":22,"column":46},"end":{"line":22,"column":92}},"type":"cond-expr","locations":[{"start":{"line":22,"column":70},"end":{"line":22,"column":73}},{"start":{"line":22,"column":76},"end":{"line":22,"column":92}}],"line":22},"1":{"loc":{"start":{"line":22,"column":46},"end":{"line":22,"column":67}},"type":"binary-expr","locations":[{"start":{"line":22,"column":46},"end":{"line":22,"column":49}},{"start":{"line":22,"column":53},"end":{"line":22,"column":67}}],"line":22},"2":{"loc":{"start":{"line":76,"column":4},"end":{"line":76,"column":44}},"type":"if","locations":[{"start":{"line":76,"column":4},"end":{"line":76,"column":44}},{"start":{"line":76,"column":4},"end":{"line":76,"column":44}}],"line":76},"3":{"loc":{"start":{"line":91,"column":28},"end":{"line":91,"column":51}},"type":"default-arg","locations":[{"start":{"line":91,"column":46},"end":{"line":91,"column":51}}],"line":91},"4":{"loc":{"start":{"line":95,"column":26},"end":{"line":95,"column":70}},"type":"binary-expr","locations":[{"start":{"line":95,"column":26},"end":{"line":95,"column":40}},{"start":{"line":95,"column":44},"end":{"line":95,"column":64}},{"start":{"line":95,"column":68},"end":{"line":95,"column":70}}],"line":95},"5":{"loc":{"start":{"line":98,"column":4},"end":{"line":101,"column":5}},"type":"if","locations":[{"start":{"line":98,"column":4},"end":{"line":101,"column":5}},{"start":{"line":98,"column":4},"end":{"line":101,"column":5}}],"line":98},"6":{"loc":{"start":{"line":114,"column":42},"end":{"line":114,"column":82}},"type":"binary-expr","locations":[{"start":{"line":114,"column":42},"end":{"line":114,"column":61}},{"start":{"line":114,"column":65},"end":{"line":114,"column":82}}],"line":114},"7":{"loc":{"start":{"line":116,"column":6},"end":{"line":121,"column":7}},"type":"if","locations":[{"start":{"line":116,"column":6},"end":{"line":121,"column":7}},{"start":{"line":116,"column":6},"end":{"line":121,"column":7}}],"line":116},"8":{"loc":{"start":{"line":138,"column":4},"end":{"line":138,"column":23}},"type":"if","locations":[{"start":{"line":138,"column":4},"end":{"line":138,"column":23}},{"start":{"line":138,"column":4},"end":{"line":138,"column":23}}],"line":138},"9":{"loc":{"start":{"line":139,"column":26},"end":{"line":139,"column":70}},"type":"binary-expr","locations":[{"start":{"line":139,"column":26},"end":{"line":139,"column":40}},{"start":{"line":139,"column":44},"end":{"line":139,"column":64}},{"start":{"line":139,"column":68},"end":{"line":139,"column":70}}],"line":139},"10":{"loc":{"start":{"line":148,"column":4},"end":{"line":153,"column":5}},"type":"if","locations":[{"start":{"line":148,"column":4},"end":{"line":153,"column":5}},{"start":{"line":148,"column":4},"end":{"line":153,"column":5}}],"line":148},"11":{"loc":{"start":{"line":156,"column":100},"end":{"line":156,"column":174}},"type":"binary-expr","locations":[{"start":{"line":156,"column":100},"end":{"line":156,"column":148}},{"start":{"line":156,"column":152},"end":{"line":156,"column":174}}],"line":156},"12":{"loc":{"start":{"line":158,"column":4},"end":{"line":162,"column":5}},"type":"if","locations":[{"start":{"line":158,"column":4},"end":{"line":162,"column":5}},{"start":{"line":158,"column":4},"end":{"line":162,"column":5}}],"line":158},"13":{"loc":{"start":{"line":171,"column":4},"end":{"line":171,"column":23}},"type":"if","locations":[{"start":{"line":171,"column":4},"end":{"line":171,"column":23}},{"start":{"line":171,"column":4},"end":{"line":171,"column":23}}],"line":171}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":3,"10":1,"11":1,"12":121,"13":24,"14":5,"15":19,"16":19,"17":6,"18":14,"19":14,"20":14,"21":14,"22":8,"23":9,"24":8,"25":10,"26":14,"27":14,"28":14,"29":15,"30":14,"31":9,"32":14,"33":14,"34":15,"35":11,"36":15,"37":2,"38":2,"39":15,"40":14,"41":63,"42":63,"43":57,"44":6,"45":6,"46":6,"47":0,"48":6,"49":6,"50":1,"51":1,"52":2,"53":1,"54":5,"55":5,"56":6,"57":1,"58":1,"59":5,"60":1,"61":4,"62":6,"63":6,"64":0,"65":6,"66":6,"67":0,"68":0,"69":0,"70":6,"71":1},"f":{"0":3,"1":121,"2":24,"3":6,"4":14,"5":9,"6":10,"7":15,"8":9,"9":15,"10":11,"11":63,"12":0,"13":1,"14":2,"15":6,"16":1,"17":1,"18":6,"19":0,"20":0},"b":{"0":[1,2],"1":[3,3],"2":[5,19],"3":[8],"4":[14,3,12],"5":[8,6],"6":[11,4],"7":[2,13],"8":[57,6],"9":[6,2,5],"10":[1,5],"11":[1,1],"12":[1,4],"13":[0,6]},"inputSourceMap":{"version":3,"sources":["rules.js"],"names":["excludeSchema","type","items","schema","default","properties","script","description","name","pattern","order","enabled","stage","enum","required","RulesHandler","DefaultHandler","constructor","options","stripUpdateFields","getType","existing","client","rules","getAll","paginate","include_totals","objString","rule","calcChanges","assets","includeExcluded","excludedRules","exclude","filter","r","includes","del","update","create","conflicts","futureRules","futureMaxOrder","Math","max","map","existingMaxOrder","nextOrderNo","reOrder","reduce","accum","conflict","find","f","push","validate","rulesSameOrder","length","formatted","dups","d","ValidationError","stateChanged","changed","toLowerCase","processChanges","changes","pool","addEachTask","data","generator","updateRule","id","then","updated","log","info","promise"],"mappings":"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","sourceRoot":"/home/circleci/repo/src/tools/auth0/handlers/","sourcesContent":["import ValidationError from '../../ValidationError';\nimport {\n  dumpJSON, calcChanges, stripFields, duplicateItems\n} from '../../utils';\nimport DefaultHandler from './default';\nimport log from '../../logger';\n\nexport const excludeSchema = {\n  type: 'array',\n  items: { type: 'string' }\n};\n\nexport const schema = {\n  type: 'array',\n  items: {\n    type: 'object',\n    default: [],\n    properties: {\n      script: {\n        type: 'string',\n        description: 'A script that contains the rule\\'s code',\n        default: ''\n      },\n      name: {\n        type: 'string',\n        description: 'The name of the rule. Can only contain alphanumeric characters, spaces and \\'-\\'. Can neither start nor end with \\'-\\' or spaces',\n        pattern: '^[^-\\\\s][a-zA-Z0-9-\\\\s]+[^-\\\\s]$'\n      },\n      order: {\n        type: [ 'number', 'null' ],\n        description: 'The rule\\'s order in relation to other rules. A rule with a lower order than another rule executes first.',\n        default: null\n      },\n      enabled: {\n        type: 'boolean',\n        description: 'true if the rule is enabled, false otherwise',\n        default: true\n      },\n      stage: {\n        type: 'string',\n        description: 'The rule\\'s execution stage',\n        default: 'login_success',\n        enum: [ 'login_success', 'login_failure', 'pre_authorize' ]\n      }\n    },\n    required: [ 'name' ]\n  }\n};\n\nexport default class RulesHandler extends DefaultHandler {\n  constructor(options) {\n    super({\n      ...options,\n      type: 'rules',\n      stripUpdateFields: [ 'stage' ] // Fields not allowed in updates\n    });\n  }\n\n  async getType() {\n    if (this.existing) return this.existing;\n    this.existing = await this.client.rules.getAll({ paginate: true, include_totals: true });\n    return this.existing;\n  }\n\n  objString(rule) {\n    return super.objString({ name: rule.name, order: rule.order });\n  }\n\n  async calcChanges(assets, includeExcluded = false) {\n    let { rules } = assets;\n\n    const excludedRules = (assets.exclude && assets.exclude.rules) || [];\n\n    let existing = await this.getType();\n\n    // Filter excluded rules\n    if (!includeExcluded) {\n      rules = rules.filter((r) => !excludedRules.includes(r.name));\n      existing = existing.filter((r) => !excludedRules.includes(r.name));\n    }\n\n    // Figure out what needs to be updated vs created\n    const {\n      del, update, create, conflicts\n    } = calcChanges(this, rules, existing, [ 'id', 'name' ]);\n\n    // Figure out the rules that need to be re-ordered\n    const futureRules = [ ...create, ...update ];\n\n    const futureMaxOrder = Math.max(...futureRules.map((r) => r.order));\n    const existingMaxOrder = Math.max(...existing.map((r) => r.order));\n    let nextOrderNo = Math.max(futureMaxOrder, existingMaxOrder);\n\n    const reOrder = futureRules.reduce((accum, r) => {\n      const conflict = existing.find((f) => r.order === f.order && r.name !== f.name);\n      if (conflict) {\n        nextOrderNo += 1;\n        accum.push({\n          ...conflict,\n          order: nextOrderNo\n        });\n      }\n      return accum;\n    }, []);\n\n    return {\n      del,\n      update,\n      create,\n      reOrder,\n      conflicts\n    };\n  }\n\n  async validate(assets) {\n    const { rules } = assets;\n\n    // Do nothing if not set\n    if (!rules) return;\n\n    const excludedRules = (assets.exclude && assets.exclude.rules) || [];\n\n    // Figure out what needs to be updated vs created\n    const { update, create, del } = await this.calcChanges(assets, true);\n    // Include del rules which are actually not going to be deleted but are excluded\n    // they can still muck up the ordering so we must take it into consideration.\n    const futureRules = [ ...create, ...update, ...del.filter((r) => excludedRules.includes(r.name)) ];\n\n    // Detect rules with the same order\n    const rulesSameOrder = duplicateItems(futureRules, 'order');\n    if (rulesSameOrder.length > 0) {\n      const formatted = rulesSameOrder.map((dups) => dups.map((d) => `${d.name}`));\n      throw new ValidationError(`There are multiple rules for the following stage-order combinations\n      ${dumpJSON(formatted)}.\n       Only one rule must be defined for the same order number in a stage.`);\n    }\n\n    // Detect Rules that are changing stage as it's not allowed.\n    const existing = await this.getType();\n    const stateChanged = futureRules.reduce((changed, rule) => ([\n      ...changed,\n      ...existing.filter((r) => rule.name.toLowerCase() === r.name.toLowerCase() && r.stage !== rule.stage)\n    ]), []).map((r) => r.name);\n\n    if (stateChanged.length > 0) {\n      throw new ValidationError(`The following rules changed stage which is not allowed:\n      ${dumpJSON(stateChanged)}.\n      Rename the rules to recreate them and avoid this error.`);\n    }\n\n    await super.validate(assets);\n  }\n\n  async processChanges(assets) {\n    const { rules } = assets;\n\n    // Do nothing if not set\n    if (!rules) return;\n\n    // Figure out what needs to be updated vs created\n    const changes = await this.calcChanges(assets);\n\n    // Temporally re-order rules with conflicting ordering\n    await this.client.pool.addEachTask({\n      data: changes.reOrder,\n      generator: (rule) => this.client.updateRule({ id: rule.id }, stripFields(rule, this.stripUpdateFields)).then(() => {\n        const updated = {\n          name: rule.name, stage: rule.stage, order: rule.order, id: rule.id\n        };\n        log.info(`Temporally re-order Rule ${dumpJSON(updated)}`);\n      })\n    }).promise();\n\n    await super.processChanges(assets, {\n      del: changes.del,\n      create: changes.create,\n      update: changes.update,\n      conflicts: changes.conflicts\n    });\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"08d4a281589627d2e75b11782576b604e1d8d2b7","contentHash":"fa45b377c190c9dd0f9c867b68deda94b0d5459336e0e082c51bedd050cc0cc9"},"/home/circleci/repo/src/tools/ValidationError.js":{"path":"/home/circleci/repo/src/tools/ValidationError.js","statementMap":{"0":{"start":{"line":4,"column":2},"end":{"line":4,"column":28}},"1":{"start":{"line":6,"column":2},"end":{"line":8,"column":3}},"2":{"start":{"line":7,"column":4},"end":{"line":7,"column":52}},"3":{"start":{"line":10,"column":2},"end":{"line":10,"column":32}},"4":{"start":{"line":11,"column":2},"end":{"line":11,"column":25}},"5":{"start":{"line":12,"column":2},"end":{"line":12,"column":20}},"6":{"start":{"line":15,"column":0},"end":{"line":15,"column":59}},"7":{"start":{"line":16,"column":0},"end":{"line":16,"column":56}},"8":{"start":{"line":17,"column":0},"end":{"line":17,"column":33}}},"fnMap":{"0":{"name":"ValidationError","decl":{"start":{"line":3,"column":9},"end":{"line":3,"column":24}},"loc":{"start":{"line":3,"column":34},"end":{"line":13,"column":1}},"line":3}},"branchMap":{"0":{"loc":{"start":{"line":6,"column":2},"end":{"line":8,"column":3}},"type":"if","locations":[{"start":{"line":6,"column":2},"end":{"line":8,"column":3}},{"start":{"line":6,"column":2},"end":{"line":8,"column":3}}],"line":6}},"s":{"0":18,"1":18,"2":18,"3":18,"4":18,"5":18,"6":1,"7":1,"8":1},"f":{"0":18},"b":{"0":[18,0]},"inputSourceMap":{"version":3,"sources":["ValidationError.js"],"names":["ValidationError","message","Error","call","process","env","NODE_ENV","captureStackTrace","constructor","name","status","prototype","Object","create","module","exports"],"mappings":";;AAAA,SAASA,eAAT,CAAyBC,OAAzB,EAAkC;AAChCC,EAAAA,KAAK,CAACC,IAAN,CAAW,IAAX,EAAiBF,OAAjB;;AACA,MAAIG,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,YAA7B,EAA2C;AACzCJ,IAAAA,KAAK,CAACK,iBAAN,CAAwB,IAAxB,EAA8B,KAAKC,WAAnC;AACD;;AACD,OAAKC,IAAL,GAAY,iBAAZ;AACA,OAAKR,OAAL,GAAeA,OAAf;AACA,OAAKS,MAAL,GAAc,GAAd;AACD;;AAEDV,eAAe,CAACW,SAAhB,GAA4BC,MAAM,CAACC,MAAP,CAAcX,KAAK,CAACS,SAApB,CAA5B;AACAX,eAAe,CAACW,SAAhB,CAA0BH,WAA1B,GAAwCR,eAAxC;AACAc,MAAM,CAACC,OAAP,GAAiBf,eAAjB","sourceRoot":"/home/circleci/repo/src/tools/","sourcesContent":["function ValidationError(message) {\n  Error.call(this, message);\n  if (process.env.NODE_ENV !== 'production') {\n    Error.captureStackTrace(this, this.constructor);\n  }\n  this.name = 'ValidationError';\n  this.message = message;\n  this.status = 400;\n}\n\nValidationError.prototype = Object.create(Error.prototype);\nValidationError.prototype.constructor = ValidationError;\nmodule.exports = ValidationError;\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"b5a152474277108cbdb9d54c90a89d29e61275dd","contentHash":"51dd2539f18bd303c7514fbb2794e011a7ad0e51241bd00dc7be85f7af073e9a"},"/home/circleci/repo/src/tools/auth0/handlers/default.js":{"path":"/home/circleci/repo/src/tools/auth0/handlers/default.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":22}},"2":{"start":{"line":8,"column":23},"end":{"line":8,"column":55}},"3":{"start":{"line":10,"column":24},"end":{"line":10,"column":64}},"4":{"start":{"line":12,"column":14},"end":{"line":12,"column":37}},"5":{"start":{"line":14,"column":15},"end":{"line":14,"column":46}},"6":{"start":{"line":16,"column":13},"end":{"line":16,"column":35}},"7":{"start":{"line":18,"column":39},"end":{"line":18,"column":93}},"8":{"start":{"line":21,"column":2},"end":{"line":24,"column":4}},"9":{"start":{"line":22,"column":4},"end":{"line":22,"column":35}},"10":{"start":{"line":23,"column":4},"end":{"line":23,"column":22}},"11":{"start":{"line":29,"column":4},"end":{"line":29,"column":33}},"12":{"start":{"line":30,"column":4},"end":{"line":30,"column":29}},"13":{"start":{"line":31,"column":4},"end":{"line":31,"column":33}},"14":{"start":{"line":32,"column":4},"end":{"line":32,"column":33}},"15":{"start":{"line":33,"column":4},"end":{"line":33,"column":25}},"16":{"start":{"line":34,"column":4},"end":{"line":34,"column":61}},"17":{"start":{"line":35,"column":4},"end":{"line":35,"column":51}},"18":{"start":{"line":36,"column":4},"end":{"line":36,"column":77}},"19":{"start":{"line":37,"column":4},"end":{"line":43,"column":6}},"20":{"start":{"line":44,"column":4},"end":{"line":44,"column":21}},"21":{"start":{"line":45,"column":4},"end":{"line":45,"column":21}},"22":{"start":{"line":46,"column":4},"end":{"line":46,"column":21}},"23":{"start":{"line":50,"column":4},"end":{"line":53,"column":5}},"24":{"start":{"line":51,"column":21},"end":{"line":51,"column":56}},"25":{"start":{"line":52,"column":6},"end":{"line":52,"column":50}},"26":{"start":{"line":55,"column":4},"end":{"line":55,"column":14}},"27":{"start":{"line":59,"column":4},"end":{"line":59,"column":77}},"28":{"start":{"line":63,"column":4},"end":{"line":63,"column":77}},"29":{"start":{"line":67,"column":4},"end":{"line":67,"column":77}},"30":{"start":{"line":71,"column":4},"end":{"line":71,"column":38}},"31":{"start":{"line":75,"column":4},"end":{"line":75,"column":68}},"32":{"start":{"line":79,"column":4},"end":{"line":79,"column":69}},"33":{"start":{"line":81,"column":4},"end":{"line":81,"column":41}},"34":{"start":{"line":82,"column":4},"end":{"line":84,"column":6}},"35":{"start":{"line":88,"column":23},"end":{"line":88,"column":40}},"36":{"start":{"line":89,"column":4},"end":{"line":89,"column":31}},"37":{"start":{"line":89,"column":21},"end":{"line":89,"column":31}},"38":{"start":{"line":90,"column":21},"end":{"line":90,"column":41}},"39":{"start":{"line":91,"column":4},"end":{"line":91,"column":100}},"40":{"start":{"line":95,"column":23},"end":{"line":95,"column":40}},"41":{"start":{"line":96,"column":4},"end":{"line":96,"column":43}},"42":{"start":{"line":96,"column":36},"end":{"line":96,"column":43}},"43":{"start":{"line":97,"column":27},"end":{"line":97,"column":73}},"44":{"start":{"line":99,"column":4},"end":{"line":104,"column":5}},"45":{"start":{"line":100,"column":24},"end":{"line":100,"column":78}},"46":{"start":{"line":100,"column":51},"end":{"line":100,"column":77}},"47":{"start":{"line":100,"column":65},"end":{"line":100,"column":76}},"48":{"start":{"line":101,"column":6},"end":{"line":103,"column":31}},"49":{"start":{"line":106,"column":25},"end":{"line":106,"column":72}},"50":{"start":{"line":108,"column":4},"end":{"line":113,"column":5}},"51":{"start":{"line":109,"column":24},"end":{"line":109,"column":80}},"52":{"start":{"line":109,"column":49},"end":{"line":109,"column":79}},"53":{"start":{"line":109,"column":63},"end":{"line":109,"column":78}},"54":{"start":{"line":110,"column":6},"end":{"line":112,"column":77}},"55":{"start":{"line":117,"column":4},"end":{"line":119,"column":5}},"56":{"start":{"line":118,"column":6},"end":{"line":118,"column":47}},"57":{"start":{"line":121,"column":16},"end":{"line":121,"column":33}},"58":{"start":{"line":122,"column":19},"end":{"line":122,"column":39}},"59":{"start":{"line":123,"column":19},"end":{"line":123,"column":39}},"60":{"start":{"line":124,"column":22},"end":{"line":124,"column":45}},"61":{"start":{"line":126,"column":4},"end":{"line":126,"column":177}},"62":{"start":{"line":128,"column":4},"end":{"line":153,"column":5}},"63":{"start":{"line":129,"column":26},"end":{"line":129,"column":116}},"64":{"start":{"line":130,"column":26},"end":{"line":130,"column":119}},"65":{"start":{"line":131,"column":27},"end":{"line":131,"column":53}},"66":{"start":{"line":133,"column":6},"end":{"line":152,"column":7}},"67":{"start":{"line":134,"column":8},"end":{"line":136,"column":12}},"68":{"start":{"line":135,"column":33},"end":{"line":135,"column":50}},"69":{"start":{"line":138,"column":8},"end":{"line":151,"column":21}},"70":{"start":{"line":141,"column":32},"end":{"line":141,"column":71}},"71":{"start":{"line":142,"column":12},"end":{"line":149,"column":15}},"72":{"start":{"line":145,"column":14},"end":{"line":145,"column":38}},"73":{"start":{"line":146,"column":14},"end":{"line":146,"column":32}},"74":{"start":{"line":148,"column":14},"end":{"line":148,"column":98}},"75":{"start":{"line":155,"column":4},"end":{"line":168,"column":17}},"76":{"start":{"line":158,"column":25},"end":{"line":158,"column":64}},"77":{"start":{"line":159,"column":23},"end":{"line":161,"column":9}},"78":{"start":{"line":162,"column":24},"end":{"line":163,"column":34}},"79":{"start":{"line":164,"column":8},"end":{"line":166,"column":11}},"80":{"start":{"line":164,"column":54},"end":{"line":164,"column":74}},"81":{"start":{"line":165,"column":10},"end":{"line":165,"column":97}},"82":{"start":{"line":169,"column":4},"end":{"line":180,"column":17}},"83":{"start":{"line":172,"column":31},"end":{"line":172,"column":70}},"84":{"start":{"line":173,"column":8},"end":{"line":178,"column":11}},"85":{"start":{"line":174,"column":10},"end":{"line":174,"column":31}},"86":{"start":{"line":175,"column":10},"end":{"line":175,"column":28}},"87":{"start":{"line":177,"column":10},"end":{"line":177,"column":97}},"88":{"start":{"line":181,"column":4},"end":{"line":197,"column":17}},"89":{"start":{"line":184,"column":25},"end":{"line":184,"column":64}},"90":{"start":{"line":185,"column":23},"end":{"line":187,"column":9}},"91":{"start":{"line":188,"column":24},"end":{"line":189,"column":34}},"92":{"start":{"line":190,"column":8},"end":{"line":195,"column":11}},"93":{"start":{"line":191,"column":10},"end":{"line":191,"column":31}},"94":{"start":{"line":192,"column":10},"end":{"line":192,"column":28}},"95":{"start":{"line":194,"column":10},"end":{"line":194,"column":97}},"96":{"start":{"line":202,"column":0},"end":{"line":202,"column":33}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":18,"column":9},"end":{"line":18,"column":31}},"loc":{"start":{"line":18,"column":37},"end":{"line":18,"column":95}},"line":18},"1":{"name":"order","decl":{"start":{"line":20,"column":9},"end":{"line":20,"column":14}},"loc":{"start":{"line":20,"column":22},"end":{"line":25,"column":1}},"line":20},"2":{"name":"decorator","decl":{"start":{"line":21,"column":18},"end":{"line":21,"column":27}},"loc":{"start":{"line":21,"column":46},"end":{"line":24,"column":3}},"line":21},"3":{"name":"(anonymous_3)","decl":{"start":{"line":28,"column":2},"end":{"line":28,"column":3}},"loc":{"start":{"line":28,"column":23},"end":{"line":47,"column":3}},"line":28},"4":{"name":"(anonymous_4)","decl":{"start":{"line":49,"column":2},"end":{"line":49,"column":3}},"loc":{"start":{"line":49,"column":18},"end":{"line":56,"column":3}},"line":49},"5":{"name":"(anonymous_5)","decl":{"start":{"line":58,"column":2},"end":{"line":58,"column":3}},"loc":{"start":{"line":58,"column":18},"end":{"line":60,"column":3}},"line":58},"6":{"name":"(anonymous_6)","decl":{"start":{"line":62,"column":2},"end":{"line":62,"column":3}},"loc":{"start":{"line":62,"column":18},"end":{"line":64,"column":3}},"line":62},"7":{"name":"(anonymous_7)","decl":{"start":{"line":66,"column":2},"end":{"line":66,"column":3}},"loc":{"start":{"line":66,"column":18},"end":{"line":68,"column":3}},"line":66},"8":{"name":"(anonymous_8)","decl":{"start":{"line":70,"column":2},"end":{"line":70,"column":3}},"loc":{"start":{"line":70,"column":18},"end":{"line":72,"column":3}},"line":70},"9":{"name":"(anonymous_9)","decl":{"start":{"line":74,"column":2},"end":{"line":74,"column":3}},"loc":{"start":{"line":74,"column":18},"end":{"line":76,"column":3}},"line":74},"10":{"name":"(anonymous_10)","decl":{"start":{"line":78,"column":2},"end":{"line":78,"column":3}},"loc":{"start":{"line":78,"column":15},"end":{"line":85,"column":3}},"line":78},"11":{"name":"(anonymous_11)","decl":{"start":{"line":87,"column":2},"end":{"line":87,"column":3}},"loc":{"start":{"line":87,"column":28},"end":{"line":92,"column":3}},"line":87},"12":{"name":"(anonymous_12)","decl":{"start":{"line":94,"column":2},"end":{"line":94,"column":3}},"loc":{"start":{"line":94,"column":25},"end":{"line":114,"column":3}},"line":94},"13":{"name":"(anonymous_13)","decl":{"start":{"line":100,"column":43},"end":{"line":100,"column":44}},"loc":{"start":{"line":100,"column":51},"end":{"line":100,"column":77}},"line":100},"14":{"name":"(anonymous_14)","decl":{"start":{"line":100,"column":60},"end":{"line":100,"column":61}},"loc":{"start":{"line":100,"column":65},"end":{"line":100,"column":76}},"line":100},"15":{"name":"(anonymous_15)","decl":{"start":{"line":109,"column":41},"end":{"line":109,"column":42}},"loc":{"start":{"line":109,"column":49},"end":{"line":109,"column":79}},"line":109},"16":{"name":"(anonymous_16)","decl":{"start":{"line":109,"column":58},"end":{"line":109,"column":59}},"loc":{"start":{"line":109,"column":63},"end":{"line":109,"column":78}},"line":109},"17":{"name":"(anonymous_17)","decl":{"start":{"line":116,"column":2},"end":{"line":116,"column":3}},"loc":{"start":{"line":116,"column":40},"end":{"line":198,"column":3}},"line":116},"18":{"name":"(anonymous_18)","decl":{"start":{"line":135,"column":28},"end":{"line":135,"column":29}},"loc":{"start":{"line":135,"column":33},"end":{"line":135,"column":50}},"line":135},"19":{"name":"(anonymous_19)","decl":{"start":{"line":140,"column":21},"end":{"line":140,"column":22}},"loc":{"start":{"line":140,"column":32},"end":{"line":150,"column":11}},"line":140},"20":{"name":"(anonymous_20)","decl":{"start":{"line":144,"column":20},"end":{"line":144,"column":21}},"loc":{"start":{"line":144,"column":26},"end":{"line":147,"column":13}},"line":144},"21":{"name":"(anonymous_21)","decl":{"start":{"line":147,"column":21},"end":{"line":147,"column":22}},"loc":{"start":{"line":147,"column":28},"end":{"line":149,"column":13}},"line":147},"22":{"name":"(anonymous_22)","decl":{"start":{"line":157,"column":17},"end":{"line":157,"column":18}},"loc":{"start":{"line":157,"column":31},"end":{"line":167,"column":7}},"line":157},"23":{"name":"(anonymous_23)","decl":{"start":{"line":164,"column":46},"end":{"line":164,"column":47}},"loc":{"start":{"line":164,"column":54},"end":{"line":164,"column":74}},"line":164},"24":{"name":"(anonymous_24)","decl":{"start":{"line":164,"column":82},"end":{"line":164,"column":83}},"loc":{"start":{"line":164,"column":89},"end":{"line":166,"column":9}},"line":164},"25":{"name":"(anonymous_25)","decl":{"start":{"line":171,"column":17},"end":{"line":171,"column":18}},"loc":{"start":{"line":171,"column":31},"end":{"line":179,"column":7}},"line":171},"26":{"name":"(anonymous_26)","decl":{"start":{"line":173,"column":47},"end":{"line":173,"column":48}},"loc":{"start":{"line":173,"column":55},"end":{"line":176,"column":9}},"line":173},"27":{"name":"(anonymous_27)","decl":{"start":{"line":176,"column":17},"end":{"line":176,"column":18}},"loc":{"start":{"line":176,"column":24},"end":{"line":178,"column":9}},"line":176},"28":{"name":"(anonymous_28)","decl":{"start":{"line":183,"column":17},"end":{"line":183,"column":18}},"loc":{"start":{"line":183,"column":31},"end":{"line":196,"column":7}},"line":183},"29":{"name":"(anonymous_29)","decl":{"start":{"line":190,"column":46},"end":{"line":190,"column":47}},"loc":{"start":{"line":190,"column":54},"end":{"line":193,"column":9}},"line":190},"30":{"name":"(anonymous_30)","decl":{"start":{"line":193,"column":17},"end":{"line":193,"column":18}},"loc":{"start":{"line":193,"column":24},"end":{"line":195,"column":9}},"line":193}},"branchMap":{"0":{"loc":{"start":{"line":18,"column":46},"end":{"line":18,"column":92}},"type":"cond-expr","locations":[{"start":{"line":18,"column":70},"end":{"line":18,"column":73}},{"start":{"line":18,"column":76},"end":{"line":18,"column":92}}],"line":18},"1":{"loc":{"start":{"line":18,"column":46},"end":{"line":18,"column":67}},"type":"binary-expr","locations":[{"start":{"line":18,"column":46},"end":{"line":18,"column":49}},{"start":{"line":18,"column":53},"end":{"line":18,"column":67}}],"line":18},"2":{"loc":{"start":{"line":31,"column":14},"end":{"line":31,"column":32}},"type":"binary-expr","locations":[{"start":{"line":31,"column":14},"end":{"line":31,"column":24}},{"start":{"line":31,"column":28},"end":{"line":31,"column":32}}],"line":31},"3":{"loc":{"start":{"line":34,"column":23},"end":{"line":34,"column":60}},"type":"binary-expr","locations":[{"start":{"line":34,"column":23},"end":{"line":34,"column":42}},{"start":{"line":34,"column":46},"end":{"line":34,"column":60}}],"line":34},"4":{"loc":{"start":{"line":35,"column":24},"end":{"line":35,"column":50}},"type":"binary-expr","locations":[{"start":{"line":35,"column":24},"end":{"line":35,"column":44}},{"start":{"line":35,"column":48},"end":{"line":35,"column":50}}],"line":35},"5":{"loc":{"start":{"line":36,"column":34},"end":{"line":36,"column":65}},"type":"binary-expr","locations":[{"start":{"line":36,"column":34},"end":{"line":36,"column":59}},{"start":{"line":36,"column":63},"end":{"line":36,"column":65}}],"line":36},"6":{"loc":{"start":{"line":42,"column":10},"end":{"line":42,"column":33}},"type":"binary-expr","locations":[{"start":{"line":42,"column":10},"end":{"line":42,"column":27}},{"start":{"line":42,"column":31},"end":{"line":42,"column":33}}],"line":42},"7":{"loc":{"start":{"line":50,"column":4},"end":{"line":53,"column":5}},"type":"if","locations":[{"start":{"line":50,"column":4},"end":{"line":53,"column":5}},{"start":{"line":50,"column":4},"end":{"line":53,"column":5}}],"line":50},"8":{"loc":{"start":{"line":89,"column":4},"end":{"line":89,"column":31}},"type":"if","locations":[{"start":{"line":89,"column":4},"end":{"line":89,"column":31}},{"start":{"line":89,"column":4},"end":{"line":89,"column":31}}],"line":89},"9":{"loc":{"start":{"line":96,"column":4},"end":{"line":96,"column":43}},"type":"if","locations":[{"start":{"line":96,"column":4},"end":{"line":96,"column":43}},{"start":{"line":96,"column":4},"end":{"line":96,"column":43}}],"line":96},"10":{"loc":{"start":{"line":99,"column":4},"end":{"line":104,"column":5}},"type":"if","locations":[{"start":{"line":99,"column":4},"end":{"line":104,"column":5}},{"start":{"line":99,"column":4},"end":{"line":104,"column":5}}],"line":99},"11":{"loc":{"start":{"line":108,"column":4},"end":{"line":113,"column":5}},"type":"if","locations":[{"start":{"line":108,"column":4},"end":{"line":113,"column":5}},{"start":{"line":108,"column":4},"end":{"line":113,"column":5}}],"line":108},"12":{"loc":{"start":{"line":117,"column":4},"end":{"line":119,"column":5}},"type":"if","locations":[{"start":{"line":117,"column":4},"end":{"line":119,"column":5}},{"start":{"line":117,"column":4},"end":{"line":119,"column":5}}],"line":117},"13":{"loc":{"start":{"line":121,"column":16},"end":{"line":121,"column":33}},"type":"binary-expr","locations":[{"start":{"line":121,"column":16},"end":{"line":121,"column":27}},{"start":{"line":121,"column":31},"end":{"line":121,"column":33}}],"line":121},"14":{"loc":{"start":{"line":122,"column":19},"end":{"line":122,"column":39}},"type":"binary-expr","locations":[{"start":{"line":122,"column":19},"end":{"line":122,"column":33}},{"start":{"line":122,"column":37},"end":{"line":122,"column":39}}],"line":122},"15":{"loc":{"start":{"line":123,"column":19},"end":{"line":123,"column":39}},"type":"binary-expr","locations":[{"start":{"line":123,"column":19},"end":{"line":123,"column":33}},{"start":{"line":123,"column":37},"end":{"line":123,"column":39}}],"line":123},"16":{"loc":{"start":{"line":124,"column":22},"end":{"line":124,"column":45}},"type":"binary-expr","locations":[{"start":{"line":124,"column":22},"end":{"line":124,"column":39}},{"start":{"line":124,"column":43},"end":{"line":124,"column":45}}],"line":124},"17":{"loc":{"start":{"line":128,"column":4},"end":{"line":153,"column":5}},"type":"if","locations":[{"start":{"line":128,"column":4},"end":{"line":153,"column":5}},{"start":{"line":128,"column":4},"end":{"line":153,"column":5}}],"line":128},"18":{"loc":{"start":{"line":129,"column":26},"end":{"line":129,"column":116}},"type":"binary-expr","locations":[{"start":{"line":129,"column":26},"end":{"line":129,"column":70}},{"start":{"line":129,"column":74},"end":{"line":129,"column":116}}],"line":129},"19":{"loc":{"start":{"line":130,"column":26},"end":{"line":130,"column":119}},"type":"binary-expr","locations":[{"start":{"line":130,"column":26},"end":{"line":130,"column":57}},{"start":{"line":130,"column":62},"end":{"line":130,"column":83}},{"start":{"line":130,"column":87},"end":{"line":130,"column":118}}],"line":130},"20":{"loc":{"start":{"line":131,"column":27},"end":{"line":131,"column":53}},"type":"binary-expr","locations":[{"start":{"line":131,"column":27},"end":{"line":131,"column":38}},{"start":{"line":131,"column":42},"end":{"line":131,"column":53}}],"line":131},"21":{"loc":{"start":{"line":133,"column":6},"end":{"line":152,"column":7}},"type":"if","locations":[{"start":{"line":133,"column":6},"end":{"line":152,"column":7}},{"start":{"line":133,"column":6},"end":{"line":152,"column":7}}],"line":133},"22":{"loc":{"start":{"line":139,"column":16},"end":{"line":139,"column":25}},"type":"binary-expr","locations":[{"start":{"line":139,"column":16},"end":{"line":139,"column":19}},{"start":{"line":139,"column":23},"end":{"line":139,"column":25}}],"line":139},"23":{"loc":{"start":{"line":156,"column":12},"end":{"line":156,"column":27}},"type":"binary-expr","locations":[{"start":{"line":156,"column":12},"end":{"line":156,"column":21}},{"start":{"line":156,"column":25},"end":{"line":156,"column":27}}],"line":156},"24":{"loc":{"start":{"line":170,"column":12},"end":{"line":170,"column":24}},"type":"binary-expr","locations":[{"start":{"line":170,"column":12},"end":{"line":170,"column":18}},{"start":{"line":170,"column":22},"end":{"line":170,"column":24}}],"line":170},"25":{"loc":{"start":{"line":182,"column":12},"end":{"line":182,"column":24}},"type":"binary-expr","locations":[{"start":{"line":182,"column":12},"end":{"line":182,"column":18}},{"start":{"line":182,"column":22},"end":{"line":182,"column":24}}],"line":182}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":2,"8":10,"9":10,"10":10,"11":2882,"12":2882,"13":2882,"14":2882,"15":2882,"16":2882,"17":2882,"18":2882,"19":2882,"20":2882,"21":2882,"22":2882,"23":45,"24":43,"25":43,"26":2,"27":20,"28":28,"29":44,"30":105,"31":0,"32":100,"33":100,"34":100,"35":42,"36":42,"37":0,"38":42,"39":42,"40":1273,"41":1273,"42":1208,"43":65,"44":65,"45":13,"46":13,"47":26,"48":13,"49":52,"50":52,"51":1,"52":1,"53":2,"54":1,"55":56,"56":8,"57":56,"58":56,"59":56,"60":56,"61":56,"62":56,"63":24,"64":24,"65":24,"66":24,"67":7,"68":8,"69":17,"70":17,"71":17,"72":17,"73":17,"74":0,"75":56,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":56,"83":21,"84":21,"85":21,"86":21,"87":0,"88":56,"89":15,"90":15,"91":15,"92":15,"93":15,"94":15,"95":0,"96":1},"f":{"0":2,"1":10,"2":10,"3":2882,"4":45,"5":20,"6":28,"7":44,"8":105,"9":0,"10":100,"11":42,"12":1273,"13":13,"14":26,"15":1,"16":2,"17":56,"18":8,"19":17,"20":17,"21":0,"22":0,"23":0,"24":0,"25":21,"26":21,"27":0,"28":15,"29":15,"30":0},"b":{"0":[0,2],"1":[2,2],"2":[2882,1731],"3":[2882,2402],"4":[2882,2764],"5":[2882,1926],"6":[2882,2655],"7":[43,2],"8":[0,42],"9":[1208,65],"10":[13,52],"11":[1,51],"12":[8,48],"13":[56,0],"14":[56,0],"15":[56,0],"16":[56,1],"17":[24,32],"18":[24,24],"19":[24,6,5],"20":[24,9],"21":[7,17],"22":[17,0],"23":[56,0],"24":[56,0],"25":[56,0]},"inputSourceMap":{"version":3,"sources":["default.js"],"names":["order","value","decorator","t","n","descriptor","DefaultHandler","constructor","options","config","type","id","client","existing","identifiers","objectFields","stripUpdateFields","functions","getAll","create","update","delete","updated","created","deleted","getClientFN","fn","Reflect","get","bind","didDelete","item","log","info","objString","didCreate","didUpdate","getType","Error","load","calcChanges","assets","typeAssets","validate","Array","isArray","duplicateNames","length","formatted","map","dups","d","name","ValidationError","duplicateIDs","processChanges","changes","del","conflicts","debug","allowDelete","byExtension","shouldDelete","warn","i","join","pool","addEachTask","data","generator","delItem","delFunction","then","catch","err","promise","updateItem","updateFN","params","payload","createItem","createFunction"],"mappings":"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","sourceRoot":"/home/circleci/repo/src/tools/auth0/handlers/","sourcesContent":["import ValidationError from '../../ValidationError';\n\nimport log from '../../logger';\nimport {\n  stripFields, dumpJSON, calcChanges, duplicateItems\n} from '../../utils';\n\nexport function order(value) {\n  return function decorator(t, n, descriptor) {\n    descriptor.value.order = value; // eslint-disable-line\n    return descriptor;\n  };\n}\n\nexport default class DefaultHandler {\n  constructor(options) {\n    this.config = options.config;\n    this.type = options.type;\n    this.id = options.id || 'id';\n    this.client = options.client;\n    this.existing = null;\n    this.identifiers = options.identifiers || [ 'id', 'name' ];\n    this.objectFields = options.objectFields || [];\n    this.stripUpdateFields = [\n      ...options.stripUpdateFields || [],\n      this.id\n    ];\n    this.functions = {\n      getAll: 'getAll',\n      create: 'create',\n      update: 'update',\n      delete: 'delete',\n      ...options.functions || {}\n    };\n\n    this.updated = 0;\n    this.created = 0;\n    this.deleted = 0;\n  }\n\n  getClientFN(fn) {\n    if (typeof fn === 'string') {\n      const client = Reflect.get(this.client, this.type);\n      return Reflect.get(client, fn).bind(client);\n    }\n    return fn;\n  }\n\n  didDelete(item) {\n    log.info(`Deleted [${this.type}]: ${this.objString(item)}`);\n  }\n\n  didCreate(item) {\n    log.info(`Created [${this.type}]: ${this.objString(item)}`);\n  }\n\n  didUpdate(item) {\n    log.info(`Updated [${this.type}]: ${this.objString(item)}`);\n  }\n\n  objString(item) {\n    return dumpJSON(item);\n  }\n\n  async getType() {\n    // Each type to impl how to get the existing as its not consistent across the mgnt api.\n    throw new Error(`Must implement getType for type ${this.type}`);\n  }\n\n  async load() {\n    // Load Asset from Tenant\n    log.info(`Retrieving ${this.type} data from Auth0`);\n    this.existing = await this.getType();\n    return { [this.type]: this.existing };\n  }\n\n  async calcChanges(assets) {\n    const typeAssets = assets[this.type];\n\n    // Do nothing if not set\n    if (!typeAssets) return {};\n\n    const existing = await this.getType();\n\n    // Figure out what needs to be updated vs created\n    return calcChanges(this, typeAssets, existing, this.identifiers, this.objectFields);\n  }\n\n  async validate(assets) {\n    // Ensure no duplication in id and name\n    const typeAssets = assets[this.type];\n\n    // Do nothing if not set\n    if (!Array.isArray(typeAssets)) return;\n\n    // Do not allow items with same name\n    const duplicateNames = duplicateItems(typeAssets, 'name');\n    if (duplicateNames.length > 0) {\n      const formatted = duplicateNames.map((dups) => dups.map((d) => `${d.name}`));\n      throw new ValidationError(`There are multiple ${this.type} with the same name combinations\n      ${dumpJSON(formatted)}.\n       Names must be unique.`);\n    }\n\n    // Do not allow items with same id\n    const duplicateIDs = duplicateItems(typeAssets, this.id);\n    if (duplicateIDs.length > 0) {\n      const formatted = duplicateIDs.map((dups) => dups.map((d) => `${d[this.id]}`));\n      throw new ValidationError(`There are multiple ${this.type} for the following stage-order combinations\n      ${dumpJSON(formatted)}.\n       Only one rule must be defined for the same order number in a stage.`);\n    }\n  }\n\n  async processChanges(assets, changes) {\n    if (!changes) {\n      changes = await this.calcChanges(assets);\n    }\n\n    const del = changes.del || [];\n    const update = changes.update || [];\n    const create = changes.create || [];\n    const conflicts = changes.conflicts || [];\n\n    log.debug(`Start processChanges for ${this.type} [delete:${del.length}] [update:${update.length}], [create:${create.length}], [conflicts:${conflicts.length}]`);\n\n    // Process Deleted\n    if (del.length > 0) {\n      const allowDelete = this.config('AUTH0_ALLOW_DELETE') === 'true' || this.config('AUTH0_ALLOW_DELETE') === true;\n      const byExtension = this.config('EXTENSION_SECRET') && (this.type === 'rules' || this.type === 'resourceServers');\n      const shouldDelete = allowDelete || byExtension;\n      if (!shouldDelete) {\n        log.warn(`Detected the following ${this.type} should be deleted. Doing so may be destructive.\\nYou can enable deletes by setting 'AUTH0_ALLOW_DELETE' to true in the config\n        \\n${changes.del.map((i) => this.objString(i)).join('\\n')}\n         `);\n      } else {\n        await this.client.pool.addEachTask({\n          data: del || [],\n          generator: (delItem) => {\n            const delFunction = this.getClientFN(this.functions.delete);\n            return delFunction({ [this.id]: delItem[this.id] })\n              .then(() => {\n                this.didDelete(delItem);\n                this.deleted += 1;\n              })\n              .catch((err) => {\n                throw new Error(`Problem deleting ${this.type} ${this.objString(delItem)}\\n${err}`);\n              });\n          }\n        }).promise();\n      }\n    }\n\n    // Process Renaming Entries Temp due to conflicts in names\n    await this.client.pool.addEachTask({\n      data: conflicts || [],\n      generator: (updateItem) => {\n        const updateFN = this.getClientFN(this.functions.update);\n        const params = { [this.id]: updateItem[this.id] };\n        const payload = stripFields({ ...updateItem }, this.stripUpdateFields);\n        return updateFN(params, payload)\n          .then((data) => this.didUpdate(data))\n          .catch((err) => {\n            throw new Error(`Problem updating ${this.type} ${this.objString(updateItem)}\\n${err}`);\n          });\n      }\n    }).promise();\n\n    // Process Creations\n    await this.client.pool.addEachTask({\n      data: create || [],\n      generator: (createItem) => {\n        const createFunction = this.getClientFN(this.functions.create);\n        return createFunction(createItem)\n          .then((data) => {\n            this.didCreate(data);\n            this.created += 1;\n          })\n          .catch((err) => {\n            throw new Error(`Problem creating ${this.type} ${this.objString(createItem)}\\n${err}`);\n          });\n      }\n    }).promise();\n\n    // Process Updates and strip fields not allowed in updates\n    await this.client.pool.addEachTask({\n      data: update || [],\n      generator: (updateItem) => {\n        const updateFN = this.getClientFN(this.functions.update);\n        const params = { [this.id]: updateItem[this.id] };\n        const payload = stripFields({ ...updateItem }, this.stripUpdateFields);\n        return updateFN(params, payload)\n          .then((data) => {\n            this.didUpdate(data);\n            this.updated += 1;\n          })\n          .catch((err) => {\n            throw new Error(`Problem updating ${this.type} ${this.objString(updateItem)}\\n${err}`);\n          });\n      }\n    }).promise();\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"b83cac475f9415a22cb2db976b3a3c03498edc70","contentHash":"e670097fcff4296df03720b951210950df90ba5b4b9aad295df717646e1f611a"},"/home/circleci/repo/src/tools/auth0/handlers/rulesConfigs.js":{"path":"/home/circleci/repo/src/tools/auth0/handlers/rulesConfigs.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":27}},"2":{"start":{"line":8,"column":15},"end":{"line":8,"column":35}},"3":{"start":{"line":10,"column":16},"end":{"line":10,"column":48}},"4":{"start":{"line":12,"column":39},"end":{"line":12,"column":93}},"5":{"start":{"line":14,"column":15},"end":{"line":30,"column":1}},"6":{"start":{"line":34,"column":4},"end":{"line":40,"column":7}},"7":{"start":{"line":44,"column":4},"end":{"line":44,"column":45}},"8":{"start":{"line":48,"column":4},"end":{"line":50,"column":7}},"9":{"start":{"line":56,"column":8},"end":{"line":56,"column":14}},"10":{"start":{"line":57,"column":4},"end":{"line":57,"column":57}},"11":{"start":{"line":57,"column":47},"end":{"line":57,"column":57}},"12":{"start":{"line":58,"column":4},"end":{"line":62,"column":6}},"13":{"start":{"line":67,"column":0},"end":{"line":67,"column":38}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":12,"column":9},"end":{"line":12,"column":31}},"loc":{"start":{"line":12,"column":37},"end":{"line":12,"column":95}},"line":12},"1":{"name":"(anonymous_1)","decl":{"start":{"line":33,"column":2},"end":{"line":33,"column":3}},"loc":{"start":{"line":33,"column":23},"end":{"line":41,"column":3}},"line":33},"2":{"name":"(anonymous_2)","decl":{"start":{"line":43,"column":2},"end":{"line":43,"column":3}},"loc":{"start":{"line":43,"column":18},"end":{"line":45,"column":3}},"line":43},"3":{"name":"(anonymous_3)","decl":{"start":{"line":47,"column":2},"end":{"line":47,"column":3}},"loc":{"start":{"line":47,"column":18},"end":{"line":51,"column":3}},"line":47},"4":{"name":"(anonymous_4)","decl":{"start":{"line":53,"column":2},"end":{"line":53,"column":3}},"loc":{"start":{"line":53,"column":28},"end":{"line":63,"column":3}},"line":53}},"branchMap":{"0":{"loc":{"start":{"line":12,"column":46},"end":{"line":12,"column":92}},"type":"cond-expr","locations":[{"start":{"line":12,"column":70},"end":{"line":12,"column":73}},{"start":{"line":12,"column":76},"end":{"line":12,"column":92}}],"line":12},"1":{"loc":{"start":{"line":12,"column":46},"end":{"line":12,"column":67}},"type":"binary-expr","locations":[{"start":{"line":12,"column":46},"end":{"line":12,"column":49}},{"start":{"line":12,"column":53},"end":{"line":12,"column":67}}],"line":12},"2":{"loc":{"start":{"line":57,"column":4},"end":{"line":57,"column":57}},"type":"if","locations":[{"start":{"line":57,"column":4},"end":{"line":57,"column":57}},{"start":{"line":57,"column":4},"end":{"line":57,"column":57}}],"line":57},"3":{"loc":{"start":{"line":57,"column":8},"end":{"line":57,"column":45}},"type":"binary-expr","locations":[{"start":{"line":57,"column":8},"end":{"line":57,"column":21}},{"start":{"line":57,"column":25},"end":{"line":57,"column":45}}],"line":57}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":110,"7":5,"8":1,"9":1,"10":1,"11":0,"12":1,"13":1},"f":{"0":1,"1":110,"2":5,"3":1,"4":1},"b":{"0":[1,0],"1":[1,1],"2":[0,1],"3":[1,1]},"inputSourceMap":{"version":3,"sources":["rulesConfigs.js"],"names":["schema","type","items","properties","key","pattern","value","required","additionalProperties","RulesConfigsHandler","DefaultHandler","constructor","options","id","functions","update","getType","client","rulesConfigs","getAll","objString","item","calcChanges","assets","length","del","create"],"mappings":";;;;;;;AAAA;;;;;;AAEO,MAAMA,MAAM,WAANA,MAAM,GAAG;AACpBC,EAAAA,IAAI,EAAE,OADc;AAEpBC,EAAAA,KAAK,EAAE;AACLD,IAAAA,IAAI,EAAE,QADD;AAELE,IAAAA,UAAU,EAAE;AACVC,MAAAA,GAAG,EAAE;AAAEH,QAAAA,IAAI,EAAE,QAAR;AAAkBI,QAAAA,OAAO,EAAE;AAA3B,OADK;AAEVC,MAAAA,KAAK,EAAE;AAAEL,QAAAA,IAAI,EAAE;AAAR;AAFG,KAFP;AAMLM,IAAAA,QAAQ,EAAE,CAAE,KAAF,EAAS,OAAT;AANL,GAFa;AAUpBC,EAAAA,oBAAoB,EAAE;AAVF,CAAf;;AAaQ,MAAMC,mBAAN,SAAkCC,iBAAlC,CAAiD;AAC9DC,EAAAA,WAAW,CAACC,OAAD,EAAU;AACnB,UAAM,EACJ,GAAGA,OADC;AAEJX,MAAAA,IAAI,EAAE,cAFF;AAGJY,MAAAA,EAAE,EAAE,KAHA;AAIJC,MAAAA,SAAS,EAAE;AACTC,QAAAA,MAAM,EAAE;AADC;AAJP,KAAN;AAQD;;AAEY,QAAPC,OAAO,GAAG;AACd,WAAO,KAAKC,MAAL,CAAYC,YAAZ,CAAyBC,MAAzB,EAAP;AACD;;AAEDC,EAAAA,SAAS,CAACC,IAAD,EAAO;AACd,WAAO,MAAMD,SAAN,CAAgB;AAAEhB,MAAAA,GAAG,EAAEiB,IAAI,CAACjB;AAAZ,KAAhB,CAAP;AACD;;AAEgB,QAAXkB,WAAW,CAACC,MAAD,EAAS;AACxB,UAAM;AAAEL,MAAAA;AAAF,QAAmBK,MAAzB;AAGA,QAAI,CAACL,YAAD,IAAiB,CAACA,YAAY,CAACM,MAAnC,EAA2C,OAAO,EAAP;AAG3C,WAAO;AACLC,MAAAA,GAAG,EAAE,EADA;AAELV,MAAAA,MAAM,EAAEG,YAFH;AAGLQ,MAAAA,MAAM,EAAE;AAHH,KAAP;AAKD;;AAhC6D;;kBAA3CjB,mB","sourceRoot":"/home/circleci/repo/src/tools/auth0/handlers/","sourcesContent":["import DefaultHandler from './default';\n\nexport const schema = {\n  type: 'array',\n  items: {\n    type: 'object',\n    properties: {\n      key: { type: 'string', pattern: '^[A-Za-z0-9_-]*$' },\n      value: { type: 'string' }\n    },\n    required: [ 'key', 'value' ]\n  },\n  additionalProperties: false\n};\n\nexport default class RulesConfigsHandler extends DefaultHandler {\n  constructor(options) {\n    super({\n      ...options,\n      type: 'rulesConfigs',\n      id: 'key',\n      functions: {\n        update: 'set' // Update or Creation of a ruleConfig is via set not update\n      }\n    });\n  }\n\n  async getType() {\n    return this.client.rulesConfigs.getAll();\n  }\n\n  objString(item) {\n    return super.objString({ key: item.key });\n  }\n\n  async calcChanges(assets) {\n    const { rulesConfigs } = assets;\n\n    // Do nothing if not set\n    if (!rulesConfigs || !rulesConfigs.length) return {};\n\n    // Intention is to not delete/cleanup old configRules, that needs to be handled manually.\n    return {\n      del: [],\n      update: rulesConfigs,\n      create: []\n    };\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"fdbc6a8685a5077d5439e039158da94545c4ec69","contentHash":"09789a3cf4ec661d41853bdb84a05de3eab25bb4fbf3bdc18719b62dc3dff582"},"/home/circleci/repo/src/tools/auth0/handlers/hooks.js":{"path":"/home/circleci/repo/src/tools/auth0/handlers/hooks.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":51}},"2":{"start":{"line":8,"column":15},"end":{"line":8,"column":35}},"3":{"start":{"line":10,"column":16},"end":{"line":10,"column":48}},"4":{"start":{"line":12,"column":17},"end":{"line":12,"column":43}},"5":{"start":{"line":14,"column":18},"end":{"line":14,"column":52}},"6":{"start":{"line":16,"column":39},"end":{"line":16,"column":93}},"7":{"start":{"line":18,"column":28},"end":{"line":18,"column":149}},"8":{"start":{"line":19,"column":22},"end":{"line":24,"column":1}},"9":{"start":{"line":25,"column":15},"end":{"line":64,"column":1}},"10":{"start":{"line":66,"column":23},"end":{"line":74,"column":1}},"11":{"start":{"line":67,"column":15},"end":{"line":67,"column":19}},"12":{"start":{"line":68,"column":2},"end":{"line":72,"column":5}},"13":{"start":{"line":69,"column":4},"end":{"line":71,"column":5}},"14":{"start":{"line":70,"column":6},"end":{"line":70,"column":20}},"15":{"start":{"line":73,"column":2},"end":{"line":73,"column":16}},"16":{"start":{"line":76,"column":18},"end":{"line":82,"column":1}},"17":{"start":{"line":77,"column":17},"end":{"line":77,"column":19}},"18":{"start":{"line":78,"column":2},"end":{"line":80,"column":5}},"19":{"start":{"line":79,"column":4},"end":{"line":79,"column":71}},"20":{"start":{"line":79,"column":37},"end":{"line":79,"column":69}},"21":{"start":{"line":81,"column":2},"end":{"line":81,"column":16}},"22":{"start":{"line":86,"column":4},"end":{"line":89,"column":7}},"23":{"start":{"line":93,"column":4},"end":{"line":96,"column":7}},"24":{"start":{"line":100,"column":21},"end":{"line":100,"column":45}},"25":{"start":{"line":101,"column":20},"end":{"line":105,"column":5}},"26":{"start":{"line":106,"column":4},"end":{"line":140,"column":7}},"27":{"start":{"line":107,"column":22},"end":{"line":107,"column":73}},"28":{"start":{"line":109,"column":6},"end":{"line":139,"column":7}},"29":{"start":{"line":110,"column":27},"end":{"line":110,"column":48}},"30":{"start":{"line":111,"column":27},"end":{"line":111,"column":45}},"31":{"start":{"line":112,"column":23},"end":{"line":112,"column":25}},"32":{"start":{"line":113,"column":23},"end":{"line":113,"column":25}},"33":{"start":{"line":114,"column":20},"end":{"line":114,"column":22}},"34":{"start":{"line":115,"column":8},"end":{"line":121,"column":11}},"35":{"start":{"line":116,"column":10},"end":{"line":120,"column":11}},"36":{"start":{"line":117,"column":12},"end":{"line":117,"column":42}},"37":{"start":{"line":118,"column":17},"end":{"line":120,"column":11}},"38":{"start":{"line":119,"column":12},"end":{"line":119,"column":42}},"39":{"start":{"line":122,"column":8},"end":{"line":126,"column":11}},"40":{"start":{"line":123,"column":10},"end":{"line":125,"column":11}},"41":{"start":{"line":124,"column":12},"end":{"line":124,"column":26}},"42":{"start":{"line":127,"column":8},"end":{"line":130,"column":11}},"43":{"start":{"line":127,"column":40},"end":{"line":130,"column":11}},"44":{"start":{"line":131,"column":8},"end":{"line":134,"column":11}},"45":{"start":{"line":131,"column":40},"end":{"line":134,"column":11}},"46":{"start":{"line":135,"column":8},"end":{"line":138,"column":11}},"47":{"start":{"line":135,"column":24},"end":{"line":138,"column":11}},"48":{"start":{"line":141,"column":4},"end":{"line":145,"column":8}},"49":{"start":{"line":142,"column":6},"end":{"line":144,"column":23}},"50":{"start":{"line":146,"column":4},"end":{"line":150,"column":8}},"51":{"start":{"line":147,"column":6},"end":{"line":149,"column":23}},"52":{"start":{"line":151,"column":4},"end":{"line":155,"column":8}},"53":{"start":{"line":152,"column":6},"end":{"line":154,"column":23}},"54":{"start":{"line":159,"column":4},"end":{"line":161,"column":5}},"55":{"start":{"line":160,"column":6},"end":{"line":160,"column":27}},"56":{"start":{"line":163,"column":4},"end":{"line":165,"column":5}},"57":{"start":{"line":164,"column":6},"end":{"line":164,"column":16}},"58":{"start":{"line":167,"column":4},"end":{"line":186,"column":5}},"59":{"start":{"line":168,"column":20},"end":{"line":171,"column":8}},"60":{"start":{"line":172,"column":6},"end":{"line":178,"column":13}},"61":{"start":{"line":172,"column":58},"end":{"line":178,"column":10}},"62":{"start":{"line":174,"column":30},"end":{"line":178,"column":9}},"63":{"start":{"line":176,"column":26},"end":{"line":178,"column":7}},"64":{"start":{"line":179,"column":6},"end":{"line":179,"column":27}},"65":{"start":{"line":181,"column":6},"end":{"line":183,"column":7}},"66":{"start":{"line":182,"column":8},"end":{"line":182,"column":18}},"67":{"start":{"line":185,"column":6},"end":{"line":185,"column":16}},"68":{"start":{"line":195,"column":8},"end":{"line":195,"column":39}},"69":{"start":{"line":197,"column":25},"end":{"line":199,"column":7}},"70":{"start":{"line":197,"column":33},"end":{"line":199,"column":7}},"71":{"start":{"line":197,"column":51},"end":{"line":199,"column":5}},"72":{"start":{"line":201,"column":4},"end":{"line":206,"column":6}},"73":{"start":{"line":212,"column":8},"end":{"line":212,"column":14}},"74":{"start":{"line":213,"column":4},"end":{"line":213,"column":23}},"75":{"start":{"line":213,"column":16},"end":{"line":213,"column":23}},"76":{"start":{"line":214,"column":24},"end":{"line":214,"column":40}},"77":{"start":{"line":215,"column":4},"end":{"line":222,"column":7}},"78":{"start":{"line":216,"column":6},"end":{"line":221,"column":7}},"79":{"start":{"line":217,"column":25},"end":{"line":217,"column":70}},"80":{"start":{"line":217,"column":52},"end":{"line":217,"column":58}},"81":{"start":{"line":218,"column":20},"end":{"line":218,"column":127}},"82":{"start":{"line":219,"column":8},"end":{"line":219,"column":25}},"83":{"start":{"line":220,"column":8},"end":{"line":220,"column":18}},"84":{"start":{"line":223,"column":4},"end":{"line":223,"column":33}},"85":{"start":{"line":229,"column":8},"end":{"line":229,"column":14}},"86":{"start":{"line":230,"column":4},"end":{"line":230,"column":23}},"87":{"start":{"line":230,"column":16},"end":{"line":230,"column":23}},"88":{"start":{"line":231,"column":20},"end":{"line":231,"column":50}},"89":{"start":{"line":232,"column":4},"end":{"line":237,"column":7}},"90":{"start":{"line":238,"column":4},"end":{"line":238,"column":37}},"91":{"start":{"line":243,"column":0},"end":{"line":243,"column":31}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":16,"column":9},"end":{"line":16,"column":31}},"loc":{"start":{"line":16,"column":37},"end":{"line":16,"column":95}},"line":16},"1":{"name":"(anonymous_1)","decl":{"start":{"line":66,"column":23},"end":{"line":66,"column":24}},"loc":{"start":{"line":66,"column":51},"end":{"line":74,"column":1}},"line":66},"2":{"name":"(anonymous_2)","decl":{"start":{"line":68,"column":16},"end":{"line":68,"column":17}},"loc":{"start":{"line":68,"column":24},"end":{"line":72,"column":3}},"line":68},"3":{"name":"(anonymous_3)","decl":{"start":{"line":76,"column":18},"end":{"line":76,"column":19}},"loc":{"start":{"line":76,"column":27},"end":{"line":82,"column":1}},"line":76},"4":{"name":"(anonymous_4)","decl":{"start":{"line":78,"column":30},"end":{"line":78,"column":31}},"loc":{"start":{"line":78,"column":38},"end":{"line":80,"column":3}},"line":78},"5":{"name":"(anonymous_5)","decl":{"start":{"line":79,"column":32},"end":{"line":79,"column":33}},"loc":{"start":{"line":79,"column":37},"end":{"line":79,"column":69}},"line":79},"6":{"name":"(anonymous_6)","decl":{"start":{"line":85,"column":2},"end":{"line":85,"column":3}},"loc":{"start":{"line":85,"column":23},"end":{"line":90,"column":3}},"line":85},"7":{"name":"(anonymous_7)","decl":{"start":{"line":92,"column":2},"end":{"line":92,"column":3}},"loc":{"start":{"line":92,"column":18},"end":{"line":97,"column":3}},"line":92},"8":{"name":"(anonymous_8)","decl":{"start":{"line":99,"column":2},"end":{"line":99,"column":3}},"loc":{"start":{"line":99,"column":30},"end":{"line":156,"column":3}},"line":99},"9":{"name":"(anonymous_9)","decl":{"start":{"line":106,"column":18},"end":{"line":106,"column":19}},"loc":{"start":{"line":106,"column":26},"end":{"line":140,"column":5}},"line":106},"10":{"name":"(anonymous_10)","decl":{"start":{"line":115,"column":40},"end":{"line":115,"column":41}},"loc":{"start":{"line":115,"column":47},"end":{"line":121,"column":9}},"line":115},"11":{"name":"(anonymous_11)","decl":{"start":{"line":122,"column":40},"end":{"line":122,"column":41}},"loc":{"start":{"line":122,"column":47},"end":{"line":126,"column":9}},"line":122},"12":{"name":"(anonymous_12)","decl":{"start":{"line":141,"column":38},"end":{"line":141,"column":39}},"loc":{"start":{"line":141,"column":52},"end":{"line":145,"column":5}},"line":141},"13":{"name":"(anonymous_13)","decl":{"start":{"line":146,"column":41},"end":{"line":146,"column":42}},"loc":{"start":{"line":146,"column":55},"end":{"line":150,"column":5}},"line":146},"14":{"name":"(anonymous_14)","decl":{"start":{"line":151,"column":41},"end":{"line":151,"column":42}},"loc":{"start":{"line":151,"column":55},"end":{"line":155,"column":5}},"line":151},"15":{"name":"(anonymous_15)","decl":{"start":{"line":158,"column":2},"end":{"line":158,"column":3}},"loc":{"start":{"line":158,"column":24},"end":{"line":187,"column":3}},"line":158},"16":{"name":"(anonymous_16)","decl":{"start":{"line":172,"column":50},"end":{"line":172,"column":51}},"loc":{"start":{"line":172,"column":58},"end":{"line":178,"column":10}},"line":172},"17":{"name":"(anonymous_17)","decl":{"start":{"line":174,"column":14},"end":{"line":174,"column":15}},"loc":{"start":{"line":174,"column":30},"end":{"line":178,"column":9}},"line":174},"18":{"name":"(anonymous_18)","decl":{"start":{"line":176,"column":14},"end":{"line":176,"column":15}},"loc":{"start":{"line":176,"column":26},"end":{"line":178,"column":7}},"line":176},"19":{"name":"(anonymous_19)","decl":{"start":{"line":189,"column":2},"end":{"line":189,"column":3}},"loc":{"start":{"line":189,"column":28},"end":{"line":207,"column":3}},"line":189},"20":{"name":"(anonymous_20)","decl":{"start":{"line":197,"column":25},"end":{"line":197,"column":26}},"loc":{"start":{"line":197,"column":33},"end":{"line":199,"column":7}},"line":197},"21":{"name":"(anonymous_21)","decl":{"start":{"line":197,"column":42},"end":{"line":197,"column":43}},"loc":{"start":{"line":197,"column":51},"end":{"line":199,"column":5}},"line":197},"22":{"name":"(anonymous_22)","decl":{"start":{"line":209,"column":2},"end":{"line":209,"column":3}},"loc":{"start":{"line":209,"column":25},"end":{"line":224,"column":3}},"line":209},"23":{"name":"(anonymous_23)","decl":{"start":{"line":215,"column":32},"end":{"line":215,"column":33}},"loc":{"start":{"line":215,"column":40},"end":{"line":222,"column":5}},"line":215},"24":{"name":"(anonymous_24)","decl":{"start":{"line":217,"column":47},"end":{"line":217,"column":48}},"loc":{"start":{"line":217,"column":52},"end":{"line":217,"column":58}},"line":217},"25":{"name":"(anonymous_25)","decl":{"start":{"line":226,"column":2},"end":{"line":226,"column":3}},"loc":{"start":{"line":226,"column":31},"end":{"line":239,"column":3}},"line":226}},"branchMap":{"0":{"loc":{"start":{"line":16,"column":46},"end":{"line":16,"column":92}},"type":"cond-expr","locations":[{"start":{"line":16,"column":70},"end":{"line":16,"column":73}},{"start":{"line":16,"column":76},"end":{"line":16,"column":92}}],"line":16},"1":{"loc":{"start":{"line":16,"column":46},"end":{"line":16,"column":67}},"type":"binary-expr","locations":[{"start":{"line":16,"column":46},"end":{"line":16,"column":49}},{"start":{"line":16,"column":53},"end":{"line":16,"column":67}}],"line":16},"2":{"loc":{"start":{"line":69,"column":4},"end":{"line":71,"column":5}},"type":"if","locations":[{"start":{"line":69,"column":4},"end":{"line":71,"column":5}},{"start":{"line":69,"column":4},"end":{"line":71,"column":5}}],"line":69},"3":{"loc":{"start":{"line":69,"column":8},"end":{"line":69,"column":58}},"type":"binary-expr","locations":[{"start":{"line":69,"column":8},"end":{"line":69,"column":26}},{"start":{"line":69,"column":30},"end":{"line":69,"column":58}}],"line":69},"4":{"loc":{"start":{"line":79,"column":37},"end":{"line":79,"column":69}},"type":"binary-expr","locations":[{"start":{"line":79,"column":37},"end":{"line":79,"column":45}},{"start":{"line":79,"column":49},"end":{"line":79,"column":69}}],"line":79},"5":{"loc":{"start":{"line":109,"column":6},"end":{"line":139,"column":7}},"type":"if","locations":[{"start":{"line":109,"column":6},"end":{"line":139,"column":7}},{"start":{"line":109,"column":6},"end":{"line":139,"column":7}}],"line":109},"6":{"loc":{"start":{"line":110,"column":27},"end":{"line":110,"column":48}},"type":"binary-expr","locations":[{"start":{"line":110,"column":27},"end":{"line":110,"column":42}},{"start":{"line":110,"column":46},"end":{"line":110,"column":48}}],"line":110},"7":{"loc":{"start":{"line":111,"column":27},"end":{"line":111,"column":45}},"type":"binary-expr","locations":[{"start":{"line":111,"column":27},"end":{"line":111,"column":39}},{"start":{"line":111,"column":43},"end":{"line":111,"column":45}}],"line":111},"8":{"loc":{"start":{"line":116,"column":10},"end":{"line":120,"column":11}},"type":"if","locations":[{"start":{"line":116,"column":10},"end":{"line":120,"column":11}},{"start":{"line":116,"column":10},"end":{"line":120,"column":11}}],"line":116},"9":{"loc":{"start":{"line":118,"column":17},"end":{"line":120,"column":11}},"type":"if","locations":[{"start":{"line":118,"column":17},"end":{"line":120,"column":11}},{"start":{"line":118,"column":17},"end":{"line":120,"column":11}}],"line":118},"10":{"loc":{"start":{"line":123,"column":10},"end":{"line":125,"column":11}},"type":"if","locations":[{"start":{"line":123,"column":10},"end":{"line":125,"column":11}},{"start":{"line":123,"column":10},"end":{"line":125,"column":11}}],"line":123},"11":{"loc":{"start":{"line":127,"column":8},"end":{"line":130,"column":11}},"type":"if","locations":[{"start":{"line":127,"column":8},"end":{"line":130,"column":11}},{"start":{"line":127,"column":8},"end":{"line":130,"column":11}}],"line":127},"12":{"loc":{"start":{"line":131,"column":8},"end":{"line":134,"column":11}},"type":"if","locations":[{"start":{"line":131,"column":8},"end":{"line":134,"column":11}},{"start":{"line":131,"column":8},"end":{"line":134,"column":11}}],"line":131},"13":{"loc":{"start":{"line":135,"column":8},"end":{"line":138,"column":11}},"type":"if","locations":[{"start":{"line":135,"column":8},"end":{"line":138,"column":11}},{"start":{"line":135,"column":8},"end":{"line":138,"column":11}}],"line":135},"14":{"loc":{"start":{"line":159,"column":4},"end":{"line":161,"column":5}},"type":"if","locations":[{"start":{"line":159,"column":4},"end":{"line":161,"column":5}},{"start":{"line":159,"column":4},"end":{"line":161,"column":5}}],"line":159},"15":{"loc":{"start":{"line":159,"column":8},"end":{"line":159,"column":32}},"type":"binary-expr","locations":[{"start":{"line":159,"column":8},"end":{"line":159,"column":21}},{"start":{"line":159,"column":25},"end":{"line":159,"column":32}}],"line":159},"16":{"loc":{"start":{"line":163,"column":4},"end":{"line":165,"column":5}},"type":"if","locations":[{"start":{"line":163,"column":4},"end":{"line":165,"column":5}},{"start":{"line":163,"column":4},"end":{"line":165,"column":5}}],"line":163},"17":{"loc":{"start":{"line":163,"column":8},"end":{"line":163,"column":76}},"type":"binary-expr","locations":[{"start":{"line":163,"column":8},"end":{"line":163,"column":26}},{"start":{"line":163,"column":30},"end":{"line":163,"column":76}}],"line":163},"18":{"loc":{"start":{"line":181,"column":6},"end":{"line":183,"column":7}},"type":"if","locations":[{"start":{"line":181,"column":6},"end":{"line":183,"column":7}},{"start":{"line":181,"column":6},"end":{"line":183,"column":7}}],"line":181},"19":{"loc":{"start":{"line":181,"column":10},"end":{"line":181,"column":58}},"type":"binary-expr","locations":[{"start":{"line":181,"column":10},"end":{"line":181,"column":32}},{"start":{"line":181,"column":36},"end":{"line":181,"column":58}}],"line":181},"20":{"loc":{"start":{"line":213,"column":4},"end":{"line":213,"column":23}},"type":"if","locations":[{"start":{"line":213,"column":4},"end":{"line":213,"column":23}},{"start":{"line":213,"column":4},"end":{"line":213,"column":23}}],"line":213},"21":{"loc":{"start":{"line":216,"column":6},"end":{"line":221,"column":7}},"type":"if","locations":[{"start":{"line":216,"column":6},"end":{"line":221,"column":7}},{"start":{"line":216,"column":6},"end":{"line":221,"column":7}}],"line":216},"22":{"loc":{"start":{"line":230,"column":4},"end":{"line":230,"column":23}},"type":"if","locations":[{"start":{"line":230,"column":4},"end":{"line":230,"column":23}},{"start":{"line":230,"column":4},"end":{"line":230,"column":23}}],"line":230}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":2,"7":1,"8":1,"9":1,"10":1,"11":5,"12":5,"13":5,"14":4,"15":5,"16":1,"17":5,"18":5,"19":25,"20":65,"21":5,"22":120,"23":6,"24":5,"25":5,"26":5,"27":5,"28":5,"29":4,"30":4,"31":4,"32":4,"33":4,"34":4,"35":6,"36":3,"37":3,"38":2,"39":4,"40":5,"41":2,"42":4,"43":2,"44":4,"45":1,"46":4,"47":1,"48":5,"49":1,"50":5,"51":1,"52":5,"53":2,"54":18,"55":0,"56":18,"57":0,"58":18,"59":18,"60":15,"61":11,"62":11,"63":11,"64":15,"65":3,"66":2,"67":1,"68":5,"69":5,"70":15,"71":5,"72":5,"73":62,"74":62,"75":57,"76":5,"77":5,"78":21,"79":1,"80":2,"81":1,"82":1,"83":1,"84":4,"85":5,"86":5,"87":0,"88":5,"89":5,"90":5,"91":1},"f":{"0":2,"1":5,"2":5,"3":5,"4":25,"5":65,"6":120,"7":6,"8":5,"9":5,"10":6,"11":5,"12":1,"13":1,"14":2,"15":18,"16":11,"17":11,"18":11,"19":5,"20":15,"21":5,"22":62,"23":21,"24":2,"25":5},"b":{"0":[2,0],"1":[2,2],"2":[4,1],"3":[5,4],"4":[65,25],"5":[4,1],"6":[4,0],"7":[4,1],"8":[3,3],"9":[2,1],"10":[2,3],"11":[2,2],"12":[1,3],"13":[1,3],"14":[0,18],"15":[18,5],"16":[0,18],"17":[18,18],"18":[2,1],"19":[3,2],"20":[57,5],"21":[1,20],"22":[0,5]},"inputSourceMap":{"version":3,"sources":["hooks.js"],"names":["ALLOWED_TRIGGER_IDS","excludeSchema","type","items","schema","default","properties","script","description","name","pattern","enabled","triggerId","enum","secrets","dependencies","required","getCertainHook","hooks","result","forEach","hook","getActive","filter","h","active","HooksHandler","DefaultHandler","constructor","options","stripUpdateFields","objString","processSecrets","allHooks","getType","changes","create","update","del","current","oldSecrets","newSecrets","Object","keys","key","constants","HOOKS_HIDDEN_SECRET_VALUE","push","length","hookId","id","Promise","all","map","data","client","removeSecrets","updateSecrets","addSecrets","reload","existing","getAll","paginate","include_totals","get","then","hookWithCode","getSecrets","err","statusCode","calcChanges","assets","conflicts","stripSecrets","list","item","undefined","validate","activeHooks","conflict","join","Error","status","processChanges"],"mappings":"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","sourceRoot":"/home/circleci/repo/src/tools/auth0/handlers/","sourcesContent":["import DefaultHandler from './default';\nimport constants from '../../constants';\n\nconst ALLOWED_TRIGGER_IDS = [ 'credentials-exchange', 'pre-user-registration', 'post-user-registration', 'post-change-password', 'send-phone-message' ];\n\nexport const excludeSchema = {\n  type: 'array',\n  items: { type: 'string' }\n};\n\nexport const schema = {\n  type: 'array',\n  items: {\n    type: 'object',\n    default: [],\n    properties: {\n      script: {\n        type: 'string',\n        description: 'A script that contains the hook\\'s code',\n        default: ''\n      },\n      name: {\n        type: 'string',\n        description: 'The name of the hook. Can only contain alphanumeric characters, spaces and \\'-\\'. Can neither start nor end with \\'-\\' or spaces',\n        pattern: '^[^-\\\\s][a-zA-Z0-9-\\\\s]+[^-\\\\s]$'\n      },\n      enabled: {\n        type: 'boolean',\n        description: 'true if the hook is active, false otherwise',\n        default: false\n      },\n      triggerId: {\n        type: 'string',\n        description: 'The hooks\\'s trigger ID',\n        enum: ALLOWED_TRIGGER_IDS\n      },\n      secrets: {\n        type: 'object',\n        description: 'List of key-value pairs containing secrets available to the hook.',\n        default: {}\n      },\n      dependencies: {\n        type: 'object',\n        default: {},\n        description: 'List of key-value pairs of NPM dependencies available to the hook.'\n      }\n    },\n    required: [ 'script', 'name', 'triggerId' ]\n  }\n};\n\nconst getCertainHook = (hooks, name, triggerId) => {\n  let result = null;\n\n  hooks.forEach((hook) => {\n    if (hook.name === name && hook.triggerId === triggerId) {\n      result = hook;\n    }\n  });\n\n  return result;\n};\n\nconst getActive = (hooks) => {\n  const result = {};\n\n  ALLOWED_TRIGGER_IDS.forEach((type) => {\n    result[type] = hooks.filter((h) => h.active && h.triggerId === type);\n  });\n\n  return result;\n};\n\nexport default class HooksHandler extends DefaultHandler {\n  constructor(options) {\n    super({\n      ...options,\n      type: 'hooks',\n      stripUpdateFields: [ 'id', 'triggerId' ]\n    });\n  }\n\n  objString(hook) {\n    return super.objString({ name: hook.name, triggerId: hook.triggerId });\n  }\n\n  async processSecrets(hooks) {\n    const allHooks = await this.getType(true);\n    const changes = {\n      create: [],\n      update: [],\n      del: []\n    };\n\n    hooks.forEach((hook) => {\n      const current = getCertainHook(allHooks, hook.name, hook.triggerId);\n      if (current) { // if the hook was deleted we don't care about its secrets\n        const oldSecrets = current.secrets || {};\n        const newSecrets = hook.secrets || {};\n        const create = {};\n        const update = {};\n        const del = [];\n\n        Object.keys(newSecrets).forEach((key) => {\n          if (!oldSecrets[key]) {\n            create[key] = newSecrets[key];\n          } else if (newSecrets[key] !== constants.HOOKS_HIDDEN_SECRET_VALUE) {\n            update[key] = newSecrets[key];\n          }\n        });\n\n        Object.keys(oldSecrets).forEach((key) => {\n          if (!newSecrets[key]) {\n            del.push(key);\n          }\n        });\n\n        if (Object.keys(create).length) changes.create.push({ hookId: current.id, secrets: create });\n        if (Object.keys(update).length) changes.update.push({ hookId: current.id, secrets: update });\n        if (del.length) changes.del.push({ hookId: current.id, secrets: del });\n      }\n    });\n\n    await Promise.all(changes.del.map(async (data) => {\n      await this.client.hooks.removeSecrets({ id: data.hookId }, data.secrets);\n    }));\n\n    await Promise.all(changes.update.map(async (data) => {\n      await this.client.hooks.updateSecrets({ id: data.hookId }, data.secrets);\n    }));\n\n    await Promise.all(changes.create.map(async (data) => {\n      await this.client.hooks.addSecrets({ id: data.hookId }, data.secrets);\n    }));\n  }\n\n  async getType(reload) {\n    if (this.existing && !reload) {\n      return this.existing;\n    }\n\n    // in case client version does not support hooks\n    if (!this.client.hooks || typeof this.client.hooks.getAll !== 'function') {\n      return [];\n    }\n\n    try {\n      const hooks = await this.client.hooks.getAll({ paginate: true, include_totals: true });\n\n      // hooks.getAll does not return code and secrets, we have to fetch hooks one-by-one\n      this.existing = await Promise.all(hooks.map((hook) => this.client.hooks.get({ id: hook.id })\n        .then((hookWithCode) => this.client.hooks.getSecrets({ id: hook.id })\n          .then((secrets) => ({ ...hookWithCode, secrets })))));\n\n      return this.existing;\n    } catch (err) {\n      if (err.statusCode === 404 || err.statusCode === 501) {\n        return [];\n      }\n      throw err;\n    }\n  }\n\n  async calcChanges(assets) {\n    const {\n      del, update, create, conflicts\n    } = await super.calcChanges(assets);\n\n    // strip secrets before hooks creating/updating, secrets have to be handled separately\n    const stripSecrets = (list) => list.map((item) => ({ ...item, secrets: undefined }));\n\n    return {\n      del,\n      update: stripSecrets(update),\n      create: stripSecrets(create),\n      conflicts: stripSecrets(conflicts)\n    };\n  }\n\n  async validate(assets) {\n    const { hooks } = assets;\n\n    // Do nothing if not set\n    if (!hooks) return;\n\n    const activeHooks = getActive(hooks);\n\n    ALLOWED_TRIGGER_IDS.forEach((type) => {\n      if (activeHooks[type].length > 1) { // There can be only one!\n        const conflict = activeHooks[type].map((h) => h.name).join(', ');\n        const err = new Error(`Only one active hook allowed for \"${type}\" extensibility point. Conflicting hooks: ${conflict}`);\n        err.status = 409;\n        throw err;\n      }\n    });\n\n    await super.validate(assets);\n  }\n\n  async processChanges(assets) {\n    const { hooks } = assets;\n\n    // Do nothing if not set\n    if (!hooks) return;\n\n    // Figure out what needs to be updated vs created\n    const changes = await this.calcChanges(assets);\n    await super.processChanges(assets, {\n      del: changes.del,\n      create: changes.create,\n      update: changes.update,\n      conflicts: changes.conflicts\n    });\n\n    await this.processSecrets(hooks);\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"edac60b56a64331ed81f04d7d71ceac537566f48","contentHash":"bc542e871c066cb7926064760d48866c32bfd7c22cc39e8ff401b525e2bf1b83"},"/home/circleci/repo/src/tools/auth0/handlers/pages.js":{"path":"/home/circleci/repo/src/tools/auth0/handlers/pages.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":74}},"2":{"start":{"line":8,"column":15},"end":{"line":8,"column":35}},"3":{"start":{"line":10,"column":16},"end":{"line":10,"column":48}},"4":{"start":{"line":12,"column":17},"end":{"line":12,"column":43}},"5":{"start":{"line":14,"column":18},"end":{"line":14,"column":52}},"6":{"start":{"line":16,"column":39},"end":{"line":16,"column":93}},"7":{"start":{"line":18,"column":23},"end":{"line":18,"column":144}},"8":{"start":{"line":18,"column":91},"end":{"line":18,"column":110}},"9":{"start":{"line":18,"column":121},"end":{"line":18,"column":143}},"10":{"start":{"line":20,"column":20},"end":{"line":24,"column":1}},"11":{"start":{"line":25,"column":15},"end":{"line":50,"column":1}},"12":{"start":{"line":54,"column":4},"end":{"line":56,"column":7}},"13":{"start":{"line":60,"column":4},"end":{"line":63,"column":7}},"14":{"start":{"line":67,"column":25},"end":{"line":71,"column":6}},"15":{"start":{"line":73,"column":4},"end":{"line":75,"column":5}},"16":{"start":{"line":74,"column":6},"end":{"line":74,"column":94}},"17":{"start":{"line":77,"column":4},"end":{"line":82,"column":7}},"18":{"start":{"line":83,"column":4},"end":{"line":83,"column":22}},"19":{"start":{"line":84,"column":4},"end":{"line":84,"column":25}},"20":{"start":{"line":88,"column":21},"end":{"line":88,"column":71}},"21":{"start":{"line":88,"column":39},"end":{"line":88,"column":70}},"22":{"start":{"line":89,"column":19},"end":{"line":103,"column":10}},"23":{"start":{"line":90,"column":6},"end":{"line":100,"column":7}},"24":{"start":{"line":91,"column":25},"end":{"line":91,"column":47}},"25":{"start":{"line":93,"column":8},"end":{"line":95,"column":9}},"26":{"start":{"line":94,"column":10},"end":{"line":94,"column":92}},"27":{"start":{"line":97,"column":8},"end":{"line":98,"column":10}},"28":{"start":{"line":99,"column":8},"end":{"line":99,"column":36}},"29":{"start":{"line":102,"column":6},"end":{"line":102,"column":19}},"30":{"start":{"line":105,"column":4},"end":{"line":107,"column":5}},"31":{"start":{"line":106,"column":6},"end":{"line":106,"column":54}},"32":{"start":{"line":109,"column":4},"end":{"line":112,"column":7}},"33":{"start":{"line":110,"column":6},"end":{"line":110,"column":24}},"34":{"start":{"line":111,"column":6},"end":{"line":111,"column":27}},"35":{"start":{"line":116,"column":18},"end":{"line":116,"column":20}},"36":{"start":{"line":117,"column":25},"end":{"line":121,"column":6}},"37":{"start":{"line":123,"column":4},"end":{"line":125,"column":5}},"38":{"start":{"line":124,"column":6},"end":{"line":124,"column":92}},"39":{"start":{"line":127,"column":4},"end":{"line":133,"column":5}},"40":{"start":{"line":128,"column":6},"end":{"line":132,"column":9}},"41":{"start":{"line":135,"column":27},"end":{"line":135,"column":65}},"42":{"start":{"line":136,"column":4},"end":{"line":144,"column":7}},"43":{"start":{"line":137,"column":19},"end":{"line":137,"column":39}},"44":{"start":{"line":139,"column":6},"end":{"line":143,"column":7}},"45":{"start":{"line":140,"column":8},"end":{"line":142,"column":11}},"46":{"start":{"line":145,"column":4},"end":{"line":145,"column":17}},"47":{"start":{"line":151,"column":8},"end":{"line":151,"column":14}},"48":{"start":{"line":152,"column":4},"end":{"line":152,"column":23}},"49":{"start":{"line":152,"column":16},"end":{"line":152,"column":23}},"50":{"start":{"line":153,"column":22},"end":{"line":153,"column":57}},"51":{"start":{"line":153,"column":38},"end":{"line":153,"column":56}},"52":{"start":{"line":155,"column":4},"end":{"line":157,"column":5}},"53":{"start":{"line":156,"column":6},"end":{"line":156,"column":44}},"54":{"start":{"line":159,"column":4},"end":{"line":159,"column":66}},"55":{"start":{"line":159,"column":45},"end":{"line":159,"column":63}},"56":{"start":{"line":164,"column":0},"end":{"line":164,"column":30}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":16,"column":9},"end":{"line":16,"column":31}},"loc":{"start":{"line":16,"column":37},"end":{"line":16,"column":95}},"line":16},"1":{"name":"(anonymous_1)","decl":{"start":{"line":18,"column":86},"end":{"line":18,"column":87}},"loc":{"start":{"line":18,"column":91},"end":{"line":18,"column":110}},"line":18},"2":{"name":"(anonymous_2)","decl":{"start":{"line":18,"column":116},"end":{"line":18,"column":117}},"loc":{"start":{"line":18,"column":121},"end":{"line":18,"column":143}},"line":18},"3":{"name":"(anonymous_3)","decl":{"start":{"line":53,"column":2},"end":{"line":53,"column":3}},"loc":{"start":{"line":53,"column":23},"end":{"line":57,"column":3}},"line":53},"4":{"name":"(anonymous_4)","decl":{"start":{"line":59,"column":2},"end":{"line":59,"column":3}},"loc":{"start":{"line":59,"column":18},"end":{"line":64,"column":3}},"line":59},"5":{"name":"(anonymous_5)","decl":{"start":{"line":66,"column":2},"end":{"line":66,"column":3}},"loc":{"start":{"line":66,"column":30},"end":{"line":85,"column":3}},"line":66},"6":{"name":"(anonymous_6)","decl":{"start":{"line":87,"column":2},"end":{"line":87,"column":3}},"loc":{"start":{"line":87,"column":27},"end":{"line":113,"column":3}},"line":87},"7":{"name":"(anonymous_7)","decl":{"start":{"line":88,"column":34},"end":{"line":88,"column":35}},"loc":{"start":{"line":88,"column":39},"end":{"line":88,"column":70}},"line":88},"8":{"name":"(anonymous_8)","decl":{"start":{"line":89,"column":35},"end":{"line":89,"column":36}},"loc":{"start":{"line":89,"column":52},"end":{"line":103,"column":5}},"line":89},"9":{"name":"(anonymous_9)","decl":{"start":{"line":109,"column":21},"end":{"line":109,"column":22}},"loc":{"start":{"line":109,"column":29},"end":{"line":112,"column":5}},"line":109},"10":{"name":"(anonymous_10)","decl":{"start":{"line":115,"column":2},"end":{"line":115,"column":3}},"loc":{"start":{"line":115,"column":18},"end":{"line":146,"column":3}},"line":115},"11":{"name":"(anonymous_11)","decl":{"start":{"line":136,"column":40},"end":{"line":136,"column":41}},"loc":{"start":{"line":136,"column":57},"end":{"line":144,"column":5}},"line":136},"12":{"name":"(anonymous_12)","decl":{"start":{"line":148,"column":2},"end":{"line":148,"column":3}},"loc":{"start":{"line":148,"column":31},"end":{"line":160,"column":3}},"line":148},"13":{"name":"(anonymous_13)","decl":{"start":{"line":153,"column":33},"end":{"line":153,"column":34}},"loc":{"start":{"line":153,"column":38},"end":{"line":153,"column":56}},"line":153},"14":{"name":"(anonymous_14)","decl":{"start":{"line":159,"column":40},"end":{"line":159,"column":41}},"loc":{"start":{"line":159,"column":45},"end":{"line":159,"column":63}},"line":159}},"branchMap":{"0":{"loc":{"start":{"line":16,"column":46},"end":{"line":16,"column":92}},"type":"cond-expr","locations":[{"start":{"line":16,"column":70},"end":{"line":16,"column":73}},{"start":{"line":16,"column":76},"end":{"line":16,"column":92}}],"line":16},"1":{"loc":{"start":{"line":16,"column":46},"end":{"line":16,"column":67}},"type":"binary-expr","locations":[{"start":{"line":16,"column":46},"end":{"line":16,"column":49}},{"start":{"line":16,"column":53},"end":{"line":16,"column":67}}],"line":16},"2":{"loc":{"start":{"line":73,"column":4},"end":{"line":75,"column":5}},"type":"if","locations":[{"start":{"line":73,"column":4},"end":{"line":75,"column":5}},{"start":{"line":73,"column":4},"end":{"line":75,"column":5}}],"line":73},"3":{"loc":{"start":{"line":90,"column":6},"end":{"line":100,"column":7}},"type":"if","locations":[{"start":{"line":90,"column":6},"end":{"line":100,"column":7}},{"start":{"line":90,"column":6},"end":{"line":100,"column":7}}],"line":90},"4":{"loc":{"start":{"line":93,"column":8},"end":{"line":95,"column":9}},"type":"if","locations":[{"start":{"line":93,"column":8},"end":{"line":95,"column":9}},{"start":{"line":93,"column":8},"end":{"line":95,"column":9}}],"line":93},"5":{"loc":{"start":{"line":105,"column":4},"end":{"line":107,"column":5}},"type":"if","locations":[{"start":{"line":105,"column":4},"end":{"line":107,"column":5}},{"start":{"line":105,"column":4},"end":{"line":107,"column":5}}],"line":105},"6":{"loc":{"start":{"line":123,"column":4},"end":{"line":125,"column":5}},"type":"if","locations":[{"start":{"line":123,"column":4},"end":{"line":125,"column":5}},{"start":{"line":123,"column":4},"end":{"line":125,"column":5}}],"line":123},"7":{"loc":{"start":{"line":127,"column":4},"end":{"line":133,"column":5}},"type":"if","locations":[{"start":{"line":127,"column":4},"end":{"line":133,"column":5}},{"start":{"line":127,"column":4},"end":{"line":133,"column":5}}],"line":127},"8":{"loc":{"start":{"line":139,"column":6},"end":{"line":143,"column":7}},"type":"if","locations":[{"start":{"line":139,"column":6},"end":{"line":143,"column":7}},{"start":{"line":139,"column":6},"end":{"line":143,"column":7}}],"line":139},"9":{"loc":{"start":{"line":152,"column":4},"end":{"line":152,"column":23}},"type":"if","locations":[{"start":{"line":152,"column":4},"end":{"line":152,"column":23}},{"start":{"line":152,"column":4},"end":{"line":152,"column":23}}],"line":152},"10":{"loc":{"start":{"line":155,"column":4},"end":{"line":157,"column":5}},"type":"if","locations":[{"start":{"line":155,"column":4},"end":{"line":157,"column":5}},{"start":{"line":155,"column":4},"end":{"line":157,"column":5}}],"line":155}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":2,"7":1,"8":8,"9":4,"10":1,"11":1,"12":112,"13":3,"14":1,"15":1,"16":0,"17":1,"18":1,"19":1,"20":3,"21":2,"22":3,"23":2,"24":2,"25":2,"26":0,"27":2,"28":2,"29":2,"30":3,"31":2,"32":3,"33":2,"34":2,"35":5,"36":5,"37":5,"38":0,"39":5,"40":5,"41":5,"42":5,"43":15,"44":15,"45":3,"46":5,"47":3,"48":3,"49":0,"50":3,"51":3,"52":3,"53":1,"54":3,"55":3,"56":1},"f":{"0":2,"1":8,"2":4,"3":112,"4":3,"5":1,"6":3,"7":2,"8":2,"9":2,"10":5,"11":15,"12":3,"13":3,"14":3},"b":{"0":[2,0],"1":[2,2],"2":[0,1],"3":[2,0],"4":[0,2],"5":[2,1],"6":[0,5],"7":[5,0],"8":[3,12],"9":[0,3],"10":[1,2]},"inputSourceMap":{"version":3,"sources":["pages.js"],"names":["supportedPages","constants","PAGE_NAMES","filter","p","includes","map","replace","pageNameMap","guardian_multifactor","password_reset","error_page","schema","type","items","properties","name","enum","html","default","url","show_log_link","enabled","required","PageHandler","DefaultHandler","constructor","options","objString","page","updateLoginPage","globalClient","client","clients","getAll","is_global","paginate","include_totals","Error","update","client_id","custom_login_page","custom_login_page_on","updated","didUpdate","updatePages","pages","toUpdate","reduce","accum","pageName","Object","keys","length","tenant","updateSettings","forEach","getType","push","tenantSettings","getSettings","entries","key","processChanges","assets","loginPage","find"],"mappings":"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","sourceRoot":"/home/circleci/repo/src/tools/auth0/handlers/","sourcesContent":["import DefaultHandler from './default';\nimport constants from '../../constants';\n\nexport const supportedPages = constants.PAGE_NAMES\n  .filter((p) => p.includes('.json'))\n  .map((p) => p.replace('.json', ''));\n\nexport const pageNameMap = {\n  guardian_multifactor: 'guardian_mfa_page',\n  password_reset: 'change_password',\n  error_page: 'error_page'\n};\n\n// With this schema, we can only validate property types but not valid properties on per type basis\nexport const schema = {\n  type: 'array',\n  items: {\n    type: 'object',\n    properties: {\n      name: { type: 'string', enum: supportedPages },\n      html: { type: 'string', default: '' },\n      url: { type: 'string' },\n      show_log_link: { type: 'boolean' },\n      enabled: { type: 'boolean' }\n    },\n    required: [ 'name' ]\n  }\n};\n\nexport default class PageHandler extends DefaultHandler {\n  constructor(options) {\n    super({\n      ...options,\n      type: 'pages'\n    });\n  }\n\n  objString(page) {\n    return super.objString({ name: page.name, enabled: page.enabled });\n  }\n\n  async updateLoginPage(page) {\n    const globalClient = await this.client.clients.getAll({ is_global: true, paginate: true, include_totals: true });\n\n    if (!globalClient[0]) {\n      throw new Error('Unable to find global client id when trying to update the login page');\n    }\n\n    await this.client.clients.update(\n      { client_id: globalClient[0].client_id },\n      {\n        custom_login_page: page.html,\n        custom_login_page_on: page.enabled\n      }\n    );\n    this.updated += 1;\n    this.didUpdate(page);\n  }\n\n  async updatePages(pages) {\n    const toUpdate = pages.filter((p) => supportedPages.includes(p.name));\n    const update = toUpdate.reduce((accum, page) => {\n      if (supportedPages.includes(page.name)) {\n        const pageName = pageNameMap[page.name];\n        if (!pageName) {\n          throw new Error(`Unable to map page ${page.name} into tenant level page setting`);\n        }\n        accum[pageName] = { ...page };\n        delete accum[pageName].name;\n      }\n      return accum;\n    }, {});\n\n    if (Object.keys(update).length) {\n      await this.client.tenant.updateSettings(update);\n    }\n\n    toUpdate.forEach((page) => {\n      this.updated += 1;\n      this.didUpdate(page);\n    });\n  }\n\n  async getType() {\n    const pages = [];\n\n    // Login page is handled via the global client\n    const globalClient = await this.client.clients.getAll({ is_global: true, paginate: true, include_totals: true });\n    if (!globalClient[0]) {\n      throw new Error('Unable to find global client id when trying to dump the login page');\n    }\n\n    if (globalClient[0].custom_login_page) {\n      pages.push({\n        name: 'login',\n        enabled: globalClient[0].custom_login_page_on,\n        html: globalClient[0].custom_login_page\n      });\n    }\n\n    const tenantSettings = await this.client.tenant.getSettings();\n\n    Object.entries(pageNameMap).forEach(([ key, name ]) => {\n      const page = tenantSettings[name];\n      if (tenantSettings[name]) {\n        pages.push({\n          ...page,\n          name: key\n        });\n      }\n    });\n\n    return pages;\n  }\n\n  async processChanges(assets) {\n    const { pages } = assets;\n\n    // Do nothing if not set\n    if (!pages) return;\n\n    // Login page is handled via the global client\n    const loginPage = pages.find((p) => p.name === 'login');\n    if (loginPage) {\n      await this.updateLoginPage(loginPage);\n    }\n\n    // Rest of pages are on tenant level settings\n    await this.updatePages(pages.filter((p) => p.name !== 'login'));\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"913ae0a79cd9aac5419f891c1ce21db27978c3f3","contentHash":"8db6722e3d674a38520baaf85afcf56a697e4c29a33b22108a5157170b5cfa80"},"/home/circleci/repo/src/tools/auth0/handlers/resourceServers.js":{"path":"/home/circleci/repo/src/tools/auth0/handlers/resourceServers.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":51}},"2":{"start":{"line":8,"column":23},"end":{"line":8,"column":55}},"3":{"start":{"line":10,"column":24},"end":{"line":10,"column":64}},"4":{"start":{"line":12,"column":17},"end":{"line":12,"column":43}},"5":{"start":{"line":14,"column":18},"end":{"line":14,"column":52}},"6":{"start":{"line":16,"column":15},"end":{"line":16,"column":35}},"7":{"start":{"line":18,"column":16},"end":{"line":18,"column":48}},"8":{"start":{"line":20,"column":13},"end":{"line":20,"column":35}},"9":{"start":{"line":22,"column":39},"end":{"line":22,"column":93}},"10":{"start":{"line":24,"column":22},"end":{"line":29,"column":1}},"11":{"start":{"line":30,"column":15},"end":{"line":64,"column":1}},"12":{"start":{"line":68,"column":4},"end":{"line":71,"column":7}},"13":{"start":{"line":75,"column":4},"end":{"line":78,"column":7}},"14":{"start":{"line":82,"column":4},"end":{"line":82,"column":44}},"15":{"start":{"line":82,"column":23},"end":{"line":82,"column":44}},"16":{"start":{"line":83,"column":28},"end":{"line":86,"column":6}},"17":{"start":{"line":87,"column":4},"end":{"line":87,"column":110}},"18":{"start":{"line":87,"column":40},"end":{"line":87,"column":108}},"19":{"start":{"line":93,"column":8},"end":{"line":93,"column":14}},"20":{"start":{"line":94,"column":4},"end":{"line":94,"column":36}},"21":{"start":{"line":94,"column":26},"end":{"line":94,"column":36}},"22":{"start":{"line":95,"column":21},"end":{"line":95,"column":75}},"23":{"start":{"line":96,"column":19},"end":{"line":96,"column":39}},"24":{"start":{"line":97,"column":4},"end":{"line":97,"column":78}},"25":{"start":{"line":97,"column":50},"end":{"line":97,"column":76}},"26":{"start":{"line":98,"column":4},"end":{"line":98,"column":64}},"27":{"start":{"line":98,"column":36},"end":{"line":98,"column":62}},"28":{"start":{"line":99,"column":4},"end":{"line":99,"column":90}},"29":{"start":{"line":105,"column":8},"end":{"line":105,"column":14}},"30":{"start":{"line":106,"column":4},"end":{"line":106,"column":33}},"31":{"start":{"line":106,"column":26},"end":{"line":106,"column":33}},"32":{"start":{"line":107,"column":28},"end":{"line":107,"column":122}},"33":{"start":{"line":107,"column":54},"end":{"line":107,"column":121}},"34":{"start":{"line":109,"column":4},"end":{"line":111,"column":5}},"35":{"start":{"line":110,"column":6},"end":{"line":110,"column":134}},"36":{"start":{"line":113,"column":4},"end":{"line":113,"column":33}},"37":{"start":{"line":118,"column":0},"end":{"line":118,"column":41}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":22,"column":9},"end":{"line":22,"column":31}},"loc":{"start":{"line":22,"column":37},"end":{"line":22,"column":95}},"line":22},"1":{"name":"(anonymous_1)","decl":{"start":{"line":67,"column":2},"end":{"line":67,"column":3}},"loc":{"start":{"line":67,"column":23},"end":{"line":72,"column":3}},"line":67},"2":{"name":"(anonymous_2)","decl":{"start":{"line":74,"column":2},"end":{"line":74,"column":3}},"loc":{"start":{"line":74,"column":28},"end":{"line":79,"column":3}},"line":74},"3":{"name":"(anonymous_3)","decl":{"start":{"line":81,"column":2},"end":{"line":81,"column":3}},"loc":{"start":{"line":81,"column":18},"end":{"line":88,"column":3}},"line":81},"4":{"name":"(anonymous_4)","decl":{"start":{"line":87,"column":34},"end":{"line":87,"column":35}},"loc":{"start":{"line":87,"column":40},"end":{"line":87,"column":108}},"line":87},"5":{"name":"(anonymous_5)","decl":{"start":{"line":90,"column":2},"end":{"line":90,"column":3}},"loc":{"start":{"line":90,"column":28},"end":{"line":100,"column":3}},"line":90},"6":{"name":"(anonymous_6)","decl":{"start":{"line":97,"column":45},"end":{"line":97,"column":46}},"loc":{"start":{"line":97,"column":50},"end":{"line":97,"column":76}},"line":97},"7":{"name":"(anonymous_7)","decl":{"start":{"line":98,"column":31},"end":{"line":98,"column":32}},"loc":{"start":{"line":98,"column":36},"end":{"line":98,"column":62}},"line":98},"8":{"name":"(anonymous_8)","decl":{"start":{"line":102,"column":2},"end":{"line":102,"column":3}},"loc":{"start":{"line":102,"column":25},"end":{"line":114,"column":3}},"line":102},"9":{"name":"(anonymous_9)","decl":{"start":{"line":107,"column":49},"end":{"line":107,"column":50}},"loc":{"start":{"line":107,"column":54},"end":{"line":107,"column":121}},"line":107}},"branchMap":{"0":{"loc":{"start":{"line":22,"column":46},"end":{"line":22,"column":92}},"type":"cond-expr","locations":[{"start":{"line":22,"column":70},"end":{"line":22,"column":73}},{"start":{"line":22,"column":76},"end":{"line":22,"column":92}}],"line":22},"1":{"loc":{"start":{"line":22,"column":46},"end":{"line":22,"column":67}},"type":"binary-expr","locations":[{"start":{"line":22,"column":46},"end":{"line":22,"column":49}},{"start":{"line":22,"column":53},"end":{"line":22,"column":67}}],"line":22},"2":{"loc":{"start":{"line":82,"column":4},"end":{"line":82,"column":44}},"type":"if","locations":[{"start":{"line":82,"column":4},"end":{"line":82,"column":44}},{"start":{"line":82,"column":4},"end":{"line":82,"column":44}}],"line":82},"3":{"loc":{"start":{"line":94,"column":4},"end":{"line":94,"column":36}},"type":"if","locations":[{"start":{"line":94,"column":4},"end":{"line":94,"column":36}},{"start":{"line":94,"column":4},"end":{"line":94,"column":36}}],"line":94},"4":{"loc":{"start":{"line":95,"column":21},"end":{"line":95,"column":75}},"type":"binary-expr","locations":[{"start":{"line":95,"column":21},"end":{"line":95,"column":35}},{"start":{"line":95,"column":39},"end":{"line":95,"column":69}},{"start":{"line":95,"column":73},"end":{"line":95,"column":75}}],"line":95},"5":{"loc":{"start":{"line":106,"column":4},"end":{"line":106,"column":33}},"type":"if","locations":[{"start":{"line":106,"column":4},"end":{"line":106,"column":33}},{"start":{"line":106,"column":4},"end":{"line":106,"column":33}}],"line":106},"6":{"loc":{"start":{"line":109,"column":4},"end":{"line":111,"column":5}},"type":"if","locations":[{"start":{"line":109,"column":4},"end":{"line":111,"column":5}},{"start":{"line":109,"column":4},"end":{"line":111,"column":5}}],"line":109}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":3,"10":1,"11":1,"12":119,"13":8,"14":12,"15":0,"16":12,"17":12,"18":9,"19":7,"20":7,"21":0,"22":7,"23":7,"24":7,"25":5,"26":7,"27":7,"28":7,"29":62,"30":62,"31":57,"32":5,"33":6,"34":5,"35":1,"36":4,"37":1},"f":{"0":3,"1":119,"2":8,"3":12,"4":9,"5":7,"6":5,"7":7,"8":62,"9":6},"b":{"0":[2,1],"1":[3,3],"2":[0,12],"3":[0,7],"4":[7,1,6],"5":[57,5],"6":[1,4]},"inputSourceMap":{"version":3,"sources":["resourceServers.js"],"names":["excludeSchema","type","items","schema","properties","name","identifier","scopes","description","enforce_policies","token_dialect","required","ResourceServersHandler","DefaultHandler","constructor","options","stripUpdateFields","objString","resourceServer","getType","existing","resourceServers","client","getAll","paginate","include_totals","filter","rs","constants","RESOURCE_SERVERS_MANAGEMENT_API_NAME","calcChanges","assets","excluded","exclude","r","includes","validate","mgmtAPIResource","find","ValidationError"],"mappings":"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","sourceRoot":"/home/circleci/repo/src/tools/auth0/handlers/","sourcesContent":["import ValidationError from '../../ValidationError';\n\nimport constants from '../../constants';\nimport DefaultHandler from './default';\nimport { calcChanges } from '../../utils';\n\nexport const excludeSchema = {\n  type: 'array',\n  items: { type: 'string' }\n};\n\nexport const schema = {\n  type: 'array',\n  items: {\n    type: 'object',\n    properties: {\n      name: { type: 'string' },\n      identifier: { type: 'string' },\n      scopes: {\n        type: 'array',\n        items: {\n          type: 'object',\n          properties: {\n            name: { type: 'string' },\n            description: { type: 'string' }\n          }\n        }\n      },\n      enforce_policies: { type: 'boolean' },\n      token_dialect: { type: 'string' }\n    },\n    required: [ 'name', 'identifier' ]\n  }\n};\n\nexport default class ResourceServersHandler extends DefaultHandler {\n  constructor(options) {\n    super({\n      ...options,\n      type: 'resourceServers',\n      stripUpdateFields: [ 'identifier' ] // Fields not allowed in updates\n    });\n  }\n\n  objString(resourceServer) {\n    return super.objString({ name: resourceServer.name, identifier: resourceServer.identifier });\n  }\n\n  async getType() {\n    if (this.existing) return this.existing;\n    const resourceServers = await this.client.resourceServers.getAll({ paginate: true, include_totals: true });\n    return resourceServers.filter((rs) => rs.name !== constants.RESOURCE_SERVERS_MANAGEMENT_API_NAME);\n  }\n\n  async calcChanges(assets) {\n    let { resourceServers } = assets;\n\n    // Do nothing if not set\n    if (!resourceServers) return {};\n\n    const excluded = (assets.exclude && assets.exclude.resourceServers) || [];\n\n    let existing = await this.getType();\n\n    // Filter excluded\n    resourceServers = resourceServers.filter((r) => !excluded.includes(r.name));\n    existing = existing.filter((r) => !excluded.includes(r.name));\n\n    return calcChanges(this, resourceServers, existing, [ 'id', 'identifier' ]);\n  }\n\n  async validate(assets) {\n    const { resourceServers } = assets;\n\n    // Do nothing if not set\n    if (!resourceServers) return;\n\n    const mgmtAPIResource = resourceServers.find((r) => r.name === constants.RESOURCE_SERVERS_MANAGEMENT_API_NAME);\n    if (mgmtAPIResource) {\n      throw new ValidationError(`You can not configure the '${constants.RESOURCE_SERVERS_MANAGEMENT_API_NAME}'.`);\n    }\n\n    await super.validate(assets);\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"fe0265585485c8765bd11e3ee6ef7c9388796a37","contentHash":"da556988e4af715eae521fd3042e936205dedc55d2c35d6071ee08b6d1f0cb5b"},"/home/circleci/repo/src/tools/auth0/handlers/databases.js":{"path":"/home/circleci/repo/src/tools/auth0/handlers/databases.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":45}},"2":{"start":{"line":10,"column":15},"end":{"line":10,"column":35}},"3":{"start":{"line":12,"column":16},"end":{"line":12,"column":48}},"4":{"start":{"line":14,"column":17},"end":{"line":14,"column":43}},"5":{"start":{"line":16,"column":18},"end":{"line":16,"column":52}},"6":{"start":{"line":18,"column":13},"end":{"line":18,"column":35}},"7":{"start":{"line":20,"column":39},"end":{"line":20,"column":93}},"8":{"start":{"line":22,"column":99},"end":{"line":22,"column":101}},"9":{"start":{"line":22,"column":103},"end":{"line":22,"column":184}},"10":{"start":{"line":22,"column":152},"end":{"line":22,"column":180}},"11":{"start":{"line":22,"column":185},"end":{"line":22,"column":221}},"12":{"start":{"line":22,"column":222},"end":{"line":22,"column":262}},"13":{"start":{"line":22,"column":263},"end":{"line":22,"column":329}},"14":{"start":{"line":22,"column":306},"end":{"line":22,"column":327}},"15":{"start":{"line":22,"column":330},"end":{"line":22,"column":461}},"16":{"start":{"line":22,"column":402},"end":{"line":22,"column":451}},"17":{"start":{"line":22,"column":462},"end":{"line":22,"column":612}},"18":{"start":{"line":22,"column":508},"end":{"line":22,"column":580}},"19":{"start":{"line":22,"column":581},"end":{"line":22,"column":610}},"20":{"start":{"line":22,"column":613},"end":{"line":22,"column":709}},"21":{"start":{"line":22,"column":648},"end":{"line":22,"column":694}},"22":{"start":{"line":22,"column":695},"end":{"line":22,"column":707}},"23":{"start":{"line":22,"column":710},"end":{"line":22,"column":722}},"24":{"start":{"line":24,"column":15},"end":{"line":54,"column":1}},"25":{"start":{"line":42,"column":89},"end":{"line":46,"column":15}},"26":{"start":{"line":55,"column":23},"end":{"line":131,"column":170}},"27":{"start":{"line":57,"column":4},"end":{"line":60,"column":7}},"28":{"start":{"line":64,"column":4},"end":{"line":67,"column":7}},"29":{"start":{"line":71,"column":4},"end":{"line":78,"column":5}},"30":{"start":{"line":72,"column":6},"end":{"line":77,"column":9}},"31":{"start":{"line":72,"column":34},"end":{"line":77,"column":8}},"32":{"start":{"line":73,"column":8},"end":{"line":75,"column":10}},"33":{"start":{"line":76,"column":8},"end":{"line":76,"column":63}},"34":{"start":{"line":80,"column":4},"end":{"line":80,"column":77}},"35":{"start":{"line":84,"column":4},"end":{"line":84,"column":44}},"36":{"start":{"line":84,"column":23},"end":{"line":84,"column":44}},"37":{"start":{"line":85,"column":4},"end":{"line":89,"column":7}},"38":{"start":{"line":90,"column":4},"end":{"line":90,"column":25}},"39":{"start":{"line":96,"column":8},"end":{"line":96,"column":14}},"40":{"start":{"line":97,"column":4},"end":{"line":97,"column":30}},"41":{"start":{"line":97,"column":20},"end":{"line":97,"column":30}},"42":{"start":{"line":98,"column":20},"end":{"line":101,"column":6}},"43":{"start":{"line":102,"column":41},"end":{"line":106,"column":6}},"44":{"start":{"line":107,"column":22},"end":{"line":115,"column":6}},"45":{"start":{"line":108,"column":6},"end":{"line":112,"column":7}},"46":{"start":{"line":109,"column":8},"end":{"line":111,"column":10}},"47":{"start":{"line":114,"column":6},"end":{"line":114,"column":16}},"48":{"start":{"line":116,"column":4},"end":{"line":118,"column":7}},"49":{"start":{"line":124,"column":8},"end":{"line":124,"column":14}},"50":{"start":{"line":125,"column":4},"end":{"line":125,"column":27}},"51":{"start":{"line":125,"column":20},"end":{"line":125,"column":27}},"52":{"start":{"line":126,"column":32},"end":{"line":126,"column":80}},"53":{"start":{"line":127,"column":20},"end":{"line":127,"column":50}},"54":{"start":{"line":128,"column":4},"end":{"line":128,"column":97}},"55":{"start":{"line":132,"column":0},"end":{"line":132,"column":34}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":20,"column":9},"end":{"line":20,"column":31}},"loc":{"start":{"line":20,"column":37},"end":{"line":20,"column":95}},"line":20},"1":{"name":"_applyDecoratedDescriptor","decl":{"start":{"line":22,"column":9},"end":{"line":22,"column":34}},"loc":{"start":{"line":22,"column":86},"end":{"line":22,"column":724}},"line":22},"2":{"name":"(anonymous_2)","decl":{"start":{"line":22,"column":135},"end":{"line":22,"column":136}},"loc":{"start":{"line":22,"column":150},"end":{"line":22,"column":182}},"line":22},"3":{"name":"(anonymous_3)","decl":{"start":{"line":22,"column":373},"end":{"line":22,"column":374}},"loc":{"start":{"line":22,"column":400},"end":{"line":22,"column":453}},"line":22},"4":{"name":"(anonymous_4)","decl":{"start":{"line":42,"column":73},"end":{"line":42,"column":74}},"loc":{"start":{"line":42,"column":89},"end":{"line":46,"column":15}},"line":42},"5":{"name":"(anonymous_5)","decl":{"start":{"line":56,"column":2},"end":{"line":56,"column":3}},"loc":{"start":{"line":56,"column":22},"end":{"line":61,"column":3}},"line":56},"6":{"name":"(anonymous_6)","decl":{"start":{"line":63,"column":2},"end":{"line":63,"column":3}},"loc":{"start":{"line":63,"column":16},"end":{"line":68,"column":3}},"line":63},"7":{"name":"(anonymous_7)","decl":{"start":{"line":70,"column":2},"end":{"line":70,"column":3}},"loc":{"start":{"line":70,"column":18},"end":{"line":81,"column":3}},"line":70},"8":{"name":"(anonymous_8)","decl":{"start":{"line":72,"column":13},"end":{"line":72,"column":14}},"loc":{"start":{"line":72,"column":34},"end":{"line":77,"column":8}},"line":72},"9":{"name":"(anonymous_9)","decl":{"start":{"line":72,"column":75},"end":{"line":72,"column":76}},"loc":{"start":{"line":72,"column":89},"end":{"line":77,"column":7}},"line":72},"10":{"name":"(anonymous_10)","decl":{"start":{"line":83,"column":2},"end":{"line":83,"column":3}},"loc":{"start":{"line":83,"column":18},"end":{"line":91,"column":3}},"line":83},"11":{"name":"(anonymous_11)","decl":{"start":{"line":93,"column":2},"end":{"line":93,"column":3}},"loc":{"start":{"line":93,"column":28},"end":{"line":119,"column":3}},"line":93},"12":{"name":"(anonymous_12)","decl":{"start":{"line":107,"column":36},"end":{"line":107,"column":37}},"loc":{"start":{"line":107,"column":42},"end":{"line":115,"column":5}},"line":107},"13":{"name":"(anonymous_13)","decl":{"start":{"line":121,"column":2},"end":{"line":121,"column":3}},"loc":{"start":{"line":121,"column":31},"end":{"line":129,"column":3}},"line":121}},"branchMap":{"0":{"loc":{"start":{"line":20,"column":46},"end":{"line":20,"column":92}},"type":"cond-expr","locations":[{"start":{"line":20,"column":70},"end":{"line":20,"column":73}},{"start":{"line":20,"column":76},"end":{"line":20,"column":92}}],"line":20},"1":{"loc":{"start":{"line":20,"column":46},"end":{"line":20,"column":67}},"type":"binary-expr","locations":[{"start":{"line":20,"column":46},"end":{"line":20,"column":49}},{"start":{"line":20,"column":53},"end":{"line":20,"column":67}}],"line":20},"2":{"loc":{"start":{"line":22,"column":263},"end":{"line":22,"column":329}},"type":"if","locations":[{"start":{"line":22,"column":263},"end":{"line":22,"column":329}},{"start":{"line":22,"column":263},"end":{"line":22,"column":329}}],"line":22},"3":{"loc":{"start":{"line":22,"column":267},"end":{"line":22,"column":302}},"type":"binary-expr","locations":[{"start":{"line":22,"column":267},"end":{"line":22,"column":282}},{"start":{"line":22,"column":286},"end":{"line":22,"column":302}}],"line":22},"4":{"loc":{"start":{"line":22,"column":409},"end":{"line":22,"column":450}},"type":"binary-expr","locations":[{"start":{"line":22,"column":409},"end":{"line":22,"column":442}},{"start":{"line":22,"column":446},"end":{"line":22,"column":450}}],"line":22},"5":{"loc":{"start":{"line":22,"column":462},"end":{"line":22,"column":612}},"type":"if","locations":[{"start":{"line":22,"column":462},"end":{"line":22,"column":612}},{"start":{"line":22,"column":462},"end":{"line":22,"column":612}}],"line":22},"6":{"loc":{"start":{"line":22,"column":466},"end":{"line":22,"column":504}},"type":"binary-expr","locations":[{"start":{"line":22,"column":466},"end":{"line":22,"column":473}},{"start":{"line":22,"column":477},"end":{"line":22,"column":504}}],"line":22},"7":{"loc":{"start":{"line":22,"column":521},"end":{"line":22,"column":579}},"type":"cond-expr","locations":[{"start":{"line":22,"column":540},"end":{"line":22,"column":570}},{"start":{"line":22,"column":573},"end":{"line":22,"column":579}}],"line":22},"8":{"loc":{"start":{"line":22,"column":613},"end":{"line":22,"column":709}},"type":"if","locations":[{"start":{"line":22,"column":613},"end":{"line":22,"column":709}},{"start":{"line":22,"column":613},"end":{"line":22,"column":709}}],"line":22},"9":{"loc":{"start":{"line":71,"column":4},"end":{"line":78,"column":5}},"type":"if","locations":[{"start":{"line":71,"column":4},"end":{"line":78,"column":5}},{"start":{"line":71,"column":4},"end":{"line":78,"column":5}}],"line":71},"10":{"loc":{"start":{"line":84,"column":4},"end":{"line":84,"column":44}},"type":"if","locations":[{"start":{"line":84,"column":4},"end":{"line":84,"column":44}},{"start":{"line":84,"column":4},"end":{"line":84,"column":44}}],"line":84},"11":{"loc":{"start":{"line":97,"column":4},"end":{"line":97,"column":30}},"type":"if","locations":[{"start":{"line":97,"column":4},"end":{"line":97,"column":30}},{"start":{"line":97,"column":4},"end":{"line":97,"column":30}}],"line":97},"12":{"loc":{"start":{"line":108,"column":6},"end":{"line":112,"column":7}},"type":"if","locations":[{"start":{"line":108,"column":6},"end":{"line":112,"column":7}},{"start":{"line":108,"column":6},"end":{"line":112,"column":7}}],"line":108},"13":{"loc":{"start":{"line":125,"column":4},"end":{"line":125,"column":27}},"type":"if","locations":[{"start":{"line":125,"column":4},"end":{"line":125,"column":27}},{"start":{"line":125,"column":4},"end":{"line":125,"column":27}}],"line":125},"14":{"loc":{"start":{"line":126,"column":32},"end":{"line":126,"column":80}},"type":"binary-expr","locations":[{"start":{"line":126,"column":32},"end":{"line":126,"column":46}},{"start":{"line":126,"column":50},"end":{"line":126,"column":74}},{"start":{"line":126,"column":78},"end":{"line":126,"column":80}}],"line":126}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":2,"8":1,"9":1,"10":4,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":0,"19":0,"20":1,"21":1,"22":1,"23":1,"24":1,"25":7,"26":1,"27":120,"28":10,"29":8,"30":3,"31":3,"32":3,"33":3,"34":5,"35":14,"36":0,"37":14,"38":14,"39":9,"40":9,"41":0,"42":9,"43":9,"44":9,"45":7,"46":2,"47":5,"48":9,"49":9,"50":9,"51":0,"52":9,"53":9,"54":9,"55":1},"f":{"0":2,"1":1,"2":4,"3":1,"4":7,"5":120,"6":10,"7":8,"8":3,"9":3,"10":14,"11":9,"12":7,"13":9},"b":{"0":[2,0],"1":[2,2],"2":[1,0],"3":[1,0],"4":[1,0],"5":[0,1],"6":[1,1],"7":[0,0],"8":[1,0],"9":[3,5],"10":[0,14],"11":[0,9],"12":[2,5],"13":[0,9],"14":[9,2,8]},"inputSourceMap":{"version":3,"sources":["databases.js"],"names":["schema","type","items","properties","strategy","enum","default","name","options","customScripts","constants","DATABASE_SCRIPTS","reduce","o","script","required","DatabaseHandler","DefaultHandler","constructor","config","stripUpdateFields","objString","db","id","getClientFN","fn","functions","update","params","payload","client","connections","get","then","connection","Reflect","getType","existing","getAll","paginate","include_totals","calcChanges","assets","databases","clients","existingDatabasesConecctions","formatted","map","enabled_clients","processChanges","excludedConnections","exclude","changes"],"mappings":"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","sourceRoot":"/home/circleci/repo/src/tools/auth0/handlers/","sourcesContent":["import DefaultHandler, { order } from './default';\nimport constants from '../../constants';\nimport { filterExcluded, getEnabledClients } from '../../utils';\n\nexport const schema = {\n  type: 'array',\n  items: {\n    type: 'object',\n    properties: {\n      strategy: { type: 'string', enum: [ 'auth0' ], default: 'auth0' },\n      name: { type: 'string' },\n      options: {\n        type: 'object',\n        properties: {\n          customScripts: {\n            type: 'object',\n            properties: {\n              ...constants.DATABASE_SCRIPTS.reduce((o, script) => ({ ...o, [script]: { type: 'string' } }), {})\n            }\n          }\n        }\n      }\n    },\n    required: [ 'name' ]\n  }\n};\n\nexport default class DatabaseHandler extends DefaultHandler {\n  constructor(config) {\n    super({\n      ...config,\n      type: 'databases',\n      stripUpdateFields: [ 'strategy', 'name' ]\n    });\n  }\n\n  objString(db) {\n    return super.objString({ name: db.name, id: db.id });\n  }\n\n  getClientFN(fn) {\n    // Override this as a database is actually a connection but we are treating them as a different object\n    // If we going to update database, we need to get current options first\n    if (fn === this.functions.update) {\n      return (params, payload) => this.client.connections.get(params)\n        .then((connection) => {\n          payload.options = { ...connection.options, ...payload.options };\n          return this.client.connections.update(params, payload);\n        });\n    }\n\n    return Reflect.get(this.client.connections, fn, this.client.connections);\n  }\n\n  async getType() {\n    if (this.existing) return this.existing;\n    this.existing = this.client.connections.getAll({ strategy: 'auth0', paginate: true, include_totals: true });\n\n    return this.existing;\n  }\n\n  async calcChanges(assets) {\n    const { databases } = assets;\n\n    // Do nothing if not set\n    if (!databases) return {};\n\n    // Convert enabled_clients by name to the id\n    const clients = await this.client.clients.getAll({ paginate: true, include_totals: true });\n    const existingDatabasesConecctions = await this.client.connections.getAll({ strategy: 'auth0', paginate: true, include_totals: true });\n    const formatted = databases.map((db) => {\n      if (db.enabled_clients) {\n        return {\n          ...db,\n          enabled_clients: getEnabledClients(assets, db, existingDatabasesConecctions, clients)\n        };\n      }\n\n      return db;\n    });\n\n    return super.calcChanges({ ...assets, databases: formatted });\n  }\n\n  // Run after clients are updated so we can convert all the enabled_clients names to id's\n  @order('60')\n  async processChanges(assets) {\n    const { databases } = assets;\n\n    // Do nothing if not set\n    if (!databases) return;\n\n    const excludedConnections = (assets.exclude && assets.exclude.databases) || [];\n\n    const changes = await this.calcChanges(assets);\n\n    await super.processChanges(assets, filterExcluded(changes, excludedConnections));\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"60a421bdfe704358e822225cc96d4f4addf155fe","contentHash":"0e1bb1696a9aef35850f87091bd355d7a0d1f6f96c24f01471b6e54e5d38079a"},"/home/circleci/repo/src/tools/auth0/handlers/connections.js":{"path":"/home/circleci/repo/src/tools/auth0/handlers/connections.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":45}},"2":{"start":{"line":10,"column":15},"end":{"line":10,"column":35}},"3":{"start":{"line":12,"column":16},"end":{"line":12,"column":48}},"4":{"start":{"line":14,"column":13},"end":{"line":14,"column":35}},"5":{"start":{"line":16,"column":39},"end":{"line":16,"column":93}},"6":{"start":{"line":18,"column":99},"end":{"line":18,"column":101}},"7":{"start":{"line":18,"column":103},"end":{"line":18,"column":184}},"8":{"start":{"line":18,"column":152},"end":{"line":18,"column":180}},"9":{"start":{"line":18,"column":185},"end":{"line":18,"column":221}},"10":{"start":{"line":18,"column":222},"end":{"line":18,"column":262}},"11":{"start":{"line":18,"column":263},"end":{"line":18,"column":329}},"12":{"start":{"line":18,"column":306},"end":{"line":18,"column":327}},"13":{"start":{"line":18,"column":330},"end":{"line":18,"column":461}},"14":{"start":{"line":18,"column":402},"end":{"line":18,"column":451}},"15":{"start":{"line":18,"column":462},"end":{"line":18,"column":612}},"16":{"start":{"line":18,"column":508},"end":{"line":18,"column":580}},"17":{"start":{"line":18,"column":581},"end":{"line":18,"column":610}},"18":{"start":{"line":18,"column":613},"end":{"line":18,"column":709}},"19":{"start":{"line":18,"column":648},"end":{"line":18,"column":694}},"20":{"start":{"line":18,"column":695},"end":{"line":18,"column":707}},"21":{"start":{"line":18,"column":710},"end":{"line":18,"column":722}},"22":{"start":{"line":20,"column":15},"end":{"line":52,"column":1}},"23":{"start":{"line":53,"column":26},"end":{"line":124,"column":170}},"24":{"start":{"line":55,"column":4},"end":{"line":58,"column":7}},"25":{"start":{"line":62,"column":4},"end":{"line":65,"column":7}},"26":{"start":{"line":69,"column":4},"end":{"line":79,"column":5}},"27":{"start":{"line":70,"column":6},"end":{"line":76,"column":8}},"28":{"start":{"line":78,"column":6},"end":{"line":78,"column":16}},"29":{"start":{"line":83,"column":4},"end":{"line":83,"column":44}},"30":{"start":{"line":83,"column":23},"end":{"line":83,"column":44}},"31":{"start":{"line":84,"column":24},"end":{"line":87,"column":6}},"32":{"start":{"line":88,"column":4},"end":{"line":88,"column":68}},"33":{"start":{"line":88,"column":44},"end":{"line":88,"column":66}},"34":{"start":{"line":89,"column":4},"end":{"line":89,"column":25}},"35":{"start":{"line":95,"column":8},"end":{"line":95,"column":14}},"36":{"start":{"line":96,"column":4},"end":{"line":96,"column":32}},"37":{"start":{"line":96,"column":22},"end":{"line":96,"column":32}},"38":{"start":{"line":97,"column":20},"end":{"line":100,"column":6}},"39":{"start":{"line":101,"column":32},"end":{"line":104,"column":6}},"40":{"start":{"line":105,"column":22},"end":{"line":108,"column":7}},"41":{"start":{"line":105,"column":60},"end":{"line":108,"column":5}},"42":{"start":{"line":109,"column":4},"end":{"line":111,"column":7}},"43":{"start":{"line":117,"column":8},"end":{"line":117,"column":14}},"44":{"start":{"line":118,"column":4},"end":{"line":118,"column":29}},"45":{"start":{"line":118,"column":22},"end":{"line":118,"column":29}},"46":{"start":{"line":119,"column":32},"end":{"line":119,"column":82}},"47":{"start":{"line":120,"column":20},"end":{"line":120,"column":50}},"48":{"start":{"line":121,"column":4},"end":{"line":121,"column":97}},"49":{"start":{"line":125,"column":0},"end":{"line":125,"column":37}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":16,"column":9},"end":{"line":16,"column":31}},"loc":{"start":{"line":16,"column":37},"end":{"line":16,"column":95}},"line":16},"1":{"name":"_applyDecoratedDescriptor","decl":{"start":{"line":18,"column":9},"end":{"line":18,"column":34}},"loc":{"start":{"line":18,"column":86},"end":{"line":18,"column":724}},"line":18},"2":{"name":"(anonymous_2)","decl":{"start":{"line":18,"column":135},"end":{"line":18,"column":136}},"loc":{"start":{"line":18,"column":150},"end":{"line":18,"column":182}},"line":18},"3":{"name":"(anonymous_3)","decl":{"start":{"line":18,"column":373},"end":{"line":18,"column":374}},"loc":{"start":{"line":18,"column":400},"end":{"line":18,"column":453}},"line":18},"4":{"name":"(anonymous_4)","decl":{"start":{"line":54,"column":2},"end":{"line":54,"column":3}},"loc":{"start":{"line":54,"column":22},"end":{"line":59,"column":3}},"line":54},"5":{"name":"(anonymous_5)","decl":{"start":{"line":61,"column":2},"end":{"line":61,"column":3}},"loc":{"start":{"line":61,"column":24},"end":{"line":66,"column":3}},"line":61},"6":{"name":"(anonymous_6)","decl":{"start":{"line":68,"column":2},"end":{"line":68,"column":3}},"loc":{"start":{"line":68,"column":43},"end":{"line":80,"column":3}},"line":68},"7":{"name":"(anonymous_7)","decl":{"start":{"line":82,"column":2},"end":{"line":82,"column":3}},"loc":{"start":{"line":82,"column":18},"end":{"line":90,"column":3}},"line":82},"8":{"name":"(anonymous_8)","decl":{"start":{"line":88,"column":39},"end":{"line":88,"column":40}},"loc":{"start":{"line":88,"column":44},"end":{"line":88,"column":66}},"line":88},"9":{"name":"(anonymous_9)","decl":{"start":{"line":92,"column":2},"end":{"line":92,"column":3}},"loc":{"start":{"line":92,"column":28},"end":{"line":112,"column":3}},"line":92},"10":{"name":"(anonymous_10)","decl":{"start":{"line":105,"column":45},"end":{"line":105,"column":46}},"loc":{"start":{"line":105,"column":60},"end":{"line":108,"column":5}},"line":105},"11":{"name":"(anonymous_11)","decl":{"start":{"line":114,"column":2},"end":{"line":114,"column":3}},"loc":{"start":{"line":114,"column":31},"end":{"line":122,"column":3}},"line":114}},"branchMap":{"0":{"loc":{"start":{"line":16,"column":46},"end":{"line":16,"column":92}},"type":"cond-expr","locations":[{"start":{"line":16,"column":70},"end":{"line":16,"column":73}},{"start":{"line":16,"column":76},"end":{"line":16,"column":92}}],"line":16},"1":{"loc":{"start":{"line":16,"column":46},"end":{"line":16,"column":67}},"type":"binary-expr","locations":[{"start":{"line":16,"column":46},"end":{"line":16,"column":49}},{"start":{"line":16,"column":53},"end":{"line":16,"column":67}}],"line":16},"2":{"loc":{"start":{"line":18,"column":263},"end":{"line":18,"column":329}},"type":"if","locations":[{"start":{"line":18,"column":263},"end":{"line":18,"column":329}},{"start":{"line":18,"column":263},"end":{"line":18,"column":329}}],"line":18},"3":{"loc":{"start":{"line":18,"column":267},"end":{"line":18,"column":302}},"type":"binary-expr","locations":[{"start":{"line":18,"column":267},"end":{"line":18,"column":282}},{"start":{"line":18,"column":286},"end":{"line":18,"column":302}}],"line":18},"4":{"loc":{"start":{"line":18,"column":409},"end":{"line":18,"column":450}},"type":"binary-expr","locations":[{"start":{"line":18,"column":409},"end":{"line":18,"column":442}},{"start":{"line":18,"column":446},"end":{"line":18,"column":450}}],"line":18},"5":{"loc":{"start":{"line":18,"column":462},"end":{"line":18,"column":612}},"type":"if","locations":[{"start":{"line":18,"column":462},"end":{"line":18,"column":612}},{"start":{"line":18,"column":462},"end":{"line":18,"column":612}}],"line":18},"6":{"loc":{"start":{"line":18,"column":466},"end":{"line":18,"column":504}},"type":"binary-expr","locations":[{"start":{"line":18,"column":466},"end":{"line":18,"column":473}},{"start":{"line":18,"column":477},"end":{"line":18,"column":504}}],"line":18},"7":{"loc":{"start":{"line":18,"column":521},"end":{"line":18,"column":579}},"type":"cond-expr","locations":[{"start":{"line":18,"column":540},"end":{"line":18,"column":570}},{"start":{"line":18,"column":573},"end":{"line":18,"column":579}}],"line":18},"8":{"loc":{"start":{"line":18,"column":613},"end":{"line":18,"column":709}},"type":"if","locations":[{"start":{"line":18,"column":613},"end":{"line":18,"column":709}},{"start":{"line":18,"column":613},"end":{"line":18,"column":709}}],"line":18},"9":{"loc":{"start":{"line":83,"column":4},"end":{"line":83,"column":44}},"type":"if","locations":[{"start":{"line":83,"column":4},"end":{"line":83,"column":44}},{"start":{"line":83,"column":4},"end":{"line":83,"column":44}}],"line":83},"10":{"loc":{"start":{"line":96,"column":4},"end":{"line":96,"column":32}},"type":"if","locations":[{"start":{"line":96,"column":4},"end":{"line":96,"column":32}},{"start":{"line":96,"column":4},"end":{"line":96,"column":32}}],"line":96},"11":{"loc":{"start":{"line":118,"column":4},"end":{"line":118,"column":29}},"type":"if","locations":[{"start":{"line":118,"column":4},"end":{"line":118,"column":29}},{"start":{"line":118,"column":4},"end":{"line":118,"column":29}}],"line":118},"12":{"loc":{"start":{"line":119,"column":32},"end":{"line":119,"column":82}},"type":"binary-expr","locations":[{"start":{"line":119,"column":32},"end":{"line":119,"column":46}},{"start":{"line":119,"column":50},"end":{"line":119,"column":76}},{"start":{"line":119,"column":80},"end":{"line":119,"column":82}}],"line":119}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":4,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":0,"17":0,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1,"24":121,"25":13,"26":10,"27":10,"28":6,"29":15,"30":0,"31":15,"32":15,"33":12,"34":15,"35":10,"36":10,"37":0,"38":10,"39":10,"40":10,"41":10,"42":10,"43":10,"44":10,"45":0,"46":10,"47":10,"48":10,"49":1},"f":{"0":1,"1":1,"2":4,"3":1,"4":121,"5":13,"6":10,"7":15,"8":12,"9":10,"10":10,"11":10},"b":{"0":[1,0],"1":[1,1],"2":[1,0],"3":[1,0],"4":[1,0],"5":[0,1],"6":[1,1],"7":[0,0],"8":[1,0],"9":[0,15],"10":[0,10],"11":[0,10],"12":[10,2,9]},"inputSourceMap":{"version":3,"sources":["connections.js"],"names":["schema","type","items","properties","name","strategy","options","enabled_clients","realms","metadata","required","ConnectionsHandler","DefaultHandler","constructor","config","stripUpdateFields","objString","connection","id","getFormattedOptions","clients","idpinitiated","client_id","e","getType","existing","connections","client","getAll","paginate","include_totals","filter","c","calcChanges","assets","existingConnections","formatted","map","processChanges","excludedConnections","exclude","changes"],"mappings":"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","sourceRoot":"/home/circleci/repo/src/tools/auth0/handlers/","sourcesContent":["import DefaultHandler, { order } from './default';\nimport { filterExcluded, convertClientNameToId, getEnabledClients } from '../../utils';\n\nexport const schema = {\n  type: 'array',\n  items: {\n    type: 'object',\n    properties: {\n      name: { type: 'string' },\n      strategy: { type: 'string' },\n      options: { type: 'object' },\n      enabled_clients: { type: 'array', items: { type: 'string' } },\n      realms: { type: 'array', items: { type: 'string' } },\n      metadata: { type: 'object' }\n    },\n    required: [ 'name', 'strategy' ]\n  }\n};\n\nexport default class ConnectionsHandler extends DefaultHandler {\n  constructor(config) {\n    super({\n      ...config,\n      type: 'connections',\n      stripUpdateFields: [ 'strategy', 'name' ]\n    });\n  }\n\n  objString(connection) {\n    return super.objString({ name: connection.name, id: connection.id });\n  }\n\n  getFormattedOptions(connection, clients) {\n    try {\n      return {\n        options: {\n          ...connection.options,\n          idpinitiated: {\n            ...connection.options.idpinitiated,\n            client_id: convertClientNameToId(\n              connection.options.idpinitiated.client_id,\n              clients\n            )\n          }\n        }\n      };\n    } catch (e) {\n      return {};\n    }\n  }\n\n  async getType() {\n    if (this.existing) return this.existing;\n    const connections = await this.client.connections.getAll({ paginate: true, include_totals: true });\n    // Filter out database connections\n    this.existing = connections.filter((c) => c.strategy !== 'auth0');\n\n    return this.existing;\n  }\n\n  async calcChanges(assets) {\n    const { connections } = assets;\n\n    // Do nothing if not set\n    if (!connections) return {};\n\n    // Convert enabled_clients by name to the id\n    const clients = await this.client.clients.getAll({ paginate: true, include_totals: true });\n    const existingConnections = await this.client.connections.getAll({ paginate: true, include_totals: true });\n    const formatted = assets.connections.map((connection) => (\n      {\n        ...connection,\n        ...this.getFormattedOptions(connection, clients),\n        enabled_clients: getEnabledClients(assets, connection, existingConnections, clients)\n      }\n    ));\n    return super.calcChanges({ ...assets, connections: formatted });\n  }\n\n  // Run after clients are updated so we can convert all the enabled_clients names to id's\n  @order('60')\n  async processChanges(assets) {\n    const { connections } = assets;\n\n    // Do nothing if not set\n    if (!connections) return;\n\n    const excludedConnections = (assets.exclude && assets.exclude.connections) || [];\n\n    const changes = await this.calcChanges(assets);\n\n    await super.processChanges(assets, filterExcluded(changes, excludedConnections));\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"9d608c913f44a267b550bbdd6652362ac7eee5fd","contentHash":"d8827ded568d51300962aa284ffd9976bc94270517854656f7eec60fec86f257"},"/home/circleci/repo/src/tools/auth0/handlers/clients.js":{"path":"/home/circleci/repo/src/tools/auth0/handlers/clients.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":27}},"2":{"start":{"line":8,"column":15},"end":{"line":8,"column":35}},"3":{"start":{"line":10,"column":16},"end":{"line":10,"column":48}},"4":{"start":{"line":12,"column":39},"end":{"line":12,"column":93}},"5":{"start":{"line":14,"column":15},"end":{"line":27,"column":1}},"6":{"start":{"line":31,"column":4},"end":{"line":37,"column":7}},"7":{"start":{"line":41,"column":4},"end":{"line":44,"column":7}},"8":{"start":{"line":50,"column":8},"end":{"line":50,"column":14}},"9":{"start":{"line":51,"column":4},"end":{"line":51,"column":25}},"10":{"start":{"line":51,"column":18},"end":{"line":51,"column":25}},"11":{"start":{"line":52,"column":28},"end":{"line":52,"column":74}},"12":{"start":{"line":58,"column":8},"end":{"line":58,"column":38}},"13":{"start":{"line":59,"column":26},"end":{"line":59,"column":56}},"14":{"start":{"line":61,"column":26},"end":{"line":67,"column":5}},"15":{"start":{"line":62,"column":6},"end":{"line":64,"column":7}},"16":{"start":{"line":63,"column":8},"end":{"line":63,"column":109}},"17":{"start":{"line":63,"column":35},"end":{"line":63,"column":107}},"18":{"start":{"line":66,"column":6},"end":{"line":66,"column":67}},"19":{"start":{"line":66,"column":33},"end":{"line":66,"column":65}},"20":{"start":{"line":69,"column":20},"end":{"line":74,"column":5}},"21":{"start":{"line":75,"column":4},"end":{"line":76,"column":7}},"22":{"start":{"line":80,"column":4},"end":{"line":82,"column":5}},"23":{"start":{"line":81,"column":6},"end":{"line":81,"column":27}},"24":{"start":{"line":84,"column":4},"end":{"line":88,"column":7}},"25":{"start":{"line":89,"column":4},"end":{"line":89,"column":25}},"26":{"start":{"line":94,"column":0},"end":{"line":94,"column":32}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":12,"column":9},"end":{"line":12,"column":31}},"loc":{"start":{"line":12,"column":37},"end":{"line":12,"column":95}},"line":12},"1":{"name":"(anonymous_1)","decl":{"start":{"line":30,"column":2},"end":{"line":30,"column":3}},"loc":{"start":{"line":30,"column":22},"end":{"line":38,"column":3}},"line":30},"2":{"name":"(anonymous_2)","decl":{"start":{"line":40,"column":2},"end":{"line":40,"column":3}},"loc":{"start":{"line":40,"column":18},"end":{"line":45,"column":3}},"line":40},"3":{"name":"(anonymous_3)","decl":{"start":{"line":47,"column":2},"end":{"line":47,"column":3}},"loc":{"start":{"line":47,"column":31},"end":{"line":77,"column":3}},"line":47},"4":{"name":"(anonymous_4)","decl":{"start":{"line":61,"column":26},"end":{"line":61,"column":27}},"loc":{"start":{"line":61,"column":34},"end":{"line":67,"column":5}},"line":61},"5":{"name":"(anonymous_5)","decl":{"start":{"line":63,"column":27},"end":{"line":63,"column":28}},"loc":{"start":{"line":63,"column":35},"end":{"line":63,"column":107}},"line":63},"6":{"name":"(anonymous_6)","decl":{"start":{"line":66,"column":25},"end":{"line":66,"column":26}},"loc":{"start":{"line":66,"column":33},"end":{"line":66,"column":65}},"line":66},"7":{"name":"(anonymous_7)","decl":{"start":{"line":79,"column":2},"end":{"line":79,"column":3}},"loc":{"start":{"line":79,"column":18},"end":{"line":90,"column":3}},"line":79}},"branchMap":{"0":{"loc":{"start":{"line":12,"column":46},"end":{"line":12,"column":92}},"type":"cond-expr","locations":[{"start":{"line":12,"column":70},"end":{"line":12,"column":73}},{"start":{"line":12,"column":76},"end":{"line":12,"column":92}}],"line":12},"1":{"loc":{"start":{"line":12,"column":46},"end":{"line":12,"column":67}},"type":"binary-expr","locations":[{"start":{"line":12,"column":46},"end":{"line":12,"column":49}},{"start":{"line":12,"column":53},"end":{"line":12,"column":67}}],"line":12},"2":{"loc":{"start":{"line":51,"column":4},"end":{"line":51,"column":25}},"type":"if","locations":[{"start":{"line":51,"column":4},"end":{"line":51,"column":25}},{"start":{"line":51,"column":4},"end":{"line":51,"column":25}}],"line":51},"3":{"loc":{"start":{"line":52,"column":28},"end":{"line":52,"column":74}},"type":"binary-expr","locations":[{"start":{"line":52,"column":28},"end":{"line":52,"column":42}},{"start":{"line":52,"column":46},"end":{"line":52,"column":68}},{"start":{"line":52,"column":72},"end":{"line":52,"column":74}}],"line":52},"4":{"loc":{"start":{"line":62,"column":6},"end":{"line":64,"column":7}},"type":"if","locations":[{"start":{"line":62,"column":6},"end":{"line":64,"column":7}},{"start":{"line":62,"column":6},"end":{"line":64,"column":7}}],"line":62},"5":{"loc":{"start":{"line":63,"column":35},"end":{"line":63,"column":107}},"type":"binary-expr","locations":[{"start":{"line":63,"column":35},"end":{"line":63,"column":67}},{"start":{"line":63,"column":71},"end":{"line":63,"column":107}}],"line":63},"6":{"loc":{"start":{"line":80,"column":4},"end":{"line":82,"column":5}},"type":"if","locations":[{"start":{"line":80,"column":4},"end":{"line":82,"column":5}},{"start":{"line":80,"column":4},"end":{"line":82,"column":5}}],"line":80}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":118,"7":11,"8":7,"9":7,"10":0,"11":7,"12":7,"13":7,"14":7,"15":28,"16":4,"17":3,"18":24,"19":11,"20":7,"21":7,"22":12,"23":0,"24":12,"25":12,"26":1},"f":{"0":1,"1":118,"2":11,"3":7,"4":28,"5":3,"6":11,"7":12},"b":{"0":[1,0],"1":[1,1],"2":[0,7],"3":[7,1,6],"4":[4,24],"5":[3,3],"6":[0,12]},"inputSourceMap":{"version":3,"sources":["clients.js"],"names":["schema","type","items","properties","name","minLength","pattern","required","ClientHandler","DefaultHandler","constructor","config","id","identifiers","objectFields","stripUpdateFields","objString","item","client_id","processChanges","assets","clients","excludedClients","exclude","del","update","create","conflicts","calcChanges","currentClient","filterClients","list","length","filter","includes","changes","getType","existing","client","getAll","paginate","include_totals","is_global"],"mappings":"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","sourceRoot":"/home/circleci/repo/src/tools/auth0/handlers/","sourcesContent":["import DefaultHandler from './default';\n\nexport const schema = {\n  type: 'array',\n  items: {\n    type: 'object',\n    properties: {\n      name: { type: 'string', minLength: 1, pattern: '[^<>]+' }\n    },\n    required: [ 'name' ]\n  }\n};\n\nexport default class ClientHandler extends DefaultHandler {\n  constructor(config) {\n    super({\n      ...config,\n      type: 'clients',\n      id: 'client_id',\n      identifiers: [ 'client_id', 'name' ],\n      objectFields: [ 'client_metadata' ],\n      stripUpdateFields: [\n        // Fields not allowed during updates\n        'callback_url_template', 'signing_keys', 'global', 'tenant', 'jwt_configuration.secret_encoded'\n      ]\n    });\n  }\n\n  objString(item) {\n    return super.objString({ name: item.name, client_id: item.client_id });\n  }\n\n  async processChanges(assets) {\n    const { clients } = assets;\n\n    // Do nothing if not set\n    if (!clients) return;\n\n    const excludedClients = (assets.exclude && assets.exclude.clients) || [];\n\n    const {\n      del, update, create, conflicts\n    } = await this.calcChanges(assets);\n\n    // Always filter out the client we are using to access Auth0 Management API\n    // As it could cause problems if it gets deleted or updated etc\n    const currentClient = this.config('AUTH0_CLIENT_ID');\n\n    const filterClients = (list) => {\n      if (excludedClients.length) {\n        return list.filter((item) => item.client_id !== currentClient && !excludedClients.includes(item.name));\n      }\n\n      return list.filter((item) => item.client_id !== currentClient);\n    };\n\n    const changes = {\n      del: filterClients(del),\n      update: filterClients(update),\n      create: filterClients(create),\n      conflicts: filterClients(conflicts)\n    };\n\n    await super.processChanges(assets, {\n      ...changes\n    });\n  }\n\n  async getType() {\n    if (this.existing) {\n      return this.existing;\n    }\n    this.existing = await this.client.clients.getAll({ paginate: true, include_totals: true, is_global: false });\n    return this.existing;\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"8dc521d6f5997e9187fa2c6d0658afa8c04c9cf1","contentHash":"6648d2097c303738fc2805e62aaef0851a7d67d1b5d7038b5c5910d142faff08"},"/home/circleci/repo/src/tools/auth0/handlers/tenant.js":{"path":"/home/circleci/repo/src/tools/auth0/handlers/tenant.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":45}},"2":{"start":{"line":10,"column":23},"end":{"line":10,"column":55}},"3":{"start":{"line":12,"column":24},"end":{"line":12,"column":64}},"4":{"start":{"line":14,"column":15},"end":{"line":14,"column":35}},"5":{"start":{"line":16,"column":16},"end":{"line":16,"column":48}},"6":{"start":{"line":18,"column":13},"end":{"line":18,"column":31}},"7":{"start":{"line":20,"column":13},"end":{"line":20,"column":35}},"8":{"start":{"line":22,"column":39},"end":{"line":22,"column":93}},"9":{"start":{"line":24,"column":99},"end":{"line":24,"column":101}},"10":{"start":{"line":24,"column":103},"end":{"line":24,"column":184}},"11":{"start":{"line":24,"column":152},"end":{"line":24,"column":180}},"12":{"start":{"line":24,"column":185},"end":{"line":24,"column":221}},"13":{"start":{"line":24,"column":222},"end":{"line":24,"column":262}},"14":{"start":{"line":24,"column":263},"end":{"line":24,"column":329}},"15":{"start":{"line":24,"column":306},"end":{"line":24,"column":327}},"16":{"start":{"line":24,"column":330},"end":{"line":24,"column":461}},"17":{"start":{"line":24,"column":402},"end":{"line":24,"column":451}},"18":{"start":{"line":24,"column":462},"end":{"line":24,"column":612}},"19":{"start":{"line":24,"column":508},"end":{"line":24,"column":580}},"20":{"start":{"line":24,"column":581},"end":{"line":24,"column":610}},"21":{"start":{"line":24,"column":613},"end":{"line":24,"column":709}},"22":{"start":{"line":24,"column":648},"end":{"line":24,"column":694}},"23":{"start":{"line":24,"column":695},"end":{"line":24,"column":707}},"24":{"start":{"line":24,"column":710},"end":{"line":24,"column":722}},"25":{"start":{"line":26,"column":15},"end":{"line":28,"column":1}},"26":{"start":{"line":29,"column":22},"end":{"line":29,"column":122}},"27":{"start":{"line":30,"column":21},"end":{"line":69,"column":170}},"28":{"start":{"line":32,"column":4},"end":{"line":34,"column":7}},"29":{"start":{"line":38,"column":19},"end":{"line":38,"column":57}},"30":{"start":{"line":39,"column":4},"end":{"line":41,"column":7}},"31":{"start":{"line":40,"column":6},"end":{"line":40,"column":42}},"32":{"start":{"line":40,"column":23},"end":{"line":40,"column":42}},"33":{"start":{"line":42,"column":4},"end":{"line":42,"column":18}},"34":{"start":{"line":48,"column":8},"end":{"line":48,"column":14}},"35":{"start":{"line":49,"column":4},"end":{"line":49,"column":24}},"36":{"start":{"line":49,"column":17},"end":{"line":49,"column":24}},"37":{"start":{"line":50,"column":21},"end":{"line":50,"column":79}},"38":{"start":{"line":50,"column":53},"end":{"line":50,"column":78}},"39":{"start":{"line":52,"column":4},"end":{"line":54,"column":5}},"40":{"start":{"line":53,"column":6},"end":{"line":53,"column":197}},"41":{"start":{"line":60,"column":8},"end":{"line":60,"column":14}},"42":{"start":{"line":62,"column":4},"end":{"line":66,"column":5}},"43":{"start":{"line":63,"column":6},"end":{"line":63,"column":54}},"44":{"start":{"line":64,"column":6},"end":{"line":64,"column":24}},"45":{"start":{"line":65,"column":6},"end":{"line":65,"column":29}},"46":{"start":{"line":70,"column":0},"end":{"line":70,"column":32}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":22,"column":9},"end":{"line":22,"column":31}},"loc":{"start":{"line":22,"column":37},"end":{"line":22,"column":95}},"line":22},"1":{"name":"_applyDecoratedDescriptor","decl":{"start":{"line":24,"column":9},"end":{"line":24,"column":34}},"loc":{"start":{"line":24,"column":86},"end":{"line":24,"column":724}},"line":24},"2":{"name":"(anonymous_2)","decl":{"start":{"line":24,"column":135},"end":{"line":24,"column":136}},"loc":{"start":{"line":24,"column":150},"end":{"line":24,"column":182}},"line":24},"3":{"name":"(anonymous_3)","decl":{"start":{"line":24,"column":373},"end":{"line":24,"column":374}},"loc":{"start":{"line":24,"column":400},"end":{"line":24,"column":453}},"line":24},"4":{"name":"(anonymous_4)","decl":{"start":{"line":31,"column":2},"end":{"line":31,"column":3}},"loc":{"start":{"line":31,"column":23},"end":{"line":35,"column":3}},"line":31},"5":{"name":"(anonymous_5)","decl":{"start":{"line":37,"column":2},"end":{"line":37,"column":3}},"loc":{"start":{"line":37,"column":18},"end":{"line":43,"column":3}},"line":37},"6":{"name":"(anonymous_6)","decl":{"start":{"line":39,"column":26},"end":{"line":39,"column":27}},"loc":{"start":{"line":39,"column":33},"end":{"line":41,"column":5}},"line":39},"7":{"name":"(anonymous_7)","decl":{"start":{"line":45,"column":2},"end":{"line":45,"column":3}},"loc":{"start":{"line":45,"column":25},"end":{"line":55,"column":3}},"line":45},"8":{"name":"(anonymous_8)","decl":{"start":{"line":50,"column":48},"end":{"line":50,"column":49}},"loc":{"start":{"line":50,"column":53},"end":{"line":50,"column":78}},"line":50},"9":{"name":"(anonymous_9)","decl":{"start":{"line":57,"column":2},"end":{"line":57,"column":3}},"loc":{"start":{"line":57,"column":31},"end":{"line":67,"column":3}},"line":57}},"branchMap":{"0":{"loc":{"start":{"line":22,"column":46},"end":{"line":22,"column":92}},"type":"cond-expr","locations":[{"start":{"line":22,"column":70},"end":{"line":22,"column":73}},{"start":{"line":22,"column":76},"end":{"line":22,"column":92}}],"line":22},"1":{"loc":{"start":{"line":22,"column":46},"end":{"line":22,"column":67}},"type":"binary-expr","locations":[{"start":{"line":22,"column":46},"end":{"line":22,"column":49}},{"start":{"line":22,"column":53},"end":{"line":22,"column":67}}],"line":22},"2":{"loc":{"start":{"line":24,"column":263},"end":{"line":24,"column":329}},"type":"if","locations":[{"start":{"line":24,"column":263},"end":{"line":24,"column":329}},{"start":{"line":24,"column":263},"end":{"line":24,"column":329}}],"line":24},"3":{"loc":{"start":{"line":24,"column":267},"end":{"line":24,"column":302}},"type":"binary-expr","locations":[{"start":{"line":24,"column":267},"end":{"line":24,"column":282}},{"start":{"line":24,"column":286},"end":{"line":24,"column":302}}],"line":24},"4":{"loc":{"start":{"line":24,"column":409},"end":{"line":24,"column":450}},"type":"binary-expr","locations":[{"start":{"line":24,"column":409},"end":{"line":24,"column":442}},{"start":{"line":24,"column":446},"end":{"line":24,"column":450}}],"line":24},"5":{"loc":{"start":{"line":24,"column":462},"end":{"line":24,"column":612}},"type":"if","locations":[{"start":{"line":24,"column":462},"end":{"line":24,"column":612}},{"start":{"line":24,"column":462},"end":{"line":24,"column":612}}],"line":24},"6":{"loc":{"start":{"line":24,"column":466},"end":{"line":24,"column":504}},"type":"binary-expr","locations":[{"start":{"line":24,"column":466},"end":{"line":24,"column":473}},{"start":{"line":24,"column":477},"end":{"line":24,"column":504}}],"line":24},"7":{"loc":{"start":{"line":24,"column":521},"end":{"line":24,"column":579}},"type":"cond-expr","locations":[{"start":{"line":24,"column":540},"end":{"line":24,"column":570}},{"start":{"line":24,"column":573},"end":{"line":24,"column":579}}],"line":24},"8":{"loc":{"start":{"line":24,"column":613},"end":{"line":24,"column":709}},"type":"if","locations":[{"start":{"line":24,"column":613},"end":{"line":24,"column":709}},{"start":{"line":24,"column":613},"end":{"line":24,"column":709}}],"line":24},"9":{"loc":{"start":{"line":40,"column":6},"end":{"line":40,"column":42}},"type":"if","locations":[{"start":{"line":40,"column":6},"end":{"line":40,"column":42}},{"start":{"line":40,"column":6},"end":{"line":40,"column":42}}],"line":40},"10":{"loc":{"start":{"line":49,"column":4},"end":{"line":49,"column":24}},"type":"if","locations":[{"start":{"line":49,"column":4},"end":{"line":49,"column":24}},{"start":{"line":49,"column":4},"end":{"line":49,"column":24}}],"line":49},"11":{"loc":{"start":{"line":52,"column":4},"end":{"line":54,"column":5}},"type":"if","locations":[{"start":{"line":52,"column":4},"end":{"line":54,"column":5}},{"start":{"line":52,"column":4},"end":{"line":54,"column":5}}],"line":52},"12":{"loc":{"start":{"line":62,"column":4},"end":{"line":66,"column":5}},"type":"if","locations":[{"start":{"line":62,"column":4},"end":{"line":66,"column":5}},{"start":{"line":62,"column":4},"end":{"line":66,"column":5}}],"line":62},"13":{"loc":{"start":{"line":62,"column":8},"end":{"line":62,"column":48}},"type":"binary-expr","locations":[{"start":{"line":62,"column":8},"end":{"line":62,"column":14}},{"start":{"line":62,"column":18},"end":{"line":62,"column":48}}],"line":62}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":2,"9":1,"10":1,"11":4,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":0,"20":0,"21":1,"22":1,"23":1,"24":1,"25":1,"26":1,"27":1,"28":111,"29":5,"30":5,"31":50,"32":0,"33":5,"34":60,"35":60,"36":57,"37":3,"38":7,"39":3,"40":1,"41":1,"42":1,"43":1,"44":1,"45":1,"46":1},"f":{"0":2,"1":1,"2":4,"3":1,"4":111,"5":5,"6":50,"7":60,"8":7,"9":1},"b":{"0":[1,1],"1":[2,2],"2":[1,0],"3":[1,0],"4":[1,0],"5":[0,1],"6":[1,1],"7":[0,0],"8":[1,0],"9":[0,50],"10":[57,3],"11":[1,2],"12":[1,0],"13":[1,1]},"inputSourceMap":{"version":3,"sources":["tenant.js"],"names":["schema","type","blockPageKeys","Object","keys","pageNameMap","values","supportedPages","TenantHandler","DefaultHandler","constructor","options","getType","tenant","client","getSettings","forEach","key","validate","assets","pageKeys","filter","k","includes","length","ValidationError","processChanges","updateSettings","updated","didUpdate"],"mappings":";;;;;;;;;AAAA;;;;AAEA;;;;AACA;;AACA;;;;;;AAEO,MAAMA,MAAM,WAANA,MAAM,GAAG;AACpBC,EAAAA,IAAI,EAAE;AADc,CAAf;AAIP,MAAMC,aAAa,GAAG,CAAE,GAAGC,MAAM,CAACC,IAAP,CAAYC,kBAAZ,CAAL,EAA+B,GAAGF,MAAM,CAACG,MAAP,CAAcD,kBAAd,CAAlC,EAA8D,GAAGE,qBAAjE,CAAtB;IAEqBC,a,WA8BlB,oBAAM,KAAN,C,YA9BY,MAAMA,aAAN,SAA4BC,iBAA5B,CAA2C;AACxDC,EAAAA,WAAW,CAACC,OAAD,EAAU;AACnB,UAAM,EACJ,GAAGA,OADC;AAEJV,MAAAA,IAAI,EAAE;AAFF,KAAN;AAID;;AAEY,QAAPW,OAAO,GAAG;AACd,UAAMC,MAAM,GAAG,MAAM,KAAKC,MAAL,CAAYD,MAAZ,CAAmBE,WAAnB,EAArB;AACAb,IAAAA,aAAa,CAACc,OAAd,CAAuBC,GAAD,IAAS;AAC7B,UAAIJ,MAAM,CAACI,GAAD,CAAV,EAAiB,OAAOJ,MAAM,CAACI,GAAD,CAAb;AAClB,KAFD;AAIA,WAAOJ,MAAP;AACD;;AAEa,QAARK,QAAQ,CAACC,MAAD,EAAS;AACrB,UAAM;AAAEN,MAAAA;AAAF,QAAaM,MAAnB;AAGA,QAAI,CAACN,MAAL,EAAa;AAEb,UAAMO,QAAQ,GAAGjB,MAAM,CAACC,IAAP,CAAYS,MAAZ,EAAoBQ,MAApB,CAA4BC,CAAD,IAAOpB,aAAa,CAACqB,QAAd,CAAuBD,CAAvB,CAAlC,CAAjB;;AACA,QAAIF,QAAQ,CAACI,MAAT,GAAkB,CAAtB,EAAyB;AACvB,YAAM,IAAIC,yBAAJ,CAAqB,uBAAsB,qBAASL,QAAT,CAAmB,oGAA9D,CAAN;AACD;AACF;;AAImB,QAAdM,cAAc,CAACP,MAAD,EAAS;AAC3B,UAAM;AAAEN,MAAAA;AAAF,QAAaM,MAAnB;;AAEA,QAAIN,MAAM,IAAIV,MAAM,CAACC,IAAP,CAAYS,MAAZ,EAAoBW,MAApB,GAA6B,CAA3C,EAA8C;AAC5C,YAAM,KAAKV,MAAL,CAAYD,MAAZ,CAAmBc,cAAnB,CAAkCd,MAAlC,CAAN;AACA,WAAKe,OAAL,IAAgB,CAAhB;AACA,WAAKC,SAAL,CAAehB,MAAf;AACD;AACF;;AAvCuD,C;kBAArCL,a","sourceRoot":"/home/circleci/repo/src/tools/auth0/handlers/","sourcesContent":["import ValidationError from '../../ValidationError';\n\nimport DefaultHandler, { order } from './default';\nimport { supportedPages, pageNameMap } from './pages';\nimport { dumpJSON } from '../../utils';\n\nexport const schema = {\n  type: 'object'\n};\n\nconst blockPageKeys = [ ...Object.keys(pageNameMap), ...Object.values(pageNameMap), ...supportedPages ];\n\nexport default class TenantHandler extends DefaultHandler {\n  constructor(options) {\n    super({\n      ...options,\n      type: 'tenant'\n    });\n  }\n\n  async getType() {\n    const tenant = await this.client.tenant.getSettings();\n    blockPageKeys.forEach((key) => {\n      if (tenant[key]) delete tenant[key];\n    });\n\n    return tenant;\n  }\n\n  async validate(assets) {\n    const { tenant } = assets;\n\n    // Nothing to validate?\n    if (!tenant) return;\n\n    const pageKeys = Object.keys(tenant).filter((k) => blockPageKeys.includes(k));\n    if (pageKeys.length > 0) {\n      throw new ValidationError(`The following pages ${dumpJSON(pageKeys)} were found in tenant settings. Pages should be set separately. Please refer to the documentation.`);\n    }\n  }\n\n  // Run after other updates so objected can be referenced such as default directory\n  @order('100')\n  async processChanges(assets) {\n    const { tenant } = assets;\n\n    if (tenant && Object.keys(tenant).length > 0) {\n      await this.client.tenant.updateSettings(tenant);\n      this.updated += 1;\n      this.didUpdate(tenant);\n    }\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"a8ab1a56b3bb3f3252f8030a281573dab8848476","contentHash":"5fe542fde7849155dfde25ea58493f3bc396237a7f2cec9d7c7308c51768e531"},"/home/circleci/repo/src/tools/auth0/handlers/emailProvider.js":{"path":"/home/circleci/repo/src/tools/auth0/handlers/emailProvider.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":27}},"2":{"start":{"line":8,"column":15},"end":{"line":8,"column":35}},"3":{"start":{"line":10,"column":16},"end":{"line":10,"column":48}},"4":{"start":{"line":12,"column":39},"end":{"line":12,"column":93}},"5":{"start":{"line":14,"column":15},"end":{"line":16,"column":1}},"6":{"start":{"line":17,"column":22},"end":{"line":17,"column":92}},"7":{"start":{"line":21,"column":4},"end":{"line":23,"column":7}},"8":{"start":{"line":27,"column":4},"end":{"line":35,"column":5}},"9":{"start":{"line":28,"column":6},"end":{"line":31,"column":9}},"10":{"start":{"line":33,"column":6},"end":{"line":33,"column":44}},"11":{"start":{"line":33,"column":34},"end":{"line":33,"column":44}},"12":{"start":{"line":34,"column":6},"end":{"line":34,"column":16}},"13":{"start":{"line":39,"column":4},"end":{"line":42,"column":7}},"14":{"start":{"line":48,"column":8},"end":{"line":48,"column":14}},"15":{"start":{"line":49,"column":4},"end":{"line":49,"column":31}},"16":{"start":{"line":49,"column":24},"end":{"line":49,"column":31}},"17":{"start":{"line":51,"column":4},"end":{"line":79,"column":5}},"18":{"start":{"line":52,"column":21},"end":{"line":52,"column":41}},"19":{"start":{"line":54,"column":6},"end":{"line":60,"column":7}},"20":{"start":{"line":55,"column":8},"end":{"line":59,"column":9}},"21":{"start":{"line":56,"column":10},"end":{"line":56,"column":51}},"22":{"start":{"line":57,"column":10},"end":{"line":57,"column":35}},"23":{"start":{"line":58,"column":10},"end":{"line":58,"column":24}},"24":{"start":{"line":62,"column":6},"end":{"line":78,"column":7}},"25":{"start":{"line":63,"column":25},"end":{"line":66,"column":9}},"26":{"start":{"line":67,"column":24},"end":{"line":67,"column":87}},"27":{"start":{"line":68,"column":8},"end":{"line":68,"column":26}},"28":{"start":{"line":69,"column":8},"end":{"line":69,"column":32}},"29":{"start":{"line":71,"column":25},"end":{"line":74,"column":9}},"30":{"start":{"line":75,"column":24},"end":{"line":75,"column":90}},"31":{"start":{"line":76,"column":8},"end":{"line":76,"column":26}},"32":{"start":{"line":77,"column":8},"end":{"line":77,"column":32}},"33":{"start":{"line":84,"column":0},"end":{"line":84,"column":39}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":12,"column":9},"end":{"line":12,"column":31}},"loc":{"start":{"line":12,"column":37},"end":{"line":12,"column":95}},"line":12},"1":{"name":"(anonymous_1)","decl":{"start":{"line":20,"column":2},"end":{"line":20,"column":3}},"loc":{"start":{"line":20,"column":23},"end":{"line":24,"column":3}},"line":20},"2":{"name":"(anonymous_2)","decl":{"start":{"line":26,"column":2},"end":{"line":26,"column":3}},"loc":{"start":{"line":26,"column":18},"end":{"line":36,"column":3}},"line":26},"3":{"name":"(anonymous_3)","decl":{"start":{"line":38,"column":2},"end":{"line":38,"column":3}},"loc":{"start":{"line":38,"column":22},"end":{"line":43,"column":3}},"line":38},"4":{"name":"(anonymous_4)","decl":{"start":{"line":45,"column":2},"end":{"line":45,"column":3}},"loc":{"start":{"line":45,"column":31},"end":{"line":80,"column":3}},"line":45}},"branchMap":{"0":{"loc":{"start":{"line":12,"column":46},"end":{"line":12,"column":92}},"type":"cond-expr","locations":[{"start":{"line":12,"column":70},"end":{"line":12,"column":73}},{"start":{"line":12,"column":76},"end":{"line":12,"column":92}}],"line":12},"1":{"loc":{"start":{"line":12,"column":46},"end":{"line":12,"column":67}},"type":"binary-expr","locations":[{"start":{"line":12,"column":46},"end":{"line":12,"column":49}},{"start":{"line":12,"column":53},"end":{"line":12,"column":67}}],"line":12},"2":{"loc":{"start":{"line":33,"column":6},"end":{"line":33,"column":44}},"type":"if","locations":[{"start":{"line":33,"column":6},"end":{"line":33,"column":44}},{"start":{"line":33,"column":6},"end":{"line":33,"column":44}}],"line":33},"3":{"loc":{"start":{"line":49,"column":4},"end":{"line":49,"column":31}},"type":"if","locations":[{"start":{"line":49,"column":4},"end":{"line":49,"column":31}},{"start":{"line":49,"column":4},"end":{"line":49,"column":31}}],"line":49},"4":{"loc":{"start":{"line":51,"column":4},"end":{"line":79,"column":5}},"type":"if","locations":[{"start":{"line":51,"column":4},"end":{"line":79,"column":5}},{"start":{"line":51,"column":4},"end":{"line":79,"column":5}}],"line":51},"5":{"loc":{"start":{"line":54,"column":6},"end":{"line":60,"column":7}},"type":"if","locations":[{"start":{"line":54,"column":6},"end":{"line":60,"column":7}},{"start":{"line":54,"column":6},"end":{"line":60,"column":7}}],"line":54},"6":{"loc":{"start":{"line":55,"column":8},"end":{"line":59,"column":9}},"type":"if","locations":[{"start":{"line":55,"column":8},"end":{"line":59,"column":9}},{"start":{"line":55,"column":8},"end":{"line":59,"column":9}}],"line":55},"7":{"loc":{"start":{"line":62,"column":6},"end":{"line":78,"column":7}},"type":"if","locations":[{"start":{"line":62,"column":6},"end":{"line":78,"column":7}},{"start":{"line":62,"column":6},"end":{"line":78,"column":7}}],"line":62}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":112,"8":8,"9":8,"10":0,"11":0,"12":0,"13":4,"14":3,"15":3,"16":0,"17":3,"18":3,"19":3,"20":2,"21":1,"22":1,"23":1,"24":3,"25":1,"26":1,"27":1,"28":1,"29":2,"30":2,"31":2,"32":2,"33":1},"f":{"0":1,"1":112,"2":8,"3":4,"4":3},"b":{"0":[1,0],"1":[1,1],"2":[0,0],"3":[0,3],"4":[3,0],"5":[2,1],"6":[1,1],"7":[1,2]},"inputSourceMap":{"version":3,"sources":["emailProvider.js"],"names":["schema","type","defaultFields","EmailProviderHandler","DefaultHandler","constructor","options","getType","client","emailProvider","get","include_fields","fields","err","statusCode","objString","provider","name","enabled","processChanges","assets","Object","keys","length","existing","delete","didDelete","updated","update","didUpdate","created","configure","didCreate"],"mappings":";;;;;;;AAAA;;;;;;AAEO,MAAMA,MAAM,WAANA,MAAM,GAAG;AAAEC,EAAAA,IAAI,EAAE;AAAR,CAAf;AAGP,MAAMC,aAAa,GAAG,CAAE,MAAF,EAAU,SAAV,EAAqB,aAArB,EAAoC,UAApC,EAAgD,sBAAhD,CAAtB;;AAEe,MAAMC,oBAAN,SAAmCC,iBAAnC,CAAkD;AAC/DC,EAAAA,WAAW,CAACC,OAAD,EAAU;AACnB,UAAM,EACJ,GAAGA,OADC;AAEJL,MAAAA,IAAI,EAAE;AAFF,KAAN;AAID;;AAEY,QAAPM,OAAO,GAAG;AACd,QAAI;AACF,aAAO,MAAM,KAAKC,MAAL,CAAYC,aAAZ,CAA0BC,GAA1B,CAA8B;AAAEC,QAAAA,cAAc,EAAE,IAAlB;AAAwBC,QAAAA,MAAM,EAAEV;AAAhC,OAA9B,CAAb;AACD,KAFD,CAEE,OAAOW,GAAP,EAAY;AACZ,UAAIA,GAAG,CAACC,UAAJ,KAAmB,GAAvB,EAA4B,OAAO,EAAP;AAC5B,YAAMD,GAAN;AACD;AACF;;AAEDE,EAAAA,SAAS,CAACC,QAAD,EAAW;AAClB,WAAO,MAAMD,SAAN,CAAgB;AAAEE,MAAAA,IAAI,EAAED,QAAQ,CAACC,IAAjB;AAAuBC,MAAAA,OAAO,EAAEF,QAAQ,CAACE;AAAzC,KAAhB,CAAP;AACD;;AAEmB,QAAdC,cAAc,CAACC,MAAD,EAAS;AAC3B,UAAM;AAAEX,MAAAA;AAAF,QAAoBW,MAA1B;AAGA,QAAI,CAACX,aAAL,EAAoB;;AAEpB,QAAIY,MAAM,CAACC,IAAP,CAAYb,aAAZ,EAA2Bc,MAA3B,GAAoC,CAAxC,EAA2C;AACzC,UAAIC,QAAQ,GAAG,MAAM,KAAKjB,OAAL,EAArB;;AAGA,UAAIiB,QAAQ,CAACP,IAAb,EAAmB;AACjB,YAAIO,QAAQ,CAACP,IAAT,KAAkBR,aAAa,CAACQ,IAApC,EAA0C;AAExC,gBAAM,KAAKT,MAAL,CAAYC,aAAZ,CAA0BgB,MAA1B,EAAN;AACA,eAAKC,SAAL,CAAeF,QAAf;AACAA,UAAAA,QAAQ,GAAG,EAAX;AACD;AACF;;AAGD,UAAIA,QAAQ,CAACP,IAAb,EAAmB;AACjB,cAAMD,QAAQ,GAAG;AAAEC,UAAAA,IAAI,EAAER,aAAa,CAACQ,IAAtB;AAA4BC,UAAAA,OAAO,EAAET,aAAa,CAACS;AAAnD,SAAjB;AACA,cAAMS,OAAO,GAAG,MAAM,KAAKnB,MAAL,CAAYC,aAAZ,CAA0BmB,MAA1B,CAAiCZ,QAAjC,EAA2CP,aAA3C,CAAtB;AACA,aAAKkB,OAAL,IAAgB,CAAhB;AACA,aAAKE,SAAL,CAAeF,OAAf;AACD,OALD,MAKO;AACL,cAAMX,QAAQ,GAAG;AAAEC,UAAAA,IAAI,EAAER,aAAa,CAACQ,IAAtB;AAA4BC,UAAAA,OAAO,EAAET,aAAa,CAACS;AAAnD,SAAjB;AACA,cAAMY,OAAO,GAAG,MAAM,KAAKtB,MAAL,CAAYC,aAAZ,CAA0BsB,SAA1B,CAAoCf,QAApC,EAA8CP,aAA9C,CAAtB;AACA,aAAKqB,OAAL,IAAgB,CAAhB;AACA,aAAKE,SAAL,CAAeF,OAAf;AACD;AACF;AACF;;AArD8D;;kBAA5C3B,oB","sourceRoot":"/home/circleci/repo/src/tools/auth0/handlers/","sourcesContent":["import DefaultHandler from './default';\n\nexport const schema = { type: 'object' };\n\n// The Management API requires the fields to be specified\nconst defaultFields = [ 'name', 'enabled', 'credentials', 'settings', 'default_from_address' ];\n\nexport default class EmailProviderHandler extends DefaultHandler {\n  constructor(options) {\n    super({\n      ...options,\n      type: 'emailProvider'\n    });\n  }\n\n  async getType() {\n    try {\n      return await this.client.emailProvider.get({ include_fields: true, fields: defaultFields });\n    } catch (err) {\n      if (err.statusCode === 404) return {};\n      throw err;\n    }\n  }\n\n  objString(provider) {\n    return super.objString({ name: provider.name, enabled: provider.enabled });\n  }\n\n  async processChanges(assets) {\n    const { emailProvider } = assets;\n\n    // Do nothing if not set\n    if (!emailProvider) return;\n\n    if (Object.keys(emailProvider).length > 0) {\n      let existing = await this.getType();\n\n      // Check for existing Email Provider\n      if (existing.name) {\n        if (existing.name !== emailProvider.name) {\n          // Delete the current provider as it's different\n          await this.client.emailProvider.delete();\n          this.didDelete(existing);\n          existing = {};\n        }\n      }\n\n      // Now configure or update depending if it is configured already\n      if (existing.name) {\n        const provider = { name: emailProvider.name, enabled: emailProvider.enabled };\n        const updated = await this.client.emailProvider.update(provider, emailProvider);\n        this.updated += 1;\n        this.didUpdate(updated);\n      } else {\n        const provider = { name: emailProvider.name, enabled: emailProvider.enabled };\n        const created = await this.client.emailProvider.configure(provider, emailProvider);\n        this.created += 1;\n        this.didCreate(created);\n      }\n    }\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"9bcb449062eaca416bb154fdebaaebae36b5d11c","contentHash":"94cd1ea15d45759aacfe0245b7fb557a27cfbbbd668dd2038ce31185ed14a8f5"},"/home/circleci/repo/src/tools/auth0/handlers/emailTemplates.js":{"path":"/home/circleci/repo/src/tools/auth0/handlers/emailTemplates.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":74}},"2":{"start":{"line":10,"column":15},"end":{"line":10,"column":35}},"3":{"start":{"line":12,"column":16},"end":{"line":12,"column":48}},"4":{"start":{"line":14,"column":17},"end":{"line":14,"column":43}},"5":{"start":{"line":16,"column":18},"end":{"line":16,"column":52}},"6":{"start":{"line":18,"column":39},"end":{"line":18,"column":93}},"7":{"start":{"line":20,"column":99},"end":{"line":20,"column":101}},"8":{"start":{"line":20,"column":103},"end":{"line":20,"column":184}},"9":{"start":{"line":20,"column":152},"end":{"line":20,"column":180}},"10":{"start":{"line":20,"column":185},"end":{"line":20,"column":221}},"11":{"start":{"line":20,"column":222},"end":{"line":20,"column":262}},"12":{"start":{"line":20,"column":263},"end":{"line":20,"column":329}},"13":{"start":{"line":20,"column":306},"end":{"line":20,"column":327}},"14":{"start":{"line":20,"column":330},"end":{"line":20,"column":461}},"15":{"start":{"line":20,"column":402},"end":{"line":20,"column":451}},"16":{"start":{"line":20,"column":462},"end":{"line":20,"column":612}},"17":{"start":{"line":20,"column":508},"end":{"line":20,"column":580}},"18":{"start":{"line":20,"column":581},"end":{"line":20,"column":610}},"19":{"start":{"line":20,"column":613},"end":{"line":20,"column":709}},"20":{"start":{"line":20,"column":648},"end":{"line":20,"column":694}},"21":{"start":{"line":20,"column":695},"end":{"line":20,"column":707}},"22":{"start":{"line":20,"column":710},"end":{"line":20,"column":722}},"23":{"start":{"line":22,"column":27},"end":{"line":22,"column":163}},"24":{"start":{"line":22,"column":110},"end":{"line":22,"column":129}},"25":{"start":{"line":22,"column":140},"end":{"line":22,"column":162}},"26":{"start":{"line":24,"column":15},"end":{"line":40,"column":1}},"27":{"start":{"line":41,"column":28},"end":{"line":97,"column":170}},"28":{"start":{"line":43,"column":4},"end":{"line":46,"column":7}},"29":{"start":{"line":50,"column":27},"end":{"line":50,"column":29}},"30":{"start":{"line":51,"column":4},"end":{"line":62,"column":8}},"31":{"start":{"line":52,"column":6},"end":{"line":61,"column":7}},"32":{"start":{"line":53,"column":25},"end":{"line":55,"column":10}},"33":{"start":{"line":56,"column":8},"end":{"line":56,"column":38}},"34":{"start":{"line":58,"column":8},"end":{"line":60,"column":9}},"35":{"start":{"line":59,"column":10},"end":{"line":59,"column":20}},"36":{"start":{"line":63,"column":4},"end":{"line":63,"column":26}},"37":{"start":{"line":67,"column":4},"end":{"line":84,"column":5}},"38":{"start":{"line":68,"column":21},"end":{"line":70,"column":7}},"39":{"start":{"line":71,"column":22},"end":{"line":71,"column":84}},"40":{"start":{"line":72,"column":6},"end":{"line":72,"column":26}},"41":{"start":{"line":73,"column":6},"end":{"line":73,"column":30}},"42":{"start":{"line":74,"column":6},"end":{"line":74,"column":24}},"43":{"start":{"line":76,"column":6},"end":{"line":83,"column":7}},"44":{"start":{"line":77,"column":24},"end":{"line":77,"column":78}},"45":{"start":{"line":78,"column":8},"end":{"line":78,"column":28}},"46":{"start":{"line":79,"column":8},"end":{"line":79,"column":32}},"47":{"start":{"line":80,"column":8},"end":{"line":80,"column":26}},"48":{"start":{"line":82,"column":8},"end":{"line":82,"column":18}},"49":{"start":{"line":90,"column":8},"end":{"line":90,"column":14}},"50":{"start":{"line":91,"column":4},"end":{"line":91,"column":58}},"51":{"start":{"line":91,"column":51},"end":{"line":91,"column":58}},"52":{"start":{"line":92,"column":4},"end":{"line":94,"column":8}},"53":{"start":{"line":93,"column":6},"end":{"line":93,"column":47}},"54":{"start":{"line":98,"column":0},"end":{"line":98,"column":39}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":18,"column":9},"end":{"line":18,"column":31}},"loc":{"start":{"line":18,"column":37},"end":{"line":18,"column":95}},"line":18},"1":{"name":"_applyDecoratedDescriptor","decl":{"start":{"line":20,"column":9},"end":{"line":20,"column":34}},"loc":{"start":{"line":20,"column":86},"end":{"line":20,"column":724}},"line":20},"2":{"name":"(anonymous_2)","decl":{"start":{"line":20,"column":135},"end":{"line":20,"column":136}},"loc":{"start":{"line":20,"column":150},"end":{"line":20,"column":182}},"line":20},"3":{"name":"(anonymous_3)","decl":{"start":{"line":20,"column":373},"end":{"line":20,"column":374}},"loc":{"start":{"line":20,"column":400},"end":{"line":20,"column":453}},"line":20},"4":{"name":"(anonymous_4)","decl":{"start":{"line":22,"column":105},"end":{"line":22,"column":106}},"loc":{"start":{"line":22,"column":110},"end":{"line":22,"column":129}},"line":22},"5":{"name":"(anonymous_5)","decl":{"start":{"line":22,"column":135},"end":{"line":22,"column":136}},"loc":{"start":{"line":22,"column":140},"end":{"line":22,"column":162}},"line":22},"6":{"name":"(anonymous_6)","decl":{"start":{"line":42,"column":2},"end":{"line":42,"column":3}},"loc":{"start":{"line":42,"column":23},"end":{"line":47,"column":3}},"line":42},"7":{"name":"(anonymous_7)","decl":{"start":{"line":49,"column":2},"end":{"line":49,"column":3}},"loc":{"start":{"line":49,"column":18},"end":{"line":64,"column":3}},"line":49},"8":{"name":"(anonymous_8)","decl":{"start":{"line":51,"column":68},"end":{"line":51,"column":69}},"loc":{"start":{"line":51,"column":82},"end":{"line":62,"column":5}},"line":51},"9":{"name":"(anonymous_9)","decl":{"start":{"line":66,"column":2},"end":{"line":66,"column":3}},"loc":{"start":{"line":66,"column":38},"end":{"line":85,"column":3}},"line":66},"10":{"name":"(anonymous_10)","decl":{"start":{"line":87,"column":2},"end":{"line":87,"column":3}},"loc":{"start":{"line":87,"column":31},"end":{"line":95,"column":3}},"line":87},"11":{"name":"(anonymous_11)","decl":{"start":{"line":92,"column":41},"end":{"line":92,"column":42}},"loc":{"start":{"line":92,"column":64},"end":{"line":94,"column":5}},"line":92}},"branchMap":{"0":{"loc":{"start":{"line":18,"column":46},"end":{"line":18,"column":92}},"type":"cond-expr","locations":[{"start":{"line":18,"column":70},"end":{"line":18,"column":73}},{"start":{"line":18,"column":76},"end":{"line":18,"column":92}}],"line":18},"1":{"loc":{"start":{"line":18,"column":46},"end":{"line":18,"column":67}},"type":"binary-expr","locations":[{"start":{"line":18,"column":46},"end":{"line":18,"column":49}},{"start":{"line":18,"column":53},"end":{"line":18,"column":67}}],"line":18},"2":{"loc":{"start":{"line":20,"column":263},"end":{"line":20,"column":329}},"type":"if","locations":[{"start":{"line":20,"column":263},"end":{"line":20,"column":329}},{"start":{"line":20,"column":263},"end":{"line":20,"column":329}}],"line":20},"3":{"loc":{"start":{"line":20,"column":267},"end":{"line":20,"column":302}},"type":"binary-expr","locations":[{"start":{"line":20,"column":267},"end":{"line":20,"column":282}},{"start":{"line":20,"column":286},"end":{"line":20,"column":302}}],"line":20},"4":{"loc":{"start":{"line":20,"column":409},"end":{"line":20,"column":450}},"type":"binary-expr","locations":[{"start":{"line":20,"column":409},"end":{"line":20,"column":442}},{"start":{"line":20,"column":446},"end":{"line":20,"column":450}}],"line":20},"5":{"loc":{"start":{"line":20,"column":462},"end":{"line":20,"column":612}},"type":"if","locations":[{"start":{"line":20,"column":462},"end":{"line":20,"column":612}},{"start":{"line":20,"column":462},"end":{"line":20,"column":612}}],"line":20},"6":{"loc":{"start":{"line":20,"column":466},"end":{"line":20,"column":504}},"type":"binary-expr","locations":[{"start":{"line":20,"column":466},"end":{"line":20,"column":473}},{"start":{"line":20,"column":477},"end":{"line":20,"column":504}}],"line":20},"7":{"loc":{"start":{"line":20,"column":521},"end":{"line":20,"column":579}},"type":"cond-expr","locations":[{"start":{"line":20,"column":540},"end":{"line":20,"column":570}},{"start":{"line":20,"column":573},"end":{"line":20,"column":579}}],"line":20},"8":{"loc":{"start":{"line":20,"column":613},"end":{"line":20,"column":709}},"type":"if","locations":[{"start":{"line":20,"column":613},"end":{"line":20,"column":709}},{"start":{"line":20,"column":613},"end":{"line":20,"column":709}}],"line":20},"9":{"loc":{"start":{"line":58,"column":8},"end":{"line":60,"column":9}},"type":"if","locations":[{"start":{"line":58,"column":8},"end":{"line":60,"column":9}},{"start":{"line":58,"column":8},"end":{"line":60,"column":9}}],"line":58},"10":{"loc":{"start":{"line":76,"column":6},"end":{"line":83,"column":7}},"type":"if","locations":[{"start":{"line":76,"column":6},"end":{"line":83,"column":7}},{"start":{"line":76,"column":6},"end":{"line":83,"column":7}}],"line":76},"11":{"loc":{"start":{"line":91,"column":4},"end":{"line":91,"column":58}},"type":"if","locations":[{"start":{"line":91,"column":4},"end":{"line":91,"column":58}},{"start":{"line":91,"column":4},"end":{"line":91,"column":58}}],"line":91},"12":{"loc":{"start":{"line":91,"column":8},"end":{"line":91,"column":49}},"type":"binary-expr","locations":[{"start":{"line":91,"column":8},"end":{"line":91,"column":23}},{"start":{"line":91,"column":27},"end":{"line":91,"column":49}}],"line":91}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":2,"7":1,"8":1,"9":4,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":0,"18":0,"19":1,"20":1,"21":1,"22":1,"23":1,"24":22,"25":11,"26":1,"27":1,"28":111,"29":5,"30":5,"31":55,"32":55,"33":55,"34":0,"35":0,"36":5,"37":2,"38":2,"39":2,"40":1,"41":1,"42":1,"43":1,"44":1,"45":1,"46":1,"47":1,"48":0,"49":2,"50":2,"51":0,"52":2,"53":2,"54":1},"f":{"0":2,"1":1,"2":4,"3":1,"4":22,"5":11,"6":111,"7":5,"8":55,"9":2,"10":2,"11":2},"b":{"0":[2,0],"1":[2,2],"2":[1,0],"3":[1,0],"4":[1,0],"5":[0,1],"6":[1,1],"7":[0,0],"8":[1,0],"9":[0,0],"10":[1,0],"11":[0,2],"12":[2,2]},"inputSourceMap":{"version":3,"sources":["emailTemplates.js"],"names":["supportedTemplates","constants","EMAIL_TEMPLATES_NAMES","filter","p","includes","map","replace","schema","type","items","properties","template","enum","body","default","required","EmailTemplateHandler","DefaultHandler","constructor","options","id","getType","emailTemplates","Promise","all","EMAIL_TEMPLATES_TYPES","name","client","get","push","err","statusCode","updateOrCreate","emailTemplate","params","updated","update","didUpdate","created","create","didCreate","processChanges","assets","length"],"mappings":"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","sourceRoot":"/home/circleci/repo/src/tools/auth0/handlers/","sourcesContent":["import DefaultHandler, { order } from './default';\nimport constants from '../../constants';\n\nexport const supportedTemplates = constants.EMAIL_TEMPLATES_NAMES\n  .filter((p) => p.includes('.json'))\n  .map((p) => p.replace('.json', ''));\n\nexport const schema = {\n  type: 'array',\n  items: {\n    type: 'object',\n    properties: {\n      template: { type: 'string', enum: supportedTemplates },\n      body: { type: 'string', default: '' }\n    },\n    required: [ 'template' ]\n  }\n};\n\nexport default class EmailTemplateHandler extends DefaultHandler {\n  constructor(options) {\n    super({\n      ...options,\n      type: 'emailTemplates',\n      id: 'template'\n    });\n  }\n\n  async getType() {\n    const emailTemplates = [];\n\n    await Promise.all(constants.EMAIL_TEMPLATES_TYPES.map(async (name) => {\n      try {\n        const template = await this.client.emailTemplates.get({ name });\n        emailTemplates.push(template);\n      } catch (err) {\n      // Ignore if not found, else throw error\n        if (err.statusCode !== 404) {\n          throw err;\n        }\n      }\n    }));\n\n    return emailTemplates;\n  }\n\n  async updateOrCreate(emailTemplate) {\n    try {\n      const params = { name: emailTemplate[this.id] };\n      const updated = await this.client.emailTemplates.update(params, emailTemplate);\n      delete updated.body;\n      this.didUpdate(updated);\n      this.updated += 1;\n    } catch (err) {\n      if (err.statusCode === 404) {\n        // Create if it does not exist\n        const created = await this.client.emailTemplates.create(emailTemplate);\n        delete created.body;\n        this.didCreate(created);\n        this.created += 1;\n      } else {\n        throw err;\n      }\n    }\n  }\n\n  // Run after email provider changes\n  @order('60')\n  async processChanges(assets) {\n    const { emailTemplates } = assets;\n\n    // Do nothing if not set\n    if (!emailTemplates || !emailTemplates.length) return;\n\n    await Promise.all(emailTemplates.map(async (emailTemplate) => {\n      await this.updateOrCreate(emailTemplate);\n    }));\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"b512ff2850a8f62a521c5285b61d1a1da4ed1af2","contentHash":"0bc338d0fb68e18b15fc51da01b80a5802d4f41d2e7d4b0a03a409a43c5e10c5"},"/home/circleci/repo/src/tools/auth0/handlers/clientGrants.js":{"path":"/home/circleci/repo/src/tools/auth0/handlers/clientGrants.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":45}},"2":{"start":{"line":10,"column":15},"end":{"line":10,"column":35}},"3":{"start":{"line":12,"column":16},"end":{"line":12,"column":48}},"4":{"start":{"line":14,"column":13},"end":{"line":14,"column":35}},"5":{"start":{"line":16,"column":39},"end":{"line":16,"column":93}},"6":{"start":{"line":18,"column":99},"end":{"line":18,"column":101}},"7":{"start":{"line":18,"column":103},"end":{"line":18,"column":184}},"8":{"start":{"line":18,"column":152},"end":{"line":18,"column":180}},"9":{"start":{"line":18,"column":185},"end":{"line":18,"column":221}},"10":{"start":{"line":18,"column":222},"end":{"line":18,"column":262}},"11":{"start":{"line":18,"column":263},"end":{"line":18,"column":329}},"12":{"start":{"line":18,"column":306},"end":{"line":18,"column":327}},"13":{"start":{"line":18,"column":330},"end":{"line":18,"column":461}},"14":{"start":{"line":18,"column":402},"end":{"line":18,"column":451}},"15":{"start":{"line":18,"column":462},"end":{"line":18,"column":612}},"16":{"start":{"line":18,"column":508},"end":{"line":18,"column":580}},"17":{"start":{"line":18,"column":581},"end":{"line":18,"column":610}},"18":{"start":{"line":18,"column":613},"end":{"line":18,"column":709}},"19":{"start":{"line":18,"column":648},"end":{"line":18,"column":694}},"20":{"start":{"line":18,"column":695},"end":{"line":18,"column":707}},"21":{"start":{"line":18,"column":710},"end":{"line":18,"column":722}},"22":{"start":{"line":20,"column":15},"end":{"line":41,"column":1}},"23":{"start":{"line":42,"column":21},"end":{"line":120,"column":170}},"24":{"start":{"line":44,"column":4},"end":{"line":49,"column":7}},"25":{"start":{"line":53,"column":4},"end":{"line":57,"column":7}},"26":{"start":{"line":61,"column":4},"end":{"line":63,"column":5}},"27":{"start":{"line":62,"column":6},"end":{"line":62,"column":27}},"28":{"start":{"line":65,"column":4},"end":{"line":68,"column":7}},"29":{"start":{"line":69,"column":26},"end":{"line":69,"column":56}},"30":{"start":{"line":70,"column":4},"end":{"line":70,"column":85}},"31":{"start":{"line":70,"column":50},"end":{"line":70,"column":83}},"32":{"start":{"line":71,"column":4},"end":{"line":71,"column":25}},"33":{"start":{"line":77,"column":8},"end":{"line":77,"column":14}},"34":{"start":{"line":78,"column":4},"end":{"line":78,"column":30}},"35":{"start":{"line":78,"column":23},"end":{"line":78,"column":30}},"36":{"start":{"line":79,"column":20},"end":{"line":82,"column":6}},"37":{"start":{"line":83,"column":35},"end":{"line":83,"column":81}},"38":{"start":{"line":84,"column":28},"end":{"line":84,"column":96}},"39":{"start":{"line":85,"column":22},"end":{"line":91,"column":6}},"40":{"start":{"line":86,"column":20},"end":{"line":87,"column":7}},"41":{"start":{"line":88,"column":20},"end":{"line":88,"column":65}},"42":{"start":{"line":88,"column":38},"end":{"line":88,"column":64}},"43":{"start":{"line":89,"column":6},"end":{"line":89,"column":51}},"44":{"start":{"line":89,"column":17},"end":{"line":89,"column":51}},"45":{"start":{"line":90,"column":6},"end":{"line":90,"column":19}},"46":{"start":{"line":92,"column":26},"end":{"line":92,"column":56}},"47":{"start":{"line":98,"column":8},"end":{"line":100,"column":6}},"48":{"start":{"line":102,"column":25},"end":{"line":108,"column":5}},"49":{"start":{"line":103,"column":6},"end":{"line":105,"column":7}},"50":{"start":{"line":104,"column":8},"end":{"line":104,"column":146}},"51":{"start":{"line":104,"column":35},"end":{"line":104,"column":144}},"52":{"start":{"line":107,"column":6},"end":{"line":107,"column":67}},"53":{"start":{"line":107,"column":33},"end":{"line":107,"column":65}},"54":{"start":{"line":110,"column":20},"end":{"line":115,"column":5}},"55":{"start":{"line":116,"column":4},"end":{"line":117,"column":7}},"56":{"start":{"line":121,"column":0},"end":{"line":121,"column":32}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":16,"column":9},"end":{"line":16,"column":31}},"loc":{"start":{"line":16,"column":37},"end":{"line":16,"column":95}},"line":16},"1":{"name":"_applyDecoratedDescriptor","decl":{"start":{"line":18,"column":9},"end":{"line":18,"column":34}},"loc":{"start":{"line":18,"column":86},"end":{"line":18,"column":724}},"line":18},"2":{"name":"(anonymous_2)","decl":{"start":{"line":18,"column":135},"end":{"line":18,"column":136}},"loc":{"start":{"line":18,"column":150},"end":{"line":18,"column":182}},"line":18},"3":{"name":"(anonymous_3)","decl":{"start":{"line":18,"column":373},"end":{"line":18,"column":374}},"loc":{"start":{"line":18,"column":400},"end":{"line":18,"column":453}},"line":18},"4":{"name":"(anonymous_4)","decl":{"start":{"line":43,"column":2},"end":{"line":43,"column":3}},"loc":{"start":{"line":43,"column":22},"end":{"line":50,"column":3}},"line":43},"5":{"name":"(anonymous_5)","decl":{"start":{"line":52,"column":2},"end":{"line":52,"column":3}},"loc":{"start":{"line":52,"column":18},"end":{"line":58,"column":3}},"line":52},"6":{"name":"(anonymous_6)","decl":{"start":{"line":60,"column":2},"end":{"line":60,"column":3}},"loc":{"start":{"line":60,"column":18},"end":{"line":72,"column":3}},"line":60},"7":{"name":"(anonymous_7)","decl":{"start":{"line":70,"column":41},"end":{"line":70,"column":42}},"loc":{"start":{"line":70,"column":50},"end":{"line":70,"column":83}},"line":70},"8":{"name":"(anonymous_8)","decl":{"start":{"line":74,"column":2},"end":{"line":74,"column":3}},"loc":{"start":{"line":74,"column":31},"end":{"line":118,"column":3}},"line":74},"9":{"name":"(anonymous_9)","decl":{"start":{"line":85,"column":46},"end":{"line":85,"column":47}},"loc":{"start":{"line":85,"column":61},"end":{"line":91,"column":5}},"line":85},"10":{"name":"(anonymous_10)","decl":{"start":{"line":88,"column":33},"end":{"line":88,"column":34}},"loc":{"start":{"line":88,"column":38},"end":{"line":88,"column":64}},"line":88},"11":{"name":"(anonymous_11)","decl":{"start":{"line":102,"column":25},"end":{"line":102,"column":26}},"loc":{"start":{"line":102,"column":33},"end":{"line":108,"column":5}},"line":102},"12":{"name":"(anonymous_12)","decl":{"start":{"line":104,"column":27},"end":{"line":104,"column":28}},"loc":{"start":{"line":104,"column":35},"end":{"line":104,"column":144}},"line":104},"13":{"name":"(anonymous_13)","decl":{"start":{"line":107,"column":25},"end":{"line":107,"column":26}},"loc":{"start":{"line":107,"column":33},"end":{"line":107,"column":65}},"line":107}},"branchMap":{"0":{"loc":{"start":{"line":16,"column":46},"end":{"line":16,"column":92}},"type":"cond-expr","locations":[{"start":{"line":16,"column":70},"end":{"line":16,"column":73}},{"start":{"line":16,"column":76},"end":{"line":16,"column":92}}],"line":16},"1":{"loc":{"start":{"line":16,"column":46},"end":{"line":16,"column":67}},"type":"binary-expr","locations":[{"start":{"line":16,"column":46},"end":{"line":16,"column":49}},{"start":{"line":16,"column":53},"end":{"line":16,"column":67}}],"line":16},"2":{"loc":{"start":{"line":18,"column":263},"end":{"line":18,"column":329}},"type":"if","locations":[{"start":{"line":18,"column":263},"end":{"line":18,"column":329}},{"start":{"line":18,"column":263},"end":{"line":18,"column":329}}],"line":18},"3":{"loc":{"start":{"line":18,"column":267},"end":{"line":18,"column":302}},"type":"binary-expr","locations":[{"start":{"line":18,"column":267},"end":{"line":18,"column":282}},{"start":{"line":18,"column":286},"end":{"line":18,"column":302}}],"line":18},"4":{"loc":{"start":{"line":18,"column":409},"end":{"line":18,"column":450}},"type":"binary-expr","locations":[{"start":{"line":18,"column":409},"end":{"line":18,"column":442}},{"start":{"line":18,"column":446},"end":{"line":18,"column":450}}],"line":18},"5":{"loc":{"start":{"line":18,"column":462},"end":{"line":18,"column":612}},"type":"if","locations":[{"start":{"line":18,"column":462},"end":{"line":18,"column":612}},{"start":{"line":18,"column":462},"end":{"line":18,"column":612}}],"line":18},"6":{"loc":{"start":{"line":18,"column":466},"end":{"line":18,"column":504}},"type":"binary-expr","locations":[{"start":{"line":18,"column":466},"end":{"line":18,"column":473}},{"start":{"line":18,"column":477},"end":{"line":18,"column":504}}],"line":18},"7":{"loc":{"start":{"line":18,"column":521},"end":{"line":18,"column":579}},"type":"cond-expr","locations":[{"start":{"line":18,"column":540},"end":{"line":18,"column":570}},{"start":{"line":18,"column":573},"end":{"line":18,"column":579}}],"line":18},"8":{"loc":{"start":{"line":18,"column":613},"end":{"line":18,"column":709}},"type":"if","locations":[{"start":{"line":18,"column":613},"end":{"line":18,"column":709}},{"start":{"line":18,"column":613},"end":{"line":18,"column":709}}],"line":18},"9":{"loc":{"start":{"line":61,"column":4},"end":{"line":63,"column":5}},"type":"if","locations":[{"start":{"line":61,"column":4},"end":{"line":63,"column":5}},{"start":{"line":61,"column":4},"end":{"line":63,"column":5}}],"line":61},"10":{"loc":{"start":{"line":78,"column":4},"end":{"line":78,"column":30}},"type":"if","locations":[{"start":{"line":78,"column":4},"end":{"line":78,"column":30}},{"start":{"line":78,"column":4},"end":{"line":78,"column":30}}],"line":78},"11":{"loc":{"start":{"line":83,"column":35},"end":{"line":83,"column":81}},"type":"binary-expr","locations":[{"start":{"line":83,"column":35},"end":{"line":83,"column":49}},{"start":{"line":83,"column":53},"end":{"line":83,"column":75}},{"start":{"line":83,"column":79},"end":{"line":83,"column":81}}],"line":83},"12":{"loc":{"start":{"line":89,"column":6},"end":{"line":89,"column":51}},"type":"if","locations":[{"start":{"line":89,"column":6},"end":{"line":89,"column":51}},{"start":{"line":89,"column":6},"end":{"line":89,"column":51}}],"line":89},"13":{"loc":{"start":{"line":103,"column":6},"end":{"line":105,"column":7}},"type":"if","locations":[{"start":{"line":103,"column":6},"end":{"line":105,"column":7}},{"start":{"line":103,"column":6},"end":{"line":105,"column":7}}],"line":103},"14":{"loc":{"start":{"line":104,"column":35},"end":{"line":104,"column":144}},"type":"binary-expr","locations":[{"start":{"line":104,"column":35},"end":{"line":104,"column":67}},{"start":{"line":104,"column":71},"end":{"line":104,"column":144}}],"line":104}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":4,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":0,"17":0,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1,"24":120,"25":6,"26":14,"27":0,"28":14,"29":14,"30":14,"31":13,"32":14,"33":9,"34":9,"35":0,"36":9,"37":9,"38":9,"39":9,"40":11,"41":11,"42":14,"43":11,"44":7,"45":11,"46":9,"47":9,"48":9,"49":36,"50":8,"51":13,"52":28,"53":8,"54":9,"55":9,"56":1},"f":{"0":1,"1":1,"2":4,"3":1,"4":120,"5":6,"6":14,"7":13,"8":9,"9":11,"10":14,"11":36,"12":13,"13":8},"b":{"0":[1,0],"1":[1,1],"2":[1,0],"3":[1,0],"4":[1,0],"5":[0,1],"6":[1,1],"7":[0,0],"8":[1,0],"9":[0,14],"10":[0,9],"11":[9,2,7],"12":[7,4],"13":[8,28],"14":[13,13]},"inputSourceMap":{"version":3,"sources":["clientGrants.js"],"names":["schema","type","items","properties","client_id","audience","scope","uniqueItems","required","ClientHandler","DefaultHandler","constructor","config","id","identifiers","stripUpdateFields","objString","item","getType","existing","client","clientGrants","getAll","paginate","include_totals","currentClient","filter","grant","processChanges","assets","clients","excludedClientsByNames","exclude","excludedClients","formatted","map","clientGrant","found","find","c","name","del","update","create","conflicts","calcChanges","filterGrants","list","length","includes","changes"],"mappings":"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","sourceRoot":"/home/circleci/repo/src/tools/auth0/handlers/","sourcesContent":["import DefaultHandler, { order } from './default';\nimport { convertClientNamesToIds } from '../../utils';\n\nexport const schema = {\n  type: 'array',\n  items: {\n    type: 'object',\n    properties: {\n      client_id: { type: 'string' },\n      audience: { type: 'string' },\n      scope: {\n        type: 'array',\n        items: { type: 'string' },\n        uniqueItems: true\n      }\n    },\n    required: [ 'client_id', 'scope', 'audience' ]\n  }\n};\n\nexport default class ClientHandler extends DefaultHandler {\n  constructor(config) {\n    super({\n      ...config,\n      type: 'clientGrants',\n      id: 'id',\n      identifiers: [ 'id', [ 'client_id', 'audience' ] ],\n      stripUpdateFields: [ 'audience', 'client_id' ]\n    });\n  }\n\n  objString(item) {\n    return super.objString({ id: item.id, client_id: item.client_id, audience: item.audience });\n  }\n\n  async getType() {\n    if (this.existing) {\n      return this.existing;\n    }\n    this.existing = await this.client.clientGrants.getAll({ paginate: true, include_totals: true });\n\n    // Always filter out the client we are using to access Auth0 Management API\n    // As it could cause problems if the grants are deleted or updated etc\n    const currentClient = this.config('AUTH0_CLIENT_ID');\n\n    this.existing = this.existing.filter((grant) => grant.client_id !== currentClient);\n\n    return this.existing;\n  }\n\n  // Run after clients are updated so we can convert client_id names to id's\n  @order('60')\n  async processChanges(assets) {\n    const { clientGrants } = assets;\n\n    // Do nothing if not set\n    if (!clientGrants) return;\n\n    const clients = await this.client.clients.getAll({ paginate: true, include_totals: true });\n    const excludedClientsByNames = (assets.exclude && assets.exclude.clients) || [];\n    const excludedClients = convertClientNamesToIds(excludedClientsByNames, clients);\n\n    // Convert clients by name to the id\n    const formatted = assets.clientGrants.map((clientGrant) => {\n      const grant = { ...clientGrant };\n      const found = clients.find((c) => c.name === grant.client_id);\n      if (found) grant.client_id = found.client_id;\n      return grant;\n    });\n\n    // Always filter out the client we are using to access Auth0 Management API\n    const currentClient = this.config('AUTH0_CLIENT_ID');\n\n    const {\n      del, update, create, conflicts\n    } = await this.calcChanges({ ...assets, clientGrants: formatted });\n\n    const filterGrants = (list) => {\n      if (excludedClients.length) {\n        return list.filter((item) => item.client_id !== currentClient && ![ ...excludedClientsByNames, ...excludedClients ].includes(item.client_id));\n      }\n\n      return list.filter((item) => item.client_id !== currentClient);\n    };\n\n    const changes = {\n      del: filterGrants(del),\n      update: filterGrants(update),\n      create: filterGrants(create),\n      conflicts: filterGrants(conflicts)\n    };\n\n    await super.processChanges(assets, {\n      ...changes\n    });\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"5245ff0876b15aeaaa1dd1002a0b19f07a2fe73c","contentHash":"e708c442d51933f48201cb7c8624112b916c5f1c1a747d1fd4723b904f6e7ddf"},"/home/circleci/repo/src/tools/auth0/handlers/guardianFactors.js":{"path":"/home/circleci/repo/src/tools/auth0/handlers/guardianFactors.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":27}},"2":{"start":{"line":8,"column":15},"end":{"line":8,"column":35}},"3":{"start":{"line":10,"column":16},"end":{"line":10,"column":48}},"4":{"start":{"line":12,"column":17},"end":{"line":12,"column":43}},"5":{"start":{"line":14,"column":18},"end":{"line":14,"column":52}},"6":{"start":{"line":16,"column":39},"end":{"line":16,"column":93}},"7":{"start":{"line":18,"column":15},"end":{"line":30,"column":1}},"8":{"start":{"line":34,"column":4},"end":{"line":37,"column":7}},"9":{"start":{"line":41,"column":4},"end":{"line":41,"column":44}},"10":{"start":{"line":41,"column":23},"end":{"line":41,"column":44}},"11":{"start":{"line":42,"column":4},"end":{"line":42,"column":60}},"12":{"start":{"line":43,"column":4},"end":{"line":43,"column":25}},"13":{"start":{"line":49,"column":8},"end":{"line":49,"column":14}},"14":{"start":{"line":50,"column":4},"end":{"line":50,"column":60}},"15":{"start":{"line":50,"column":53},"end":{"line":50,"column":60}},"16":{"start":{"line":51,"column":4},"end":{"line":61,"column":8}},"17":{"start":{"line":52,"column":19},"end":{"line":53,"column":7}},"18":{"start":{"line":54,"column":21},"end":{"line":56,"column":7}},"19":{"start":{"line":57,"column":6},"end":{"line":57,"column":23}},"20":{"start":{"line":58,"column":6},"end":{"line":58,"column":60}},"21":{"start":{"line":59,"column":6},"end":{"line":59,"column":29}},"22":{"start":{"line":60,"column":6},"end":{"line":60,"column":24}},"23":{"start":{"line":66,"column":0},"end":{"line":66,"column":41}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":16,"column":9},"end":{"line":16,"column":31}},"loc":{"start":{"line":16,"column":37},"end":{"line":16,"column":95}},"line":16},"1":{"name":"(anonymous_1)","decl":{"start":{"line":33,"column":2},"end":{"line":33,"column":3}},"loc":{"start":{"line":33,"column":23},"end":{"line":38,"column":3}},"line":33},"2":{"name":"(anonymous_2)","decl":{"start":{"line":40,"column":2},"end":{"line":40,"column":3}},"loc":{"start":{"line":40,"column":18},"end":{"line":44,"column":3}},"line":40},"3":{"name":"(anonymous_3)","decl":{"start":{"line":46,"column":2},"end":{"line":46,"column":3}},"loc":{"start":{"line":46,"column":31},"end":{"line":62,"column":3}},"line":46},"4":{"name":"(anonymous_4)","decl":{"start":{"line":51,"column":42},"end":{"line":51,"column":43}},"loc":{"start":{"line":51,"column":58},"end":{"line":61,"column":5}},"line":51}},"branchMap":{"0":{"loc":{"start":{"line":16,"column":46},"end":{"line":16,"column":92}},"type":"cond-expr","locations":[{"start":{"line":16,"column":70},"end":{"line":16,"column":73}},{"start":{"line":16,"column":76},"end":{"line":16,"column":92}}],"line":16},"1":{"loc":{"start":{"line":16,"column":46},"end":{"line":16,"column":67}},"type":"binary-expr","locations":[{"start":{"line":16,"column":46},"end":{"line":16,"column":49}},{"start":{"line":16,"column":53},"end":{"line":16,"column":67}}],"line":16},"2":{"loc":{"start":{"line":41,"column":4},"end":{"line":41,"column":44}},"type":"if","locations":[{"start":{"line":41,"column":4},"end":{"line":41,"column":44}},{"start":{"line":41,"column":4},"end":{"line":41,"column":44}}],"line":41},"3":{"loc":{"start":{"line":50,"column":4},"end":{"line":50,"column":60}},"type":"if","locations":[{"start":{"line":50,"column":4},"end":{"line":50,"column":60}},{"start":{"line":50,"column":4},"end":{"line":50,"column":60}}],"line":50},"4":{"loc":{"start":{"line":50,"column":8},"end":{"line":50,"column":51}},"type":"binary-expr","locations":[{"start":{"line":50,"column":8},"end":{"line":50,"column":24}},{"start":{"line":50,"column":28},"end":{"line":50,"column":51}}],"line":50}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":2,"7":1,"8":112,"9":5,"10":0,"11":5,"12":5,"13":1,"14":1,"15":0,"16":1,"17":1,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1},"f":{"0":2,"1":112,"2":5,"3":1,"4":1},"b":{"0":[2,0],"1":[2,2],"2":[0,5],"3":[0,1],"4":[1,1]},"inputSourceMap":{"version":3,"sources":["guardianFactors.js"],"names":["schema","type","items","properties","name","enum","constants","GUARDIAN_FACTORS","required","GuardianFactorsHandler","DefaultHandler","constructor","options","id","getType","existing","client","guardian","getFactors","processChanges","assets","guardianFactors","length","Promise","all","map","factor","data","params","updateFactor","didUpdate","updated"],"mappings":";;;;;;;AAAA;;;;AACA;;;;;;AAEO,MAAMA,MAAM,WAANA,MAAM,GAAG;AACpBC,EAAAA,IAAI,EAAE,OADc;AAEpBC,EAAAA,KAAK,EAAE;AACLD,IAAAA,IAAI,EAAE,QADD;AAELE,IAAAA,UAAU,EAAE;AACVC,MAAAA,IAAI,EAAE;AAAEH,QAAAA,IAAI,EAAE,QAAR;AAAkBI,QAAAA,IAAI,EAAEC,oBAAUC;AAAlC;AADI,KAFP;AAKLC,IAAAA,QAAQ,EAAE,CAAE,MAAF;AALL;AAFa,CAAf;;AAWQ,MAAMC,sBAAN,SAAqCC,iBAArC,CAAoD;AACjEC,EAAAA,WAAW,CAACC,OAAD,EAAU;AACnB,UAAM,EACJ,GAAGA,OADC;AAEJX,MAAAA,IAAI,EAAE,iBAFF;AAGJY,MAAAA,EAAE,EAAE;AAHA,KAAN;AAKD;;AAEY,QAAPC,OAAO,GAAG;AACd,QAAI,KAAKC,QAAT,EAAmB,OAAO,KAAKA,QAAZ;AACnB,SAAKA,QAAL,GAAgB,MAAM,KAAKC,MAAL,CAAYC,QAAZ,CAAqBC,UAArB,EAAtB;AACA,WAAO,KAAKH,QAAZ;AACD;;AAEmB,QAAdI,cAAc,CAACC,MAAD,EAAS;AAE3B,UAAM;AAAEC,MAAAA;AAAF,QAAsBD,MAA5B;AAGA,QAAI,CAACC,eAAD,IAAoB,CAACA,eAAe,CAACC,MAAzC,EAAiD;AAGjD,UAAMC,OAAO,CAACC,GAAR,CAAYH,eAAe,CAACI,GAAhB,CAAoB,MAAOC,MAAP,IAAkB;AACtD,YAAMC,IAAI,GAAG,EAAE,GAAGD;AAAL,OAAb;AACA,YAAME,MAAM,GAAG;AAAExB,QAAAA,IAAI,EAAEsB,MAAM,CAACtB;AAAf,OAAf;AACA,aAAOuB,IAAI,CAACvB,IAAZ;AACA,YAAM,KAAKY,MAAL,CAAYC,QAAZ,CAAqBY,YAArB,CAAkCD,MAAlC,EAA0CD,IAA1C,CAAN;AACA,WAAKG,SAAL,CAAeF,MAAf;AACA,WAAKG,OAAL,IAAgB,CAAhB;AACD,KAPiB,CAAZ,CAAN;AAQD;;AA/BgE;;kBAA9CtB,sB","sourceRoot":"/home/circleci/repo/src/tools/auth0/handlers/","sourcesContent":["import DefaultHandler from './default';\nimport constants from '../../constants';\n\nexport const schema = {\n  type: 'array',\n  items: {\n    type: 'object',\n    properties: {\n      name: { type: 'string', enum: constants.GUARDIAN_FACTORS }\n    },\n    required: [ 'name' ]\n  }\n};\n\nexport default class GuardianFactorsHandler extends DefaultHandler {\n  constructor(options) {\n    super({\n      ...options,\n      type: 'guardianFactors',\n      id: 'name'\n    });\n  }\n\n  async getType() {\n    if (this.existing) return this.existing;\n    this.existing = await this.client.guardian.getFactors();\n    return this.existing;\n  }\n\n  async processChanges(assets) {\n    // No API to delete or create guardianFactors, we can only update.\n    const { guardianFactors } = assets;\n\n    // Do nothing if not set\n    if (!guardianFactors || !guardianFactors.length) return;\n\n    // Process each factor\n    await Promise.all(guardianFactors.map(async (factor) => {\n      const data = { ...factor };\n      const params = { name: factor.name };\n      delete data.name;\n      await this.client.guardian.updateFactor(params, data);\n      this.didUpdate(params);\n      this.updated += 1;\n    }));\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"ae79ecf1d06f5dc11376b3d480cffd13a795bbbc","contentHash":"a2d3417fe1d9c4cde91906d2e48cedd040dad2626d69ca5b5174b0d922025ed3"},"/home/circleci/repo/src/tools/auth0/handlers/guardianFactorProviders.js":{"path":"/home/circleci/repo/src/tools/auth0/handlers/guardianFactorProviders.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":27}},"2":{"start":{"line":8,"column":15},"end":{"line":8,"column":35}},"3":{"start":{"line":10,"column":16},"end":{"line":10,"column":48}},"4":{"start":{"line":12,"column":17},"end":{"line":12,"column":43}},"5":{"start":{"line":14,"column":18},"end":{"line":14,"column":52}},"6":{"start":{"line":16,"column":39},"end":{"line":16,"column":93}},"7":{"start":{"line":18,"column":17},"end":{"line":26,"column":6}},"8":{"start":{"line":19,"column":2},"end":{"line":24,"column":5}},"9":{"start":{"line":20,"column":4},"end":{"line":23,"column":7}},"10":{"start":{"line":25,"column":2},"end":{"line":25,"column":15}},"11":{"start":{"line":27,"column":15},"end":{"line":43,"column":1}},"12":{"start":{"line":38,"column":32},"end":{"line":38,"column":42}},"13":{"start":{"line":47,"column":4},"end":{"line":50,"column":7}},"14":{"start":{"line":54,"column":4},"end":{"line":54,"column":44}},"15":{"start":{"line":54,"column":23},"end":{"line":54,"column":44}},"16":{"start":{"line":55,"column":17},"end":{"line":60,"column":7}},"17":{"start":{"line":56,"column":23},"end":{"line":56,"column":70}},"18":{"start":{"line":57,"column":6},"end":{"line":59,"column":8}},"19":{"start":{"line":61,"column":4},"end":{"line":61,"column":55}},"20":{"start":{"line":61,"column":28},"end":{"line":61,"column":53}},"21":{"start":{"line":67,"column":8},"end":{"line":67,"column":14}},"22":{"start":{"line":68,"column":4},"end":{"line":68,"column":76}},"23":{"start":{"line":68,"column":69},"end":{"line":68,"column":76}},"24":{"start":{"line":69,"column":4},"end":{"line":81,"column":8}},"25":{"start":{"line":70,"column":19},"end":{"line":71,"column":7}},"26":{"start":{"line":72,"column":21},"end":{"line":75,"column":7}},"27":{"start":{"line":76,"column":6},"end":{"line":76,"column":23}},"28":{"start":{"line":77,"column":6},"end":{"line":77,"column":27}},"29":{"start":{"line":78,"column":6},"end":{"line":78,"column":68}},"30":{"start":{"line":79,"column":6},"end":{"line":79,"column":29}},"31":{"start":{"line":80,"column":6},"end":{"line":80,"column":24}},"32":{"start":{"line":86,"column":0},"end":{"line":86,"column":49}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":16,"column":9},"end":{"line":16,"column":31}},"loc":{"start":{"line":16,"column":37},"end":{"line":16,"column":95}},"line":16},"1":{"name":"(anonymous_1)","decl":{"start":{"line":18,"column":86},"end":{"line":18,"column":87}},"loc":{"start":{"line":18,"column":116},"end":{"line":26,"column":1}},"line":18},"2":{"name":"(anonymous_2)","decl":{"start":{"line":19,"column":20},"end":{"line":19,"column":21}},"loc":{"start":{"line":19,"column":25},"end":{"line":24,"column":3}},"line":19},"3":{"name":"(anonymous_3)","decl":{"start":{"line":38,"column":27},"end":{"line":38,"column":28}},"loc":{"start":{"line":38,"column":32},"end":{"line":38,"column":42}},"line":38},"4":{"name":"(anonymous_4)","decl":{"start":{"line":46,"column":2},"end":{"line":46,"column":3}},"loc":{"start":{"line":46,"column":23},"end":{"line":51,"column":3}},"line":46},"5":{"name":"(anonymous_5)","decl":{"start":{"line":53,"column":2},"end":{"line":53,"column":3}},"loc":{"start":{"line":53,"column":18},"end":{"line":62,"column":3}},"line":53},"6":{"name":"(anonymous_6)","decl":{"start":{"line":55,"column":48},"end":{"line":55,"column":49}},"loc":{"start":{"line":55,"column":59},"end":{"line":60,"column":5}},"line":55},"7":{"name":"(anonymous_7)","decl":{"start":{"line":61,"column":23},"end":{"line":61,"column":24}},"loc":{"start":{"line":61,"column":28},"end":{"line":61,"column":53}},"line":61},"8":{"name":"(anonymous_8)","decl":{"start":{"line":64,"column":2},"end":{"line":64,"column":3}},"loc":{"start":{"line":64,"column":31},"end":{"line":82,"column":3}},"line":64},"9":{"name":"(anonymous_9)","decl":{"start":{"line":69,"column":50},"end":{"line":69,"column":51}},"loc":{"start":{"line":69,"column":74},"end":{"line":81,"column":5}},"line":69}},"branchMap":{"0":{"loc":{"start":{"line":16,"column":46},"end":{"line":16,"column":92}},"type":"cond-expr","locations":[{"start":{"line":16,"column":70},"end":{"line":16,"column":73}},{"start":{"line":16,"column":76},"end":{"line":16,"column":92}}],"line":16},"1":{"loc":{"start":{"line":16,"column":46},"end":{"line":16,"column":67}},"type":"binary-expr","locations":[{"start":{"line":16,"column":46},"end":{"line":16,"column":49}},{"start":{"line":16,"column":53},"end":{"line":16,"column":67}}],"line":16},"2":{"loc":{"start":{"line":54,"column":4},"end":{"line":54,"column":44}},"type":"if","locations":[{"start":{"line":54,"column":4},"end":{"line":54,"column":44}},{"start":{"line":54,"column":4},"end":{"line":54,"column":44}}],"line":54},"3":{"loc":{"start":{"line":68,"column":4},"end":{"line":68,"column":76}},"type":"if","locations":[{"start":{"line":68,"column":4},"end":{"line":68,"column":76}},{"start":{"line":68,"column":4},"end":{"line":68,"column":76}}],"line":68},"4":{"loc":{"start":{"line":68,"column":8},"end":{"line":68,"column":67}},"type":"binary-expr","locations":[{"start":{"line":68,"column":8},"end":{"line":68,"column":32}},{"start":{"line":68,"column":36},"end":{"line":68,"column":67}}],"line":68}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":2,"7":1,"8":2,"9":2,"10":2,"11":1,"12":2,"13":112,"14":5,"15":0,"16":5,"17":10,"18":10,"19":5,"20":10,"21":1,"22":1,"23":0,"24":1,"25":1,"26":1,"27":1,"28":1,"29":1,"30":1,"31":1,"32":1},"f":{"0":2,"1":2,"2":2,"3":2,"4":112,"5":5,"6":10,"7":10,"8":1,"9":1},"b":{"0":[2,0],"1":[2,2],"2":[0,5],"3":[0,1],"4":[1,1]},"inputSourceMap":{"version":3,"sources":["guardianFactorProviders.js"],"names":["mappings","Object","entries","constants","GUARDIAN_FACTOR_PROVIDERS","reduce","accum","name","providers","forEach","p","push","provider","schema","type","items","properties","enum","GUARDIAN_FACTORS","map","required","GuardianFactorProvidersHandler","DefaultHandler","constructor","options","id","getType","existing","data","Promise","all","m","client","guardian","getFactorProvider","filter","d","keys","length","processChanges","assets","guardianFactorProviders","factorProvider","params","updateFactorProvider","didUpdate","updated"],"mappings":";;;;;;;AAAA;;;;AACA;;;;;;AAEA,MAAMA,QAAQ,GAAGC,MAAM,CAACC,OAAP,CAAeC,oBAAUC,yBAAzB,EAAoDC,MAApD,CAA2D,CAACC,KAAD,EAAQ,CAAEC,IAAF,EAAQC,SAAR,CAAR,KAAgC;AAC1GA,EAAAA,SAAS,CAACC,OAAV,CAAmBC,CAAD,IAAO;AACvBJ,IAAAA,KAAK,CAACK,IAAN,CAAW;AAAEJ,MAAAA,IAAF;AAAQK,MAAAA,QAAQ,EAAEF;AAAlB,KAAX;AACD,GAFD;AAGA,SAAOJ,KAAP;AACD,CALgB,EAKd,EALc,CAAjB;AAOO,MAAMO,MAAM,WAANA,MAAM,GAAG;AACpBC,EAAAA,IAAI,EAAE,OADc;AAEpBC,EAAAA,KAAK,EAAE;AACLD,IAAAA,IAAI,EAAE,QADD;AAELE,IAAAA,UAAU,EAAE;AACVT,MAAAA,IAAI,EAAE;AAAEO,QAAAA,IAAI,EAAE,QAAR;AAAkBG,QAAAA,IAAI,EAAEd,oBAAUe;AAAlC,OADI;AAEVN,MAAAA,QAAQ,EAAE;AAAEE,QAAAA,IAAI,EAAE,QAAR;AAAkBG,QAAAA,IAAI,EAAEjB,QAAQ,CAACmB,GAAT,CAAcT,CAAD,IAAOA,CAAC,CAACE,QAAtB;AAAxB;AAFA,KAFP;AAMLQ,IAAAA,QAAQ,EAAE,CAAE,MAAF,EAAU,UAAV;AANL;AAFa,CAAf;;AAYQ,MAAMC,8BAAN,SAA6CC,iBAA7C,CAA4D;AACzEC,EAAAA,WAAW,CAACC,OAAD,EAAU;AACnB,UAAM,EACJ,GAAGA,OADC;AAEJV,MAAAA,IAAI,EAAE,yBAFF;AAGJW,MAAAA,EAAE,EAAE;AAHA,KAAN;AAKD;;AAEY,QAAPC,OAAO,GAAG;AACd,QAAI,KAAKC,QAAT,EAAmB,OAAO,KAAKA,QAAZ;AAEnB,UAAMC,IAAI,GAAG,MAAMC,OAAO,CAACC,GAAR,CAAY9B,QAAQ,CAACmB,GAAT,CAAa,MAAOY,CAAP,IAAa;AACvD,YAAMnB,QAAQ,GAAG,MAAM,KAAKoB,MAAL,CAAYC,QAAZ,CAAqBC,iBAArB,CAAuCH,CAAvC,CAAvB;AACA,aAAO,EAAE,GAAGA,CAAL;AAAQ,WAAGnB;AAAX,OAAP;AACD,KAH8B,CAAZ,CAAnB;AAMA,WAAOgB,IAAI,CAACO,MAAL,CAAaC,CAAD,IAAOnC,MAAM,CAACoC,IAAP,CAAYD,CAAZ,EAAeE,MAAf,GAAwB,CAA3C,CAAP;AACD;;AAEmB,QAAdC,cAAc,CAACC,MAAD,EAAS;AAE3B,UAAM;AAAEC,MAAAA;AAAF,QAA8BD,MAApC;AAGA,QAAI,CAACC,uBAAD,IAA4B,CAACA,uBAAuB,CAACH,MAAzD,EAAiE;AAGjE,UAAMT,OAAO,CAACC,GAAR,CAAYW,uBAAuB,CAACtB,GAAxB,CAA4B,MAAOuB,cAAP,IAA0B;AACtE,YAAMd,IAAI,GAAG,EAAE,GAAGc;AAAL,OAAb;AACA,YAAMC,MAAM,GAAG;AAAEpC,QAAAA,IAAI,EAAEmC,cAAc,CAACnC,IAAvB;AAA6BK,QAAAA,QAAQ,EAAE8B,cAAc,CAAC9B;AAAtD,OAAf;AACA,aAAOgB,IAAI,CAACrB,IAAZ;AACA,aAAOqB,IAAI,CAAChB,QAAZ;AACA,YAAM,KAAKoB,MAAL,CAAYC,QAAZ,CAAqBW,oBAArB,CAA0CD,MAA1C,EAAkDf,IAAlD,CAAN;AACA,WAAKiB,SAAL,CAAeF,MAAf;AACA,WAAKG,OAAL,IAAgB,CAAhB;AACD,KARiB,CAAZ,CAAN;AASD;;AAtCwE;;kBAAtDzB,8B","sourceRoot":"/home/circleci/repo/src/tools/auth0/handlers/","sourcesContent":["import DefaultHandler from './default';\nimport constants from '../../constants';\n\nconst mappings = Object.entries(constants.GUARDIAN_FACTOR_PROVIDERS).reduce((accum, [ name, providers ]) => {\n  providers.forEach((p) => {\n    accum.push({ name, provider: p });\n  });\n  return accum;\n}, []);\n\nexport const schema = {\n  type: 'array',\n  items: {\n    type: 'object',\n    properties: {\n      name: { type: 'string', enum: constants.GUARDIAN_FACTORS },\n      provider: { type: 'string', enum: mappings.map((p) => p.provider) }\n    },\n    required: [ 'name', 'provider' ]\n  }\n};\n\nexport default class GuardianFactorProvidersHandler extends DefaultHandler {\n  constructor(options) {\n    super({\n      ...options,\n      type: 'guardianFactorProviders',\n      id: 'name'\n    });\n  }\n\n  async getType() {\n    if (this.existing) return this.existing;\n\n    const data = await Promise.all(mappings.map(async (m) => {\n      const provider = await this.client.guardian.getFactorProvider(m);\n      return { ...m, ...provider };\n    }));\n\n    // Filter out empty, should have more then 2 keys (name, provider)\n    return data.filter((d) => Object.keys(d).length > 2);\n  }\n\n  async processChanges(assets) {\n    // No API to delete or create guardianFactorProviders, we can only update.\n    const { guardianFactorProviders } = assets;\n\n    // Do nothing if not set\n    if (!guardianFactorProviders || !guardianFactorProviders.length) return;\n\n    // Process each factor\n    await Promise.all(guardianFactorProviders.map(async (factorProvider) => {\n      const data = { ...factorProvider };\n      const params = { name: factorProvider.name, provider: factorProvider.provider };\n      delete data.name;\n      delete data.provider;\n      await this.client.guardian.updateFactorProvider(params, data);\n      this.didUpdate(params);\n      this.updated += 1;\n    }));\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"8f8c8b2d6ad4779bbc9088e615ea75c433ee71ac","contentHash":"d0d1cbbe09a909d8d78c10dad2391425c8dd27eb62cac4a6cc9c3213312b183d"},"/home/circleci/repo/src/tools/auth0/handlers/guardianFactorTemplates.js":{"path":"/home/circleci/repo/src/tools/auth0/handlers/guardianFactorTemplates.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":27}},"2":{"start":{"line":8,"column":15},"end":{"line":8,"column":35}},"3":{"start":{"line":10,"column":16},"end":{"line":10,"column":48}},"4":{"start":{"line":12,"column":17},"end":{"line":12,"column":43}},"5":{"start":{"line":14,"column":18},"end":{"line":14,"column":52}},"6":{"start":{"line":16,"column":39},"end":{"line":16,"column":93}},"7":{"start":{"line":18,"column":15},"end":{"line":30,"column":1}},"8":{"start":{"line":34,"column":4},"end":{"line":37,"column":7}},"9":{"start":{"line":41,"column":4},"end":{"line":41,"column":44}},"10":{"start":{"line":41,"column":23},"end":{"line":41,"column":44}},"11":{"start":{"line":42,"column":17},"end":{"line":50,"column":7}},"12":{"start":{"line":43,"column":24},"end":{"line":45,"column":8}},"13":{"start":{"line":46,"column":6},"end":{"line":49,"column":8}},"14":{"start":{"line":51,"column":4},"end":{"line":51,"column":55}},"15":{"start":{"line":51,"column":28},"end":{"line":51,"column":53}},"16":{"start":{"line":57,"column":8},"end":{"line":57,"column":14}},"17":{"start":{"line":58,"column":4},"end":{"line":58,"column":76}},"18":{"start":{"line":58,"column":69},"end":{"line":58,"column":76}},"19":{"start":{"line":59,"column":4},"end":{"line":69,"column":8}},"20":{"start":{"line":60,"column":19},"end":{"line":61,"column":7}},"21":{"start":{"line":62,"column":21},"end":{"line":64,"column":7}},"22":{"start":{"line":65,"column":6},"end":{"line":65,"column":23}},"23":{"start":{"line":66,"column":6},"end":{"line":66,"column":69}},"24":{"start":{"line":67,"column":6},"end":{"line":67,"column":29}},"25":{"start":{"line":68,"column":6},"end":{"line":68,"column":24}},"26":{"start":{"line":74,"column":0},"end":{"line":74,"column":49}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":16,"column":9},"end":{"line":16,"column":31}},"loc":{"start":{"line":16,"column":37},"end":{"line":16,"column":95}},"line":16},"1":{"name":"(anonymous_1)","decl":{"start":{"line":33,"column":2},"end":{"line":33,"column":3}},"loc":{"start":{"line":33,"column":23},"end":{"line":38,"column":3}},"line":33},"2":{"name":"(anonymous_2)","decl":{"start":{"line":40,"column":2},"end":{"line":40,"column":3}},"loc":{"start":{"line":40,"column":18},"end":{"line":52,"column":3}},"line":40},"3":{"name":"(anonymous_3)","decl":{"start":{"line":42,"column":85},"end":{"line":42,"column":86}},"loc":{"start":{"line":42,"column":99},"end":{"line":50,"column":5}},"line":42},"4":{"name":"(anonymous_4)","decl":{"start":{"line":51,"column":23},"end":{"line":51,"column":24}},"loc":{"start":{"line":51,"column":28},"end":{"line":51,"column":53}},"line":51},"5":{"name":"(anonymous_5)","decl":{"start":{"line":54,"column":2},"end":{"line":54,"column":3}},"loc":{"start":{"line":54,"column":31},"end":{"line":70,"column":3}},"line":54},"6":{"name":"(anonymous_6)","decl":{"start":{"line":59,"column":50},"end":{"line":59,"column":51}},"loc":{"start":{"line":59,"column":74},"end":{"line":69,"column":5}},"line":59}},"branchMap":{"0":{"loc":{"start":{"line":16,"column":46},"end":{"line":16,"column":92}},"type":"cond-expr","locations":[{"start":{"line":16,"column":70},"end":{"line":16,"column":73}},{"start":{"line":16,"column":76},"end":{"line":16,"column":92}}],"line":16},"1":{"loc":{"start":{"line":16,"column":46},"end":{"line":16,"column":67}},"type":"binary-expr","locations":[{"start":{"line":16,"column":46},"end":{"line":16,"column":49}},{"start":{"line":16,"column":53},"end":{"line":16,"column":67}}],"line":16},"2":{"loc":{"start":{"line":41,"column":4},"end":{"line":41,"column":44}},"type":"if","locations":[{"start":{"line":41,"column":4},"end":{"line":41,"column":44}},{"start":{"line":41,"column":4},"end":{"line":41,"column":44}}],"line":41},"3":{"loc":{"start":{"line":58,"column":4},"end":{"line":58,"column":76}},"type":"if","locations":[{"start":{"line":58,"column":4},"end":{"line":58,"column":76}},{"start":{"line":58,"column":4},"end":{"line":58,"column":76}}],"line":58},"4":{"loc":{"start":{"line":58,"column":8},"end":{"line":58,"column":67}},"type":"binary-expr","locations":[{"start":{"line":58,"column":8},"end":{"line":58,"column":32}},{"start":{"line":58,"column":36},"end":{"line":58,"column":67}}],"line":58}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":2,"7":1,"8":112,"9":5,"10":0,"11":5,"12":5,"13":5,"14":5,"15":5,"16":1,"17":1,"18":0,"19":1,"20":1,"21":1,"22":1,"23":1,"24":1,"25":1,"26":1},"f":{"0":2,"1":112,"2":5,"3":5,"4":5,"5":1,"6":1},"b":{"0":[2,0],"1":[2,2],"2":[0,5],"3":[0,1],"4":[1,1]},"inputSourceMap":{"version":3,"sources":["guardianFactorTemplates.js"],"names":["schema","type","items","properties","name","enum","constants","GUARDIAN_FACTOR_TEMPLATES","required","GuardianFactorTemplatesHandler","DefaultHandler","constructor","options","id","getType","existing","data","Promise","all","map","templates","client","guardian","getFactorTemplates","filter","d","Object","keys","length","processChanges","assets","guardianFactorTemplates","fatorTemplates","params","updateFactorTemplates","didUpdate","updated"],"mappings":";;;;;;;AAAA;;;;AACA;;;;;;AAEO,MAAMA,MAAM,WAANA,MAAM,GAAG;AACpBC,EAAAA,IAAI,EAAE,OADc;AAEpBC,EAAAA,KAAK,EAAE;AACLD,IAAAA,IAAI,EAAE,QADD;AAELE,IAAAA,UAAU,EAAE;AACVC,MAAAA,IAAI,EAAE;AAAEH,QAAAA,IAAI,EAAE,QAAR;AAAkBI,QAAAA,IAAI,EAAEC,oBAAUC;AAAlC;AADI,KAFP;AAKLC,IAAAA,QAAQ,EAAE,CAAE,MAAF;AALL;AAFa,CAAf;;AAWQ,MAAMC,8BAAN,SAA6CC,iBAA7C,CAA4D;AACzEC,EAAAA,WAAW,CAACC,OAAD,EAAU;AACnB,UAAM,EACJ,GAAGA,OADC;AAEJX,MAAAA,IAAI,EAAE,yBAFF;AAGJY,MAAAA,EAAE,EAAE;AAHA,KAAN;AAKD;;AAEY,QAAPC,OAAO,GAAG;AACd,QAAI,KAAKC,QAAT,EAAmB,OAAO,KAAKA,QAAZ;AAEnB,UAAMC,IAAI,GAAG,MAAMC,OAAO,CAACC,GAAR,CAAYZ,oBAAUC,yBAAV,CAAoCY,GAApC,CAAwC,MAAOf,IAAP,IAAgB;AACrF,YAAMgB,SAAS,GAAG,MAAM,KAAKC,MAAL,CAAYC,QAAZ,CAAqBC,kBAArB,CAAwC;AAAEnB,QAAAA;AAAF,OAAxC,CAAxB;AACA,aAAO;AAAEA,QAAAA,IAAF;AAAQ,WAAGgB;AAAX,OAAP;AACD,KAH8B,CAAZ,CAAnB;AAMA,WAAOJ,IAAI,CAACQ,MAAL,CAAaC,CAAD,IAAOC,MAAM,CAACC,IAAP,CAAYF,CAAZ,EAAeG,MAAf,GAAwB,CAA3C,CAAP;AACD;;AAEmB,QAAdC,cAAc,CAACC,MAAD,EAAS;AAE3B,UAAM;AAAEC,MAAAA;AAAF,QAA8BD,MAApC;AAGA,QAAI,CAACC,uBAAD,IAA4B,CAACA,uBAAuB,CAACH,MAAzD,EAAiE;AAGjE,UAAMX,OAAO,CAACC,GAAR,CAAYa,uBAAuB,CAACZ,GAAxB,CAA4B,MAAOa,cAAP,IAA0B;AACtE,YAAMhB,IAAI,GAAG,EAAE,GAAGgB;AAAL,OAAb;AACA,YAAMC,MAAM,GAAG;AAAE7B,QAAAA,IAAI,EAAE4B,cAAc,CAAC5B;AAAvB,OAAf;AACA,aAAOY,IAAI,CAACZ,IAAZ;AACA,YAAM,KAAKiB,MAAL,CAAYC,QAAZ,CAAqBY,qBAArB,CAA2CD,MAA3C,EAAmDjB,IAAnD,CAAN;AACA,WAAKmB,SAAL,CAAeF,MAAf;AACA,WAAKG,OAAL,IAAgB,CAAhB;AACD,KAPiB,CAAZ,CAAN;AAQD;;AArCwE;;kBAAtD3B,8B","sourceRoot":"/home/circleci/repo/src/tools/auth0/handlers/","sourcesContent":["import DefaultHandler from './default';\nimport constants from '../../constants';\n\nexport const schema = {\n  type: 'array',\n  items: {\n    type: 'object',\n    properties: {\n      name: { type: 'string', enum: constants.GUARDIAN_FACTOR_TEMPLATES }\n    },\n    required: [ 'name' ]\n  }\n};\n\nexport default class GuardianFactorTemplatesHandler extends DefaultHandler {\n  constructor(options) {\n    super({\n      ...options,\n      type: 'guardianFactorTemplates',\n      id: 'name'\n    });\n  }\n\n  async getType() {\n    if (this.existing) return this.existing;\n\n    const data = await Promise.all(constants.GUARDIAN_FACTOR_TEMPLATES.map(async (name) => {\n      const templates = await this.client.guardian.getFactorTemplates({ name });\n      return { name, ...templates };\n    }));\n\n    // Filter out empty, should have more then 1 keys (name)\n    return data.filter((d) => Object.keys(d).length > 1);\n  }\n\n  async processChanges(assets) {\n    // No API to delete or create guardianFactorTemplates, we can only update.\n    const { guardianFactorTemplates } = assets;\n\n    // Do nothing if not set\n    if (!guardianFactorTemplates || !guardianFactorTemplates.length) return;\n\n    // Process each factor templates\n    await Promise.all(guardianFactorTemplates.map(async (fatorTemplates) => {\n      const data = { ...fatorTemplates };\n      const params = { name: fatorTemplates.name };\n      delete data.name;\n      await this.client.guardian.updateFactorTemplates(params, data);\n      this.didUpdate(params);\n      this.updated += 1;\n    }));\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"a103b0d798e1aa336083b147762f17bed0e392ec","contentHash":"5a79ad6aa22240f47f2f497b53ea231957f0407c8d56b8da8b20c9381ef980a8"},"/home/circleci/repo/src/tools/auth0/handlers/guardianPolicies.js":{"path":"/home/circleci/repo/src/tools/auth0/handlers/guardianPolicies.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":27}},"2":{"start":{"line":8,"column":15},"end":{"line":8,"column":35}},"3":{"start":{"line":10,"column":16},"end":{"line":10,"column":48}},"4":{"start":{"line":12,"column":17},"end":{"line":12,"column":43}},"5":{"start":{"line":14,"column":18},"end":{"line":14,"column":52}},"6":{"start":{"line":16,"column":39},"end":{"line":16,"column":93}},"7":{"start":{"line":18,"column":15},"end":{"line":30,"column":1}},"8":{"start":{"line":34,"column":4},"end":{"line":36,"column":7}},"9":{"start":{"line":40,"column":4},"end":{"line":42,"column":5}},"10":{"start":{"line":41,"column":6},"end":{"line":41,"column":16}},"11":{"start":{"line":44,"column":4},"end":{"line":44,"column":44}},"12":{"start":{"line":44,"column":23},"end":{"line":44,"column":44}},"13":{"start":{"line":45,"column":21},"end":{"line":45,"column":61}},"14":{"start":{"line":46,"column":4},"end":{"line":48,"column":6}},"15":{"start":{"line":49,"column":4},"end":{"line":49,"column":25}},"16":{"start":{"line":55,"column":8},"end":{"line":55,"column":14}},"17":{"start":{"line":56,"column":4},"end":{"line":56,"column":64}},"18":{"start":{"line":56,"column":57},"end":{"line":56,"column":64}},"19":{"start":{"line":57,"column":19},"end":{"line":57,"column":21}},"20":{"start":{"line":58,"column":17},"end":{"line":58,"column":42}},"21":{"start":{"line":59,"column":4},"end":{"line":59,"column":60}},"22":{"start":{"line":60,"column":4},"end":{"line":60,"column":22}},"23":{"start":{"line":61,"column":4},"end":{"line":61,"column":37}},"24":{"start":{"line":66,"column":0},"end":{"line":66,"column":42}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":16,"column":9},"end":{"line":16,"column":31}},"loc":{"start":{"line":16,"column":37},"end":{"line":16,"column":95}},"line":16},"1":{"name":"(anonymous_1)","decl":{"start":{"line":33,"column":2},"end":{"line":33,"column":3}},"loc":{"start":{"line":33,"column":23},"end":{"line":37,"column":3}},"line":33},"2":{"name":"(anonymous_2)","decl":{"start":{"line":39,"column":2},"end":{"line":39,"column":3}},"loc":{"start":{"line":39,"column":18},"end":{"line":50,"column":3}},"line":39},"3":{"name":"(anonymous_3)","decl":{"start":{"line":52,"column":2},"end":{"line":52,"column":3}},"loc":{"start":{"line":52,"column":31},"end":{"line":62,"column":3}},"line":52}},"branchMap":{"0":{"loc":{"start":{"line":16,"column":46},"end":{"line":16,"column":92}},"type":"cond-expr","locations":[{"start":{"line":16,"column":70},"end":{"line":16,"column":73}},{"start":{"line":16,"column":76},"end":{"line":16,"column":92}}],"line":16},"1":{"loc":{"start":{"line":16,"column":46},"end":{"line":16,"column":67}},"type":"binary-expr","locations":[{"start":{"line":16,"column":46},"end":{"line":16,"column":49}},{"start":{"line":16,"column":53},"end":{"line":16,"column":67}}],"line":16},"2":{"loc":{"start":{"line":40,"column":4},"end":{"line":42,"column":5}},"type":"if","locations":[{"start":{"line":40,"column":4},"end":{"line":42,"column":5}},{"start":{"line":40,"column":4},"end":{"line":42,"column":5}}],"line":40},"3":{"loc":{"start":{"line":40,"column":8},"end":{"line":40,"column":87}},"type":"binary-expr","locations":[{"start":{"line":40,"column":8},"end":{"line":40,"column":29}},{"start":{"line":40,"column":33},"end":{"line":40,"column":87}}],"line":40},"4":{"loc":{"start":{"line":44,"column":4},"end":{"line":44,"column":44}},"type":"if","locations":[{"start":{"line":44,"column":4},"end":{"line":44,"column":44}},{"start":{"line":44,"column":4},"end":{"line":44,"column":44}}],"line":44},"5":{"loc":{"start":{"line":56,"column":4},"end":{"line":56,"column":64}},"type":"if","locations":[{"start":{"line":56,"column":4},"end":{"line":56,"column":64}},{"start":{"line":56,"column":4},"end":{"line":56,"column":64}}],"line":56},"6":{"loc":{"start":{"line":56,"column":8},"end":{"line":56,"column":55}},"type":"binary-expr","locations":[{"start":{"line":56,"column":8},"end":{"line":56,"column":25}},{"start":{"line":56,"column":29},"end":{"line":56,"column":55}}],"line":56}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":2,"7":1,"8":112,"9":6,"10":1,"11":5,"12":0,"13":5,"14":5,"15":5,"16":2,"17":2,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1,"24":1},"f":{"0":2,"1":112,"2":6,"3":2},"b":{"0":[2,0],"1":[2,2],"2":[1,5],"3":[6,6],"4":[0,5],"5":[1,1],"6":[2,2]},"inputSourceMap":{"version":3,"sources":["guardianPolicies.js"],"names":["schema","type","properties","policies","items","enum","constants","GUARDIAN_POLICIES","additionalProperties","GuardianPoliciesHandler","DefaultHandler","constructor","options","getType","client","guardian","getPolicies","existing","processChanges","assets","guardianPolicies","params","data","updatePolicies","updated","didUpdate"],"mappings":";;;;;;;AAAA;;;;AACA;;;;;;AAEO,MAAMA,MAAM,WAANA,MAAM,GAAG;AACpBC,EAAAA,IAAI,EAAE,QADc;AAEpBC,EAAAA,UAAU,EAAE;AACVC,IAAAA,QAAQ,EAAE;AACRF,MAAAA,IAAI,EAAE,OADE;AAERG,MAAAA,KAAK,EAAE;AACLH,QAAAA,IAAI,EAAE,QADD;AAELI,QAAAA,IAAI,EAAEC,oBAAUC;AAFX;AAFC;AADA,GAFQ;AAWpBC,EAAAA,oBAAoB,EAAE;AAXF,CAAf;;AAcQ,MAAMC,uBAAN,SAAsCC,iBAAtC,CAAqD;AAClEC,EAAAA,WAAW,CAACC,OAAD,EAAU;AACnB,UAAM,EACJ,GAAGA,OADC;AAEJX,MAAAA,IAAI,EAAE;AAFF,KAAN;AAID;;AAEY,QAAPY,OAAO,GAAG;AAEd,QAAI,CAAC,KAAKC,MAAL,CAAYC,QAAb,IAAyB,OAAO,KAAKD,MAAL,CAAYC,QAAZ,CAAqBC,WAA5B,KAA4C,UAAzE,EAAqF;AACnF,aAAO,EAAP;AACD;;AAED,QAAI,KAAKC,QAAT,EAAmB,OAAO,KAAKA,QAAZ;AACnB,UAAMd,QAAQ,GAAG,MAAM,KAAKW,MAAL,CAAYC,QAAZ,CAAqBC,WAArB,EAAvB;AACA,SAAKC,QAAL,GAAgB;AAAEd,MAAAA;AAAF,KAAhB;AACA,WAAO,KAAKc,QAAZ;AACD;;AAEmB,QAAdC,cAAc,CAACC,MAAD,EAAS;AAE3B,UAAM;AAAEC,MAAAA;AAAF,QAAuBD,MAA7B;AAGA,QAAI,CAACC,gBAAD,IAAqB,CAACA,gBAAgB,CAACjB,QAA3C,EAAqD;AAErD,UAAMkB,MAAM,GAAG,EAAf;AACA,UAAMC,IAAI,GAAGF,gBAAgB,CAACjB,QAA9B;AACA,UAAM,KAAKW,MAAL,CAAYC,QAAZ,CAAqBQ,cAArB,CAAoCF,MAApC,EAA4CC,IAA5C,CAAN;AACA,SAAKE,OAAL,IAAgB,CAAhB;AACA,SAAKC,SAAL,CAAeL,gBAAf;AACD;;AAhCiE;;kBAA/CX,uB","sourceRoot":"/home/circleci/repo/src/tools/auth0/handlers/","sourcesContent":["import DefaultHandler from './default';\nimport constants from '../../constants';\n\nexport const schema = {\n  type: 'object',\n  properties: {\n    policies: {\n      type: 'array',\n      items: {\n        type: 'string',\n        enum: constants.GUARDIAN_POLICIES\n      }\n    }\n  },\n  additionalProperties: false\n};\n\nexport default class GuardianPoliciesHandler extends DefaultHandler {\n  constructor(options) {\n    super({\n      ...options,\n      type: 'guardianPolicies'\n    });\n  }\n\n  async getType() {\n    // in case client version does not support the operation\n    if (!this.client.guardian || typeof this.client.guardian.getPolicies !== 'function') {\n      return {};\n    }\n\n    if (this.existing) return this.existing;\n    const policies = await this.client.guardian.getPolicies();\n    this.existing = { policies };\n    return this.existing;\n  }\n\n  async processChanges(assets) {\n    // No API to delete or create guardianPolicies, we can only update.\n    const { guardianPolicies } = assets;\n\n    // Do nothing if not set\n    if (!guardianPolicies || !guardianPolicies.policies) return;\n\n    const params = {};\n    const data = guardianPolicies.policies;\n    await this.client.guardian.updatePolicies(params, data);\n    this.updated += 1;\n    this.didUpdate(guardianPolicies);\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"8cddf1e4d30dad098a129cdc5af7da82906705e8","contentHash":"49575b01718235ae2a91193c6de9bbd8cf7cb3bf282f9ddbe65d67cc1fa59890"},"/home/circleci/repo/src/tools/auth0/handlers/guardianPhoneFactorSelectedProvider.js":{"path":"/home/circleci/repo/src/tools/auth0/handlers/guardianPhoneFactorSelectedProvider.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":27}},"2":{"start":{"line":8,"column":15},"end":{"line":8,"column":35}},"3":{"start":{"line":10,"column":16},"end":{"line":10,"column":48}},"4":{"start":{"line":12,"column":17},"end":{"line":12,"column":43}},"5":{"start":{"line":14,"column":18},"end":{"line":14,"column":52}},"6":{"start":{"line":16,"column":39},"end":{"line":16,"column":93}},"7":{"start":{"line":18,"column":15},"end":{"line":27,"column":1}},"8":{"start":{"line":29,"column":34},"end":{"line":39,"column":1}},"9":{"start":{"line":30,"column":2},"end":{"line":32,"column":3}},"10":{"start":{"line":31,"column":4},"end":{"line":31,"column":16}},"11":{"start":{"line":34,"column":2},"end":{"line":36,"column":3}},"12":{"start":{"line":35,"column":4},"end":{"line":35,"column":16}},"13":{"start":{"line":38,"column":2},"end":{"line":38,"column":15}},"14":{"start":{"line":43,"column":4},"end":{"line":45,"column":7}},"15":{"start":{"line":49,"column":4},"end":{"line":51,"column":5}},"16":{"start":{"line":50,"column":6},"end":{"line":50,"column":16}},"17":{"start":{"line":53,"column":4},"end":{"line":53,"column":44}},"18":{"start":{"line":53,"column":23},"end":{"line":53,"column":44}},"19":{"start":{"line":55,"column":4},"end":{"line":63,"column":5}},"20":{"start":{"line":56,"column":6},"end":{"line":56,"column":82}},"21":{"start":{"line":58,"column":6},"end":{"line":60,"column":7}},"22":{"start":{"line":59,"column":8},"end":{"line":59,"column":18}},"23":{"start":{"line":62,"column":6},"end":{"line":62,"column":14}},"24":{"start":{"line":65,"column":4},"end":{"line":65,"column":25}},"25":{"start":{"line":71,"column":8},"end":{"line":71,"column":14}},"26":{"start":{"line":72,"column":4},"end":{"line":72,"column":102}},"27":{"start":{"line":72,"column":95},"end":{"line":72,"column":102}},"28":{"start":{"line":73,"column":19},"end":{"line":73,"column":21}},"29":{"start":{"line":74,"column":17},"end":{"line":74,"column":52}},"30":{"start":{"line":75,"column":4},"end":{"line":75,"column":79}},"31":{"start":{"line":76,"column":4},"end":{"line":76,"column":22}},"32":{"start":{"line":77,"column":4},"end":{"line":77,"column":56}},"33":{"start":{"line":82,"column":0},"end":{"line":82,"column":55}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":16,"column":9},"end":{"line":16,"column":31}},"loc":{"start":{"line":16,"column":37},"end":{"line":16,"column":95}},"line":16},"1":{"name":"(anonymous_1)","decl":{"start":{"line":29,"column":34},"end":{"line":29,"column":35}},"loc":{"start":{"line":29,"column":41},"end":{"line":39,"column":1}},"line":29},"2":{"name":"(anonymous_2)","decl":{"start":{"line":42,"column":2},"end":{"line":42,"column":3}},"loc":{"start":{"line":42,"column":23},"end":{"line":46,"column":3}},"line":42},"3":{"name":"(anonymous_3)","decl":{"start":{"line":48,"column":2},"end":{"line":48,"column":3}},"loc":{"start":{"line":48,"column":18},"end":{"line":66,"column":3}},"line":48},"4":{"name":"(anonymous_4)","decl":{"start":{"line":68,"column":2},"end":{"line":68,"column":3}},"loc":{"start":{"line":68,"column":31},"end":{"line":78,"column":3}},"line":68}},"branchMap":{"0":{"loc":{"start":{"line":16,"column":46},"end":{"line":16,"column":92}},"type":"cond-expr","locations":[{"start":{"line":16,"column":70},"end":{"line":16,"column":73}},{"start":{"line":16,"column":76},"end":{"line":16,"column":92}}],"line":16},"1":{"loc":{"start":{"line":16,"column":46},"end":{"line":16,"column":67}},"type":"binary-expr","locations":[{"start":{"line":16,"column":46},"end":{"line":16,"column":49}},{"start":{"line":16,"column":53},"end":{"line":16,"column":67}}],"line":16},"2":{"loc":{"start":{"line":30,"column":2},"end":{"line":32,"column":3}},"type":"if","locations":[{"start":{"line":30,"column":2},"end":{"line":32,"column":3}},{"start":{"line":30,"column":2},"end":{"line":32,"column":3}}],"line":30},"3":{"loc":{"start":{"line":34,"column":2},"end":{"line":36,"column":3}},"type":"if","locations":[{"start":{"line":34,"column":2},"end":{"line":36,"column":3}},{"start":{"line":34,"column":2},"end":{"line":36,"column":3}}],"line":34},"4":{"loc":{"start":{"line":34,"column":6},"end":{"line":34,"column":183}},"type":"binary-expr","locations":[{"start":{"line":34,"column":6},"end":{"line":34,"column":28}},{"start":{"line":34,"column":32},"end":{"line":34,"column":49}},{"start":{"line":34,"column":53},"end":{"line":34,"column":79}},{"start":{"line":34,"column":83},"end":{"line":34,"column":114}},{"start":{"line":34,"column":118},"end":{"line":34,"column":183}}],"line":34},"5":{"loc":{"start":{"line":49,"column":4},"end":{"line":51,"column":5}},"type":"if","locations":[{"start":{"line":49,"column":4},"end":{"line":51,"column":5}},{"start":{"line":49,"column":4},"end":{"line":51,"column":5}}],"line":49},"6":{"loc":{"start":{"line":49,"column":8},"end":{"line":49,"column":106}},"type":"binary-expr","locations":[{"start":{"line":49,"column":8},"end":{"line":49,"column":29}},{"start":{"line":49,"column":33},"end":{"line":49,"column":106}}],"line":49},"7":{"loc":{"start":{"line":53,"column":4},"end":{"line":53,"column":44}},"type":"if","locations":[{"start":{"line":53,"column":4},"end":{"line":53,"column":44}},{"start":{"line":53,"column":4},"end":{"line":53,"column":44}}],"line":53},"8":{"loc":{"start":{"line":58,"column":6},"end":{"line":60,"column":7}},"type":"if","locations":[{"start":{"line":58,"column":6},"end":{"line":60,"column":7}},{"start":{"line":58,"column":6},"end":{"line":60,"column":7}}],"line":58},"9":{"loc":{"start":{"line":72,"column":4},"end":{"line":72,"column":102}},"type":"if","locations":[{"start":{"line":72,"column":4},"end":{"line":72,"column":102}},{"start":{"line":72,"column":4},"end":{"line":72,"column":102}}],"line":72},"10":{"loc":{"start":{"line":72,"column":8},"end":{"line":72,"column":93}},"type":"binary-expr","locations":[{"start":{"line":72,"column":8},"end":{"line":72,"column":44}},{"start":{"line":72,"column":48},"end":{"line":72,"column":93}}],"line":72}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":2,"7":1,"8":1,"9":3,"10":1,"11":2,"12":1,"13":1,"14":115,"15":9,"16":1,"17":8,"18":0,"19":8,"20":8,"21":3,"22":2,"23":1,"24":5,"25":2,"26":2,"27":1,"28":1,"29":1,"30":1,"31":1,"32":1,"33":1},"f":{"0":2,"1":3,"2":115,"3":9,"4":2},"b":{"0":[2,0],"1":[2,2],"2":[1,2],"3":[1,1],"4":[2,1,1,1,1],"5":[1,8],"6":[9,9],"7":[0,8],"8":[2,1],"9":[1,1],"10":[2,2]},"inputSourceMap":{"version":3,"sources":["guardianPhoneFactorSelectedProvider.js"],"names":["schema","type","properties","provider","enum","constants","GUARDIAN_PHONE_PROVIDERS","additionalProperties","isFeatureUnavailableError","err","statusCode","originalError","response","body","errorCode","GuardianPhoneSelectedProviderHandler","DefaultHandler","constructor","options","getType","client","guardian","getPhoneFactorSelectedProvider","existing","e","processChanges","assets","guardianPhoneFactorSelectedProvider","params","data","updatePhoneFactorSelectedProvider","updated","didUpdate"],"mappings":";;;;;;;AAAA;;;;AACA;;;;;;AAEO,MAAMA,MAAM,WAANA,MAAM,GAAG;AACpBC,EAAAA,IAAI,EAAE,QADc;AAEpBC,EAAAA,UAAU,EAAE;AACVC,IAAAA,QAAQ,EAAE;AACRF,MAAAA,IAAI,EAAE,QADE;AAERG,MAAAA,IAAI,EAAEC,oBAAUC;AAFR;AADA,GAFQ;AAQpBC,EAAAA,oBAAoB,EAAE;AARF,CAAf;;AAWP,MAAMC,yBAAyB,GAAIC,GAAD,IAAS;AACzC,MAAIA,GAAG,CAACC,UAAJ,KAAmB,GAAvB,EAA4B;AAE1B,WAAO,IAAP;AACD;;AACD,MAAID,GAAG,CAACC,UAAJ,KAAmB,GAAnB,IACCD,GAAG,CAACE,aADL,IAECF,GAAG,CAACE,aAAJ,CAAkBC,QAFnB,IAGCH,GAAG,CAACE,aAAJ,CAAkBC,QAAlB,CAA2BC,IAH5B,IAICJ,GAAG,CAACE,aAAJ,CAAkBC,QAAlB,CAA2BC,IAA3B,CAAgCC,SAAhC,KAA8C,mBAJnD,EAIwE;AAEtE,WAAO,IAAP;AACD;;AACD,SAAO,KAAP;AACD,CAdD;;AAgBe,MAAMC,oCAAN,SAAmDC,iBAAnD,CAAkE;AAC/EC,EAAAA,WAAW,CAACC,OAAD,EAAU;AACnB,UAAM,EACJ,GAAGA,OADC;AAEJjB,MAAAA,IAAI,EAAE;AAFF,KAAN;AAID;;AAEY,QAAPkB,OAAO,GAAG;AAEd,QAAI,CAAC,KAAKC,MAAL,CAAYC,QAAb,IAAyB,OAAO,KAAKD,MAAL,CAAYC,QAAZ,CAAqBC,8BAA5B,KAA+D,UAA5F,EAAwG;AACtG,aAAO,EAAP;AACD;;AAED,QAAI,KAAKC,QAAT,EAAmB,OAAO,KAAKA,QAAZ;;AAEnB,QAAI;AACF,WAAKA,QAAL,GAAgB,MAAM,KAAKH,MAAL,CAAYC,QAAZ,CAAqBC,8BAArB,EAAtB;AACD,KAFD,CAEE,OAAOE,CAAP,EAAU;AACV,UAAIhB,yBAAyB,CAACgB,CAAD,CAA7B,EAAkC;AAEhC,eAAO,EAAP;AACD;;AACD,YAAMA,CAAN;AACD;;AAED,WAAO,KAAKD,QAAZ;AACD;;AAEmB,QAAdE,cAAc,CAACC,MAAD,EAAS;AAE3B,UAAM;AAAEC,MAAAA;AAAF,QAA0CD,MAAhD;AAGA,QAAI,CAACC,mCAAD,IAAwC,CAACA,mCAAmC,CAACxB,QAAjF,EAA2F;AAE3F,UAAMyB,MAAM,GAAG,EAAf;AACA,UAAMC,IAAI,GAAGF,mCAAb;AACA,UAAM,KAAKP,MAAL,CAAYC,QAAZ,CAAqBS,iCAArB,CAAuDF,MAAvD,EAA+DC,IAA/D,CAAN;AACA,SAAKE,OAAL,IAAgB,CAAhB;AACA,SAAKC,SAAL,CAAeL,mCAAf;AACD;;AAzC8E;;kBAA5DZ,oC","sourceRoot":"/home/circleci/repo/src/tools/auth0/handlers/","sourcesContent":["import DefaultHandler from './default';\nimport constants from '../../constants';\n\nexport const schema = {\n  type: 'object',\n  properties: {\n    provider: {\n      type: 'string',\n      enum: constants.GUARDIAN_PHONE_PROVIDERS\n    }\n  },\n  additionalProperties: false\n};\n\nconst isFeatureUnavailableError = (err) => {\n  if (err.statusCode === 404) {\n    // Older Management API version where the endpoint is not available.\n    return true;\n  }\n  if (err.statusCode === 403\n    && err.originalError\n    && err.originalError.response\n    && err.originalError.response.body\n    && err.originalError.response.body.errorCode === 'hooks_not_allowed') {\n    // Recent Management API version, but with feature explicitly disabled.\n    return true;\n  }\n  return false;\n};\n\nexport default class GuardianPhoneSelectedProviderHandler extends DefaultHandler {\n  constructor(options) {\n    super({\n      ...options,\n      type: 'guardianPhoneFactorSelectedProvider'\n    });\n  }\n\n  async getType() {\n    // in case client version does not support the operation\n    if (!this.client.guardian || typeof this.client.guardian.getPhoneFactorSelectedProvider !== 'function') {\n      return {};\n    }\n\n    if (this.existing) return this.existing;\n\n    try {\n      this.existing = await this.client.guardian.getPhoneFactorSelectedProvider();\n    } catch (e) {\n      if (isFeatureUnavailableError(e)) {\n        // Gracefully skip processing this configuration value.\n        return {};\n      }\n      throw e;\n    }\n\n    return this.existing;\n  }\n\n  async processChanges(assets) {\n    // No API to delete or create guardianPhoneFactorSelectedProvider, we can only update.\n    const { guardianPhoneFactorSelectedProvider } = assets;\n\n    // Do nothing if not set\n    if (!guardianPhoneFactorSelectedProvider || !guardianPhoneFactorSelectedProvider.provider) return;\n\n    const params = {};\n    const data = guardianPhoneFactorSelectedProvider;\n    await this.client.guardian.updatePhoneFactorSelectedProvider(params, data);\n    this.updated += 1;\n    this.didUpdate(guardianPhoneFactorSelectedProvider);\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"5860f2c4896939b3bf31dbe87752270dfdc92dde","contentHash":"cf7855d508eb957e2c4deafe46f9ede3e1a811f5554fa6e66063342ac5f034a8"},"/home/circleci/repo/src/tools/auth0/handlers/guardianPhoneFactorMessageTypes.js":{"path":"/home/circleci/repo/src/tools/auth0/handlers/guardianPhoneFactorMessageTypes.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":27}},"2":{"start":{"line":8,"column":15},"end":{"line":8,"column":35}},"3":{"start":{"line":10,"column":16},"end":{"line":10,"column":48}},"4":{"start":{"line":12,"column":17},"end":{"line":12,"column":43}},"5":{"start":{"line":14,"column":18},"end":{"line":14,"column":52}},"6":{"start":{"line":16,"column":39},"end":{"line":16,"column":93}},"7":{"start":{"line":18,"column":15},"end":{"line":30,"column":1}},"8":{"start":{"line":32,"column":34},"end":{"line":42,"column":1}},"9":{"start":{"line":33,"column":2},"end":{"line":35,"column":3}},"10":{"start":{"line":34,"column":4},"end":{"line":34,"column":16}},"11":{"start":{"line":37,"column":2},"end":{"line":39,"column":3}},"12":{"start":{"line":38,"column":4},"end":{"line":38,"column":16}},"13":{"start":{"line":41,"column":2},"end":{"line":41,"column":15}},"14":{"start":{"line":46,"column":4},"end":{"line":48,"column":7}},"15":{"start":{"line":52,"column":4},"end":{"line":54,"column":5}},"16":{"start":{"line":53,"column":6},"end":{"line":53,"column":16}},"17":{"start":{"line":56,"column":4},"end":{"line":56,"column":44}},"18":{"start":{"line":56,"column":23},"end":{"line":56,"column":44}},"19":{"start":{"line":58,"column":4},"end":{"line":66,"column":5}},"20":{"start":{"line":59,"column":6},"end":{"line":59,"column":78}},"21":{"start":{"line":61,"column":6},"end":{"line":63,"column":7}},"22":{"start":{"line":62,"column":8},"end":{"line":62,"column":18}},"23":{"start":{"line":65,"column":6},"end":{"line":65,"column":14}},"24":{"start":{"line":68,"column":4},"end":{"line":68,"column":25}},"25":{"start":{"line":74,"column":8},"end":{"line":74,"column":14}},"26":{"start":{"line":75,"column":4},"end":{"line":75,"column":99}},"27":{"start":{"line":75,"column":92},"end":{"line":75,"column":99}},"28":{"start":{"line":76,"column":19},"end":{"line":76,"column":21}},"29":{"start":{"line":77,"column":17},"end":{"line":77,"column":48}},"30":{"start":{"line":78,"column":4},"end":{"line":78,"column":75}},"31":{"start":{"line":79,"column":4},"end":{"line":79,"column":22}},"32":{"start":{"line":80,"column":4},"end":{"line":80,"column":52}},"33":{"start":{"line":85,"column":0},"end":{"line":85,"column":51}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":16,"column":9},"end":{"line":16,"column":31}},"loc":{"start":{"line":16,"column":37},"end":{"line":16,"column":95}},"line":16},"1":{"name":"(anonymous_1)","decl":{"start":{"line":32,"column":34},"end":{"line":32,"column":35}},"loc":{"start":{"line":32,"column":41},"end":{"line":42,"column":1}},"line":32},"2":{"name":"(anonymous_2)","decl":{"start":{"line":45,"column":2},"end":{"line":45,"column":3}},"loc":{"start":{"line":45,"column":23},"end":{"line":49,"column":3}},"line":45},"3":{"name":"(anonymous_3)","decl":{"start":{"line":51,"column":2},"end":{"line":51,"column":3}},"loc":{"start":{"line":51,"column":18},"end":{"line":69,"column":3}},"line":51},"4":{"name":"(anonymous_4)","decl":{"start":{"line":71,"column":2},"end":{"line":71,"column":3}},"loc":{"start":{"line":71,"column":31},"end":{"line":81,"column":3}},"line":71}},"branchMap":{"0":{"loc":{"start":{"line":16,"column":46},"end":{"line":16,"column":92}},"type":"cond-expr","locations":[{"start":{"line":16,"column":70},"end":{"line":16,"column":73}},{"start":{"line":16,"column":76},"end":{"line":16,"column":92}}],"line":16},"1":{"loc":{"start":{"line":16,"column":46},"end":{"line":16,"column":67}},"type":"binary-expr","locations":[{"start":{"line":16,"column":46},"end":{"line":16,"column":49}},{"start":{"line":16,"column":53},"end":{"line":16,"column":67}}],"line":16},"2":{"loc":{"start":{"line":33,"column":2},"end":{"line":35,"column":3}},"type":"if","locations":[{"start":{"line":33,"column":2},"end":{"line":35,"column":3}},{"start":{"line":33,"column":2},"end":{"line":35,"column":3}}],"line":33},"3":{"loc":{"start":{"line":37,"column":2},"end":{"line":39,"column":3}},"type":"if","locations":[{"start":{"line":37,"column":2},"end":{"line":39,"column":3}},{"start":{"line":37,"column":2},"end":{"line":39,"column":3}}],"line":37},"4":{"loc":{"start":{"line":37,"column":6},"end":{"line":37,"column":187}},"type":"binary-expr","locations":[{"start":{"line":37,"column":6},"end":{"line":37,"column":28}},{"start":{"line":37,"column":32},"end":{"line":37,"column":49}},{"start":{"line":37,"column":53},"end":{"line":37,"column":79}},{"start":{"line":37,"column":83},"end":{"line":37,"column":114}},{"start":{"line":37,"column":118},"end":{"line":37,"column":187}}],"line":37},"5":{"loc":{"start":{"line":52,"column":4},"end":{"line":54,"column":5}},"type":"if","locations":[{"start":{"line":52,"column":4},"end":{"line":54,"column":5}},{"start":{"line":52,"column":4},"end":{"line":54,"column":5}}],"line":52},"6":{"loc":{"start":{"line":52,"column":8},"end":{"line":52,"column":102}},"type":"binary-expr","locations":[{"start":{"line":52,"column":8},"end":{"line":52,"column":29}},{"start":{"line":52,"column":33},"end":{"line":52,"column":102}}],"line":52},"7":{"loc":{"start":{"line":56,"column":4},"end":{"line":56,"column":44}},"type":"if","locations":[{"start":{"line":56,"column":4},"end":{"line":56,"column":44}},{"start":{"line":56,"column":4},"end":{"line":56,"column":44}}],"line":56},"8":{"loc":{"start":{"line":61,"column":6},"end":{"line":63,"column":7}},"type":"if","locations":[{"start":{"line":61,"column":6},"end":{"line":63,"column":7}},{"start":{"line":61,"column":6},"end":{"line":63,"column":7}}],"line":61},"9":{"loc":{"start":{"line":75,"column":4},"end":{"line":75,"column":99}},"type":"if","locations":[{"start":{"line":75,"column":4},"end":{"line":75,"column":99}},{"start":{"line":75,"column":4},"end":{"line":75,"column":99}}],"line":75},"10":{"loc":{"start":{"line":75,"column":8},"end":{"line":75,"column":90}},"type":"binary-expr","locations":[{"start":{"line":75,"column":8},"end":{"line":75,"column":40}},{"start":{"line":75,"column":44},"end":{"line":75,"column":90}}],"line":75}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":2,"7":1,"8":1,"9":3,"10":1,"11":2,"12":1,"13":1,"14":115,"15":9,"16":1,"17":8,"18":0,"19":8,"20":8,"21":3,"22":2,"23":1,"24":5,"25":2,"26":2,"27":1,"28":1,"29":1,"30":1,"31":1,"32":1,"33":1},"f":{"0":2,"1":3,"2":115,"3":9,"4":2},"b":{"0":[2,0],"1":[2,2],"2":[1,2],"3":[1,1],"4":[2,1,1,1,1],"5":[1,8],"6":[9,9],"7":[0,8],"8":[2,1],"9":[1,1],"10":[2,2]},"inputSourceMap":{"version":3,"sources":["guardianPhoneFactorMessageTypes.js"],"names":["schema","type","properties","message_types","items","enum","constants","GUARDIAN_PHONE_MESSAGE_TYPES","additionalProperties","isFeatureUnavailableError","err","statusCode","originalError","response","body","errorCode","GuardianPhoneMessageTypesHandler","DefaultHandler","constructor","options","getType","client","guardian","getPhoneFactorMessageTypes","existing","e","processChanges","assets","guardianPhoneFactorMessageTypes","params","data","updatePhoneFactorMessageTypes","updated","didUpdate"],"mappings":";;;;;;;AAAA;;;;AACA;;;;;;AAEO,MAAMA,MAAM,WAANA,MAAM,GAAG;AACpBC,EAAAA,IAAI,EAAE,QADc;AAEpBC,EAAAA,UAAU,EAAE;AACVC,IAAAA,aAAa,EAAE;AACbF,MAAAA,IAAI,EAAE,OADO;AAEbG,MAAAA,KAAK,EAAE;AACLH,QAAAA,IAAI,EAAE,QADD;AAELI,QAAAA,IAAI,EAAEC,oBAAUC;AAFX;AAFM;AADL,GAFQ;AAWpBC,EAAAA,oBAAoB,EAAE;AAXF,CAAf;;AAcP,MAAMC,yBAAyB,GAAIC,GAAD,IAAS;AACzC,MAAIA,GAAG,CAACC,UAAJ,KAAmB,GAAvB,EAA4B;AAE1B,WAAO,IAAP;AACD;;AACD,MAAID,GAAG,CAACC,UAAJ,KAAmB,GAAnB,IACCD,GAAG,CAACE,aADL,IAECF,GAAG,CAACE,aAAJ,CAAkBC,QAFnB,IAGCH,GAAG,CAACE,aAAJ,CAAkBC,QAAlB,CAA2BC,IAH5B,IAICJ,GAAG,CAACE,aAAJ,CAAkBC,QAAlB,CAA2BC,IAA3B,CAAgCC,SAAhC,KAA8C,uBAJnD,EAI4E;AAE1E,WAAO,IAAP;AACD;;AACD,SAAO,KAAP;AACD,CAdD;;AAgBe,MAAMC,gCAAN,SAA+CC,iBAA/C,CAA8D;AAC3EC,EAAAA,WAAW,CAACC,OAAD,EAAU;AACnB,UAAM,EACJ,GAAGA,OADC;AAEJlB,MAAAA,IAAI,EAAE;AAFF,KAAN;AAID;;AAEY,QAAPmB,OAAO,GAAG;AAEd,QAAI,CAAC,KAAKC,MAAL,CAAYC,QAAb,IAAyB,OAAO,KAAKD,MAAL,CAAYC,QAAZ,CAAqBC,0BAA5B,KAA2D,UAAxF,EAAoG;AAClG,aAAO,EAAP;AACD;;AAED,QAAI,KAAKC,QAAT,EAAmB,OAAO,KAAKA,QAAZ;;AAEnB,QAAI;AACF,WAAKA,QAAL,GAAgB,MAAM,KAAKH,MAAL,CAAYC,QAAZ,CAAqBC,0BAArB,EAAtB;AACD,KAFD,CAEE,OAAOE,CAAP,EAAU;AACV,UAAIhB,yBAAyB,CAACgB,CAAD,CAA7B,EAAkC;AAEhC,eAAO,EAAP;AACD;;AACD,YAAMA,CAAN;AACD;;AAED,WAAO,KAAKD,QAAZ;AACD;;AAEmB,QAAdE,cAAc,CAACC,MAAD,EAAS;AAE3B,UAAM;AAAEC,MAAAA;AAAF,QAAsCD,MAA5C;AAGA,QAAI,CAACC,+BAAD,IAAoC,CAACA,+BAA+B,CAACzB,aAAzE,EAAwF;AAExF,UAAM0B,MAAM,GAAG,EAAf;AACA,UAAMC,IAAI,GAAGF,+BAAb;AACA,UAAM,KAAKP,MAAL,CAAYC,QAAZ,CAAqBS,6BAArB,CAAmDF,MAAnD,EAA2DC,IAA3D,CAAN;AACA,SAAKE,OAAL,IAAgB,CAAhB;AACA,SAAKC,SAAL,CAAeL,+BAAf;AACD;;AAzC0E;;kBAAxDZ,gC","sourceRoot":"/home/circleci/repo/src/tools/auth0/handlers/","sourcesContent":["import DefaultHandler from './default';\nimport constants from '../../constants';\n\nexport const schema = {\n  type: 'object',\n  properties: {\n    message_types: {\n      type: 'array',\n      items: {\n        type: 'string',\n        enum: constants.GUARDIAN_PHONE_MESSAGE_TYPES\n      }\n    }\n  },\n  additionalProperties: false\n};\n\nconst isFeatureUnavailableError = (err) => {\n  if (err.statusCode === 404) {\n    // Older Management API version where the endpoint is not available.\n    return true;\n  }\n  if (err.statusCode === 403\n    && err.originalError\n    && err.originalError.response\n    && err.originalError.response.body\n    && err.originalError.response.body.errorCode === 'voice_mfa_not_allowed') {\n    // Recent Management API version, but with feature explicitly disabled.\n    return true;\n  }\n  return false;\n};\n\nexport default class GuardianPhoneMessageTypesHandler extends DefaultHandler {\n  constructor(options) {\n    super({\n      ...options,\n      type: 'guardianPhoneFactorMessageTypes'\n    });\n  }\n\n  async getType() {\n    // in case client version does not support the operation\n    if (!this.client.guardian || typeof this.client.guardian.getPhoneFactorMessageTypes !== 'function') {\n      return {};\n    }\n\n    if (this.existing) return this.existing;\n\n    try {\n      this.existing = await this.client.guardian.getPhoneFactorMessageTypes();\n    } catch (e) {\n      if (isFeatureUnavailableError(e)) {\n        // Gracefully skip processing this configuration value.\n        return {};\n      }\n      throw e;\n    }\n\n    return this.existing;\n  }\n\n  async processChanges(assets) {\n    // No API to delete or create guardianPhoneFactorMessageTypes, we can only update.\n    const { guardianPhoneFactorMessageTypes } = assets;\n\n    // Do nothing if not set\n    if (!guardianPhoneFactorMessageTypes || !guardianPhoneFactorMessageTypes.message_types) return;\n\n    const params = {};\n    const data = guardianPhoneFactorMessageTypes;\n    await this.client.guardian.updatePhoneFactorMessageTypes(params, data);\n    this.updated += 1;\n    this.didUpdate(guardianPhoneFactorMessageTypes);\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"438561244ff67314c65c961296573bba1f1ab09a","contentHash":"dc89c6d6ea9971904339b3148430de14f09089e72774f67b947f30af348f1fd0"},"/home/circleci/repo/src/tools/auth0/handlers/roles.js":{"path":"/home/circleci/repo/src/tools/auth0/handlers/roles.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":45}},"2":{"start":{"line":10,"column":15},"end":{"line":10,"column":35}},"3":{"start":{"line":12,"column":16},"end":{"line":12,"column":48}},"4":{"start":{"line":14,"column":13},"end":{"line":14,"column":35}},"5":{"start":{"line":16,"column":14},"end":{"line":16,"column":37}},"6":{"start":{"line":18,"column":15},"end":{"line":18,"column":46}},"7":{"start":{"line":20,"column":39},"end":{"line":20,"column":93}},"8":{"start":{"line":22,"column":99},"end":{"line":22,"column":101}},"9":{"start":{"line":22,"column":103},"end":{"line":22,"column":184}},"10":{"start":{"line":22,"column":152},"end":{"line":22,"column":180}},"11":{"start":{"line":22,"column":185},"end":{"line":22,"column":221}},"12":{"start":{"line":22,"column":222},"end":{"line":22,"column":262}},"13":{"start":{"line":22,"column":263},"end":{"line":22,"column":329}},"14":{"start":{"line":22,"column":306},"end":{"line":22,"column":327}},"15":{"start":{"line":22,"column":330},"end":{"line":22,"column":461}},"16":{"start":{"line":22,"column":402},"end":{"line":22,"column":451}},"17":{"start":{"line":22,"column":462},"end":{"line":22,"column":612}},"18":{"start":{"line":22,"column":508},"end":{"line":22,"column":580}},"19":{"start":{"line":22,"column":581},"end":{"line":22,"column":610}},"20":{"start":{"line":22,"column":613},"end":{"line":22,"column":709}},"21":{"start":{"line":22,"column":648},"end":{"line":22,"column":694}},"22":{"start":{"line":22,"column":695},"end":{"line":22,"column":707}},"23":{"start":{"line":22,"column":710},"end":{"line":22,"column":722}},"24":{"start":{"line":24,"column":15},"end":{"line":55,"column":1}},"25":{"start":{"line":56,"column":19},"end":{"line":231,"column":170}},"26":{"start":{"line":58,"column":4},"end":{"line":62,"column":7}},"27":{"start":{"line":66,"column":17},"end":{"line":67,"column":5}},"28":{"start":{"line":68,"column":4},"end":{"line":68,"column":28}},"29":{"start":{"line":69,"column":20},"end":{"line":69,"column":56}},"30":{"start":{"line":71,"column":4},"end":{"line":77,"column":5}},"31":{"start":{"line":72,"column":6},"end":{"line":76,"column":9}},"32":{"start":{"line":79,"column":4},"end":{"line":79,"column":19}},"33":{"start":{"line":83,"column":4},"end":{"line":91,"column":17}},"34":{"start":{"line":85,"column":25},"end":{"line":90,"column":8}},"35":{"start":{"line":86,"column":8},"end":{"line":86,"column":29}},"36":{"start":{"line":87,"column":8},"end":{"line":87,"column":26}},"37":{"start":{"line":89,"column":8},"end":{"line":89,"column":89}},"38":{"start":{"line":95,"column":4},"end":{"line":97,"column":7}},"39":{"start":{"line":101,"column":4},"end":{"line":114,"column":5}},"40":{"start":{"line":102,"column":6},"end":{"line":110,"column":19}},"41":{"start":{"line":104,"column":27},"end":{"line":109,"column":10}},"42":{"start":{"line":105,"column":10},"end":{"line":105,"column":31}},"43":{"start":{"line":106,"column":10},"end":{"line":106,"column":28}},"44":{"start":{"line":108,"column":10},"end":{"line":108,"column":91}},"45":{"start":{"line":112,"column":6},"end":{"line":113,"column":57}},"46":{"start":{"line":113,"column":24},"end":{"line":113,"column":41}},"47":{"start":{"line":118,"column":25},"end":{"line":118,"column":100}},"48":{"start":{"line":118,"column":63},"end":{"line":118,"column":99}},"49":{"start":{"line":119,"column":19},"end":{"line":121,"column":5}},"50":{"start":{"line":122,"column":27},"end":{"line":122,"column":43}},"51":{"start":{"line":123,"column":4},"end":{"line":123,"column":28}},"52":{"start":{"line":124,"column":4},"end":{"line":124,"column":19}},"53":{"start":{"line":125,"column":4},"end":{"line":125,"column":49}},"54":{"start":{"line":127,"column":4},"end":{"line":131,"column":5}},"55":{"start":{"line":128,"column":6},"end":{"line":130,"column":9}},"56":{"start":{"line":133,"column":4},"end":{"line":137,"column":5}},"57":{"start":{"line":134,"column":6},"end":{"line":136,"column":9}},"58":{"start":{"line":139,"column":4},"end":{"line":139,"column":18}},"59":{"start":{"line":143,"column":4},"end":{"line":151,"column":17}},"60":{"start":{"line":145,"column":25},"end":{"line":150,"column":8}},"61":{"start":{"line":146,"column":8},"end":{"line":146,"column":29}},"62":{"start":{"line":147,"column":8},"end":{"line":147,"column":26}},"63":{"start":{"line":149,"column":8},"end":{"line":149,"column":89}},"64":{"start":{"line":155,"column":4},"end":{"line":157,"column":5}},"65":{"start":{"line":156,"column":6},"end":{"line":156,"column":27}},"66":{"start":{"line":159,"column":4},"end":{"line":161,"column":5}},"67":{"start":{"line":160,"column":6},"end":{"line":160,"column":16}},"68":{"start":{"line":163,"column":4},"end":{"line":191,"column":5}},"69":{"start":{"line":164,"column":20},"end":{"line":167,"column":8}},"70":{"start":{"line":169,"column":6},"end":{"line":181,"column":7}},"71":{"start":{"line":169,"column":23},"end":{"line":169,"column":24}},"72":{"start":{"line":170,"column":28},"end":{"line":174,"column":10}},"73":{"start":{"line":175,"column":30},"end":{"line":179,"column":11}},"74":{"start":{"line":176,"column":10},"end":{"line":176,"column":49}},"75":{"start":{"line":177,"column":10},"end":{"line":177,"column":40}},"76":{"start":{"line":178,"column":10},"end":{"line":178,"column":28}},"77":{"start":{"line":180,"column":8},"end":{"line":180,"column":49}},"78":{"start":{"line":183,"column":6},"end":{"line":183,"column":28}},"79":{"start":{"line":184,"column":6},"end":{"line":184,"column":27}},"80":{"start":{"line":186,"column":6},"end":{"line":188,"column":7}},"81":{"start":{"line":187,"column":8},"end":{"line":187,"column":18}},"82":{"start":{"line":190,"column":6},"end":{"line":190,"column":16}},"83":{"start":{"line":197,"column":8},"end":{"line":197,"column":14}},"84":{"start":{"line":198,"column":4},"end":{"line":198,"column":23}},"85":{"start":{"line":198,"column":16},"end":{"line":198,"column":23}},"86":{"start":{"line":199,"column":21},"end":{"line":199,"column":41}},"87":{"start":{"line":200,"column":20},"end":{"line":200,"column":82}},"88":{"start":{"line":202,"column":4},"end":{"line":202,"column":161}},"89":{"start":{"line":204,"column":22},"end":{"line":210,"column":6}},"90":{"start":{"line":211,"column":4},"end":{"line":228,"column":8}},"91":{"start":{"line":212,"column":6},"end":{"line":227,"column":7}},"92":{"start":{"line":214,"column":10},"end":{"line":214,"column":45}},"93":{"start":{"line":215,"column":10},"end":{"line":215,"column":16}},"94":{"start":{"line":218,"column":10},"end":{"line":218,"column":49}},"95":{"start":{"line":219,"column":10},"end":{"line":219,"column":16}},"96":{"start":{"line":222,"column":10},"end":{"line":222,"column":58}},"97":{"start":{"line":223,"column":10},"end":{"line":223,"column":16}},"98":{"start":{"line":226,"column":10},"end":{"line":226,"column":16}},"99":{"start":{"line":232,"column":0},"end":{"line":232,"column":30}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":20,"column":9},"end":{"line":20,"column":31}},"loc":{"start":{"line":20,"column":37},"end":{"line":20,"column":95}},"line":20},"1":{"name":"_applyDecoratedDescriptor","decl":{"start":{"line":22,"column":9},"end":{"line":22,"column":34}},"loc":{"start":{"line":22,"column":86},"end":{"line":22,"column":724}},"line":22},"2":{"name":"(anonymous_2)","decl":{"start":{"line":22,"column":135},"end":{"line":22,"column":136}},"loc":{"start":{"line":22,"column":150},"end":{"line":22,"column":182}},"line":22},"3":{"name":"(anonymous_3)","decl":{"start":{"line":22,"column":373},"end":{"line":22,"column":374}},"loc":{"start":{"line":22,"column":400},"end":{"line":22,"column":453}},"line":22},"4":{"name":"(anonymous_4)","decl":{"start":{"line":57,"column":2},"end":{"line":57,"column":3}},"loc":{"start":{"line":57,"column":22},"end":{"line":63,"column":3}},"line":57},"5":{"name":"(anonymous_5)","decl":{"start":{"line":65,"column":2},"end":{"line":65,"column":3}},"loc":{"start":{"line":65,"column":25},"end":{"line":80,"column":3}},"line":65},"6":{"name":"(anonymous_6)","decl":{"start":{"line":82,"column":2},"end":{"line":82,"column":3}},"loc":{"start":{"line":82,"column":29},"end":{"line":92,"column":3}},"line":82},"7":{"name":"(anonymous_7)","decl":{"start":{"line":85,"column":17},"end":{"line":85,"column":18}},"loc":{"start":{"line":85,"column":25},"end":{"line":90,"column":8}},"line":85},"8":{"name":"(anonymous_8)","decl":{"start":{"line":85,"column":52},"end":{"line":85,"column":53}},"loc":{"start":{"line":85,"column":60},"end":{"line":88,"column":7}},"line":85},"9":{"name":"(anonymous_9)","decl":{"start":{"line":88,"column":15},"end":{"line":88,"column":16}},"loc":{"start":{"line":88,"column":22},"end":{"line":90,"column":7}},"line":88},"10":{"name":"(anonymous_10)","decl":{"start":{"line":94,"column":2},"end":{"line":94,"column":3}},"loc":{"start":{"line":94,"column":25},"end":{"line":98,"column":3}},"line":94},"11":{"name":"(anonymous_11)","decl":{"start":{"line":100,"column":2},"end":{"line":100,"column":3}},"loc":{"start":{"line":100,"column":26},"end":{"line":115,"column":3}},"line":100},"12":{"name":"(anonymous_12)","decl":{"start":{"line":104,"column":19},"end":{"line":104,"column":20}},"loc":{"start":{"line":104,"column":27},"end":{"line":109,"column":10}},"line":104},"13":{"name":"(anonymous_13)","decl":{"start":{"line":104,"column":54},"end":{"line":104,"column":55}},"loc":{"start":{"line":104,"column":60},"end":{"line":107,"column":9}},"line":104},"14":{"name":"(anonymous_14)","decl":{"start":{"line":107,"column":17},"end":{"line":107,"column":18}},"loc":{"start":{"line":107,"column":24},"end":{"line":109,"column":9}},"line":107},"15":{"name":"(anonymous_15)","decl":{"start":{"line":113,"column":19},"end":{"line":113,"column":20}},"loc":{"start":{"line":113,"column":24},"end":{"line":113,"column":41}},"line":113},"16":{"name":"(anonymous_16)","decl":{"start":{"line":117,"column":2},"end":{"line":117,"column":3}},"loc":{"start":{"line":117,"column":32},"end":{"line":140,"column":3}},"line":117},"17":{"name":"(anonymous_17)","decl":{"start":{"line":118,"column":42},"end":{"line":118,"column":43}},"loc":{"start":{"line":118,"column":63},"end":{"line":118,"column":99}},"line":118},"18":{"name":"(anonymous_18)","decl":{"start":{"line":142,"column":2},"end":{"line":142,"column":3}},"loc":{"start":{"line":142,"column":36},"end":{"line":152,"column":3}},"line":142},"19":{"name":"(anonymous_19)","decl":{"start":{"line":145,"column":17},"end":{"line":145,"column":18}},"loc":{"start":{"line":145,"column":25},"end":{"line":150,"column":8}},"line":145},"20":{"name":"(anonymous_20)","decl":{"start":{"line":145,"column":59},"end":{"line":145,"column":60}},"loc":{"start":{"line":145,"column":67},"end":{"line":148,"column":7}},"line":145},"21":{"name":"(anonymous_21)","decl":{"start":{"line":148,"column":15},"end":{"line":148,"column":16}},"loc":{"start":{"line":148,"column":22},"end":{"line":150,"column":7}},"line":148},"22":{"name":"(anonymous_22)","decl":{"start":{"line":154,"column":2},"end":{"line":154,"column":3}},"loc":{"start":{"line":154,"column":18},"end":{"line":192,"column":3}},"line":154},"23":{"name":"(anonymous_23)","decl":{"start":{"line":175,"column":64},"end":{"line":175,"column":65}},"loc":{"start":{"line":175,"column":84},"end":{"line":179,"column":9}},"line":175},"24":{"name":"(anonymous_24)","decl":{"start":{"line":194,"column":2},"end":{"line":194,"column":3}},"loc":{"start":{"line":194,"column":31},"end":{"line":229,"column":3}},"line":194},"25":{"name":"(anonymous_25)","decl":{"start":{"line":211,"column":36},"end":{"line":211,"column":37}},"loc":{"start":{"line":211,"column":52},"end":{"line":228,"column":5}},"line":211}},"branchMap":{"0":{"loc":{"start":{"line":20,"column":46},"end":{"line":20,"column":92}},"type":"cond-expr","locations":[{"start":{"line":20,"column":70},"end":{"line":20,"column":73}},{"start":{"line":20,"column":76},"end":{"line":20,"column":92}}],"line":20},"1":{"loc":{"start":{"line":20,"column":46},"end":{"line":20,"column":67}},"type":"binary-expr","locations":[{"start":{"line":20,"column":46},"end":{"line":20,"column":49}},{"start":{"line":20,"column":53},"end":{"line":20,"column":67}}],"line":20},"2":{"loc":{"start":{"line":22,"column":263},"end":{"line":22,"column":329}},"type":"if","locations":[{"start":{"line":22,"column":263},"end":{"line":22,"column":329}},{"start":{"line":22,"column":263},"end":{"line":22,"column":329}}],"line":22},"3":{"loc":{"start":{"line":22,"column":267},"end":{"line":22,"column":302}},"type":"binary-expr","locations":[{"start":{"line":22,"column":267},"end":{"line":22,"column":282}},{"start":{"line":22,"column":286},"end":{"line":22,"column":302}}],"line":22},"4":{"loc":{"start":{"line":22,"column":409},"end":{"line":22,"column":450}},"type":"binary-expr","locations":[{"start":{"line":22,"column":409},"end":{"line":22,"column":442}},{"start":{"line":22,"column":446},"end":{"line":22,"column":450}}],"line":22},"5":{"loc":{"start":{"line":22,"column":462},"end":{"line":22,"column":612}},"type":"if","locations":[{"start":{"line":22,"column":462},"end":{"line":22,"column":612}},{"start":{"line":22,"column":462},"end":{"line":22,"column":612}}],"line":22},"6":{"loc":{"start":{"line":22,"column":466},"end":{"line":22,"column":504}},"type":"binary-expr","locations":[{"start":{"line":22,"column":466},"end":{"line":22,"column":473}},{"start":{"line":22,"column":477},"end":{"line":22,"column":504}}],"line":22},"7":{"loc":{"start":{"line":22,"column":521},"end":{"line":22,"column":579}},"type":"cond-expr","locations":[{"start":{"line":22,"column":540},"end":{"line":22,"column":570}},{"start":{"line":22,"column":573},"end":{"line":22,"column":579}}],"line":22},"8":{"loc":{"start":{"line":22,"column":613},"end":{"line":22,"column":709}},"type":"if","locations":[{"start":{"line":22,"column":613},"end":{"line":22,"column":709}},{"start":{"line":22,"column":613},"end":{"line":22,"column":709}}],"line":22},"9":{"loc":{"start":{"line":71,"column":4},"end":{"line":77,"column":5}},"type":"if","locations":[{"start":{"line":71,"column":4},"end":{"line":77,"column":5}},{"start":{"line":71,"column":4},"end":{"line":77,"column":5}}],"line":71},"10":{"loc":{"start":{"line":71,"column":8},"end":{"line":71,"column":78}},"type":"binary-expr","locations":[{"start":{"line":71,"column":8},"end":{"line":71,"column":47}},{"start":{"line":71,"column":51},"end":{"line":71,"column":78}}],"line":71},"11":{"loc":{"start":{"line":84,"column":12},"end":{"line":84,"column":25}},"type":"binary-expr","locations":[{"start":{"line":84,"column":12},"end":{"line":84,"column":19}},{"start":{"line":84,"column":23},"end":{"line":84,"column":25}}],"line":84},"12":{"loc":{"start":{"line":101,"column":4},"end":{"line":114,"column":5}},"type":"if","locations":[{"start":{"line":101,"column":4},"end":{"line":114,"column":5}},{"start":{"line":101,"column":4},"end":{"line":114,"column":5}}],"line":101},"13":{"loc":{"start":{"line":101,"column":8},"end":{"line":101,"column":98}},"type":"binary-expr","locations":[{"start":{"line":101,"column":8},"end":{"line":101,"column":52}},{"start":{"line":101,"column":56},"end":{"line":101,"column":98}}],"line":101},"14":{"loc":{"start":{"line":103,"column":14},"end":{"line":103,"column":24}},"type":"binary-expr","locations":[{"start":{"line":103,"column":14},"end":{"line":103,"column":18}},{"start":{"line":103,"column":22},"end":{"line":103,"column":24}}],"line":103},"15":{"loc":{"start":{"line":127,"column":4},"end":{"line":131,"column":5}},"type":"if","locations":[{"start":{"line":127,"column":4},"end":{"line":131,"column":5}},{"start":{"line":127,"column":4},"end":{"line":131,"column":5}}],"line":127},"16":{"loc":{"start":{"line":127,"column":8},"end":{"line":127,"column":94}},"type":"binary-expr","locations":[{"start":{"line":127,"column":8},"end":{"line":127,"column":55}},{"start":{"line":127,"column":59},"end":{"line":127,"column":94}}],"line":127},"17":{"loc":{"start":{"line":133,"column":4},"end":{"line":137,"column":5}},"type":"if","locations":[{"start":{"line":133,"column":4},"end":{"line":137,"column":5}},{"start":{"line":133,"column":4},"end":{"line":137,"column":5}}],"line":133},"18":{"loc":{"start":{"line":133,"column":8},"end":{"line":133,"column":74}},"type":"binary-expr","locations":[{"start":{"line":133,"column":8},"end":{"line":133,"column":45}},{"start":{"line":133,"column":49},"end":{"line":133,"column":74}}],"line":133},"19":{"loc":{"start":{"line":144,"column":12},"end":{"line":144,"column":25}},"type":"binary-expr","locations":[{"start":{"line":144,"column":12},"end":{"line":144,"column":19}},{"start":{"line":144,"column":23},"end":{"line":144,"column":25}}],"line":144},"20":{"loc":{"start":{"line":155,"column":4},"end":{"line":157,"column":5}},"type":"if","locations":[{"start":{"line":155,"column":4},"end":{"line":157,"column":5}},{"start":{"line":155,"column":4},"end":{"line":157,"column":5}}],"line":155},"21":{"loc":{"start":{"line":159,"column":4},"end":{"line":161,"column":5}},"type":"if","locations":[{"start":{"line":159,"column":4},"end":{"line":161,"column":5}},{"start":{"line":159,"column":4},"end":{"line":161,"column":5}}],"line":159},"22":{"loc":{"start":{"line":159,"column":8},"end":{"line":159,"column":76}},"type":"binary-expr","locations":[{"start":{"line":159,"column":8},"end":{"line":159,"column":26}},{"start":{"line":159,"column":30},"end":{"line":159,"column":76}}],"line":159},"23":{"loc":{"start":{"line":186,"column":6},"end":{"line":188,"column":7}},"type":"if","locations":[{"start":{"line":186,"column":6},"end":{"line":188,"column":7}},{"start":{"line":186,"column":6},"end":{"line":188,"column":7}}],"line":186},"24":{"loc":{"start":{"line":186,"column":10},"end":{"line":186,"column":58}},"type":"binary-expr","locations":[{"start":{"line":186,"column":10},"end":{"line":186,"column":32}},{"start":{"line":186,"column":36},"end":{"line":186,"column":58}}],"line":186},"25":{"loc":{"start":{"line":198,"column":4},"end":{"line":198,"column":23}},"type":"if","locations":[{"start":{"line":198,"column":4},"end":{"line":198,"column":23}},{"start":{"line":198,"column":4},"end":{"line":198,"column":23}}],"line":198},"26":{"loc":{"start":{"line":212,"column":6},"end":{"line":227,"column":7}},"type":"switch","locations":[{"start":{"line":213,"column":8},"end":{"line":215,"column":16}},{"start":{"line":217,"column":8},"end":{"line":219,"column":16}},{"start":{"line":221,"column":8},"end":{"line":223,"column":16}},{"start":{"line":225,"column":8},"end":{"line":226,"column":16}}],"line":212},"27":{"loc":{"start":{"line":213,"column":13},"end":{"line":213,"column":48}},"type":"binary-expr","locations":[{"start":{"line":213,"column":13},"end":{"line":213,"column":23}},{"start":{"line":213,"column":27},"end":{"line":213,"column":48}}],"line":213},"28":{"loc":{"start":{"line":217,"column":13},"end":{"line":217,"column":54}},"type":"binary-expr","locations":[{"start":{"line":217,"column":13},"end":{"line":217,"column":26}},{"start":{"line":217,"column":30},"end":{"line":217,"column":54}}],"line":217},"29":{"loc":{"start":{"line":221,"column":13},"end":{"line":221,"column":54}},"type":"binary-expr","locations":[{"start":{"line":221,"column":13},"end":{"line":221,"column":26}},{"start":{"line":221,"column":30},"end":{"line":221,"column":54}}],"line":221}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":2,"8":1,"9":1,"10":4,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":0,"19":0,"20":1,"21":1,"22":1,"23":1,"24":1,"25":1,"26":117,"27":2,"28":2,"29":2,"30":2,"31":0,"32":2,"33":2,"34":2,"35":2,"36":2,"37":0,"38":1,"39":1,"40":1,"41":1,"42":1,"43":1,"44":0,"45":0,"46":0,"47":1,"48":1,"49":1,"50":1,"51":1,"52":1,"53":1,"54":1,"55":1,"56":1,"57":1,"58":1,"59":1,"60":1,"61":1,"62":1,"63":0,"64":11,"65":0,"66":11,"67":0,"68":11,"69":11,"70":8,"71":8,"72":7,"73":7,"74":155,"75":155,"76":155,"77":7,"78":8,"79":8,"80":3,"81":2,"82":1,"83":3,"84":3,"85":0,"86":3,"87":3,"88":3,"89":3,"90":3,"91":9,"92":1,"93":1,"94":2,"95":2,"96":1,"97":1,"98":5,"99":1},"f":{"0":2,"1":1,"2":4,"3":1,"4":117,"5":2,"6":2,"7":2,"8":2,"9":0,"10":1,"11":1,"12":1,"13":1,"14":0,"15":0,"16":1,"17":1,"18":1,"19":1,"20":1,"21":0,"22":11,"23":155,"24":3,"25":9},"b":{"0":[1,1],"1":[2,2],"2":[1,0],"3":[1,0],"4":[1,0],"5":[0,1],"6":[1,1],"7":[0,0],"8":[1,0],"9":[0,2],"10":[2,1],"11":[2,0],"12":[1,0],"13":[1,1],"14":[1,0],"15":[1,0],"16":[1,1],"17":[1,0],"18":[1,1],"19":[1,0],"20":[0,11],"21":[0,11],"22":[11,11],"23":[2,1],"24":[3,2],"25":[0,3],"26":[1,2,1,5],"27":[9,3],"28":[8,3],"29":[6,3]},"inputSourceMap":{"version":3,"sources":["roles.js"],"names":["schema","type","items","properties","name","id","description","permissions","permission_name","resource_server_identifier","required","RoleHandler","DefaultHandler","constructor","config","identifiers","createRole","data","role","created","client","roles","create","length","createRoles","creates","pool","addEachTask","generator","item","then","didCreate","catch","err","Error","objString","promise","deleteRole","delete","deleteRoles","dels","didDelete","deleted","log","warn","map","i","join","updateRole","existingRole","find","roleDataForUpdate","params","newPermissions","update","updateRoles","updates","didUpdate","updated","getType","existing","getAll","paginate","include_totals","index","strippedPerms","Promise","all","permission","resource_server_name","statusCode","processChanges","assets","changes","debug","del","myChanges","change"],"mappings":"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","sourceRoot":"/home/circleci/repo/src/tools/auth0/handlers/","sourcesContent":["import DefaultHandler, { order } from './default';\nimport { calcChanges } from '../../utils';\nimport log from '../../logger';\n\nexport const schema = {\n  type: 'array',\n  items: {\n    type: 'object',\n    properties: {\n      name: { type: 'string' },\n      id: { type: 'string' },\n      description: { type: 'string' },\n      permissions: {\n        type: 'array',\n        items: {\n          type: 'object',\n          properties: {\n            permission_name: { type: 'string' },\n            resource_server_identifier: { type: 'string' }\n          }\n        }\n      }\n    },\n    required: [ 'name' ]\n  }\n};\n\nexport default class RoleHandler extends DefaultHandler {\n  constructor(config) {\n    super({\n      ...config,\n      type: 'roles',\n      id: 'id',\n      identifiers: [ 'name' ]\n    });\n  }\n\n  async createRole(data) {\n    const role = { ...data };\n    delete role.permissions;\n\n    const created = await this.client.roles.create(role);\n\n    if (typeof data.permissions !== 'undefined' && data.permissions.length > 0) {\n      await this.client.roles.permissions.create({ id: created.id }, { permissions: data.permissions });\n    }\n\n    return created;\n  }\n\n  async createRoles(creates) {\n    await this.client.pool.addEachTask({\n      data: creates || [],\n      generator: (item) => this.createRole(item).then((data) => {\n        this.didCreate(data);\n        this.created += 1;\n      }).catch((err) => {\n        throw new Error(`Problem creating ${this.type} ${this.objString(item)}\\n${err}`);\n      })\n    }).promise();\n  }\n\n  async deleteRole(data) {\n    await this.client.roles.delete({ id: data.id });\n  }\n\n  async deleteRoles(dels) {\n    if (this.config('AUTH0_ALLOW_DELETE') === 'true' || this.config('AUTH0_ALLOW_DELETE') === true) {\n      await this.client.pool.addEachTask({\n        data: dels || [],\n        generator: (item) => this.deleteRole(item).then(() => {\n          this.didDelete(item);\n          this.deleted += 1;\n        }).catch((err) => {\n          throw new Error(`Problem deleting ${this.type} ${this.objString(item)}\\n${err}`);\n        })\n      }).promise();\n    } else {\n      log.warn(`Detected the following roles should be deleted. Doing so may be destructive.\\nYou can enable deletes by setting 'AUTH0_ALLOW_DELETE' to true in the config\n      \\n${dels.map((i) => this.objString(i)).join('\\n')}`);\n    }\n  }\n\n  async updateRole(data, roles) {\n    const existingRole = await roles.find((roleDataForUpdate) => roleDataForUpdate.name === data.name);\n\n    const params = { id: data.id };\n    const newPermissions = data.permissions;\n\n    delete data.permissions;\n    delete data.id;\n\n    await this.client.roles.update(params, data);\n\n    if (typeof existingRole.permissions !== 'undefined' && existingRole.permissions.length > 0) {\n      await this.client.roles.permissions.delete(params, { permissions: existingRole.permissions });\n    }\n\n    if (typeof newPermissions !== 'undefined' && newPermissions.length > 0) {\n      await this.client.roles.permissions.create(params, { permissions: newPermissions });\n    }\n\n    return params;\n  }\n\n  async updateRoles(updates, roles) {\n    await this.client.pool.addEachTask({\n      data: updates || [],\n      generator: (item) => this.updateRole(item, roles).then((data) => {\n        this.didUpdate(data);\n        this.updated += 1;\n      }).catch((err) => {\n        throw new Error(`Problem updating ${this.type} ${this.objString(item)}\\n${err}`);\n      })\n    }).promise();\n  }\n\n  async getType() {\n    if (this.existing) {\n      return this.existing;\n    }\n\n    // in case client version does not support roles\n    if (!this.client.roles || typeof this.client.roles.getAll !== 'function') {\n      return [];\n    }\n\n    try {\n      const roles = await this.client.roles.getAll({ paginate: true, include_totals: true });\n      for (let index = 0; index < roles.length; index++) {\n        const permissions = await this.client.roles.permissions.getAll({ paginate: true, include_totals: true, id: roles[index].id });\n        const strippedPerms = await Promise.all(permissions.map(async (permission) => {\n          delete permission.resource_server_name;\n          delete permission.description;\n          return permission;\n        }));\n        roles[index].permissions = strippedPerms;\n      }\n      this.existing = roles;\n      return this.existing;\n    } catch (err) {\n      if (err.statusCode === 404 || err.statusCode === 501) {\n        return [];\n      }\n      throw err;\n    }\n  }\n\n  @order('60')\n  async processChanges(assets) {\n    const { roles } = assets;\n    // Do nothing if not set\n    if (!roles) return;\n    // Gets roles from destination tenant\n    const existing = await this.getType();\n    const changes = calcChanges(this, roles, existing, [ 'id', 'name' ]);\n    log.debug(`Start processChanges for roles [delete:${changes.del.length}] [update:${changes.update.length}], [create:${changes.create.length}]`);\n    const myChanges = [ { del: changes.del }, { create: changes.create }, { update: changes.update } ];\n    await Promise.all(myChanges.map(async (change) => {\n      switch (true) {\n        case change.del && change.del.length > 0:\n          await this.deleteRoles(change.del);\n          break;\n        case change.create && change.create.length > 0:\n          await this.createRoles(changes.create);\n          break;\n        case change.update && change.update.length > 0:\n          await this.updateRoles(change.update, existing);\n          break;\n        default:\n          break;\n      }\n    }));\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"f06e4d9b1b86bac920b8a8f4a2ab7f72483a5f12","contentHash":"109f270ac9cdee97a55fd739332acb1067e0d782ea19cf42728c35875f17efaf"},"/home/circleci/repo/src/tools/auth0/handlers/branding.js":{"path":"/home/circleci/repo/src/tools/auth0/handlers/branding.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":27}},"2":{"start":{"line":8,"column":15},"end":{"line":8,"column":35}},"3":{"start":{"line":10,"column":16},"end":{"line":10,"column":48}},"4":{"start":{"line":12,"column":39},"end":{"line":12,"column":93}},"5":{"start":{"line":14,"column":15},"end":{"line":16,"column":1}},"6":{"start":{"line":20,"column":4},"end":{"line":22,"column":7}},"7":{"start":{"line":26,"column":4},"end":{"line":28,"column":5}},"8":{"start":{"line":27,"column":6},"end":{"line":27,"column":16}},"9":{"start":{"line":30,"column":4},"end":{"line":36,"column":5}},"10":{"start":{"line":31,"column":6},"end":{"line":31,"column":54}},"11":{"start":{"line":33,"column":6},"end":{"line":33,"column":44}},"12":{"start":{"line":33,"column":34},"end":{"line":33,"column":44}},"13":{"start":{"line":34,"column":6},"end":{"line":34,"column":44}},"14":{"start":{"line":34,"column":34},"end":{"line":34,"column":44}},"15":{"start":{"line":35,"column":6},"end":{"line":35,"column":16}},"16":{"start":{"line":42,"column":8},"end":{"line":42,"column":14}},"17":{"start":{"line":43,"column":4},"end":{"line":43,"column":59}},"18":{"start":{"line":43,"column":52},"end":{"line":43,"column":59}},"19":{"start":{"line":44,"column":4},"end":{"line":44,"column":60}},"20":{"start":{"line":45,"column":4},"end":{"line":45,"column":22}},"21":{"start":{"line":46,"column":4},"end":{"line":46,"column":29}},"22":{"start":{"line":51,"column":0},"end":{"line":51,"column":34}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":12,"column":9},"end":{"line":12,"column":31}},"loc":{"start":{"line":12,"column":37},"end":{"line":12,"column":95}},"line":12},"1":{"name":"(anonymous_1)","decl":{"start":{"line":19,"column":2},"end":{"line":19,"column":3}},"loc":{"start":{"line":19,"column":23},"end":{"line":23,"column":3}},"line":19},"2":{"name":"(anonymous_2)","decl":{"start":{"line":25,"column":2},"end":{"line":25,"column":3}},"loc":{"start":{"line":25,"column":18},"end":{"line":37,"column":3}},"line":25},"3":{"name":"(anonymous_3)","decl":{"start":{"line":39,"column":2},"end":{"line":39,"column":3}},"loc":{"start":{"line":39,"column":31},"end":{"line":47,"column":3}},"line":39}},"branchMap":{"0":{"loc":{"start":{"line":12,"column":46},"end":{"line":12,"column":92}},"type":"cond-expr","locations":[{"start":{"line":12,"column":70},"end":{"line":12,"column":73}},{"start":{"line":12,"column":76},"end":{"line":12,"column":92}}],"line":12},"1":{"loc":{"start":{"line":12,"column":46},"end":{"line":12,"column":67}},"type":"binary-expr","locations":[{"start":{"line":12,"column":46},"end":{"line":12,"column":49}},{"start":{"line":12,"column":53},"end":{"line":12,"column":67}}],"line":12},"2":{"loc":{"start":{"line":26,"column":4},"end":{"line":28,"column":5}},"type":"if","locations":[{"start":{"line":26,"column":4},"end":{"line":28,"column":5}},{"start":{"line":26,"column":4},"end":{"line":28,"column":5}}],"line":26},"3":{"loc":{"start":{"line":26,"column":8},"end":{"line":26,"column":87}},"type":"binary-expr","locations":[{"start":{"line":26,"column":8},"end":{"line":26,"column":29}},{"start":{"line":26,"column":33},"end":{"line":26,"column":87}}],"line":26},"4":{"loc":{"start":{"line":33,"column":6},"end":{"line":33,"column":44}},"type":"if","locations":[{"start":{"line":33,"column":6},"end":{"line":33,"column":44}},{"start":{"line":33,"column":6},"end":{"line":33,"column":44}}],"line":33},"5":{"loc":{"start":{"line":34,"column":6},"end":{"line":34,"column":44}},"type":"if","locations":[{"start":{"line":34,"column":6},"end":{"line":34,"column":44}},{"start":{"line":34,"column":6},"end":{"line":34,"column":44}}],"line":34},"6":{"loc":{"start":{"line":43,"column":4},"end":{"line":43,"column":59}},"type":"if","locations":[{"start":{"line":43,"column":4},"end":{"line":43,"column":59}},{"start":{"line":43,"column":4},"end":{"line":43,"column":59}}],"line":43},"7":{"loc":{"start":{"line":43,"column":8},"end":{"line":43,"column":50}},"type":"binary-expr","locations":[{"start":{"line":43,"column":8},"end":{"line":43,"column":17}},{"start":{"line":43,"column":21},"end":{"line":43,"column":50}}],"line":43}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":110,"7":5,"8":4,"9":1,"10":1,"11":0,"12":0,"13":0,"14":0,"15":0,"16":1,"17":1,"18":0,"19":1,"20":1,"21":1,"22":1},"f":{"0":1,"1":110,"2":5,"3":1},"b":{"0":[1,0],"1":[1,1],"2":[4,1],"3":[5,1],"4":[0,0],"5":[0,0],"6":[0,1],"7":[1,1]},"inputSourceMap":{"version":3,"sources":["branding.js"],"names":["schema","type","BrandingHandler","DefaultHandler","constructor","options","getType","client","branding","getSettings","err","statusCode","processChanges","assets","Object","keys","length","updateSettings","updated","didUpdate"],"mappings":";;;;;;;AAAA;;;;;;AAEO,MAAMA,MAAM,WAANA,MAAM,GAAG;AAAEC,EAAAA,IAAI,EAAE;AAAR,CAAf;;AAEQ,MAAMC,eAAN,SAA8BC,iBAA9B,CAA6C;AAC1DC,EAAAA,WAAW,CAACC,OAAD,EAAU;AACnB,UAAM,EACJ,GAAGA,OADC;AAEJJ,MAAAA,IAAI,EAAE;AAFF,KAAN;AAID;;AAEY,QAAPK,OAAO,GAAG;AAEd,QAAI,CAAC,KAAKC,MAAL,CAAYC,QAAb,IAAyB,OAAO,KAAKD,MAAL,CAAYC,QAAZ,CAAqBC,WAA5B,KAA4C,UAAzE,EAAqF;AACnF,aAAO,EAAP;AACD;;AAED,QAAI;AACF,aAAO,MAAM,KAAKF,MAAL,CAAYC,QAAZ,CAAqBC,WAArB,EAAb;AACD,KAFD,CAEE,OAAOC,GAAP,EAAY;AACZ,UAAIA,GAAG,CAACC,UAAJ,KAAmB,GAAvB,EAA4B,OAAO,EAAP;AAC5B,UAAID,GAAG,CAACC,UAAJ,KAAmB,GAAvB,EAA4B,OAAO,EAAP;AAC5B,YAAMD,GAAN;AACD;AACF;;AAEmB,QAAdE,cAAc,CAACC,MAAD,EAAS;AAC3B,UAAM;AAAEL,MAAAA;AAAF,QAAeK,MAArB;AAGA,QAAI,CAACL,QAAD,IAAa,CAACM,MAAM,CAACC,IAAP,CAAYP,QAAZ,EAAsBQ,MAAxC,EAAgD;AAEhD,UAAM,KAAKT,MAAL,CAAYC,QAAZ,CAAqBS,cAArB,CAAoC,EAApC,EAAwCT,QAAxC,CAAN;AACA,SAAKU,OAAL,IAAgB,CAAhB;AACA,SAAKC,SAAL,CAAeX,QAAf;AACD;;AAhCyD;;kBAAvCN,e","sourceRoot":"/home/circleci/repo/src/tools/auth0/handlers/","sourcesContent":["import DefaultHandler from './default';\n\nexport const schema = { type: 'object' };\n\nexport default class BrandingHandler extends DefaultHandler {\n  constructor(options) {\n    super({\n      ...options,\n      type: 'branding'\n    });\n  }\n\n  async getType() {\n    // in case client version does not support branding\n    if (!this.client.branding || typeof this.client.branding.getSettings !== 'function') {\n      return {};\n    }\n\n    try {\n      return await this.client.branding.getSettings();\n    } catch (err) {\n      if (err.statusCode === 404) return {};\n      if (err.statusCode === 501) return {};\n      throw err;\n    }\n  }\n\n  async processChanges(assets) {\n    const { branding } = assets;\n\n    // Do nothing if not set\n    if (!branding || !Object.keys(branding).length) return;\n\n    await this.client.branding.updateSettings({}, branding);\n    this.updated += 1;\n    this.didUpdate(branding);\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"46a66d5841e25abc37ee6fc9ddb124db1c973488","contentHash":"c8ffea022fbb7c73d19e5da4e74c20711603155560740e05e3e23d0de2792504"},"/home/circleci/repo/src/tools/auth0/handlers/prompts.js":{"path":"/home/circleci/repo/src/tools/auth0/handlers/prompts.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":27}},"2":{"start":{"line":8,"column":15},"end":{"line":8,"column":35}},"3":{"start":{"line":10,"column":16},"end":{"line":10,"column":48}},"4":{"start":{"line":12,"column":39},"end":{"line":12,"column":93}},"5":{"start":{"line":14,"column":15},"end":{"line":16,"column":1}},"6":{"start":{"line":20,"column":4},"end":{"line":22,"column":7}},"7":{"start":{"line":26,"column":4},"end":{"line":28,"column":5}},"8":{"start":{"line":27,"column":6},"end":{"line":27,"column":16}},"9":{"start":{"line":30,"column":4},"end":{"line":36,"column":5}},"10":{"start":{"line":31,"column":6},"end":{"line":31,"column":53}},"11":{"start":{"line":33,"column":6},"end":{"line":33,"column":44}},"12":{"start":{"line":33,"column":34},"end":{"line":33,"column":44}},"13":{"start":{"line":34,"column":6},"end":{"line":34,"column":44}},"14":{"start":{"line":34,"column":34},"end":{"line":34,"column":44}},"15":{"start":{"line":35,"column":6},"end":{"line":35,"column":16}},"16":{"start":{"line":42,"column":8},"end":{"line":42,"column":14}},"17":{"start":{"line":43,"column":4},"end":{"line":43,"column":57}},"18":{"start":{"line":43,"column":50},"end":{"line":43,"column":57}},"19":{"start":{"line":44,"column":4},"end":{"line":44,"column":58}},"20":{"start":{"line":45,"column":4},"end":{"line":45,"column":22}},"21":{"start":{"line":46,"column":4},"end":{"line":46,"column":28}},"22":{"start":{"line":51,"column":0},"end":{"line":51,"column":33}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":12,"column":9},"end":{"line":12,"column":31}},"loc":{"start":{"line":12,"column":37},"end":{"line":12,"column":95}},"line":12},"1":{"name":"(anonymous_1)","decl":{"start":{"line":19,"column":2},"end":{"line":19,"column":3}},"loc":{"start":{"line":19,"column":23},"end":{"line":23,"column":3}},"line":19},"2":{"name":"(anonymous_2)","decl":{"start":{"line":25,"column":2},"end":{"line":25,"column":3}},"loc":{"start":{"line":25,"column":18},"end":{"line":37,"column":3}},"line":25},"3":{"name":"(anonymous_3)","decl":{"start":{"line":39,"column":2},"end":{"line":39,"column":3}},"loc":{"start":{"line":39,"column":31},"end":{"line":47,"column":3}},"line":39}},"branchMap":{"0":{"loc":{"start":{"line":12,"column":46},"end":{"line":12,"column":92}},"type":"cond-expr","locations":[{"start":{"line":12,"column":70},"end":{"line":12,"column":73}},{"start":{"line":12,"column":76},"end":{"line":12,"column":92}}],"line":12},"1":{"loc":{"start":{"line":12,"column":46},"end":{"line":12,"column":67}},"type":"binary-expr","locations":[{"start":{"line":12,"column":46},"end":{"line":12,"column":49}},{"start":{"line":12,"column":53},"end":{"line":12,"column":67}}],"line":12},"2":{"loc":{"start":{"line":26,"column":4},"end":{"line":28,"column":5}},"type":"if","locations":[{"start":{"line":26,"column":4},"end":{"line":28,"column":5}},{"start":{"line":26,"column":4},"end":{"line":28,"column":5}}],"line":26},"3":{"loc":{"start":{"line":26,"column":8},"end":{"line":26,"column":85}},"type":"binary-expr","locations":[{"start":{"line":26,"column":8},"end":{"line":26,"column":28}},{"start":{"line":26,"column":32},"end":{"line":26,"column":85}}],"line":26},"4":{"loc":{"start":{"line":33,"column":6},"end":{"line":33,"column":44}},"type":"if","locations":[{"start":{"line":33,"column":6},"end":{"line":33,"column":44}},{"start":{"line":33,"column":6},"end":{"line":33,"column":44}}],"line":33},"5":{"loc":{"start":{"line":34,"column":6},"end":{"line":34,"column":44}},"type":"if","locations":[{"start":{"line":34,"column":6},"end":{"line":34,"column":44}},{"start":{"line":34,"column":6},"end":{"line":34,"column":44}}],"line":34},"6":{"loc":{"start":{"line":43,"column":4},"end":{"line":43,"column":57}},"type":"if","locations":[{"start":{"line":43,"column":4},"end":{"line":43,"column":57}},{"start":{"line":43,"column":4},"end":{"line":43,"column":57}}],"line":43},"7":{"loc":{"start":{"line":43,"column":8},"end":{"line":43,"column":48}},"type":"binary-expr","locations":[{"start":{"line":43,"column":8},"end":{"line":43,"column":16}},{"start":{"line":43,"column":20},"end":{"line":43,"column":48}}],"line":43}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":110,"7":5,"8":4,"9":1,"10":1,"11":0,"12":0,"13":0,"14":0,"15":0,"16":1,"17":1,"18":0,"19":1,"20":1,"21":1,"22":1},"f":{"0":1,"1":110,"2":5,"3":1},"b":{"0":[1,0],"1":[1,1],"2":[4,1],"3":[5,1],"4":[0,0],"5":[0,0],"6":[0,1],"7":[1,1]},"inputSourceMap":{"version":3,"sources":["prompts.js"],"names":["schema","type","PromptsHandler","DefaultHandler","constructor","options","getType","client","prompts","getSettings","err","statusCode","processChanges","assets","Object","keys","length","updateSettings","updated","didUpdate"],"mappings":";;;;;;;AAAA;;;;;;AAEO,MAAMA,MAAM,WAANA,MAAM,GAAG;AAAEC,EAAAA,IAAI,EAAE;AAAR,CAAf;;AAEQ,MAAMC,cAAN,SAA6BC,iBAA7B,CAA4C;AACzDC,EAAAA,WAAW,CAACC,OAAD,EAAU;AACnB,UAAM,EACJ,GAAGA,OADC;AAEJJ,MAAAA,IAAI,EAAE;AAFF,KAAN;AAID;;AAEY,QAAPK,OAAO,GAAG;AAEd,QAAI,CAAC,KAAKC,MAAL,CAAYC,OAAb,IAAwB,OAAO,KAAKD,MAAL,CAAYC,OAAZ,CAAoBC,WAA3B,KAA2C,UAAvE,EAAmF;AACjF,aAAO,EAAP;AACD;;AAED,QAAI;AACF,aAAO,MAAM,KAAKF,MAAL,CAAYC,OAAZ,CAAoBC,WAApB,EAAb;AACD,KAFD,CAEE,OAAOC,GAAP,EAAY;AACZ,UAAIA,GAAG,CAACC,UAAJ,KAAmB,GAAvB,EAA4B,OAAO,EAAP;AAC5B,UAAID,GAAG,CAACC,UAAJ,KAAmB,GAAvB,EAA4B,OAAO,EAAP;AAE5B,YAAMD,GAAN;AACD;AACF;;AAEmB,QAAdE,cAAc,CAACC,MAAD,EAAS;AAC3B,UAAM;AAAEL,MAAAA;AAAF,QAAcK,MAApB;AAGA,QAAI,CAACL,OAAD,IAAY,CAACM,MAAM,CAACC,IAAP,CAAYP,OAAZ,EAAqBQ,MAAtC,EAA8C;AAE9C,UAAM,KAAKT,MAAL,CAAYC,OAAZ,CAAoBS,cAApB,CAAmC,EAAnC,EAAuCT,OAAvC,CAAN;AACA,SAAKU,OAAL,IAAgB,CAAhB;AACA,SAAKC,SAAL,CAAeX,OAAf;AACD;;AAjCwD;;kBAAtCN,c","sourceRoot":"/home/circleci/repo/src/tools/auth0/handlers/","sourcesContent":["import DefaultHandler from './default';\n\nexport const schema = { type: 'object' };\n\nexport default class PromptsHandler extends DefaultHandler {\n  constructor(options) {\n    super({\n      ...options,\n      type: 'prompts'\n    });\n  }\n\n  async getType() {\n    // in case client version does not support branding\n    if (!this.client.prompts || typeof this.client.prompts.getSettings !== 'function') {\n      return {};\n    }\n\n    try {\n      return await this.client.prompts.getSettings();\n    } catch (err) {\n      if (err.statusCode === 404) return {};\n      if (err.statusCode === 501) return {};\n\n      throw err;\n    }\n  }\n\n  async processChanges(assets) {\n    const { prompts } = assets;\n\n    // Do nothing if not set\n    if (!prompts || !Object.keys(prompts).length) return;\n\n    await this.client.prompts.updateSettings({}, prompts);\n    this.updated += 1;\n    this.didUpdate(prompts);\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"7232eff217f84461901050be8927011dc69c44a4","contentHash":"d3f74ed021cf936dec91be2730ead8578be47c6218fa676ad6603e1a48b77345"},"/home/circleci/repo/src/tools/auth0/handlers/migrations.js":{"path":"/home/circleci/repo/src/tools/auth0/handlers/migrations.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":45}},"2":{"start":{"line":10,"column":15},"end":{"line":10,"column":35}},"3":{"start":{"line":12,"column":16},"end":{"line":12,"column":48}},"4":{"start":{"line":14,"column":14},"end":{"line":14,"column":37}},"5":{"start":{"line":16,"column":15},"end":{"line":16,"column":46}},"6":{"start":{"line":18,"column":39},"end":{"line":18,"column":93}},"7":{"start":{"line":20,"column":99},"end":{"line":20,"column":101}},"8":{"start":{"line":20,"column":103},"end":{"line":20,"column":184}},"9":{"start":{"line":20,"column":152},"end":{"line":20,"column":180}},"10":{"start":{"line":20,"column":185},"end":{"line":20,"column":221}},"11":{"start":{"line":20,"column":222},"end":{"line":20,"column":262}},"12":{"start":{"line":20,"column":263},"end":{"line":20,"column":329}},"13":{"start":{"line":20,"column":306},"end":{"line":20,"column":327}},"14":{"start":{"line":20,"column":330},"end":{"line":20,"column":461}},"15":{"start":{"line":20,"column":402},"end":{"line":20,"column":451}},"16":{"start":{"line":20,"column":462},"end":{"line":20,"column":612}},"17":{"start":{"line":20,"column":508},"end":{"line":20,"column":580}},"18":{"start":{"line":20,"column":581},"end":{"line":20,"column":610}},"19":{"start":{"line":20,"column":613},"end":{"line":20,"column":709}},"20":{"start":{"line":20,"column":648},"end":{"line":20,"column":694}},"21":{"start":{"line":20,"column":695},"end":{"line":20,"column":707}},"22":{"start":{"line":20,"column":710},"end":{"line":20,"column":722}},"23":{"start":{"line":22,"column":15},"end":{"line":27,"column":1}},"24":{"start":{"line":28,"column":25},"end":{"line":87,"column":170}},"25":{"start":{"line":30,"column":4},"end":{"line":32,"column":7}},"26":{"start":{"line":36,"column":4},"end":{"line":42,"column":5}},"27":{"start":{"line":37,"column":25},"end":{"line":37,"column":69}},"28":{"start":{"line":38,"column":6},"end":{"line":38,"column":30}},"29":{"start":{"line":40,"column":6},"end":{"line":40,"column":44}},"30":{"start":{"line":40,"column":34},"end":{"line":40,"column":44}},"31":{"start":{"line":41,"column":6},"end":{"line":41,"column":16}},"32":{"start":{"line":48,"column":8},"end":{"line":48,"column":14}},"33":{"start":{"line":50,"column":4},"end":{"line":60,"column":5}},"34":{"start":{"line":51,"column":20},"end":{"line":51,"column":70}},"35":{"start":{"line":53,"column":6},"end":{"line":59,"column":7}},"36":{"start":{"line":54,"column":8},"end":{"line":56,"column":11}},"37":{"start":{"line":57,"column":8},"end":{"line":57,"column":26}},"38":{"start":{"line":58,"column":8},"end":{"line":58,"column":30}},"39":{"start":{"line":64,"column":4},"end":{"line":68,"column":5}},"40":{"start":{"line":65,"column":6},"end":{"line":65,"column":220}},"41":{"start":{"line":67,"column":6},"end":{"line":67,"column":197}},"42":{"start":{"line":72,"column":18},"end":{"line":73,"column":5}},"43":{"start":{"line":74,"column":40},"end":{"line":74,"column":92}},"44":{"start":{"line":75,"column":31},"end":{"line":75,"column":51}},"45":{"start":{"line":76,"column":34},"end":{"line":76,"column":98}},"46":{"start":{"line":76,"column":68},"end":{"line":76,"column":97}},"47":{"start":{"line":77,"column":30},"end":{"line":77,"column":120}},"48":{"start":{"line":77,"column":67},"end":{"line":77,"column":119}},"49":{"start":{"line":79,"column":4},"end":{"line":82,"column":5}},"50":{"start":{"line":80,"column":6},"end":{"line":80,"column":84}},"51":{"start":{"line":81,"column":6},"end":{"line":81,"column":60}},"52":{"start":{"line":81,"column":40},"end":{"line":81,"column":58}},"53":{"start":{"line":84,"column":4},"end":{"line":84,"column":17}},"54":{"start":{"line":88,"column":0},"end":{"line":88,"column":36}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":18,"column":9},"end":{"line":18,"column":31}},"loc":{"start":{"line":18,"column":37},"end":{"line":18,"column":95}},"line":18},"1":{"name":"_applyDecoratedDescriptor","decl":{"start":{"line":20,"column":9},"end":{"line":20,"column":34}},"loc":{"start":{"line":20,"column":86},"end":{"line":20,"column":724}},"line":20},"2":{"name":"(anonymous_2)","decl":{"start":{"line":20,"column":135},"end":{"line":20,"column":136}},"loc":{"start":{"line":20,"column":150},"end":{"line":20,"column":182}},"line":20},"3":{"name":"(anonymous_3)","decl":{"start":{"line":20,"column":373},"end":{"line":20,"column":374}},"loc":{"start":{"line":20,"column":400},"end":{"line":20,"column":453}},"line":20},"4":{"name":"(anonymous_4)","decl":{"start":{"line":29,"column":2},"end":{"line":29,"column":3}},"loc":{"start":{"line":29,"column":23},"end":{"line":33,"column":3}},"line":29},"5":{"name":"(anonymous_5)","decl":{"start":{"line":35,"column":2},"end":{"line":35,"column":3}},"loc":{"start":{"line":35,"column":18},"end":{"line":43,"column":3}},"line":35},"6":{"name":"(anonymous_6)","decl":{"start":{"line":45,"column":2},"end":{"line":45,"column":3}},"loc":{"start":{"line":45,"column":31},"end":{"line":61,"column":3}},"line":45},"7":{"name":"(anonymous_7)","decl":{"start":{"line":63,"column":2},"end":{"line":63,"column":3}},"loc":{"start":{"line":63,"column":75},"end":{"line":69,"column":3}},"line":63},"8":{"name":"(anonymous_8)","decl":{"start":{"line":71,"column":2},"end":{"line":71,"column":3}},"loc":{"start":{"line":71,"column":48},"end":{"line":85,"column":3}},"line":71},"9":{"name":"(anonymous_9)","decl":{"start":{"line":76,"column":60},"end":{"line":76,"column":61}},"loc":{"start":{"line":76,"column":68},"end":{"line":76,"column":97}},"line":76},"10":{"name":"(anonymous_10)","decl":{"start":{"line":77,"column":59},"end":{"line":77,"column":60}},"loc":{"start":{"line":77,"column":67},"end":{"line":77,"column":119}},"line":77},"11":{"name":"(anonymous_11)","decl":{"start":{"line":81,"column":32},"end":{"line":81,"column":33}},"loc":{"start":{"line":81,"column":40},"end":{"line":81,"column":58}},"line":81}},"branchMap":{"0":{"loc":{"start":{"line":18,"column":46},"end":{"line":18,"column":92}},"type":"cond-expr","locations":[{"start":{"line":18,"column":70},"end":{"line":18,"column":73}},{"start":{"line":18,"column":76},"end":{"line":18,"column":92}}],"line":18},"1":{"loc":{"start":{"line":18,"column":46},"end":{"line":18,"column":67}},"type":"binary-expr","locations":[{"start":{"line":18,"column":46},"end":{"line":18,"column":49}},{"start":{"line":18,"column":53},"end":{"line":18,"column":67}}],"line":18},"2":{"loc":{"start":{"line":20,"column":263},"end":{"line":20,"column":329}},"type":"if","locations":[{"start":{"line":20,"column":263},"end":{"line":20,"column":329}},{"start":{"line":20,"column":263},"end":{"line":20,"column":329}}],"line":20},"3":{"loc":{"start":{"line":20,"column":267},"end":{"line":20,"column":302}},"type":"binary-expr","locations":[{"start":{"line":20,"column":267},"end":{"line":20,"column":282}},{"start":{"line":20,"column":286},"end":{"line":20,"column":302}}],"line":20},"4":{"loc":{"start":{"line":20,"column":409},"end":{"line":20,"column":450}},"type":"binary-expr","locations":[{"start":{"line":20,"column":409},"end":{"line":20,"column":442}},{"start":{"line":20,"column":446},"end":{"line":20,"column":450}}],"line":20},"5":{"loc":{"start":{"line":20,"column":462},"end":{"line":20,"column":612}},"type":"if","locations":[{"start":{"line":20,"column":462},"end":{"line":20,"column":612}},{"start":{"line":20,"column":462},"end":{"line":20,"column":612}}],"line":20},"6":{"loc":{"start":{"line":20,"column":466},"end":{"line":20,"column":504}},"type":"binary-expr","locations":[{"start":{"line":20,"column":466},"end":{"line":20,"column":473}},{"start":{"line":20,"column":477},"end":{"line":20,"column":504}}],"line":20},"7":{"loc":{"start":{"line":20,"column":521},"end":{"line":20,"column":579}},"type":"cond-expr","locations":[{"start":{"line":20,"column":540},"end":{"line":20,"column":570}},{"start":{"line":20,"column":573},"end":{"line":20,"column":579}}],"line":20},"8":{"loc":{"start":{"line":20,"column":613},"end":{"line":20,"column":709}},"type":"if","locations":[{"start":{"line":20,"column":613},"end":{"line":20,"column":709}},{"start":{"line":20,"column":613},"end":{"line":20,"column":709}}],"line":20},"9":{"loc":{"start":{"line":40,"column":6},"end":{"line":40,"column":44}},"type":"if","locations":[{"start":{"line":40,"column":6},"end":{"line":40,"column":44}},{"start":{"line":40,"column":6},"end":{"line":40,"column":44}}],"line":40},"10":{"loc":{"start":{"line":50,"column":4},"end":{"line":60,"column":5}},"type":"if","locations":[{"start":{"line":50,"column":4},"end":{"line":60,"column":5}},{"start":{"line":50,"column":4},"end":{"line":60,"column":5}}],"line":50},"11":{"loc":{"start":{"line":50,"column":8},"end":{"line":50,"column":56}},"type":"binary-expr","locations":[{"start":{"line":50,"column":8},"end":{"line":50,"column":18}},{"start":{"line":50,"column":22},"end":{"line":50,"column":56}}],"line":50},"12":{"loc":{"start":{"line":53,"column":6},"end":{"line":59,"column":7}},"type":"if","locations":[{"start":{"line":53,"column":6},"end":{"line":59,"column":7}},{"start":{"line":53,"column":6},"end":{"line":59,"column":7}}],"line":53},"13":{"loc":{"start":{"line":64,"column":4},"end":{"line":68,"column":5}},"type":"if","locations":[{"start":{"line":64,"column":4},"end":{"line":68,"column":5}},{"start":{"line":64,"column":4},"end":{"line":68,"column":5}}],"line":64},"14":{"loc":{"start":{"line":77,"column":67},"end":{"line":77,"column":119}},"type":"binary-expr","locations":[{"start":{"line":77,"column":67},"end":{"line":77,"column":94}},{"start":{"line":77,"column":98},"end":{"line":77,"column":119}}],"line":77},"15":{"loc":{"start":{"line":79,"column":4},"end":{"line":82,"column":5}},"type":"if","locations":[{"start":{"line":79,"column":4},"end":{"line":82,"column":5}},{"start":{"line":79,"column":4},"end":{"line":82,"column":5}}],"line":79}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":2,"7":1,"8":1,"9":4,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":0,"18":0,"19":1,"20":1,"21":1,"22":1,"23":1,"24":1,"25":115,"26":11,"27":11,"28":10,"29":1,"30":1,"31":0,"32":5,"33":5,"34":5,"35":5,"36":4,"37":4,"38":4,"39":3,"40":1,"41":2,"42":5,"43":5,"44":5,"45":5,"46":9,"47":5,"48":5,"49":5,"50":3,"51":3,"52":4,"53":5,"54":1},"f":{"0":2,"1":1,"2":4,"3":1,"4":115,"5":11,"6":5,"7":3,"8":5,"9":9,"10":5,"11":4},"b":{"0":[1,1],"1":[2,2],"2":[1,0],"3":[1,0],"4":[1,0],"5":[0,1],"6":[1,1],"7":[0,0],"8":[1,0],"9":[1,0],"10":[5,0],"11":[5,5],"12":[4,1],"13":[1,2],"14":[5,3],"15":[3,2]},"inputSourceMap":{"version":3,"sources":["migrations.js"],"names":["schema","type","additionalProperties","MigrationsHandler","DefaultHandler","constructor","options","getType","migrations","client","getMigrations","flags","err","statusCode","processChanges","assets","Object","keys","length","removeUnavailableMigrations","updateMigrations","updated","didUpdate","logUnavailableMigrations","ignoreUnavailableMigrations","ignoredMigrations","log","info","join","warn","config","existingMigrations","unavailableMigrations","filter","flag","forEach"],"mappings":";;;;;;;;;AAAA;;;;AACA;;;;;;;;AAEO,MAAMA,MAAM,WAANA,MAAM,GAAG;AACpBC,EAAAA,IAAI,EAAE,QADc;AAEpBC,EAAAA,oBAAoB,EAAE;AAAED,IAAAA,IAAI,EAAE;AAAR;AAFF,CAAf;IAKcE,iB,WAmBlB,oBAAM,KAAN,C,YAnBY,MAAMA,iBAAN,SAAgCC,iBAAhC,CAA+C;AAC5DC,EAAAA,WAAW,CAACC,OAAD,EAAU;AACnB,UAAM,EACJ,GAAGA,OADC;AAEJL,MAAAA,IAAI,EAAE;AAFF,KAAN;AAID;;AAEY,QAAPM,OAAO,GAAG;AACd,QAAI;AACF,YAAMC,UAAU,GAAG,MAAM,KAAKC,MAAL,CAAYD,UAAZ,CAAuBE,aAAvB,EAAzB;AACA,aAAOF,UAAU,CAACG,KAAlB;AACD,KAHD,CAGE,OAAOC,GAAP,EAAY;AACZ,UAAIA,GAAG,CAACC,UAAJ,KAAmB,GAAvB,EAA4B,OAAO,EAAP;AAC5B,YAAMD,GAAN;AACD;AACF;;AAImB,QAAdE,cAAc,CAACC,MAAD,EAAS;AAC3B,UAAM;AAAEP,MAAAA;AAAF,QAAiBO,MAAvB;;AAEA,QAAIP,UAAU,IAAIQ,MAAM,CAACC,IAAP,CAAYT,UAAZ,EAAwBU,MAAxB,GAAiC,CAAnD,EAAsD;AACpD,YAAMP,KAAK,GAAG,MAAM,KAAKQ,2BAAL,CAAiCX,UAAjC,CAApB;;AAEA,UAAIQ,MAAM,CAACC,IAAP,CAAYN,KAAZ,EAAmBO,MAAnB,GAA4B,CAAhC,EAAmC;AACjC,cAAM,KAAKT,MAAL,CAAYD,UAAZ,CAAuBY,gBAAvB,CAAwC;AAAET,UAAAA;AAAF,SAAxC,CAAN;AACA,aAAKU,OAAL,IAAgB,CAAhB;AACA,aAAKC,SAAL,CAAeX,KAAf;AACD;AACF;AACF;;AAEDY,EAAAA,wBAAwB,CAACC,2BAAD,EAA8BC,iBAA9B,EAAiD;AACvE,QAAID,2BAAJ,EAAiC;AAC/BE,uBAAIC,IAAJ,CAAU,+CAA8CF,iBAAiB,CAACG,IAAlB,CAAuB,GAAvB,CAA4B,oHAApF;AACD,KAFD,MAEO;AACLF,uBAAIG,IAAJ,CAAU,wDAAuDJ,iBAAiB,CAACG,IAAlB,CAAuB,GAAvB,CAA4B,oFAA7F;AACD;AACF;;AAEgC,QAA3BT,2BAA2B,CAACX,UAAD,EAAa;AAC5C,UAAMG,KAAK,GAAG,EAAE,GAAGH;AAAL,KAAd;AACA,UAAMgB,2BAA2B,GAAG,CAAC,CAAC,KAAKM,MAAL,CAAY,qCAAZ,CAAtC;AACA,UAAMC,kBAAkB,GAAG,MAAM,KAAKxB,OAAL,EAAjC;AACA,UAAMyB,qBAAqB,GAAGhB,MAAM,CAACC,IAAP,CAAYN,KAAZ,EAAmBsB,MAAnB,CAA2BC,IAAD,IAAU,EAAEA,IAAI,IAAIH,kBAAV,CAApC,CAA9B;AACA,UAAMN,iBAAiB,GAAGO,qBAAqB,CAACC,MAAtB,CAA8BC,IAAD,IAAUV,2BAA2B,IAAIb,KAAK,CAACuB,IAAD,CAAL,KAAgB,KAAtF,CAA1B;;AAEA,QAAIT,iBAAiB,CAACP,MAAlB,GAA2B,CAA/B,EAAkC;AAChC,WAAKK,wBAAL,CAA8BC,2BAA9B,EAA2DC,iBAA3D;AACAA,MAAAA,iBAAiB,CAACU,OAAlB,CAA2BD,IAAD,IAAU,OAAOvB,KAAK,CAACuB,IAAD,CAAhD;AACD;;AACD,WAAOvB,KAAP;AACD;;AAtD2D,C;kBAAzCR,iB","sourceRoot":"/home/circleci/repo/src/tools/auth0/handlers/","sourcesContent":["import DefaultHandler, { order } from './default';\nimport log from '../../logger';\n\nexport const schema = {\n  type: 'object',\n  additionalProperties: { type: 'boolean' }\n};\n\nexport default class MigrationsHandler extends DefaultHandler {\n  constructor(options) {\n    super({\n      ...options,\n      type: 'migrations'\n    });\n  }\n\n  async getType() {\n    try {\n      const migrations = await this.client.migrations.getMigrations();\n      return migrations.flags;\n    } catch (err) {\n      if (err.statusCode === 404) return {};\n      throw err;\n    }\n  }\n\n  // Run at the end since switching a flag will depend on other applying other changes\n  @order('150')\n  async processChanges(assets) {\n    const { migrations } = assets;\n\n    if (migrations && Object.keys(migrations).length > 0) {\n      const flags = await this.removeUnavailableMigrations(migrations);\n\n      if (Object.keys(flags).length > 0) {\n        await this.client.migrations.updateMigrations({ flags });\n        this.updated += 1;\n        this.didUpdate(flags);\n      }\n    }\n  }\n\n  logUnavailableMigrations(ignoreUnavailableMigrations, ignoredMigrations) {\n    if (ignoreUnavailableMigrations) {\n      log.info(`The following migrations are not available '${ignoredMigrations.join(',')}'. The migrations will be ignored because you have AUTH0_IGNORE_UNAVAILABLE_MIGRATIONS=true in your configuration.`);\n    } else {\n      log.warn(`The following disabled migrations are not available '${ignoredMigrations.join(',')}'. The migrations will be ignored, remove the migrations to avoid future warnings.`);\n    }\n  }\n\n  async removeUnavailableMigrations(migrations) {\n    const flags = { ...migrations };\n    const ignoreUnavailableMigrations = !!this.config('AUTH0_IGNORE_UNAVAILABLE_MIGRATIONS');\n    const existingMigrations = await this.getType();\n    const unavailableMigrations = Object.keys(flags).filter((flag) => !(flag in existingMigrations));\n    const ignoredMigrations = unavailableMigrations.filter((flag) => ignoreUnavailableMigrations || flags[flag] === false);\n\n    if (ignoredMigrations.length > 0) {\n      this.logUnavailableMigrations(ignoreUnavailableMigrations, ignoredMigrations);\n      ignoredMigrations.forEach((flag) => delete flags[flag]);\n    }\n    return flags;\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"9ee686336eca0b768ca6a63a5d3337c0c0817cc9","contentHash":"a5f04ed3ad495e4eb89e24691d4fbad01f58a0145f43e60f3efe9c8e3aedcf3d"},"/home/circleci/repo/src/tools/auth0/handlers/actions.js":{"path":"/home/circleci/repo/src/tools/auth0/handlers/actions.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":45}},"2":{"start":{"line":10,"column":14},"end":{"line":10,"column":31}},"3":{"start":{"line":12,"column":15},"end":{"line":12,"column":46}},"4":{"start":{"line":14,"column":15},"end":{"line":14,"column":35}},"5":{"start":{"line":16,"column":16},"end":{"line":16,"column":48}},"6":{"start":{"line":18,"column":14},"end":{"line":18,"column":37}},"7":{"start":{"line":20,"column":15},"end":{"line":20,"column":46}},"8":{"start":{"line":22,"column":13},"end":{"line":22,"column":35}},"9":{"start":{"line":24,"column":39},"end":{"line":24,"column":93}},"10":{"start":{"line":26,"column":99},"end":{"line":26,"column":101}},"11":{"start":{"line":26,"column":103},"end":{"line":26,"column":184}},"12":{"start":{"line":26,"column":152},"end":{"line":26,"column":180}},"13":{"start":{"line":26,"column":185},"end":{"line":26,"column":221}},"14":{"start":{"line":26,"column":222},"end":{"line":26,"column":262}},"15":{"start":{"line":26,"column":263},"end":{"line":26,"column":329}},"16":{"start":{"line":26,"column":306},"end":{"line":26,"column":327}},"17":{"start":{"line":26,"column":330},"end":{"line":26,"column":461}},"18":{"start":{"line":26,"column":402},"end":{"line":26,"column":451}},"19":{"start":{"line":26,"column":462},"end":{"line":26,"column":612}},"20":{"start":{"line":26,"column":508},"end":{"line":26,"column":580}},"21":{"start":{"line":26,"column":581},"end":{"line":26,"column":610}},"22":{"start":{"line":26,"column":613},"end":{"line":26,"column":709}},"23":{"start":{"line":26,"column":648},"end":{"line":26,"column":694}},"24":{"start":{"line":26,"column":695},"end":{"line":26,"column":707}},"25":{"start":{"line":26,"column":710},"end":{"line":26,"column":722}},"26":{"start":{"line":28,"column":32},"end":{"line":28,"column":34}},"27":{"start":{"line":29,"column":15},"end":{"line":109,"column":1}},"28":{"start":{"line":112,"column":2},"end":{"line":112,"column":57}},"29":{"start":{"line":112,"column":32},"end":{"line":112,"column":55}},"30":{"start":{"line":116,"column":20},"end":{"line":116,"column":82}},"31":{"start":{"line":117,"column":2},"end":{"line":117,"column":81}},"32":{"start":{"line":120,"column":21},"end":{"line":259,"column":170}},"33":{"start":{"line":122,"column":4},"end":{"line":129,"column":7}},"34":{"start":{"line":125,"column":26},"end":{"line":125,"column":51}},"35":{"start":{"line":126,"column":26},"end":{"line":126,"column":51}},"36":{"start":{"line":133,"column":22},"end":{"line":134,"column":5}},"37":{"start":{"line":135,"column":4},"end":{"line":135,"column":30}},"38":{"start":{"line":136,"column":4},"end":{"line":136,"column":28}},"39":{"start":{"line":137,"column":26},"end":{"line":137,"column":69}},"40":{"start":{"line":138,"column":4},"end":{"line":138,"column":33}},"41":{"start":{"line":139,"column":4},"end":{"line":139,"column":25}},"42":{"start":{"line":143,"column":4},"end":{"line":145,"column":5}},"43":{"start":{"line":144,"column":6},"end":{"line":144,"column":16}},"44":{"start":{"line":147,"column":4},"end":{"line":150,"column":7}},"45":{"start":{"line":154,"column":4},"end":{"line":157,"column":7}},"46":{"start":{"line":161,"column":4},"end":{"line":168,"column":17}},"47":{"start":{"line":163,"column":27},"end":{"line":167,"column":8}},"48":{"start":{"line":164,"column":8},"end":{"line":164,"column":84}},"49":{"start":{"line":166,"column":8},"end":{"line":166,"column":92}},"50":{"start":{"line":172,"column":4},"end":{"line":192,"column":5}},"51":{"start":{"line":173,"column":6},"end":{"line":175,"column":9}},"52":{"start":{"line":177,"column":6},"end":{"line":191,"column":7}},"53":{"start":{"line":178,"column":8},"end":{"line":182,"column":9}},"54":{"start":{"line":179,"column":10},"end":{"line":179,"column":107}},"55":{"start":{"line":181,"column":10},"end":{"line":181,"column":33}},"56":{"start":{"line":184,"column":8},"end":{"line":186,"column":9}},"57":{"start":{"line":185,"column":10},"end":{"line":185,"column":20}},"58":{"start":{"line":188,"column":8},"end":{"line":188,"column":26}},"59":{"start":{"line":189,"column":8},"end":{"line":189,"column":32}},"60":{"start":{"line":190,"column":8},"end":{"line":190,"column":40}},"61":{"start":{"line":196,"column":26},"end":{"line":196,"column":28}},"62":{"start":{"line":198,"column":4},"end":{"line":210,"column":5}},"63":{"start":{"line":199,"column":6},"end":{"line":201,"column":7}},"64":{"start":{"line":200,"column":8},"end":{"line":200,"column":41}},"65":{"start":{"line":203,"column":6},"end":{"line":205,"column":7}},"66":{"start":{"line":204,"column":8},"end":{"line":204,"column":47}},"67":{"start":{"line":207,"column":6},"end":{"line":209,"column":7}},"68":{"start":{"line":208,"column":8},"end":{"line":208,"column":57}},"69":{"start":{"line":212,"column":4},"end":{"line":214,"column":5}},"70":{"start":{"line":213,"column":6},"end":{"line":213,"column":67}},"71":{"start":{"line":216,"column":4},"end":{"line":216,"column":25}},"72":{"start":{"line":220,"column":4},"end":{"line":220,"column":44}},"73":{"start":{"line":220,"column":23},"end":{"line":220,"column":44}},"74":{"start":{"line":222,"column":4},"end":{"line":224,"column":5}},"75":{"start":{"line":223,"column":6},"end":{"line":223,"column":16}},"76":{"start":{"line":226,"column":4},"end":{"line":243,"column":5}},"77":{"start":{"line":227,"column":6},"end":{"line":229,"column":9}},"78":{"start":{"line":230,"column":6},"end":{"line":230,"column":27}},"79":{"start":{"line":232,"column":6},"end":{"line":234,"column":7}},"80":{"start":{"line":233,"column":8},"end":{"line":233,"column":18}},"81":{"start":{"line":236,"column":6},"end":{"line":240,"column":7}},"82":{"start":{"line":237,"column":8},"end":{"line":237,"column":77}},"83":{"start":{"line":239,"column":8},"end":{"line":239,"column":18}},"84":{"start":{"line":242,"column":6},"end":{"line":242,"column":16}},"85":{"start":{"line":249,"column":8},"end":{"line":249,"column":14}},"86":{"start":{"line":250,"column":4},"end":{"line":250,"column":25}},"87":{"start":{"line":250,"column":18},"end":{"line":250,"column":25}},"88":{"start":{"line":251,"column":20},"end":{"line":251,"column":50}},"89":{"start":{"line":252,"column":4},"end":{"line":252,"column":48}},"90":{"start":{"line":253,"column":26},"end":{"line":253,"column":28}},"91":{"start":{"line":254,"column":4},"end":{"line":254,"column":76}},"92":{"start":{"line":254,"column":58},"end":{"line":254,"column":73}},"93":{"start":{"line":255,"column":4},"end":{"line":255,"column":76}},"94":{"start":{"line":255,"column":58},"end":{"line":255,"column":73}},"95":{"start":{"line":256,"column":4},"end":{"line":256,"column":44}},"96":{"start":{"line":260,"column":0},"end":{"line":260,"column":32}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":24,"column":9},"end":{"line":24,"column":31}},"loc":{"start":{"line":24,"column":37},"end":{"line":24,"column":95}},"line":24},"1":{"name":"_applyDecoratedDescriptor","decl":{"start":{"line":26,"column":9},"end":{"line":26,"column":34}},"loc":{"start":{"line":26,"column":86},"end":{"line":26,"column":724}},"line":26},"2":{"name":"(anonymous_2)","decl":{"start":{"line":26,"column":135},"end":{"line":26,"column":136}},"loc":{"start":{"line":26,"column":150},"end":{"line":26,"column":182}},"line":26},"3":{"name":"(anonymous_3)","decl":{"start":{"line":26,"column":373},"end":{"line":26,"column":374}},"loc":{"start":{"line":26,"column":400},"end":{"line":26,"column":453}},"line":26},"4":{"name":"sleep","decl":{"start":{"line":111,"column":9},"end":{"line":111,"column":14}},"loc":{"start":{"line":111,"column":19},"end":{"line":113,"column":1}},"line":111},"5":{"name":"(anonymous_5)","decl":{"start":{"line":112,"column":21},"end":{"line":112,"column":22}},"loc":{"start":{"line":112,"column":32},"end":{"line":112,"column":55}},"line":112},"6":{"name":"isActionsDisabled","decl":{"start":{"line":115,"column":9},"end":{"line":115,"column":26}},"loc":{"start":{"line":115,"column":32},"end":{"line":118,"column":1}},"line":115},"7":{"name":"(anonymous_7)","decl":{"start":{"line":121,"column":2},"end":{"line":121,"column":3}},"loc":{"start":{"line":121,"column":23},"end":{"line":130,"column":3}},"line":121},"8":{"name":"(anonymous_8)","decl":{"start":{"line":125,"column":16},"end":{"line":125,"column":17}},"loc":{"start":{"line":125,"column":26},"end":{"line":125,"column":51}},"line":125},"9":{"name":"(anonymous_9)","decl":{"start":{"line":126,"column":16},"end":{"line":126,"column":17}},"loc":{"start":{"line":126,"column":26},"end":{"line":126,"column":51}},"line":126},"10":{"name":"(anonymous_10)","decl":{"start":{"line":132,"column":2},"end":{"line":132,"column":3}},"loc":{"start":{"line":132,"column":29},"end":{"line":140,"column":3}},"line":132},"11":{"name":"(anonymous_11)","decl":{"start":{"line":142,"column":2},"end":{"line":142,"column":3}},"loc":{"start":{"line":142,"column":29},"end":{"line":151,"column":3}},"line":142},"12":{"name":"(anonymous_12)","decl":{"start":{"line":153,"column":2},"end":{"line":153,"column":3}},"loc":{"start":{"line":153,"column":20},"end":{"line":158,"column":3}},"line":153},"13":{"name":"(anonymous_13)","decl":{"start":{"line":160,"column":2},"end":{"line":160,"column":3}},"loc":{"start":{"line":160,"column":31},"end":{"line":169,"column":3}},"line":160},"14":{"name":"(anonymous_14)","decl":{"start":{"line":163,"column":17},"end":{"line":163,"column":18}},"loc":{"start":{"line":163,"column":27},"end":{"line":167,"column":8}},"line":163},"15":{"name":"(anonymous_15)","decl":{"start":{"line":163,"column":58},"end":{"line":163,"column":59}},"loc":{"start":{"line":163,"column":64},"end":{"line":165,"column":7}},"line":163},"16":{"name":"(anonymous_16)","decl":{"start":{"line":165,"column":15},"end":{"line":165,"column":16}},"loc":{"start":{"line":165,"column":22},"end":{"line":167,"column":7}},"line":165},"17":{"name":"(anonymous_17)","decl":{"start":{"line":171,"column":2},"end":{"line":171,"column":3}},"loc":{"start":{"line":171,"column":29},"end":{"line":193,"column":3}},"line":171},"18":{"name":"(anonymous_18)","decl":{"start":{"line":195,"column":2},"end":{"line":195,"column":3}},"loc":{"start":{"line":195,"column":37},"end":{"line":217,"column":3}},"line":195},"19":{"name":"(anonymous_19)","decl":{"start":{"line":219,"column":2},"end":{"line":219,"column":3}},"loc":{"start":{"line":219,"column":18},"end":{"line":244,"column":3}},"line":219},"20":{"name":"(anonymous_20)","decl":{"start":{"line":246,"column":2},"end":{"line":246,"column":3}},"loc":{"start":{"line":246,"column":31},"end":{"line":257,"column":3}},"line":246},"21":{"name":"(anonymous_21)","decl":{"start":{"line":254,"column":48},"end":{"line":254,"column":49}},"loc":{"start":{"line":254,"column":58},"end":{"line":254,"column":73}},"line":254},"22":{"name":"(anonymous_22)","decl":{"start":{"line":255,"column":48},"end":{"line":255,"column":49}},"loc":{"start":{"line":255,"column":58},"end":{"line":255,"column":73}},"line":255}},"branchMap":{"0":{"loc":{"start":{"line":24,"column":46},"end":{"line":24,"column":92}},"type":"cond-expr","locations":[{"start":{"line":24,"column":70},"end":{"line":24,"column":73}},{"start":{"line":24,"column":76},"end":{"line":24,"column":92}}],"line":24},"1":{"loc":{"start":{"line":24,"column":46},"end":{"line":24,"column":67}},"type":"binary-expr","locations":[{"start":{"line":24,"column":46},"end":{"line":24,"column":49}},{"start":{"line":24,"column":53},"end":{"line":24,"column":67}}],"line":24},"2":{"loc":{"start":{"line":26,"column":263},"end":{"line":26,"column":329}},"type":"if","locations":[{"start":{"line":26,"column":263},"end":{"line":26,"column":329}},{"start":{"line":26,"column":263},"end":{"line":26,"column":329}}],"line":26},"3":{"loc":{"start":{"line":26,"column":267},"end":{"line":26,"column":302}},"type":"binary-expr","locations":[{"start":{"line":26,"column":267},"end":{"line":26,"column":282}},{"start":{"line":26,"column":286},"end":{"line":26,"column":302}}],"line":26},"4":{"loc":{"start":{"line":26,"column":409},"end":{"line":26,"column":450}},"type":"binary-expr","locations":[{"start":{"line":26,"column":409},"end":{"line":26,"column":442}},{"start":{"line":26,"column":446},"end":{"line":26,"column":450}}],"line":26},"5":{"loc":{"start":{"line":26,"column":462},"end":{"line":26,"column":612}},"type":"if","locations":[{"start":{"line":26,"column":462},"end":{"line":26,"column":612}},{"start":{"line":26,"column":462},"end":{"line":26,"column":612}}],"line":26},"6":{"loc":{"start":{"line":26,"column":466},"end":{"line":26,"column":504}},"type":"binary-expr","locations":[{"start":{"line":26,"column":466},"end":{"line":26,"column":473}},{"start":{"line":26,"column":477},"end":{"line":26,"column":504}}],"line":26},"7":{"loc":{"start":{"line":26,"column":521},"end":{"line":26,"column":579}},"type":"cond-expr","locations":[{"start":{"line":26,"column":540},"end":{"line":26,"column":570}},{"start":{"line":26,"column":573},"end":{"line":26,"column":579}}],"line":26},"8":{"loc":{"start":{"line":26,"column":613},"end":{"line":26,"column":709}},"type":"if","locations":[{"start":{"line":26,"column":613},"end":{"line":26,"column":709}},{"start":{"line":26,"column":613},"end":{"line":26,"column":709}}],"line":26},"9":{"loc":{"start":{"line":116,"column":20},"end":{"line":116,"column":82}},"type":"binary-expr","locations":[{"start":{"line":116,"column":20},"end":{"line":116,"column":76}},{"start":{"line":116,"column":80},"end":{"line":116,"column":82}}],"line":116},"10":{"loc":{"start":{"line":117,"column":9},"end":{"line":117,"column":80}},"type":"binary-expr","locations":[{"start":{"line":117,"column":9},"end":{"line":117,"column":31}},{"start":{"line":117,"column":35},"end":{"line":117,"column":80}}],"line":117},"11":{"loc":{"start":{"line":143,"column":4},"end":{"line":145,"column":5}},"type":"if","locations":[{"start":{"line":143,"column":4},"end":{"line":145,"column":5}},{"start":{"line":143,"column":4},"end":{"line":145,"column":5}}],"line":143},"12":{"loc":{"start":{"line":143,"column":8},"end":{"line":143,"column":80}},"type":"binary-expr","locations":[{"start":{"line":143,"column":8},"end":{"line":143,"column":28}},{"start":{"line":143,"column":32},"end":{"line":143,"column":80}}],"line":143},"13":{"loc":{"start":{"line":162,"column":12},"end":{"line":162,"column":25}},"type":"binary-expr","locations":[{"start":{"line":162,"column":12},"end":{"line":162,"column":19}},{"start":{"line":162,"column":23},"end":{"line":162,"column":25}}],"line":162},"14":{"loc":{"start":{"line":177,"column":6},"end":{"line":191,"column":7}},"type":"if","locations":[{"start":{"line":177,"column":6},"end":{"line":191,"column":7}},{"start":{"line":177,"column":6},"end":{"line":191,"column":7}}],"line":177},"15":{"loc":{"start":{"line":177,"column":10},"end":{"line":177,"column":79}},"type":"binary-expr","locations":[{"start":{"line":177,"column":10},"end":{"line":177,"column":21}},{"start":{"line":177,"column":25},"end":{"line":177,"column":79}}],"line":177},"16":{"loc":{"start":{"line":178,"column":8},"end":{"line":182,"column":9}},"type":"if","locations":[{"start":{"line":178,"column":8},"end":{"line":182,"column":9}},{"start":{"line":178,"column":8},"end":{"line":182,"column":9}}],"line":178},"17":{"loc":{"start":{"line":184,"column":8},"end":{"line":186,"column":9}},"type":"if","locations":[{"start":{"line":184,"column":8},"end":{"line":186,"column":9}},{"start":{"line":184,"column":8},"end":{"line":186,"column":9}}],"line":184},"18":{"loc":{"start":{"line":198,"column":4},"end":{"line":210,"column":5}},"type":"if","locations":[{"start":{"line":198,"column":4},"end":{"line":210,"column":5}},{"start":{"line":198,"column":4},"end":{"line":210,"column":5}}],"line":198},"19":{"loc":{"start":{"line":199,"column":6},"end":{"line":201,"column":7}},"type":"if","locations":[{"start":{"line":199,"column":6},"end":{"line":201,"column":7}},{"start":{"line":199,"column":6},"end":{"line":201,"column":7}}],"line":199},"20":{"loc":{"start":{"line":203,"column":6},"end":{"line":205,"column":7}},"type":"if","locations":[{"start":{"line":203,"column":6},"end":{"line":205,"column":7}},{"start":{"line":203,"column":6},"end":{"line":205,"column":7}}],"line":203},"21":{"loc":{"start":{"line":207,"column":6},"end":{"line":209,"column":7}},"type":"if","locations":[{"start":{"line":207,"column":6},"end":{"line":209,"column":7}},{"start":{"line":207,"column":6},"end":{"line":209,"column":7}}],"line":207},"22":{"loc":{"start":{"line":212,"column":4},"end":{"line":214,"column":5}},"type":"if","locations":[{"start":{"line":212,"column":4},"end":{"line":214,"column":5}},{"start":{"line":212,"column":4},"end":{"line":214,"column":5}}],"line":212},"23":{"loc":{"start":{"line":220,"column":4},"end":{"line":220,"column":44}},"type":"if","locations":[{"start":{"line":220,"column":4},"end":{"line":220,"column":44}},{"start":{"line":220,"column":4},"end":{"line":220,"column":44}}],"line":220},"24":{"loc":{"start":{"line":222,"column":4},"end":{"line":224,"column":5}},"type":"if","locations":[{"start":{"line":222,"column":4},"end":{"line":224,"column":5}},{"start":{"line":222,"column":4},"end":{"line":224,"column":5}}],"line":222},"25":{"loc":{"start":{"line":222,"column":8},"end":{"line":222,"column":80}},"type":"binary-expr","locations":[{"start":{"line":222,"column":8},"end":{"line":222,"column":28}},{"start":{"line":222,"column":32},"end":{"line":222,"column":80}}],"line":222},"26":{"loc":{"start":{"line":232,"column":6},"end":{"line":234,"column":7}},"type":"if","locations":[{"start":{"line":232,"column":6},"end":{"line":234,"column":7}},{"start":{"line":232,"column":6},"end":{"line":234,"column":7}}],"line":232},"27":{"loc":{"start":{"line":232,"column":10},"end":{"line":232,"column":84}},"type":"binary-expr","locations":[{"start":{"line":232,"column":10},"end":{"line":232,"column":32}},{"start":{"line":232,"column":36},"end":{"line":232,"column":58}},{"start":{"line":232,"column":62},"end":{"line":232,"column":84}}],"line":232},"28":{"loc":{"start":{"line":236,"column":6},"end":{"line":240,"column":7}},"type":"if","locations":[{"start":{"line":236,"column":6},"end":{"line":240,"column":7}},{"start":{"line":236,"column":6},"end":{"line":240,"column":7}}],"line":236},"29":{"loc":{"start":{"line":250,"column":4},"end":{"line":250,"column":25}},"type":"if","locations":[{"start":{"line":250,"column":4},"end":{"line":250,"column":25}},{"start":{"line":250,"column":4},"end":{"line":250,"column":25}}],"line":250}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":3,"10":1,"11":1,"12":4,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":0,"21":0,"22":1,"23":1,"24":1,"25":1,"26":1,"27":1,"28":0,"29":0,"30":1,"31":1,"32":1,"33":117,"34":1,"35":1,"36":1,"37":1,"38":1,"39":1,"40":1,"41":1,"42":1,"43":0,"44":1,"45":2,"46":2,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":11,"73":0,"74":11,"75":0,"76":11,"77":11,"78":7,"79":4,"80":3,"81":1,"82":0,"83":0,"84":1,"85":2,"86":2,"87":0,"88":2,"89":2,"90":2,"91":2,"92":1,"93":2,"94":0,"95":2,"96":1},"f":{"0":3,"1":1,"2":4,"3":1,"4":0,"5":0,"6":1,"7":117,"8":1,"9":1,"10":1,"11":1,"12":2,"13":2,"14":0,"15":0,"16":0,"17":0,"18":0,"19":11,"20":2,"21":1,"22":0},"b":{"0":[1,2],"1":[3,3],"2":[1,0],"3":[1,0],"4":[1,0],"5":[0,1],"6":[1,1],"7":[0,0],"8":[1,0],"9":[1,1],"10":[1,0],"11":[0,1],"12":[1,1],"13":[2,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,11],"24":[0,11],"25":[11,11],"26":[3,1],"27":[4,3,2],"28":[0,1],"29":[0,2]},"inputSourceMap":{"version":3,"sources":["actions.js"],"names":["MAX_ACTION_DEPLOY_RETRY","schema","type","items","required","additionalProperties","properties","code","default","runtime","dependencies","name","version","registry_url","secrets","value","updated_at","format","supported_triggers","id","url","deployed","status","sleep","ms","Promise","resolve","setTimeout","isActionsDisabled","err","errorBody","_","get","statusCode","errorCode","ActionHandler","DefaultHandler","constructor","options","functions","create","action","createAction","delete","deleteAction","stripUpdateFields","addAction","createdAction","client","actions","force","objString","deployActions","pool","addEachTask","data","generator","deployAction","then","log","info","catch","Error","promise","deploy","message","includes","retry_count","actionChanges","found","getType","existing","getAll","paginate","processChanges","assets","changes","calcChanges","push","filter","update"],"mappings":"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","sourceRoot":"/home/circleci/repo/src/tools/auth0/handlers/","sourcesContent":["import _ from 'lodash';\nimport DefaultHandler, { order } from './default';\nimport log from '../../logger';\nimport { areArraysEquals } from '../../utils';\n\nconst MAX_ACTION_DEPLOY_RETRY = 60;\n\n// With this schema, we can only validate property types but not valid properties on per type basis\nexport const schema = {\n  type: 'array',\n  items: {\n    type: 'object',\n    required: [ 'name', 'supported_triggers', 'code' ],\n    additionalProperties: false,\n    properties: {\n      code: { type: 'string', default: '' },\n      runtime: { type: 'string' },\n      dependencies: {\n        type: 'array',\n        items: {\n          type: 'object',\n          additionalProperties: false,\n          properties: {\n            name: { type: 'string' },\n            version: { type: 'string' },\n            registry_url: { type: 'string' }\n          }\n        }\n      },\n      secrets: {\n        type: 'array',\n        items: {\n          type: 'object',\n          properties: {\n            name: { type: 'string' },\n            value: { type: 'string' },\n            updated_at: { type: 'string', format: 'date-time' }\n          }\n        }\n      },\n      name: { type: 'string', default: '' },\n      supported_triggers: {\n        type: 'array',\n        items: {\n          type: 'object',\n          properties: {\n            id: { type: 'string', default: '' },\n            version: { type: 'string' },\n            url: { type: 'string' }\n          }\n        }\n      },\n      deployed: { type: 'boolean' },\n      status: { type: 'string' }\n    }\n  }\n};\n\nfunction sleep(ms) {\n  return new Promise((resolve) => setTimeout(resolve, ms));\n}\n\nfunction isActionsDisabled(err) {\n  const errorBody = _.get(err, 'originalError.response.body') || {};\n\n  return (\n    err.statusCode === 403 && errorBody.errorCode === 'feature_not_enabled'\n  );\n}\n\nexport default class ActionHandler extends DefaultHandler {\n  constructor(options) {\n    super({\n      ...options,\n      type: 'actions',\n      functions: {\n        create: (action) => this.createAction(action),\n        delete: (action) => this.deleteAction(action)\n      },\n      stripUpdateFields: [\n        'deployed',\n        'status'\n      ]\n    });\n  }\n\n  async createAction(action) {\n    // Strip the deployed flag\n    const addAction = { ...action };\n    delete addAction.deployed;\n    delete addAction.status;\n    const createdAction = await this.client.actions.create(addAction);\n\n    // Add the action id so we can deploy it later\n    action.id = createdAction.id;\n    return createdAction;\n  }\n\n  async deleteAction(action) {\n    if (!this.client.actions || typeof this.client.actions.delete !== 'function') {\n      return [];\n    }\n    return this.client.actions.delete({ id: action.id, force: true });\n  }\n\n  objString(action) {\n    return super.objString({ id: action.id, name: action.name });\n  }\n\n  async deployActions(actions) {\n    await this.client.pool\n      .addEachTask({\n        data: actions || [],\n        generator: (action) => this.deployAction(action)\n          .then(() => {\n            log.info(`Deployed [${this.type}]: ${this.objString(action)}`);\n          })\n          .catch((err) => {\n            throw new Error(\n              `Problem Deploying ${this.type} ${this.objString(action)}\\n${err}`\n            );\n          })\n      })\n      .promise();\n  }\n\n  async deployAction(action) {\n    try {\n      await this.client.actions.deploy({ id: action.id });\n    } catch (err) {\n      // Retry if pending build.\n      if (err.message && err.message.includes('must be in the \\'built\\' state')) {\n        if (!action.retry_count) {\n          log.info(`[${this.type}]: Waiting for build to complete ${this.objString(action)}`);\n          action.retry_count = 1;\n        }\n        if (action.retry_count > MAX_ACTION_DEPLOY_RETRY) {\n          throw err;\n        }\n        await sleep(1000);\n        action.retry_count += 1;\n        await this.deployAction(action);\n      }\n    }\n  }\n\n  async actionChanges(action, found) {\n    const actionChanges = {};\n\n    // if action is deployed, should compare against curren_version - calcDeployedVersionChanges method\n    if (!action.deployed) {\n      // name or secrets modifications are not supported yet\n      if (action.code !== found.code) {\n        actionChanges.code = action.code;\n      }\n\n      if (action.runtime !== found.runtime) {\n        actionChanges.runtime = action.runtime;\n      }\n\n      if (!areArraysEquals(action.dependencies, found.dependencies)) {\n        actionChanges.dependencies = action.dependencies;\n      }\n    }\n\n    if (!areArraysEquals(action.supported_triggers, found.supported_triggers)) {\n      actionChanges.supported_triggers = action.supported_triggers;\n    }\n\n    return actionChanges;\n  }\n\n  async getType() {\n    if (this.existing) return this.existing;\n\n    if (!this.client.actions || typeof this.client.actions.getAll !== 'function') {\n      return [];\n    }\n    // Actions API does not support include_totals param like the other paginate API's.\n    // So we set it to false otherwise it will fail with \"Additional properties not allowed: include_totals\"\n    try {\n      this.existing = await this.client.actions.getAll({ paginate: true });\n      return this.existing;\n    } catch (err) {\n      if (err.statusCode === 403 || err.statusCode === 404 || err.statusCode === 501) {\n        return [];\n      }\n\n      if (isActionsDisabled(err)) {\n        log.info('Skipping actions because it is not enabled.');\n        return [];\n      }\n\n      throw err;\n    }\n  }\n\n  @order('60')\n  async processChanges(assets) {\n    const { actions } = assets;\n\n    // Do nothing if not set\n    if (!actions) return;\n    const changes = await this.calcChanges(assets);\n\n    await super.processChanges(assets, changes);\n    // Deploy actions\n    const deployActions = [];\n    deployActions.push(...changes.create.filter((action) => action.deployed));\n    deployActions.push(...changes.update.filter((action) => action.deployed));\n    await this.deployActions(deployActions);\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"de11b42be00875e1d026f4a22284426ca57a4065","contentHash":"32750f810cc3bcb8d6305a4ab39982ba6e9bb6d06c51d622bf8a47fe4fee17e6"},"/home/circleci/repo/src/tools/auth0/handlers/triggers.js":{"path":"/home/circleci/repo/src/tools/auth0/handlers/triggers.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":45}},"2":{"start":{"line":10,"column":14},"end":{"line":10,"column":31}},"3":{"start":{"line":12,"column":15},"end":{"line":12,"column":46}},"4":{"start":{"line":14,"column":15},"end":{"line":14,"column":35}},"5":{"start":{"line":16,"column":16},"end":{"line":16,"column":48}},"6":{"start":{"line":18,"column":17},"end":{"line":18,"column":43}},"7":{"start":{"line":20,"column":18},"end":{"line":20,"column":52}},"8":{"start":{"line":22,"column":14},"end":{"line":22,"column":37}},"9":{"start":{"line":24,"column":15},"end":{"line":24,"column":46}},"10":{"start":{"line":26,"column":39},"end":{"line":26,"column":93}},"11":{"start":{"line":28,"column":99},"end":{"line":28,"column":101}},"12":{"start":{"line":28,"column":103},"end":{"line":28,"column":184}},"13":{"start":{"line":28,"column":152},"end":{"line":28,"column":180}},"14":{"start":{"line":28,"column":185},"end":{"line":28,"column":221}},"15":{"start":{"line":28,"column":222},"end":{"line":28,"column":262}},"16":{"start":{"line":28,"column":263},"end":{"line":28,"column":329}},"17":{"start":{"line":28,"column":306},"end":{"line":28,"column":327}},"18":{"start":{"line":28,"column":330},"end":{"line":28,"column":461}},"19":{"start":{"line":28,"column":402},"end":{"line":28,"column":451}},"20":{"start":{"line":28,"column":462},"end":{"line":28,"column":612}},"21":{"start":{"line":28,"column":508},"end":{"line":28,"column":580}},"22":{"start":{"line":28,"column":581},"end":{"line":28,"column":610}},"23":{"start":{"line":28,"column":613},"end":{"line":28,"column":709}},"24":{"start":{"line":28,"column":648},"end":{"line":28,"column":694}},"25":{"start":{"line":28,"column":695},"end":{"line":28,"column":707}},"26":{"start":{"line":28,"column":710},"end":{"line":28,"column":722}},"27":{"start":{"line":30,"column":15},"end":{"line":51,"column":1}},"28":{"start":{"line":54,"column":20},"end":{"line":54,"column":82}},"29":{"start":{"line":55,"column":2},"end":{"line":55,"column":81}},"30":{"start":{"line":58,"column":23},"end":{"line":139,"column":170}},"31":{"start":{"line":60,"column":4},"end":{"line":63,"column":7}},"32":{"start":{"line":67,"column":4},"end":{"line":69,"column":5}},"33":{"start":{"line":68,"column":6},"end":{"line":68,"column":27}},"34":{"start":{"line":71,"column":4},"end":{"line":73,"column":5}},"35":{"start":{"line":72,"column":6},"end":{"line":72,"column":16}},"36":{"start":{"line":75,"column":28},"end":{"line":75,"column":30}},"37":{"start":{"line":77,"column":4},"end":{"line":111,"column":5}},"38":{"start":{"line":78,"column":18},"end":{"line":78,"column":60}},"39":{"start":{"line":79,"column":23},"end":{"line":79,"column":83}},"40":{"start":{"line":81,"column":6},"end":{"line":95,"column":7}},"41":{"start":{"line":81,"column":19},"end":{"line":81,"column":20}},"42":{"start":{"line":82,"column":26},"end":{"line":82,"column":37}},"43":{"start":{"line":85,"column":12},"end":{"line":87,"column":10}},"44":{"start":{"line":89,"column":8},"end":{"line":94,"column":9}},"45":{"start":{"line":90,"column":10},"end":{"line":93,"column":14}},"46":{"start":{"line":90,"column":64},"end":{"line":93,"column":11}},"47":{"start":{"line":97,"column":6},"end":{"line":97,"column":38}},"48":{"start":{"line":98,"column":6},"end":{"line":98,"column":27}},"49":{"start":{"line":100,"column":6},"end":{"line":102,"column":7}},"50":{"start":{"line":101,"column":8},"end":{"line":101,"column":18}},"51":{"start":{"line":104,"column":6},"end":{"line":108,"column":7}},"52":{"start":{"line":105,"column":8},"end":{"line":105,"column":83}},"53":{"start":{"line":107,"column":8},"end":{"line":107,"column":18}},"54":{"start":{"line":110,"column":6},"end":{"line":110,"column":16}},"55":{"start":{"line":117,"column":8},"end":{"line":117,"column":14}},"56":{"start":{"line":118,"column":4},"end":{"line":118,"column":26}},"57":{"start":{"line":118,"column":19},"end":{"line":118,"column":26}},"58":{"start":{"line":119,"column":4},"end":{"line":136,"column":8}},"59":{"start":{"line":120,"column":23},"end":{"line":126,"column":9}},"60":{"start":{"line":120,"column":44},"end":{"line":126,"column":7}},"61":{"start":{"line":127,"column":6},"end":{"line":131,"column":9}},"62":{"start":{"line":132,"column":6},"end":{"line":134,"column":9}},"63":{"start":{"line":135,"column":6},"end":{"line":135,"column":24}},"64":{"start":{"line":140,"column":0},"end":{"line":140,"column":34}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":26,"column":9},"end":{"line":26,"column":31}},"loc":{"start":{"line":26,"column":37},"end":{"line":26,"column":95}},"line":26},"1":{"name":"_applyDecoratedDescriptor","decl":{"start":{"line":28,"column":9},"end":{"line":28,"column":34}},"loc":{"start":{"line":28,"column":86},"end":{"line":28,"column":724}},"line":28},"2":{"name":"(anonymous_2)","decl":{"start":{"line":28,"column":135},"end":{"line":28,"column":136}},"loc":{"start":{"line":28,"column":150},"end":{"line":28,"column":182}},"line":28},"3":{"name":"(anonymous_3)","decl":{"start":{"line":28,"column":373},"end":{"line":28,"column":374}},"loc":{"start":{"line":28,"column":400},"end":{"line":28,"column":453}},"line":28},"4":{"name":"isActionsDisabled","decl":{"start":{"line":53,"column":9},"end":{"line":53,"column":26}},"loc":{"start":{"line":53,"column":32},"end":{"line":56,"column":1}},"line":53},"5":{"name":"(anonymous_5)","decl":{"start":{"line":59,"column":2},"end":{"line":59,"column":3}},"loc":{"start":{"line":59,"column":23},"end":{"line":64,"column":3}},"line":59},"6":{"name":"(anonymous_6)","decl":{"start":{"line":66,"column":2},"end":{"line":66,"column":3}},"loc":{"start":{"line":66,"column":18},"end":{"line":112,"column":3}},"line":66},"7":{"name":"(anonymous_7)","decl":{"start":{"line":90,"column":52},"end":{"line":90,"column":53}},"loc":{"start":{"line":90,"column":64},"end":{"line":93,"column":11}},"line":90},"8":{"name":"(anonymous_8)","decl":{"start":{"line":114,"column":2},"end":{"line":114,"column":3}},"loc":{"start":{"line":114,"column":31},"end":{"line":137,"column":3}},"line":114},"9":{"name":"(anonymous_9)","decl":{"start":{"line":119,"column":51},"end":{"line":119,"column":52}},"loc":{"start":{"line":119,"column":75},"end":{"line":136,"column":5}},"line":119},"10":{"name":"(anonymous_10)","decl":{"start":{"line":120,"column":32},"end":{"line":120,"column":33}},"loc":{"start":{"line":120,"column":44},"end":{"line":126,"column":7}},"line":120}},"branchMap":{"0":{"loc":{"start":{"line":26,"column":46},"end":{"line":26,"column":92}},"type":"cond-expr","locations":[{"start":{"line":26,"column":70},"end":{"line":26,"column":73}},{"start":{"line":26,"column":76},"end":{"line":26,"column":92}}],"line":26},"1":{"loc":{"start":{"line":26,"column":46},"end":{"line":26,"column":67}},"type":"binary-expr","locations":[{"start":{"line":26,"column":46},"end":{"line":26,"column":49}},{"start":{"line":26,"column":53},"end":{"line":26,"column":67}}],"line":26},"2":{"loc":{"start":{"line":28,"column":263},"end":{"line":28,"column":329}},"type":"if","locations":[{"start":{"line":28,"column":263},"end":{"line":28,"column":329}},{"start":{"line":28,"column":263},"end":{"line":28,"column":329}}],"line":28},"3":{"loc":{"start":{"line":28,"column":267},"end":{"line":28,"column":302}},"type":"binary-expr","locations":[{"start":{"line":28,"column":267},"end":{"line":28,"column":282}},{"start":{"line":28,"column":286},"end":{"line":28,"column":302}}],"line":28},"4":{"loc":{"start":{"line":28,"column":409},"end":{"line":28,"column":450}},"type":"binary-expr","locations":[{"start":{"line":28,"column":409},"end":{"line":28,"column":442}},{"start":{"line":28,"column":446},"end":{"line":28,"column":450}}],"line":28},"5":{"loc":{"start":{"line":28,"column":462},"end":{"line":28,"column":612}},"type":"if","locations":[{"start":{"line":28,"column":462},"end":{"line":28,"column":612}},{"start":{"line":28,"column":462},"end":{"line":28,"column":612}}],"line":28},"6":{"loc":{"start":{"line":28,"column":466},"end":{"line":28,"column":504}},"type":"binary-expr","locations":[{"start":{"line":28,"column":466},"end":{"line":28,"column":473}},{"start":{"line":28,"column":477},"end":{"line":28,"column":504}}],"line":28},"7":{"loc":{"start":{"line":28,"column":521},"end":{"line":28,"column":579}},"type":"cond-expr","locations":[{"start":{"line":28,"column":540},"end":{"line":28,"column":570}},{"start":{"line":28,"column":573},"end":{"line":28,"column":579}}],"line":28},"8":{"loc":{"start":{"line":28,"column":613},"end":{"line":28,"column":709}},"type":"if","locations":[{"start":{"line":28,"column":613},"end":{"line":28,"column":709}},{"start":{"line":28,"column":613},"end":{"line":28,"column":709}}],"line":28},"9":{"loc":{"start":{"line":54,"column":20},"end":{"line":54,"column":82}},"type":"binary-expr","locations":[{"start":{"line":54,"column":20},"end":{"line":54,"column":76}},{"start":{"line":54,"column":80},"end":{"line":54,"column":82}}],"line":54},"10":{"loc":{"start":{"line":55,"column":9},"end":{"line":55,"column":80}},"type":"binary-expr","locations":[{"start":{"line":55,"column":9},"end":{"line":55,"column":31}},{"start":{"line":55,"column":35},"end":{"line":55,"column":80}}],"line":55},"11":{"loc":{"start":{"line":67,"column":4},"end":{"line":69,"column":5}},"type":"if","locations":[{"start":{"line":67,"column":4},"end":{"line":69,"column":5}},{"start":{"line":67,"column":4},"end":{"line":69,"column":5}}],"line":67},"12":{"loc":{"start":{"line":71,"column":4},"end":{"line":73,"column":5}},"type":"if","locations":[{"start":{"line":71,"column":4},"end":{"line":73,"column":5}},{"start":{"line":71,"column":4},"end":{"line":73,"column":5}}],"line":71},"13":{"loc":{"start":{"line":71,"column":8},"end":{"line":71,"column":88}},"type":"binary-expr","locations":[{"start":{"line":71,"column":8},"end":{"line":71,"column":28}},{"start":{"line":71,"column":32},"end":{"line":71,"column":88}}],"line":71},"14":{"loc":{"start":{"line":89,"column":8},"end":{"line":94,"column":9}},"type":"if","locations":[{"start":{"line":89,"column":8},"end":{"line":94,"column":9}},{"start":{"line":89,"column":8},"end":{"line":94,"column":9}}],"line":89},"15":{"loc":{"start":{"line":100,"column":6},"end":{"line":102,"column":7}},"type":"if","locations":[{"start":{"line":100,"column":6},"end":{"line":102,"column":7}},{"start":{"line":100,"column":6},"end":{"line":102,"column":7}}],"line":100},"16":{"loc":{"start":{"line":100,"column":10},"end":{"line":100,"column":58}},"type":"binary-expr","locations":[{"start":{"line":100,"column":10},"end":{"line":100,"column":32}},{"start":{"line":100,"column":36},"end":{"line":100,"column":58}}],"line":100},"17":{"loc":{"start":{"line":104,"column":6},"end":{"line":108,"column":7}},"type":"if","locations":[{"start":{"line":104,"column":6},"end":{"line":108,"column":7}},{"start":{"line":104,"column":6},"end":{"line":108,"column":7}}],"line":104},"18":{"loc":{"start":{"line":118,"column":4},"end":{"line":118,"column":26}},"type":"if","locations":[{"start":{"line":118,"column":4},"end":{"line":118,"column":26}},{"start":{"line":118,"column":4},"end":{"line":118,"column":26}}],"line":118}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":4,"11":1,"12":1,"13":4,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":1,"21":0,"22":0,"23":1,"24":1,"25":1,"26":1,"27":1,"28":1,"29":1,"30":1,"31":114,"32":8,"33":0,"34":8,"35":7,"36":1,"37":1,"38":1,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":1,"50":0,"51":1,"52":1,"53":1,"54":0,"55":1,"56":1,"57":0,"58":1,"59":6,"60":1,"61":6,"62":6,"63":6,"64":1},"f":{"0":4,"1":1,"2":4,"3":1,"4":1,"5":114,"6":8,"7":0,"8":1,"9":6,"10":1},"b":{"0":[2,2],"1":[4,4],"2":[1,0],"3":[1,0],"4":[1,0],"5":[0,1],"6":[1,1],"7":[0,0],"8":[1,0],"9":[1,0],"10":[1,1],"11":[0,8],"12":[7,1],"13":[8,8],"14":[0,0],"15":[0,1],"16":[1,1],"17":[1,0],"18":[0,1]},"inputSourceMap":{"version":3,"sources":["triggers.js"],"names":["schema","type","items","additionalProperties","properties","trigger_id","action_name","enum","constants","ACTIONS_TRIGGERS","display_name","default","isActionsDisabled","err","errorBody","_","get","statusCode","errorCode","TriggersHandler","DefaultHandler","constructor","options","id","getType","existing","client","actions","getAllTriggers","triggerBindings","res","triggers","map","uniq","value","i","length","triggerId","bindings","getTriggerBindings","binding","action","name","log","info","processChanges","assets","Promise","all","Object","entries","data","ref","updateTriggerBindings","didUpdate","updated"],"mappings":"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","sourceRoot":"/home/circleci/repo/src/tools/auth0/handlers/","sourcesContent":["import _ from 'lodash';\nimport DefaultHandler, { order } from './default';\nimport constants from '../../constants';\nimport log from '../../logger';\n\nexport const schema = {\n  type: 'object',\n  items: {\n    type: 'object',\n    additionalProperties: true,\n    properties: {\n      trigger_id: {\n        type: 'object',\n        properties: {\n          action_name: { type: 'string', enum: constants.ACTIONS_TRIGGERS },\n          display_name: { type: 'string', default: '' }\n        }\n      }\n    }\n  }\n};\n\nfunction isActionsDisabled(err) {\n  const errorBody = _.get(err, 'originalError.response.body') || {};\n\n  return (\n    err.statusCode === 403 && errorBody.errorCode === 'feature_not_enabled'\n  );\n}\nexport default class TriggersHandler extends DefaultHandler {\n  constructor(options) {\n    super({\n      ...options,\n      type: 'triggers',\n      id: 'name'\n    });\n  }\n\n  async getType() {\n    if (this.existing) {\n      return this.existing;\n    }\n\n    // in case client version does not support actions\n    if (\n      !this.client.actions\n      || typeof this.client.actions.getAllTriggers !== 'function'\n    ) {\n      return [];\n    }\n\n    const triggerBindings = {};\n\n    try {\n      const res = await this.client.actions.getAllTriggers();\n      const triggers = _(res.triggers).map('id').uniq().value();\n\n      for (let i = 0; i < triggers.length; i++) {\n        const triggerId = triggers[i];\n        const { bindings } = await this.client.actions.getTriggerBindings({\n          trigger_id: triggerId\n        });\n        if (bindings.length > 0) {\n          triggerBindings[triggerId] = bindings.map((binding) => ({\n            action_name: binding.action.name,\n            display_name: binding.display_name\n          }));\n        }\n      }\n\n      this.existing = triggerBindings;\n      return this.existing;\n    } catch (err) {\n      if (err.statusCode === 404 || err.statusCode === 501) {\n        return [];\n      }\n\n      if (isActionsDisabled(err)) {\n        log.info('Skipping triggers because Actions is not enabled.');\n        return {};\n      }\n\n      throw err;\n    }\n  }\n\n  @order('80')\n  async processChanges(assets) {\n    // No API to delete or create triggers, we can only update.\n    const { triggers } = assets;\n\n    // Do nothing if not set\n    if (!triggers) return;\n\n    // Process each trigger\n    await Promise.all(Object.entries(triggers).map(async ([ name, data ]) => {\n      const bindings = data.map((binding) => ({\n        ref: {\n          type: 'action_name',\n          value: binding.action_name\n        },\n        display_name: binding.display_name\n      }));\n      await this.client.actions.updateTriggerBindings({ trigger_id: name }, { bindings });\n      this.didUpdate({ trigger_id: name });\n      this.updated += 1;\n    }));\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"0acb3d3fe5ff94701a54c2db4d8bedce44d14b98","contentHash":"35a9f7ecdeb782f24ac4ecccb4e766d12cc4a0aa03884e7f859be9b79470b328"},"/home/circleci/repo/src/tools/auth0/handlers/organizations.js":{"path":"/home/circleci/repo/src/tools/auth0/handlers/organizations.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":45}},"2":{"start":{"line":10,"column":14},"end":{"line":10,"column":31}},"3":{"start":{"line":12,"column":15},"end":{"line":12,"column":46}},"4":{"start":{"line":14,"column":15},"end":{"line":14,"column":35}},"5":{"start":{"line":16,"column":16},"end":{"line":16,"column":48}},"6":{"start":{"line":18,"column":13},"end":{"line":18,"column":35}},"7":{"start":{"line":20,"column":14},"end":{"line":20,"column":37}},"8":{"start":{"line":22,"column":15},"end":{"line":22,"column":46}},"9":{"start":{"line":24,"column":39},"end":{"line":24,"column":93}},"10":{"start":{"line":26,"column":99},"end":{"line":26,"column":101}},"11":{"start":{"line":26,"column":103},"end":{"line":26,"column":184}},"12":{"start":{"line":26,"column":152},"end":{"line":26,"column":180}},"13":{"start":{"line":26,"column":185},"end":{"line":26,"column":221}},"14":{"start":{"line":26,"column":222},"end":{"line":26,"column":262}},"15":{"start":{"line":26,"column":263},"end":{"line":26,"column":329}},"16":{"start":{"line":26,"column":306},"end":{"line":26,"column":327}},"17":{"start":{"line":26,"column":330},"end":{"line":26,"column":461}},"18":{"start":{"line":26,"column":402},"end":{"line":26,"column":451}},"19":{"start":{"line":26,"column":462},"end":{"line":26,"column":612}},"20":{"start":{"line":26,"column":508},"end":{"line":26,"column":580}},"21":{"start":{"line":26,"column":581},"end":{"line":26,"column":610}},"22":{"start":{"line":26,"column":613},"end":{"line":26,"column":709}},"23":{"start":{"line":26,"column":648},"end":{"line":26,"column":694}},"24":{"start":{"line":26,"column":695},"end":{"line":26,"column":707}},"25":{"start":{"line":26,"column":710},"end":{"line":26,"column":722}},"26":{"start":{"line":28,"column":15},"end":{"line":62,"column":1}},"27":{"start":{"line":63,"column":28},"end":{"line":256,"column":170}},"28":{"start":{"line":65,"column":4},"end":{"line":69,"column":7}},"29":{"start":{"line":73,"column":4},"end":{"line":75,"column":7}},"30":{"start":{"line":79,"column":4},"end":{"line":92,"column":5}},"31":{"start":{"line":80,"column":6},"end":{"line":88,"column":19}},"32":{"start":{"line":82,"column":27},"end":{"line":87,"column":10}},"33":{"start":{"line":83,"column":10},"end":{"line":83,"column":31}},"34":{"start":{"line":84,"column":10},"end":{"line":84,"column":28}},"35":{"start":{"line":86,"column":10},"end":{"line":86,"column":91}},"36":{"start":{"line":90,"column":6},"end":{"line":91,"column":57}},"37":{"start":{"line":91,"column":24},"end":{"line":91,"column":41}},"38":{"start":{"line":96,"column":25},"end":{"line":97,"column":5}},"39":{"start":{"line":98,"column":4},"end":{"line":98,"column":36}},"40":{"start":{"line":99,"column":20},"end":{"line":99,"column":72}},"41":{"start":{"line":101,"column":4},"end":{"line":105,"column":5}},"42":{"start":{"line":102,"column":6},"end":{"line":104,"column":17}},"43":{"start":{"line":102,"column":52},"end":{"line":104,"column":14}},"44":{"start":{"line":107,"column":4},"end":{"line":107,"column":19}},"45":{"start":{"line":111,"column":4},"end":{"line":119,"column":17}},"46":{"start":{"line":113,"column":25},"end":{"line":118,"column":8}},"47":{"start":{"line":114,"column":8},"end":{"line":114,"column":29}},"48":{"start":{"line":115,"column":8},"end":{"line":115,"column":26}},"49":{"start":{"line":117,"column":8},"end":{"line":117,"column":89}},"50":{"start":{"line":125,"column":8},"end":{"line":125,"column":78}},"51":{"start":{"line":125,"column":48},"end":{"line":125,"column":77}},"52":{"start":{"line":126,"column":19},"end":{"line":128,"column":5}},"53":{"start":{"line":131,"column":8},"end":{"line":131,"column":11}},"54":{"start":{"line":132,"column":4},"end":{"line":132,"column":27}},"55":{"start":{"line":133,"column":4},"end":{"line":133,"column":20}},"56":{"start":{"line":134,"column":4},"end":{"line":134,"column":18}},"57":{"start":{"line":135,"column":4},"end":{"line":135,"column":56}},"58":{"start":{"line":136,"column":32},"end":{"line":136,"column":124}},"59":{"start":{"line":136,"column":64},"end":{"line":136,"column":123}},"60":{"start":{"line":136,"column":87},"end":{"line":136,"column":122}},"61":{"start":{"line":137,"column":29},"end":{"line":137,"column":121}},"62":{"start":{"line":137,"column":53},"end":{"line":137,"column":120}},"63":{"start":{"line":137,"column":84},"end":{"line":137,"column":119}},"64":{"start":{"line":138,"column":32},"end":{"line":138,"column":188}},"65":{"start":{"line":138,"column":56},"end":{"line":138,"column":187}},"66":{"start":{"line":138,"column":86},"end":{"line":138,"column":186}},"67":{"start":{"line":139,"column":4},"end":{"line":146,"column":9}},"68":{"start":{"line":139,"column":54},"end":{"line":146,"column":6}},"69":{"start":{"line":145,"column":6},"end":{"line":145,"column":114}},"70":{"start":{"line":147,"column":4},"end":{"line":149,"column":9}},"71":{"start":{"line":147,"column":51},"end":{"line":149,"column":6}},"72":{"start":{"line":148,"column":6},"end":{"line":148,"column":112}},"73":{"start":{"line":150,"column":4},"end":{"line":155,"column":9}},"74":{"start":{"line":150,"column":54},"end":{"line":155,"column":6}},"75":{"start":{"line":154,"column":6},"end":{"line":154,"column":114}},"76":{"start":{"line":156,"column":4},"end":{"line":156,"column":18}},"77":{"start":{"line":160,"column":4},"end":{"line":168,"column":17}},"78":{"start":{"line":162,"column":25},"end":{"line":167,"column":8}},"79":{"start":{"line":163,"column":8},"end":{"line":163,"column":29}},"80":{"start":{"line":164,"column":8},"end":{"line":164,"column":26}},"81":{"start":{"line":166,"column":8},"end":{"line":166,"column":89}},"82":{"start":{"line":172,"column":4},"end":{"line":174,"column":5}},"83":{"start":{"line":173,"column":6},"end":{"line":173,"column":27}},"84":{"start":{"line":176,"column":4},"end":{"line":178,"column":5}},"85":{"start":{"line":177,"column":6},"end":{"line":177,"column":16}},"86":{"start":{"line":180,"column":4},"end":{"line":201,"column":5}},"87":{"start":{"line":181,"column":28},"end":{"line":184,"column":8}},"88":{"start":{"line":186,"column":6},"end":{"line":191,"column":7}},"89":{"start":{"line":186,"column":23},"end":{"line":186,"column":24}},"90":{"start":{"line":187,"column":28},"end":{"line":189,"column":10}},"91":{"start":{"line":190,"column":8},"end":{"line":190,"column":55}},"92":{"start":{"line":193,"column":6},"end":{"line":193,"column":36}},"93":{"start":{"line":194,"column":6},"end":{"line":194,"column":27}},"94":{"start":{"line":196,"column":6},"end":{"line":198,"column":7}},"95":{"start":{"line":197,"column":8},"end":{"line":197,"column":18}},"96":{"start":{"line":200,"column":6},"end":{"line":200,"column":16}},"97":{"start":{"line":207,"column":8},"end":{"line":207,"column":14}},"98":{"start":{"line":208,"column":4},"end":{"line":208,"column":31}},"99":{"start":{"line":208,"column":24},"end":{"line":208,"column":31}},"100":{"start":{"line":209,"column":21},"end":{"line":209,"column":41}},"101":{"start":{"line":210,"column":32},"end":{"line":213,"column":6}},"102":{"start":{"line":214,"column":4},"end":{"line":224,"column":7}},"103":{"start":{"line":215,"column":6},"end":{"line":223,"column":58}},"104":{"start":{"line":218,"column":12},"end":{"line":218,"column":22}},"105":{"start":{"line":219,"column":8},"end":{"line":219,"column":31}},"106":{"start":{"line":220,"column":8},"end":{"line":222,"column":10}},"107":{"start":{"line":221,"column":56},"end":{"line":221,"column":71}},"108":{"start":{"line":223,"column":30},"end":{"line":223,"column":56}},"109":{"start":{"line":225,"column":20},"end":{"line":225,"column":90}},"110":{"start":{"line":227,"column":4},"end":{"line":227,"column":169}},"111":{"start":{"line":229,"column":22},"end":{"line":235,"column":6}},"112":{"start":{"line":236,"column":4},"end":{"line":253,"column":8}},"113":{"start":{"line":237,"column":6},"end":{"line":252,"column":7}},"114":{"start":{"line":239,"column":10},"end":{"line":239,"column":53}},"115":{"start":{"line":240,"column":10},"end":{"line":240,"column":16}},"116":{"start":{"line":243,"column":10},"end":{"line":243,"column":57}},"117":{"start":{"line":244,"column":10},"end":{"line":244,"column":16}},"118":{"start":{"line":247,"column":10},"end":{"line":247,"column":66}},"119":{"start":{"line":248,"column":10},"end":{"line":248,"column":16}},"120":{"start":{"line":251,"column":10},"end":{"line":251,"column":16}},"121":{"start":{"line":257,"column":0},"end":{"line":257,"column":39}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":24,"column":9},"end":{"line":24,"column":31}},"loc":{"start":{"line":24,"column":37},"end":{"line":24,"column":95}},"line":24},"1":{"name":"_applyDecoratedDescriptor","decl":{"start":{"line":26,"column":9},"end":{"line":26,"column":34}},"loc":{"start":{"line":26,"column":86},"end":{"line":26,"column":724}},"line":26},"2":{"name":"(anonymous_2)","decl":{"start":{"line":26,"column":135},"end":{"line":26,"column":136}},"loc":{"start":{"line":26,"column":150},"end":{"line":26,"column":182}},"line":26},"3":{"name":"(anonymous_3)","decl":{"start":{"line":26,"column":373},"end":{"line":26,"column":374}},"loc":{"start":{"line":26,"column":400},"end":{"line":26,"column":453}},"line":26},"4":{"name":"(anonymous_4)","decl":{"start":{"line":64,"column":2},"end":{"line":64,"column":3}},"loc":{"start":{"line":64,"column":22},"end":{"line":70,"column":3}},"line":64},"5":{"name":"(anonymous_5)","decl":{"start":{"line":72,"column":2},"end":{"line":72,"column":3}},"loc":{"start":{"line":72,"column":32},"end":{"line":76,"column":3}},"line":72},"6":{"name":"(anonymous_6)","decl":{"start":{"line":78,"column":2},"end":{"line":78,"column":3}},"loc":{"start":{"line":78,"column":34},"end":{"line":93,"column":3}},"line":78},"7":{"name":"(anonymous_7)","decl":{"start":{"line":82,"column":19},"end":{"line":82,"column":20}},"loc":{"start":{"line":82,"column":27},"end":{"line":87,"column":10}},"line":82},"8":{"name":"(anonymous_8)","decl":{"start":{"line":82,"column":62},"end":{"line":82,"column":63}},"loc":{"start":{"line":82,"column":68},"end":{"line":85,"column":9}},"line":82},"9":{"name":"(anonymous_9)","decl":{"start":{"line":85,"column":17},"end":{"line":85,"column":18}},"loc":{"start":{"line":85,"column":24},"end":{"line":87,"column":9}},"line":85},"10":{"name":"(anonymous_10)","decl":{"start":{"line":91,"column":19},"end":{"line":91,"column":20}},"loc":{"start":{"line":91,"column":24},"end":{"line":91,"column":41}},"line":91},"11":{"name":"(anonymous_11)","decl":{"start":{"line":95,"column":2},"end":{"line":95,"column":3}},"loc":{"start":{"line":95,"column":32},"end":{"line":108,"column":3}},"line":95},"12":{"name":"(anonymous_12)","decl":{"start":{"line":102,"column":44},"end":{"line":102,"column":45}},"loc":{"start":{"line":102,"column":52},"end":{"line":104,"column":14}},"line":102},"13":{"name":"(anonymous_13)","decl":{"start":{"line":110,"column":2},"end":{"line":110,"column":3}},"loc":{"start":{"line":110,"column":37},"end":{"line":120,"column":3}},"line":110},"14":{"name":"(anonymous_14)","decl":{"start":{"line":113,"column":17},"end":{"line":113,"column":18}},"loc":{"start":{"line":113,"column":25},"end":{"line":118,"column":8}},"line":113},"15":{"name":"(anonymous_15)","decl":{"start":{"line":113,"column":60},"end":{"line":113,"column":61}},"loc":{"start":{"line":113,"column":68},"end":{"line":116,"column":7}},"line":113},"16":{"name":"(anonymous_16)","decl":{"start":{"line":116,"column":15},"end":{"line":116,"column":16}},"loc":{"start":{"line":116,"column":22},"end":{"line":118,"column":7}},"line":116},"17":{"name":"(anonymous_17)","decl":{"start":{"line":122,"column":2},"end":{"line":122,"column":3}},"loc":{"start":{"line":122,"column":47},"end":{"line":157,"column":3}},"line":122},"18":{"name":"(anonymous_18)","decl":{"start":{"line":125,"column":33},"end":{"line":125,"column":34}},"loc":{"start":{"line":125,"column":48},"end":{"line":125,"column":77}},"line":125},"19":{"name":"(anonymous_19)","decl":{"start":{"line":136,"column":59},"end":{"line":136,"column":60}},"loc":{"start":{"line":136,"column":64},"end":{"line":136,"column":123}},"line":136},"20":{"name":"(anonymous_20)","decl":{"start":{"line":136,"column":82},"end":{"line":136,"column":83}},"loc":{"start":{"line":136,"column":87},"end":{"line":136,"column":122}},"line":136},"21":{"name":"(anonymous_21)","decl":{"start":{"line":137,"column":48},"end":{"line":137,"column":49}},"loc":{"start":{"line":137,"column":53},"end":{"line":137,"column":120}},"line":137},"22":{"name":"(anonymous_22)","decl":{"start":{"line":137,"column":79},"end":{"line":137,"column":80}},"loc":{"start":{"line":137,"column":84},"end":{"line":137,"column":119}},"line":137},"23":{"name":"(anonymous_23)","decl":{"start":{"line":138,"column":51},"end":{"line":138,"column":52}},"loc":{"start":{"line":138,"column":56},"end":{"line":138,"column":187}},"line":138},"24":{"name":"(anonymous_24)","decl":{"start":{"line":138,"column":81},"end":{"line":138,"column":82}},"loc":{"start":{"line":138,"column":86},"end":{"line":138,"column":186}},"line":138},"25":{"name":"(anonymous_25)","decl":{"start":{"line":139,"column":46},"end":{"line":139,"column":47}},"loc":{"start":{"line":139,"column":54},"end":{"line":146,"column":6}},"line":139},"26":{"name":"(anonymous_26)","decl":{"start":{"line":144,"column":13},"end":{"line":144,"column":14}},"loc":{"start":{"line":144,"column":19},"end":{"line":146,"column":5}},"line":144},"27":{"name":"(anonymous_27)","decl":{"start":{"line":147,"column":43},"end":{"line":147,"column":44}},"loc":{"start":{"line":147,"column":51},"end":{"line":149,"column":6}},"line":147},"28":{"name":"(anonymous_28)","decl":{"start":{"line":147,"column":155},"end":{"line":147,"column":156}},"loc":{"start":{"line":147,"column":161},"end":{"line":149,"column":5}},"line":147},"29":{"name":"(anonymous_29)","decl":{"start":{"line":150,"column":46},"end":{"line":150,"column":47}},"loc":{"start":{"line":150,"column":54},"end":{"line":155,"column":6}},"line":150},"30":{"name":"(anonymous_30)","decl":{"start":{"line":153,"column":13},"end":{"line":153,"column":14}},"loc":{"start":{"line":153,"column":19},"end":{"line":155,"column":5}},"line":153},"31":{"name":"(anonymous_31)","decl":{"start":{"line":159,"column":2},"end":{"line":159,"column":3}},"loc":{"start":{"line":159,"column":43},"end":{"line":169,"column":3}},"line":159},"32":{"name":"(anonymous_32)","decl":{"start":{"line":162,"column":17},"end":{"line":162,"column":18}},"loc":{"start":{"line":162,"column":25},"end":{"line":167,"column":8}},"line":162},"33":{"name":"(anonymous_33)","decl":{"start":{"line":162,"column":66},"end":{"line":162,"column":67}},"loc":{"start":{"line":162,"column":74},"end":{"line":165,"column":7}},"line":162},"34":{"name":"(anonymous_34)","decl":{"start":{"line":165,"column":15},"end":{"line":165,"column":16}},"loc":{"start":{"line":165,"column":22},"end":{"line":167,"column":7}},"line":165},"35":{"name":"(anonymous_35)","decl":{"start":{"line":171,"column":2},"end":{"line":171,"column":3}},"loc":{"start":{"line":171,"column":18},"end":{"line":202,"column":3}},"line":171},"36":{"name":"(anonymous_36)","decl":{"start":{"line":204,"column":2},"end":{"line":204,"column":3}},"loc":{"start":{"line":204,"column":31},"end":{"line":254,"column":3}},"line":204},"37":{"name":"(anonymous_37)","decl":{"start":{"line":214,"column":26},"end":{"line":214,"column":27}},"loc":{"start":{"line":214,"column":33},"end":{"line":224,"column":5}},"line":214},"38":{"name":"(anonymous_38)","decl":{"start":{"line":215,"column":52},"end":{"line":215,"column":53}},"loc":{"start":{"line":215,"column":66},"end":{"line":223,"column":7}},"line":215},"39":{"name":"(anonymous_39)","decl":{"start":{"line":221,"column":51},"end":{"line":221,"column":52}},"loc":{"start":{"line":221,"column":56},"end":{"line":221,"column":71}},"line":221},"40":{"name":"(anonymous_40)","decl":{"start":{"line":223,"column":16},"end":{"line":223,"column":17}},"loc":{"start":{"line":223,"column":30},"end":{"line":223,"column":56}},"line":223},"41":{"name":"(anonymous_41)","decl":{"start":{"line":236,"column":36},"end":{"line":236,"column":37}},"loc":{"start":{"line":236,"column":52},"end":{"line":253,"column":5}},"line":236}},"branchMap":{"0":{"loc":{"start":{"line":24,"column":46},"end":{"line":24,"column":92}},"type":"cond-expr","locations":[{"start":{"line":24,"column":70},"end":{"line":24,"column":73}},{"start":{"line":24,"column":76},"end":{"line":24,"column":92}}],"line":24},"1":{"loc":{"start":{"line":24,"column":46},"end":{"line":24,"column":67}},"type":"binary-expr","locations":[{"start":{"line":24,"column":46},"end":{"line":24,"column":49}},{"start":{"line":24,"column":53},"end":{"line":24,"column":67}}],"line":24},"2":{"loc":{"start":{"line":26,"column":263},"end":{"line":26,"column":329}},"type":"if","locations":[{"start":{"line":26,"column":263},"end":{"line":26,"column":329}},{"start":{"line":26,"column":263},"end":{"line":26,"column":329}}],"line":26},"3":{"loc":{"start":{"line":26,"column":267},"end":{"line":26,"column":302}},"type":"binary-expr","locations":[{"start":{"line":26,"column":267},"end":{"line":26,"column":282}},{"start":{"line":26,"column":286},"end":{"line":26,"column":302}}],"line":26},"4":{"loc":{"start":{"line":26,"column":409},"end":{"line":26,"column":450}},"type":"binary-expr","locations":[{"start":{"line":26,"column":409},"end":{"line":26,"column":442}},{"start":{"line":26,"column":446},"end":{"line":26,"column":450}}],"line":26},"5":{"loc":{"start":{"line":26,"column":462},"end":{"line":26,"column":612}},"type":"if","locations":[{"start":{"line":26,"column":462},"end":{"line":26,"column":612}},{"start":{"line":26,"column":462},"end":{"line":26,"column":612}}],"line":26},"6":{"loc":{"start":{"line":26,"column":466},"end":{"line":26,"column":504}},"type":"binary-expr","locations":[{"start":{"line":26,"column":466},"end":{"line":26,"column":473}},{"start":{"line":26,"column":477},"end":{"line":26,"column":504}}],"line":26},"7":{"loc":{"start":{"line":26,"column":521},"end":{"line":26,"column":579}},"type":"cond-expr","locations":[{"start":{"line":26,"column":540},"end":{"line":26,"column":570}},{"start":{"line":26,"column":573},"end":{"line":26,"column":579}}],"line":26},"8":{"loc":{"start":{"line":26,"column":613},"end":{"line":26,"column":709}},"type":"if","locations":[{"start":{"line":26,"column":613},"end":{"line":26,"column":709}},{"start":{"line":26,"column":613},"end":{"line":26,"column":709}}],"line":26},"9":{"loc":{"start":{"line":79,"column":4},"end":{"line":92,"column":5}},"type":"if","locations":[{"start":{"line":79,"column":4},"end":{"line":92,"column":5}},{"start":{"line":79,"column":4},"end":{"line":92,"column":5}}],"line":79},"10":{"loc":{"start":{"line":79,"column":8},"end":{"line":79,"column":98}},"type":"binary-expr","locations":[{"start":{"line":79,"column":8},"end":{"line":79,"column":52}},{"start":{"line":79,"column":56},"end":{"line":79,"column":98}}],"line":79},"11":{"loc":{"start":{"line":81,"column":14},"end":{"line":81,"column":24}},"type":"binary-expr","locations":[{"start":{"line":81,"column":14},"end":{"line":81,"column":18}},{"start":{"line":81,"column":22},"end":{"line":81,"column":24}}],"line":81},"12":{"loc":{"start":{"line":101,"column":4},"end":{"line":105,"column":5}},"type":"if","locations":[{"start":{"line":101,"column":4},"end":{"line":105,"column":5}},{"start":{"line":101,"column":4},"end":{"line":105,"column":5}}],"line":101},"13":{"loc":{"start":{"line":101,"column":8},"end":{"line":101,"column":76}},"type":"binary-expr","locations":[{"start":{"line":101,"column":8},"end":{"line":101,"column":46}},{"start":{"line":101,"column":50},"end":{"line":101,"column":76}}],"line":101},"14":{"loc":{"start":{"line":112,"column":12},"end":{"line":112,"column":25}},"type":"binary-expr","locations":[{"start":{"line":112,"column":12},"end":{"line":112,"column":19}},{"start":{"line":112,"column":23},"end":{"line":112,"column":25}}],"line":112},"15":{"loc":{"start":{"line":138,"column":86},"end":{"line":138,"column":186}},"type":"binary-expr","locations":[{"start":{"line":138,"column":86},"end":{"line":138,"column":121}},{"start":{"line":138,"column":125},"end":{"line":138,"column":186}}],"line":138},"16":{"loc":{"start":{"line":161,"column":12},"end":{"line":161,"column":25}},"type":"binary-expr","locations":[{"start":{"line":161,"column":12},"end":{"line":161,"column":19}},{"start":{"line":161,"column":23},"end":{"line":161,"column":25}}],"line":161},"17":{"loc":{"start":{"line":172,"column":4},"end":{"line":174,"column":5}},"type":"if","locations":[{"start":{"line":172,"column":4},"end":{"line":174,"column":5}},{"start":{"line":172,"column":4},"end":{"line":174,"column":5}}],"line":172},"18":{"loc":{"start":{"line":176,"column":4},"end":{"line":178,"column":5}},"type":"if","locations":[{"start":{"line":176,"column":4},"end":{"line":178,"column":5}},{"start":{"line":176,"column":4},"end":{"line":178,"column":5}}],"line":176},"19":{"loc":{"start":{"line":176,"column":8},"end":{"line":176,"column":92}},"type":"binary-expr","locations":[{"start":{"line":176,"column":8},"end":{"line":176,"column":34}},{"start":{"line":176,"column":38},"end":{"line":176,"column":92}}],"line":176},"20":{"loc":{"start":{"line":196,"column":6},"end":{"line":198,"column":7}},"type":"if","locations":[{"start":{"line":196,"column":6},"end":{"line":198,"column":7}},{"start":{"line":196,"column":6},"end":{"line":198,"column":7}}],"line":196},"21":{"loc":{"start":{"line":196,"column":10},"end":{"line":196,"column":58}},"type":"binary-expr","locations":[{"start":{"line":196,"column":10},"end":{"line":196,"column":32}},{"start":{"line":196,"column":36},"end":{"line":196,"column":58}}],"line":196},"22":{"loc":{"start":{"line":208,"column":4},"end":{"line":208,"column":31}},"type":"if","locations":[{"start":{"line":208,"column":4},"end":{"line":208,"column":31}},{"start":{"line":208,"column":4},"end":{"line":208,"column":31}}],"line":208},"23":{"loc":{"start":{"line":215,"column":25},"end":{"line":215,"column":46}},"type":"binary-expr","locations":[{"start":{"line":215,"column":25},"end":{"line":215,"column":40}},{"start":{"line":215,"column":44},"end":{"line":215,"column":46}}],"line":215},"24":{"loc":{"start":{"line":221,"column":26},"end":{"line":221,"column":78}},"type":"binary-expr","locations":[{"start":{"line":221,"column":26},"end":{"line":221,"column":72}},{"start":{"line":221,"column":76},"end":{"line":221,"column":78}}],"line":221},"25":{"loc":{"start":{"line":237,"column":6},"end":{"line":252,"column":7}},"type":"switch","locations":[{"start":{"line":238,"column":8},"end":{"line":240,"column":16}},{"start":{"line":242,"column":8},"end":{"line":244,"column":16}},{"start":{"line":246,"column":8},"end":{"line":248,"column":16}},{"start":{"line":250,"column":8},"end":{"line":251,"column":16}}],"line":237},"26":{"loc":{"start":{"line":238,"column":13},"end":{"line":238,"column":48}},"type":"binary-expr","locations":[{"start":{"line":238,"column":13},"end":{"line":238,"column":23}},{"start":{"line":238,"column":27},"end":{"line":238,"column":48}}],"line":238},"27":{"loc":{"start":{"line":242,"column":13},"end":{"line":242,"column":54}},"type":"binary-expr","locations":[{"start":{"line":242,"column":13},"end":{"line":242,"column":26}},{"start":{"line":242,"column":30},"end":{"line":242,"column":54}}],"line":242},"28":{"loc":{"start":{"line":246,"column":13},"end":{"line":246,"column":54}},"type":"binary-expr","locations":[{"start":{"line":246,"column":13},"end":{"line":246,"column":26}},{"start":{"line":246,"column":30},"end":{"line":246,"column":54}}],"line":246}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":3,"10":1,"11":1,"12":4,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":0,"21":0,"22":1,"23":1,"24":1,"25":1,"26":1,"27":1,"28":125,"29":1,"30":1,"31":1,"32":1,"33":1,"34":1,"35":0,"36":0,"37":0,"38":2,"39":2,"40":2,"41":2,"42":1,"43":1,"44":2,"45":2,"46":2,"47":2,"48":2,"49":0,"50":4,"51":4,"52":4,"53":4,"54":4,"55":4,"56":4,"57":4,"58":4,"59":3,"60":3,"61":4,"62":3,"63":3,"64":4,"65":3,"66":3,"67":4,"68":1,"69":0,"70":4,"71":1,"72":0,"73":4,"74":1,"75":0,"76":4,"77":4,"78":4,"79":4,"80":4,"81":0,"82":18,"83":1,"84":17,"85":5,"86":12,"87":12,"88":9,"89":9,"90":97,"91":97,"92":9,"93":9,"94":3,"95":2,"96":1,"97":7,"98":7,"99":1,"100":6,"101":6,"102":6,"103":6,"104":5,"105":5,"106":5,"107":8,"108":5,"109":6,"110":6,"111":6,"112":6,"113":18,"114":1,"115":1,"116":2,"117":2,"118":4,"119":4,"120":11,"121":1},"f":{"0":3,"1":1,"2":4,"3":1,"4":125,"5":1,"6":1,"7":1,"8":1,"9":0,"10":0,"11":2,"12":1,"13":2,"14":2,"15":2,"16":0,"17":4,"18":4,"19":3,"20":3,"21":3,"22":3,"23":3,"24":3,"25":1,"26":0,"27":1,"28":0,"29":1,"30":0,"31":4,"32":4,"33":4,"34":0,"35":18,"36":7,"37":6,"38":5,"39":8,"40":5,"41":18},"b":{"0":[1,2],"1":[3,3],"2":[1,0],"3":[1,0],"4":[1,0],"5":[0,1],"6":[1,1],"7":[0,0],"8":[1,0],"9":[1,0],"10":[1,1],"11":[1,0],"12":[1,1],"13":[2,2],"14":[2,0],"15":[3,2],"16":[4,0],"17":[1,17],"18":[5,12],"19":[17,12],"20":[2,1],"21":[3,2],"22":[1,6],"23":[6,2],"24":[5,1],"25":[1,2,4,11],"26":[18,6],"27":[17,6],"28":[15,6]},"inputSourceMap":{"version":3,"sources":["organizations.js"],"names":["schema","type","items","properties","name","display_name","branding","metadata","connections","connection_id","assign_membership_on_login","required","OrganizationsHandler","DefaultHandler","constructor","config","id","identifiers","deleteOrganization","org","client","organizations","delete","deleteOrganizations","data","pool","addEachTask","generator","item","then","didDelete","deleted","catch","err","Error","objString","promise","log","warn","map","i","join","createOrganization","organization","created","create","length","Promise","all","conn","addEnabledConnection","createOrganizations","creates","didCreate","updateOrganization","existingConnections","find","orgToUpdate","params","update","connectionsToRemove","filter","c","x","connectionsToAdd","connectionsToUpdate","updateEnabledConnection","_","omit","removeEnabledConnection","updateOrganizations","updates","orgs","didUpdate","updated","getType","existing","getAll","paginate","include_totals","index","get","statusCode","processChanges","assets","forEach","connection","changes","debug","del","myChanges","change"],"mappings":";;;;;;;;;AAAA;;;;AACA;;;;AACA;;AACA;;;;;;;;AAEO,MAAMA,MAAM,WAANA,MAAM,GAAG;AACpBC,EAAAA,IAAI,EAAE,OADc;AAEpBC,EAAAA,KAAK,EAAE;AACLD,IAAAA,IAAI,EAAE,QADD;AAELE,IAAAA,UAAU,EAAE;AACVC,MAAAA,IAAI,EAAE;AAAEH,QAAAA,IAAI,EAAE;AAAR,OADI;AAEVI,MAAAA,YAAY,EAAE;AAAEJ,QAAAA,IAAI,EAAE;AAAR,OAFJ;AAGVK,MAAAA,QAAQ,EAAE;AAAEL,QAAAA,IAAI,EAAE;AAAR,OAHA;AAIVM,MAAAA,QAAQ,EAAE;AAAEN,QAAAA,IAAI,EAAE;AAAR,OAJA;AAKVO,MAAAA,WAAW,EAAE;AACXP,QAAAA,IAAI,EAAE,OADK;AAEXC,QAAAA,KAAK,EAAE;AACLD,UAAAA,IAAI,EAAE,QADD;AAELE,UAAAA,UAAU,EAAE;AACVM,YAAAA,aAAa,EAAE;AAAER,cAAAA,IAAI,EAAE;AAAR,aADL;AAEVS,YAAAA,0BAA0B,EAAE;AAAET,cAAAA,IAAI,EAAE;AAAR;AAFlB;AAFP;AAFI;AALH,KAFP;AAkBLU,IAAAA,QAAQ,EAAE,CAAE,MAAF;AAlBL;AAFa,CAAf;IAwBcC,oB,WAoIlB,oBAAM,IAAN,C,YApIY,MAAMA,oBAAN,SAAmCC,iBAAnC,CAAkD;AAC/DC,EAAAA,WAAW,CAACC,MAAD,EAAS;AAClB,UAAM,EACJ,GAAGA,MADC;AAEJd,MAAAA,IAAI,EAAE,eAFF;AAGJe,MAAAA,EAAE,EAAE,IAHA;AAIJC,MAAAA,WAAW,EAAE,CAAE,MAAF;AAJT,KAAN;AAMD;;AAEuB,QAAlBC,kBAAkB,CAACC,GAAD,EAAM;AAC5B,UAAM,KAAKC,MAAL,CAAYC,aAAZ,CAA0BC,MAA1B,CAAiC;AAAEN,MAAAA,EAAE,EAAEG,GAAG,CAACH;AAAV,KAAjC,CAAN;AACD;;AAEwB,QAAnBO,mBAAmB,CAACC,IAAD,EAAO;AAC9B,QAAI,KAAKT,MAAL,CAAY,oBAAZ,MAAsC,MAAtC,IAAgD,KAAKA,MAAL,CAAY,oBAAZ,MAAsC,IAA1F,EAAgG;AAC9F,YAAM,KAAKK,MAAL,CAAYK,IAAZ,CAAiBC,WAAjB,CAA6B;AACjCF,QAAAA,IAAI,EAAEA,IAAI,IAAI,EADmB;AAEjCG,QAAAA,SAAS,EAAGC,IAAD,IAAU,KAAKV,kBAAL,CAAwBU,IAAxB,EAA8BC,IAA9B,CAAmC,MAAM;AAC5D,eAAKC,SAAL,CAAeF,IAAf;AACA,eAAKG,OAAL,IAAgB,CAAhB;AACD,SAHoB,EAGlBC,KAHkB,CAGXC,GAAD,IAAS;AAChB,gBAAM,IAAIC,KAAJ,CAAW,oBAAmB,KAAKjC,IAAK,IAAG,KAAKkC,SAAL,CAAeP,IAAf,CAAqB,KAAIK,GAAI,EAAxE,CAAN;AACD,SALoB;AAFY,OAA7B,EAQHG,OARG,EAAN;AASD,KAVD,MAUO;AACLC,uBAAIC,IAAJ,CAAU;AAChB,UAAUd,IAAI,CAACe,GAAL,CAAUC,CAAD,IAAO,KAAKL,SAAL,CAAeK,CAAf,CAAhB,EAAmCC,IAAnC,CAAwC,IAAxC,CAA8C,EADlD;AAED;AACF;;AAEuB,QAAlBC,kBAAkB,CAACvB,GAAD,EAAM;AAC5B,UAAMwB,YAAY,GAAG,EAAE,GAAGxB;AAAL,KAArB;AACA,WAAOwB,YAAY,CAACnC,WAApB;AAEA,UAAMoC,OAAO,GAAG,MAAM,KAAKxB,MAAL,CAAYC,aAAZ,CAA0BwB,MAA1B,CAAiCF,YAAjC,CAAtB;;AAEA,QAAI,OAAOxB,GAAG,CAACX,WAAX,KAA2B,WAA3B,IAA0CW,GAAG,CAACX,WAAJ,CAAgBsC,MAAhB,GAAyB,CAAvE,EAA0E;AACxE,YAAMC,OAAO,CAACC,GAAR,CAAY7B,GAAG,CAACX,WAAJ,CAAgB+B,GAAhB,CAAqBU,IAAD,IAAU,KAAK7B,MAAL,CAAYC,aAAZ,CAA0B6B,oBAA1B,CAA+C;AAAElC,QAAAA,EAAE,EAAE4B,OAAO,CAAC5B;AAAd,OAA/C,EAAmEiC,IAAnE,CAA9B,CAAZ,CAAN;AACD;;AAED,WAAOL,OAAP;AACD;;AAEwB,QAAnBO,mBAAmB,CAACC,OAAD,EAAU;AACjC,UAAM,KAAKhC,MAAL,CAAYK,IAAZ,CAAiBC,WAAjB,CAA6B;AACjCF,MAAAA,IAAI,EAAE4B,OAAO,IAAI,EADgB;AAEjCzB,MAAAA,SAAS,EAAGC,IAAD,IAAU,KAAKc,kBAAL,CAAwBd,IAAxB,EAA8BC,IAA9B,CAAoCL,IAAD,IAAU;AAChE,aAAK6B,SAAL,CAAe7B,IAAf;AACA,aAAKoB,OAAL,IAAgB,CAAhB;AACD,OAHoB,EAGlBZ,KAHkB,CAGXC,GAAD,IAAS;AAChB,cAAM,IAAIC,KAAJ,CAAW,oBAAmB,KAAKjC,IAAK,IAAG,KAAKkC,SAAL,CAAeP,IAAf,CAAqB,KAAIK,GAAI,EAAxE,CAAN;AACD,OALoB;AAFY,KAA7B,EAQHG,OARG,EAAN;AASD;;AAEuB,QAAlBkB,kBAAkB,CAACnC,GAAD,EAAME,aAAN,EAAqB;AAC3C,UAAM;AAAEb,MAAAA,WAAW,EAAE+C;AAAf,QAAuC,MAAMlC,aAAa,CAACmC,IAAd,CAAoBC,WAAD,IAAiBA,WAAW,CAACrD,IAAZ,KAAqBe,GAAG,CAACf,IAA7D,CAAnD;AAEA,UAAMsD,MAAM,GAAG;AAAE1C,MAAAA,EAAE,EAAEG,GAAG,CAACH;AAAV,KAAf;AACA,UAAM;AAAER,MAAAA;AAAF,QAAkBW,GAAxB;AAEA,WAAOA,GAAG,CAACX,WAAX;AACA,WAAOW,GAAG,CAACf,IAAX;AACA,WAAOe,GAAG,CAACH,EAAX;AAEA,UAAM,KAAKI,MAAL,CAAYC,aAAZ,CAA0BsC,MAA1B,CAAiCD,MAAjC,EAAyCvC,GAAzC,CAAN;AAEA,UAAMyC,mBAAmB,GAAGL,mBAAmB,CAACM,MAApB,CAA4BC,CAAD,IAAO,CAACtD,WAAW,CAACgD,IAAZ,CAAkBO,CAAD,IAAOA,CAAC,CAACtD,aAAF,KAAoBqD,CAAC,CAACrD,aAA9C,CAAnC,CAA5B;AACA,UAAMuD,gBAAgB,GAAGxD,WAAW,CAACqD,MAAZ,CAAoBC,CAAD,IAAO,CAACP,mBAAmB,CAACC,IAApB,CAA0BO,CAAD,IAAOA,CAAC,CAACtD,aAAF,KAAoBqD,CAAC,CAACrD,aAAtD,CAA3B,CAAzB;AACA,UAAMwD,mBAAmB,GAAGzD,WAAW,CAACqD,MAAZ,CAAoBC,CAAD,IAAOP,mBAAmB,CAACC,IAApB,CAA0BO,CAAD,IAAOA,CAAC,CAACtD,aAAF,KAAoBqD,CAAC,CAACrD,aAAtB,IAAuCsD,CAAC,CAACrD,0BAAF,KAAiCoD,CAAC,CAACpD,0BAA1G,CAA1B,CAA5B;AAGA,UAAMqC,OAAO,CAACC,GAAR,CAAYiB,mBAAmB,CAAC1B,GAApB,CAAyBU,IAAD,IAAU,KAAK7B,MAAL,CAAYC,aAAZ,CACjD6C,uBADiD,CACzB;AAAEzD,MAAAA,aAAa,EAAEwC,IAAI,CAACxC,aAAtB;AAAqC,SAAGiD;AAAxC,KADyB,EACyB;AAAEhD,MAAAA,0BAA0B,EAAEuC,IAAI,CAACvC;AAAnC,KADzB,EAEjDsB,KAFiD,CAE3C,MAAM;AACX,YAAM,IAAIE,KAAJ,CAAW,uCAAsCe,IAAI,CAACxC,aAAc,sBAAqBiD,MAAM,CAAC1C,EAAG,EAAnG,CAAN;AACD,KAJiD,CAAlC,CAAZ,CAAN;AAMA,UAAM+B,OAAO,CAACC,GAAR,CAAYgB,gBAAgB,CAACzB,GAAjB,CAAsBU,IAAD,IAAU,KAAK7B,MAAL,CAAYC,aAAZ,CAC9C6B,oBAD8C,CACzBQ,MADyB,EACjBS,iBAAEC,IAAF,CAAOnB,IAAP,EAAa,YAAb,CADiB,EAE9CjB,KAF8C,CAExC,MAAM;AACX,YAAM,IAAIE,KAAJ,CAAW,qCAAoCe,IAAI,CAACxC,aAAc,sBAAqBiD,MAAM,CAAC1C,EAAG,EAAjG,CAAN;AACD,KAJ8C,CAA/B,CAAZ,CAAN;AAMA,UAAM+B,OAAO,CAACC,GAAR,CAAYY,mBAAmB,CAACrB,GAApB,CAAyBU,IAAD,IAAU,KAAK7B,MAAL,CAAYC,aAAZ,CACjDgD,uBADiD,CACzB;AAAE5D,MAAAA,aAAa,EAAEwC,IAAI,CAACxC,aAAtB;AAAqC,SAAGiD;AAAxC,KADyB,EAEjD1B,KAFiD,CAE3C,MAAM;AACX,YAAM,IAAIE,KAAJ,CAAW,uCAAsCe,IAAI,CAACxC,aAAc,sBAAqBiD,MAAM,CAAC1C,EAAG,EAAnG,CAAN;AACD,KAJiD,CAAlC,CAAZ,CAAN;AAMA,WAAO0C,MAAP;AACD;;AAEwB,QAAnBY,mBAAmB,CAACC,OAAD,EAAUC,IAAV,EAAgB;AACvC,UAAM,KAAKpD,MAAL,CAAYK,IAAZ,CAAiBC,WAAjB,CAA6B;AACjCF,MAAAA,IAAI,EAAE+C,OAAO,IAAI,EADgB;AAEjC5C,MAAAA,SAAS,EAAGC,IAAD,IAAU,KAAK0B,kBAAL,CAAwB1B,IAAxB,EAA8B4C,IAA9B,EAAoC3C,IAApC,CAA0CL,IAAD,IAAU;AACtE,aAAKiD,SAAL,CAAejD,IAAf;AACA,aAAKkD,OAAL,IAAgB,CAAhB;AACD,OAHoB,EAGlB1C,KAHkB,CAGXC,GAAD,IAAS;AAChB,cAAM,IAAIC,KAAJ,CAAW,oBAAmB,KAAKjC,IAAK,IAAG,KAAKkC,SAAL,CAAeP,IAAf,CAAqB,KAAIK,GAAI,EAAxE,CAAN;AACD,OALoB;AAFY,KAA7B,EAQHG,OARG,EAAN;AASD;;AAEY,QAAPuC,OAAO,GAAG;AACd,QAAI,KAAKC,QAAT,EAAmB;AACjB,aAAO,KAAKA,QAAZ;AACD;;AAED,QAAI,CAAC,KAAKxD,MAAL,CAAYC,aAAb,IAA8B,OAAO,KAAKD,MAAL,CAAYC,aAAZ,CAA0BwD,MAAjC,KAA4C,UAA9E,EAA0F;AACxF,aAAO,EAAP;AACD;;AAED,QAAI;AACF,YAAMxD,aAAa,GAAG,MAAM,KAAKD,MAAL,CAAYC,aAAZ,CAA0BwD,MAA1B,CAAiC;AAAEC,QAAAA,QAAQ,EAAE,IAAZ;AAAkBC,QAAAA,cAAc,EAAE;AAAlC,OAAjC,CAA5B;;AACA,WAAK,IAAIC,KAAK,GAAG,CAAjB,EAAoBA,KAAK,GAAG3D,aAAa,CAACyB,MAA1C,EAAkDkC,KAAK,EAAvD,EAA2D;AACzD,cAAMxE,WAAW,GAAG,MAAM,KAAKY,MAAL,CAAYC,aAAZ,CAA0Bb,WAA1B,CAAsCyE,GAAtC,CAA0C;AAAEjE,UAAAA,EAAE,EAAEK,aAAa,CAAC2D,KAAD,CAAb,CAAqBhE;AAA3B,SAA1C,CAA1B;AACAK,QAAAA,aAAa,CAAC2D,KAAD,CAAb,CAAqBxE,WAArB,GAAmCA,WAAnC;AACD;;AACD,WAAKoE,QAAL,GAAgBvD,aAAhB;AACA,aAAO,KAAKuD,QAAZ;AACD,KARD,CAQE,OAAO3C,GAAP,EAAY;AACZ,UAAIA,GAAG,CAACiD,UAAJ,KAAmB,GAAnB,IAA0BjD,GAAG,CAACiD,UAAJ,KAAmB,GAAjD,EAAsD;AACpD,eAAO,EAAP;AACD;;AACD,YAAMjD,GAAN;AACD;AACF;;AAImB,QAAdkD,cAAc,CAACC,MAAD,EAAS;AAC3B,UAAM;AAAE/D,MAAAA;AAAF,QAAoB+D,MAA1B;AAEA,QAAI,CAAC/D,aAAL,EAAoB;AAEpB,UAAMuD,QAAQ,GAAG,MAAM,KAAKD,OAAL,EAAvB;AACA,UAAMpB,mBAAmB,GAAG,MAAM,KAAKnC,MAAL,CAAYZ,WAAZ,CAAwBqE,MAAxB,CAA+B;AAAEC,MAAAA,QAAQ,EAAE,IAAZ;AAAkBC,MAAAA,cAAc,EAAE;AAAlC,KAA/B,CAAlC;AAGA1D,IAAAA,aAAa,CAACgE,OAAd,CAAuBlE,GAAD,IAAS;AAC7BA,MAAAA,GAAG,CAACX,WAAJ,GAAkB,CAACW,GAAG,CAACX,WAAJ,IAAmB,EAApB,EAAwB+B,GAAxB,CAA6B+C,UAAD,IAAgB;AAC5D,cAAM;AAAElF,UAAAA;AAAF,YAAWkF,UAAjB;AACA,eAAOA,UAAU,CAAClF,IAAlB;AAEA,eAAO,EACL,GAAGkF,UADE;AAEL7E,UAAAA,aAAa,EAAE,CAAC8C,mBAAmB,CAACC,IAApB,CAA0BM,CAAD,IAAOA,CAAC,CAAC1D,IAAF,KAAWA,IAA3C,KAAoD,EAArD,EAAyDY;AAFnE,SAAP;AAID,OARiB,EAQf6C,MARe,CAQPyB,UAAD,IAAgB,CAAC,CAACA,UAAU,CAAC7E,aARrB,CAAlB;AASD,KAVD;AAYA,UAAM8E,OAAO,GAAG,wBAAY,IAAZ,EAAkBlE,aAAlB,EAAiCuD,QAAjC,EAA2C,CAAE,IAAF,EAAQ,MAAR,CAA3C,CAAhB;;AAEAvC,qBAAImD,KAAJ,CAAW,kDAAiDD,OAAO,CAACE,GAAR,CAAY3C,MAAO,aAAYyC,OAAO,CAAC5B,MAAR,CAAeb,MAAO,cAAayC,OAAO,CAAC1C,MAAR,CAAeC,MAAO,GAApJ;;AAEA,UAAM4C,SAAS,GAAG,CAAE;AAAED,MAAAA,GAAG,EAAEF,OAAO,CAACE;AAAf,KAAF,EAAwB;AAAE5C,MAAAA,MAAM,EAAE0C,OAAO,CAAC1C;AAAlB,KAAxB,EAAoD;AAAEc,MAAAA,MAAM,EAAE4B,OAAO,CAAC5B;AAAlB,KAApD,CAAlB;AAEA,UAAMZ,OAAO,CAACC,GAAR,CAAY0C,SAAS,CAACnD,GAAV,CAAc,MAAOoD,MAAP,IAAkB;AAChD,cAAQ,IAAR;AACE,aAAKA,MAAM,CAACF,GAAP,IAAcE,MAAM,CAACF,GAAP,CAAW3C,MAAX,GAAoB,CAAvC;AACE,gBAAM,KAAKvB,mBAAL,CAAyBoE,MAAM,CAACF,GAAhC,CAAN;AACA;;AACF,aAAKE,MAAM,CAAC9C,MAAP,IAAiB8C,MAAM,CAAC9C,MAAP,CAAcC,MAAd,GAAuB,CAA7C;AACE,gBAAM,KAAKK,mBAAL,CAAyBoC,OAAO,CAAC1C,MAAjC,CAAN;AACA;;AACF,aAAK8C,MAAM,CAAChC,MAAP,IAAiBgC,MAAM,CAAChC,MAAP,CAAcb,MAAd,GAAuB,CAA7C;AACE,gBAAM,KAAKwB,mBAAL,CAAyBqB,MAAM,CAAChC,MAAhC,EAAwCiB,QAAxC,CAAN;AACA;;AACF;AACE;AAXJ;AAaD,KAdiB,CAAZ,CAAN;AAeD;;AA/K8D,C;kBAA5ChE,oB","sourceRoot":"/home/circleci/repo/src/tools/auth0/handlers/","sourcesContent":["import _ from 'lodash';\nimport DefaultHandler, { order } from './default';\nimport { calcChanges } from '../../utils';\nimport log from '../../logger';\n\nexport const schema = {\n  type: 'array',\n  items: {\n    type: 'object',\n    properties: {\n      name: { type: 'string' },\n      display_name: { type: 'string' },\n      branding: { type: 'object' },\n      metadata: { type: 'object' },\n      connections: {\n        type: 'array',\n        items: {\n          type: 'object',\n          properties: {\n            connection_id: { type: 'string' },\n            assign_membership_on_login: { type: 'boolean' }\n          }\n        }\n      }\n    },\n    required: [ 'name' ]\n  }\n};\n\nexport default class OrganizationsHandler extends DefaultHandler {\n  constructor(config) {\n    super({\n      ...config,\n      type: 'organizations',\n      id: 'id',\n      identifiers: [ 'name' ]\n    });\n  }\n\n  async deleteOrganization(org) {\n    await this.client.organizations.delete({ id: org.id });\n  }\n\n  async deleteOrganizations(data) {\n    if (this.config('AUTH0_ALLOW_DELETE') === 'true' || this.config('AUTH0_ALLOW_DELETE') === true) {\n      await this.client.pool.addEachTask({\n        data: data || [],\n        generator: (item) => this.deleteOrganization(item).then(() => {\n          this.didDelete(item);\n          this.deleted += 1;\n        }).catch((err) => {\n          throw new Error(`Problem deleting ${this.type} ${this.objString(item)}\\n${err}`);\n        })\n      }).promise();\n    } else {\n      log.warn(`Detected the following organizations should be deleted. Doing so may be destructive.\\nYou can enable deletes by setting 'AUTH0_ALLOW_DELETE' to true in the config\n      \\n${data.map((i) => this.objString(i)).join('\\n')}`);\n    }\n  }\n\n  async createOrganization(org) {\n    const organization = { ...org };\n    delete organization.connections;\n\n    const created = await this.client.organizations.create(organization);\n\n    if (typeof org.connections !== 'undefined' && org.connections.length > 0) {\n      await Promise.all(org.connections.map((conn) => this.client.organizations.addEnabledConnection({ id: created.id }, conn)));\n    }\n\n    return created;\n  }\n\n  async createOrganizations(creates) {\n    await this.client.pool.addEachTask({\n      data: creates || [],\n      generator: (item) => this.createOrganization(item).then((data) => {\n        this.didCreate(data);\n        this.created += 1;\n      }).catch((err) => {\n        throw new Error(`Problem creating ${this.type} ${this.objString(item)}\\n${err}`);\n      })\n    }).promise();\n  }\n\n  async updateOrganization(org, organizations) {\n    const { connections: existingConnections } = await organizations.find((orgToUpdate) => orgToUpdate.name === org.name);\n\n    const params = { id: org.id };\n    const { connections } = org;\n\n    delete org.connections;\n    delete org.name;\n    delete org.id;\n\n    await this.client.organizations.update(params, org);\n\n    const connectionsToRemove = existingConnections.filter((c) => !connections.find((x) => x.connection_id === c.connection_id));\n    const connectionsToAdd = connections.filter((c) => !existingConnections.find((x) => x.connection_id === c.connection_id));\n    const connectionsToUpdate = connections.filter((c) => existingConnections.find((x) => x.connection_id === c.connection_id && x.assign_membership_on_login !== c.assign_membership_on_login));\n\n    // Handle updates first\n    await Promise.all(connectionsToUpdate.map((conn) => this.client.organizations\n      .updateEnabledConnection({ connection_id: conn.connection_id, ...params }, { assign_membership_on_login: conn.assign_membership_on_login })\n      .catch(() => {\n        throw new Error(`Problem updating Enabled Connection ${conn.connection_id} for organizations ${params.id}`);\n      })));\n\n    await Promise.all(connectionsToAdd.map((conn) => this.client.organizations\n      .addEnabledConnection(params, _.omit(conn, 'connection'))\n      .catch(() => {\n        throw new Error(`Problem adding Enabled Connection ${conn.connection_id} for organizations ${params.id}`);\n      })));\n\n    await Promise.all(connectionsToRemove.map((conn) => this.client.organizations\n      .removeEnabledConnection({ connection_id: conn.connection_id, ...params })\n      .catch(() => {\n        throw new Error(`Problem removing Enabled Connection ${conn.connection_id} for organizations ${params.id}`);\n      })));\n\n    return params;\n  }\n\n  async updateOrganizations(updates, orgs) {\n    await this.client.pool.addEachTask({\n      data: updates || [],\n      generator: (item) => this.updateOrganization(item, orgs).then((data) => {\n        this.didUpdate(data);\n        this.updated += 1;\n      }).catch((err) => {\n        throw new Error(`Problem updating ${this.type} ${this.objString(item)}\\n${err}`);\n      })\n    }).promise();\n  }\n\n  async getType() {\n    if (this.existing) {\n      return this.existing;\n    }\n\n    if (!this.client.organizations || typeof this.client.organizations.getAll !== 'function') {\n      return [];\n    }\n\n    try {\n      const organizations = await this.client.organizations.getAll({ paginate: true, include_totals: true });\n      for (let index = 0; index < organizations.length; index++) {\n        const connections = await this.client.organizations.connections.get({ id: organizations[index].id });\n        organizations[index].connections = connections;\n      }\n      this.existing = organizations;\n      return this.existing;\n    } catch (err) {\n      if (err.statusCode === 404 || err.statusCode === 501) {\n        return [];\n      }\n      throw err;\n    }\n  }\n\n  // Run after connections\n  @order('70')\n  async processChanges(assets) {\n    const { organizations } = assets;\n    // Do nothing if not set\n    if (!organizations) return;\n    // Gets organizations from destination tenant\n    const existing = await this.getType();\n    const existingConnections = await this.client.connections.getAll({ paginate: true, include_totals: true });\n\n    // We need to get the connection ids for the names configured so we can link them together\n    organizations.forEach((org) => {\n      org.connections = (org.connections || []).map((connection) => {\n        const { name } = connection;\n        delete connection.name;\n\n        return {\n          ...connection,\n          connection_id: (existingConnections.find((c) => c.name === name) || {}).id\n        };\n      }).filter((connection) => !!connection.connection_id);\n    });\n\n    const changes = calcChanges(this, organizations, existing, [ 'id', 'name' ]);\n\n    log.debug(`Start processChanges for organizations [delete:${changes.del.length}] [update:${changes.update.length}], [create:${changes.create.length}]`);\n\n    const myChanges = [ { del: changes.del }, { create: changes.create }, { update: changes.update } ];\n\n    await Promise.all(myChanges.map(async (change) => {\n      switch (true) {\n        case change.del && change.del.length > 0:\n          await this.deleteOrganizations(change.del);\n          break;\n        case change.create && change.create.length > 0:\n          await this.createOrganizations(changes.create);\n          break;\n        case change.update && change.update.length > 0:\n          await this.updateOrganizations(change.update, existing);\n          break;\n        default:\n          break;\n      }\n    }));\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"e58b15e9766194cfe54e13ef7a2c864b7b427b78","contentHash":"da83ef3b1b2992fcc5faf7afef363bd753d8a9b9b636d892f3ffe9c92721381e"},"/home/circleci/repo/src/logger.js":{"path":"/home/circleci/repo/src/logger.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":15},"end":{"line":7,"column":33}},"2":{"start":{"line":9,"column":16},"end":{"line":9,"column":48}},"3":{"start":{"line":11,"column":39},"end":{"line":11,"column":93}},"4":{"start":{"line":13,"column":0},"end":{"line":13,"column":34}},"5":{"start":{"line":14,"column":12},"end":{"line":23,"column":2}},"6":{"start":{"line":24,"column":0},"end":{"line":24,"column":22}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":11,"column":9},"end":{"line":11,"column":31}},"loc":{"start":{"line":11,"column":37},"end":{"line":11,"column":95}},"line":11}},"branchMap":{"0":{"loc":{"start":{"line":11,"column":46},"end":{"line":11,"column":92}},"type":"cond-expr","locations":[{"start":{"line":11,"column":70},"end":{"line":11,"column":73}},{"start":{"line":11,"column":76},"end":{"line":11,"column":92}}],"line":11},"1":{"loc":{"start":{"line":11,"column":46},"end":{"line":11,"column":67}},"type":"binary-expr","locations":[{"start":{"line":11,"column":46},"end":{"line":11,"column":49}},{"start":{"line":11,"column":53},"end":{"line":11,"column":67}}],"line":11},"2":{"loc":{"start":{"line":17,"column":11},"end":{"line":17,"column":42}},"type":"binary-expr","locations":[{"start":{"line":17,"column":11},"end":{"line":17,"column":32}},{"start":{"line":17,"column":36},"end":{"line":17,"column":42}}],"line":17}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1},"f":{"0":1},"b":{"0":[0,1],"1":[1,1],"2":[1,1]},"inputSourceMap":{"version":3,"sources":["logger.js"],"names":["winston","emitErrs","log","Logger","transports","Console","timestamp","level","process","env","AUTH0_LOG","handleExceptions","json","colorize","exitOnError"],"mappings":";;;;;;AAAA;;;;;;AAEAA,kBAAQC,QAAR,GAAmB,IAAnB;AAEA,MAAMC,GAAG,GAAG,IAAIF,kBAAQG,MAAZ,CAAmB;AAC7BC,EAAAA,UAAU,EAAE,CACV,IAAIJ,kBAAQI,UAAR,CAAmBC,OAAvB,CAA+B;AAC7BC,IAAAA,SAAS,EAAE,IADkB;AAE7BC,IAAAA,KAAK,EAAEC,OAAO,CAACC,GAAR,CAAYC,SAAZ,IAAyB,MAFH;AAG7BC,IAAAA,gBAAgB,EAAE,IAHW;AAI7BC,IAAAA,IAAI,EAAE,KAJuB;AAK7BC,IAAAA,QAAQ,EAAE;AALmB,GAA/B,CADU,CADiB;AAU7BC,EAAAA,WAAW,EAAE;AAVgB,CAAnB,CAAZ;kBAaeZ,G","sourceRoot":"/home/circleci/repo/src/","sourcesContent":["import winston from 'winston';\n\nwinston.emitErrs = true;\n\nconst log = new winston.Logger({\n  transports: [\n    new winston.transports.Console({\n      timestamp: true,\n      level: process.env.AUTH0_LOG || 'info',\n      handleExceptions: true,\n      json: false,\n      colorize: true\n    })\n  ],\n  exitOnError: false\n});\n\nexport default log;\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"ad035a459362ae48749704c19020efbd873de46e","contentHash":"b46aa9bc56840edd9247f935fa8a4ef9c975377492a3265a4704883750889015"},"/home/circleci/repo/src/utils.js":{"path":"/home/circleci/repo/src/utils.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":34}},"2":{"start":{"line":7,"column":0},"end":{"line":7,"column":24}},"3":{"start":{"line":8,"column":0},"end":{"line":8,"column":28}},"4":{"start":{"line":9,"column":0},"end":{"line":9,"column":28}},"5":{"start":{"line":10,"column":0},"end":{"line":10,"column":28}},"6":{"start":{"line":11,"column":0},"end":{"line":11,"column":42}},"7":{"start":{"line":12,"column":0},"end":{"line":12,"column":32}},"8":{"start":{"line":13,"column":0},"end":{"line":13,"column":44}},"9":{"start":{"line":14,"column":0},"end":{"line":14,"column":28}},"10":{"start":{"line":15,"column":0},"end":{"line":15,"column":40}},"11":{"start":{"line":16,"column":0},"end":{"line":16,"column":38}},"12":{"start":{"line":17,"column":0},"end":{"line":17,"column":38}},"13":{"start":{"line":18,"column":0},"end":{"line":18,"column":44}},"14":{"start":{"line":19,"column":0},"end":{"line":19,"column":32}},"15":{"start":{"line":20,"column":0},"end":{"line":20,"column":46}},"16":{"start":{"line":21,"column":0},"end":{"line":21,"column":54}},"17":{"start":{"line":22,"column":0},"end":{"line":22,"column":56}},"18":{"start":{"line":24,"column":15},"end":{"line":24,"column":34}},"19":{"start":{"line":26,"column":16},"end":{"line":26,"column":48}},"20":{"start":{"line":28,"column":12},"end":{"line":28,"column":27}},"21":{"start":{"line":30,"column":13},"end":{"line":30,"column":42}},"22":{"start":{"line":32,"column":24},"end":{"line":32,"column":52}},"23":{"start":{"line":34,"column":25},"end":{"line":34,"column":66}},"24":{"start":{"line":36,"column":15},"end":{"line":36,"column":34}},"25":{"start":{"line":38,"column":16},"end":{"line":38,"column":48}},"26":{"start":{"line":40,"column":13},"end":{"line":40,"column":31}},"27":{"start":{"line":42,"column":14},"end":{"line":42,"column":33}},"28":{"start":{"line":44,"column":15},"end":{"line":44,"column":46}},"29":{"start":{"line":46,"column":39},"end":{"line":46,"column":93}},"30":{"start":{"line":49,"column":2},"end":{"line":53,"column":3}},"31":{"start":{"line":50,"column":4},"end":{"line":50,"column":79}},"32":{"start":{"line":52,"column":4},"end":{"line":52,"column":17}},"33":{"start":{"line":57,"column":2},"end":{"line":61,"column":3}},"34":{"start":{"line":58,"column":4},"end":{"line":58,"column":74}},"35":{"start":{"line":60,"column":4},"end":{"line":60,"column":17}},"36":{"start":{"line":65,"column":2},"end":{"line":67,"column":3}},"37":{"start":{"line":66,"column":4},"end":{"line":66,"column":157}},"38":{"start":{"line":66,"column":58},"end":{"line":66,"column":88}},"39":{"start":{"line":66,"column":102},"end":{"line":66,"column":155}},"40":{"start":{"line":69,"column":2},"end":{"line":69,"column":12}},"41":{"start":{"line":73,"column":2},"end":{"line":78,"column":3}},"42":{"start":{"line":74,"column":20},"end":{"line":74,"column":56}},"43":{"start":{"line":75,"column":4},"end":{"line":75,"column":31}},"44":{"start":{"line":77,"column":4},"end":{"line":77,"column":93}},"45":{"start":{"line":82,"column":2},"end":{"line":90,"column":3}},"46":{"start":{"line":83,"column":4},"end":{"line":83,"column":45}},"47":{"start":{"line":85,"column":21},"end":{"line":85,"column":54}},"48":{"start":{"line":87,"column":4},"end":{"line":87,"column":96}},"49":{"start":{"line":89,"column":4},"end":{"line":89,"column":91}},"50":{"start":{"line":94,"column":2},"end":{"line":100,"column":3}},"51":{"start":{"line":95,"column":4},"end":{"line":97,"column":5}},"52":{"start":{"line":96,"column":6},"end":{"line":96,"column":75}},"53":{"start":{"line":99,"column":4},"end":{"line":99,"column":16}},"54":{"start":{"line":102,"column":2},"end":{"line":102,"column":15}},"55":{"start":{"line":106,"column":2},"end":{"line":106,"column":26}},"56":{"start":{"line":106,"column":16},"end":{"line":106,"column":25}},"57":{"start":{"line":110,"column":18},"end":{"line":111,"column":3}},"58":{"start":{"line":112,"column":17},"end":{"line":112,"column":135}},"59":{"start":{"line":113,"column":2},"end":{"line":125,"column":5}},"60":{"start":{"line":114,"column":4},"end":{"line":114,"column":40}},"61":{"start":{"line":114,"column":33},"end":{"line":114,"column":40}},"62":{"start":{"line":115,"column":18},"end":{"line":115,"column":33}},"63":{"start":{"line":117,"column":4},"end":{"line":124,"column":5}},"64":{"start":{"line":118,"column":6},"end":{"line":123,"column":9}},"65":{"start":{"line":119,"column":23},"end":{"line":120,"column":9}},"66":{"start":{"line":121,"column":8},"end":{"line":121,"column":28}},"67":{"start":{"line":122,"column":8},"end":{"line":122,"column":22}},"68":{"start":{"line":126,"column":2},"end":{"line":126,"column":17}},"69":{"start":{"line":130,"column":2},"end":{"line":132,"column":5}},"70":{"start":{"line":136,"column":2},"end":{"line":138,"column":4}},"71":{"start":{"line":136,"column":31},"end":{"line":138,"column":4}},"72":{"start":{"line":139,"column":2},"end":{"line":141,"column":4}},"73":{"start":{"line":145,"column":2},"end":{"line":147,"column":3}},"74":{"start":{"line":146,"column":4},"end":{"line":146,"column":16}},"75":{"start":{"line":149,"column":26},"end":{"line":159,"column":3}},"76":{"start":{"line":160,"column":17},"end":{"line":161,"column":3}},"77":{"start":{"line":162,"column":2},"end":{"line":164,"column":5}},"78":{"start":{"line":163,"column":4},"end":{"line":163,"column":24}},"79":{"start":{"line":165,"column":2},"end":{"line":167,"column":5}},"80":{"start":{"line":166,"column":4},"end":{"line":166,"column":49}},"81":{"start":{"line":166,"column":30},"end":{"line":166,"column":49}},"82":{"start":{"line":168,"column":2},"end":{"line":168,"column":16}},"83":{"start":{"line":172,"column":26},"end":{"line":172,"column":66}},"84":{"start":{"line":174,"column":2},"end":{"line":180,"column":3}},"85":{"start":{"line":174,"column":15},"end":{"line":174,"column":16}},"86":{"start":{"line":175,"column":16},"end":{"line":175,"column":34}},"87":{"start":{"line":177,"column":4},"end":{"line":179,"column":5}},"88":{"start":{"line":178,"column":6},"end":{"line":178,"column":38}},"89":{"start":{"line":182,"column":2},"end":{"line":182,"column":11}},"90":{"start":{"line":186,"column":2},"end":{"line":188,"column":3}},"91":{"start":{"line":187,"column":4},"end":{"line":187,"column":24}},"92":{"start":{"line":192,"column":2},"end":{"line":194,"column":3}},"93":{"start":{"line":193,"column":4},"end":{"line":193,"column":45}},"94":{"start":{"line":198,"column":23},"end":{"line":198,"column":97}},"95":{"start":{"line":199,"column":2},"end":{"line":203,"column":5}},"96":{"start":{"line":200,"column":4},"end":{"line":202,"column":5}},"97":{"start":{"line":201,"column":6},"end":{"line":201,"column":24}},"98":{"start":{"line":204,"column":2},"end":{"line":204,"column":16}},"99":{"start":{"line":208,"column":2},"end":{"line":213,"column":3}},"100":{"start":{"line":209,"column":18},"end":{"line":209,"column":66}},"101":{"start":{"line":209,"column":41},"end":{"line":209,"column":65}},"102":{"start":{"line":210,"column":4},"end":{"line":210,"column":43}},"103":{"start":{"line":212,"column":4},"end":{"line":212,"column":20}},"104":{"start":{"line":217,"column":2},"end":{"line":217,"column":163}},"105":{"start":{"line":217,"column":52},"end":{"line":217,"column":97}},"106":{"start":{"line":217,"column":115},"end":{"line":217,"column":161}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":46,"column":9},"end":{"line":46,"column":31}},"loc":{"start":{"line":46,"column":37},"end":{"line":46,"column":95}},"line":46},"1":{"name":"isDirectory","decl":{"start":{"line":48,"column":9},"end":{"line":48,"column":20}},"loc":{"start":{"line":48,"column":24},"end":{"line":54,"column":1}},"line":48},"2":{"name":"isFile","decl":{"start":{"line":56,"column":9},"end":{"line":56,"column":15}},"loc":{"start":{"line":56,"column":19},"end":{"line":62,"column":1}},"line":56},"3":{"name":"getFiles","decl":{"start":{"line":64,"column":9},"end":{"line":64,"column":17}},"loc":{"start":{"line":64,"column":32},"end":{"line":70,"column":1}},"line":64},"4":{"name":"(anonymous_4)","decl":{"start":{"line":66,"column":53},"end":{"line":66,"column":54}},"loc":{"start":{"line":66,"column":58},"end":{"line":66,"column":88}},"line":66},"5":{"name":"(anonymous_5)","decl":{"start":{"line":66,"column":97},"end":{"line":66,"column":98}},"loc":{"start":{"line":66,"column":102},"end":{"line":66,"column":155}},"line":66},"6":{"name":"loadJSON","decl":{"start":{"line":72,"column":9},"end":{"line":72,"column":17}},"loc":{"start":{"line":72,"column":34},"end":{"line":79,"column":1}},"line":72},"7":{"name":"dumpJSON","decl":{"start":{"line":81,"column":9},"end":{"line":81,"column":17}},"loc":{"start":{"line":81,"column":34},"end":{"line":91,"column":1}},"line":81},"8":{"name":"existsMustBeDir","decl":{"start":{"line":93,"column":9},"end":{"line":93,"column":24}},"loc":{"start":{"line":93,"column":33},"end":{"line":103,"column":1}},"line":93},"9":{"name":"toConfigFn","decl":{"start":{"line":105,"column":9},"end":{"line":105,"column":19}},"loc":{"start":{"line":105,"column":26},"end":{"line":107,"column":1}},"line":105},"10":{"name":"(anonymous_10)","decl":{"start":{"line":106,"column":9},"end":{"line":106,"column":10}},"loc":{"start":{"line":106,"column":16},"end":{"line":106,"column":25}},"line":106},"11":{"name":"stripIdentifiers","decl":{"start":{"line":109,"column":9},"end":{"line":109,"column":25}},"loc":{"start":{"line":109,"column":41},"end":{"line":127,"column":1}},"line":109},"12":{"name":"(anonymous_12)","decl":{"start":{"line":113,"column":25},"end":{"line":113,"column":26}},"loc":{"start":{"line":113,"column":30},"end":{"line":125,"column":3}},"line":113},"13":{"name":"(anonymous_13)","decl":{"start":{"line":118,"column":34},"end":{"line":118,"column":35}},"loc":{"start":{"line":118,"column":39},"end":{"line":123,"column":7}},"line":118},"14":{"name":"sanitize","decl":{"start":{"line":129,"column":9},"end":{"line":129,"column":17}},"loc":{"start":{"line":129,"column":23},"end":{"line":133,"column":1}},"line":129},"15":{"name":"hoursAsInteger","decl":{"start":{"line":135,"column":9},"end":{"line":135,"column":23}},"loc":{"start":{"line":135,"column":41},"end":{"line":142,"column":1}},"line":135},"16":{"name":"formatResults","decl":{"start":{"line":144,"column":9},"end":{"line":144,"column":22}},"loc":{"start":{"line":144,"column":29},"end":{"line":169,"column":1}},"line":144},"17":{"name":"(anonymous_17)","decl":{"start":{"line":162,"column":38},"end":{"line":162,"column":39}},"loc":{"start":{"line":162,"column":56},"end":{"line":164,"column":3}},"line":162},"18":{"name":"(anonymous_18)","decl":{"start":{"line":165,"column":39},"end":{"line":165,"column":40}},"loc":{"start":{"line":165,"column":46},"end":{"line":167,"column":3}},"line":165},"19":{"name":"recordsSorter","decl":{"start":{"line":171,"column":9},"end":{"line":171,"column":22}},"loc":{"start":{"line":171,"column":29},"end":{"line":183,"column":1}},"line":171},"20":{"name":"clearTenantFlags","decl":{"start":{"line":185,"column":9},"end":{"line":185,"column":25}},"loc":{"start":{"line":185,"column":34},"end":{"line":189,"column":1}},"line":185},"21":{"name":"ensureProp","decl":{"start":{"line":191,"column":9},"end":{"line":191,"column":19}},"loc":{"start":{"line":191,"column":44},"end":{"line":195,"column":1}},"line":191},"22":{"name":"clearClientArrays","decl":{"start":{"line":197,"column":9},"end":{"line":197,"column":26}},"loc":{"start":{"line":197,"column":35},"end":{"line":205,"column":1}},"line":197},"23":{"name":"(anonymous_23)","decl":{"start":{"line":199,"column":30},"end":{"line":199,"column":31}},"loc":{"start":{"line":199,"column":38},"end":{"line":203,"column":3}},"line":199},"24":{"name":"convertClientIdToName","decl":{"start":{"line":207,"column":9},"end":{"line":207,"column":30}},"loc":{"start":{"line":207,"column":60},"end":{"line":214,"column":1}},"line":207},"25":{"name":"(anonymous_25)","decl":{"start":{"line":209,"column":36},"end":{"line":209,"column":37}},"loc":{"start":{"line":209,"column":41},"end":{"line":209,"column":65}},"line":209},"26":{"name":"mapClientID2NameSorted","decl":{"start":{"line":216,"column":9},"end":{"line":216,"column":31}},"loc":{"start":{"line":216,"column":62},"end":{"line":218,"column":1}},"line":216},"27":{"name":"(anonymous_27)","decl":{"start":{"line":217,"column":40},"end":{"line":217,"column":41}},"loc":{"start":{"line":217,"column":52},"end":{"line":217,"column":97}},"line":217},"28":{"name":"(anonymous_28)","decl":{"start":{"line":217,"column":105},"end":{"line":217,"column":106}},"loc":{"start":{"line":217,"column":115},"end":{"line":217,"column":161}},"line":217}},"branchMap":{"0":{"loc":{"start":{"line":46,"column":46},"end":{"line":46,"column":92}},"type":"cond-expr","locations":[{"start":{"line":46,"column":70},"end":{"line":46,"column":73}},{"start":{"line":46,"column":76},"end":{"line":46,"column":92}}],"line":46},"1":{"loc":{"start":{"line":46,"column":46},"end":{"line":46,"column":67}},"type":"binary-expr","locations":[{"start":{"line":46,"column":46},"end":{"line":46,"column":49}},{"start":{"line":46,"column":53},"end":{"line":46,"column":67}}],"line":46},"2":{"loc":{"start":{"line":65,"column":2},"end":{"line":67,"column":3}},"type":"if","locations":[{"start":{"line":65,"column":2},"end":{"line":67,"column":3}},{"start":{"line":65,"column":2},"end":{"line":67,"column":3}}],"line":65},"3":{"loc":{"start":{"line":66,"column":102},"end":{"line":66,"column":155}},"type":"binary-expr","locations":[{"start":{"line":66,"column":102},"end":{"line":66,"column":111}},{"start":{"line":66,"column":115},"end":{"line":66,"column":155}}],"line":66},"4":{"loc":{"start":{"line":87,"column":42},"end":{"line":87,"column":94}},"type":"cond-expr","locations":[{"start":{"line":87,"column":68},"end":{"line":87,"column":76}},{"start":{"line":87,"column":79},"end":{"line":87,"column":94}}],"line":87},"5":{"loc":{"start":{"line":94,"column":2},"end":{"line":100,"column":3}},"type":"if","locations":[{"start":{"line":94,"column":2},"end":{"line":100,"column":3}},{"start":{"line":94,"column":2},"end":{"line":100,"column":3}}],"line":94},"6":{"loc":{"start":{"line":95,"column":4},"end":{"line":97,"column":5}},"type":"if","locations":[{"start":{"line":95,"column":4},"end":{"line":97,"column":5}},{"start":{"line":95,"column":4},"end":{"line":97,"column":5}}],"line":95},"7":{"loc":{"start":{"line":114,"column":4},"end":{"line":114,"column":40}},"type":"if","locations":[{"start":{"line":114,"column":4},"end":{"line":114,"column":40}},{"start":{"line":114,"column":4},"end":{"line":114,"column":40}}],"line":114},"8":{"loc":{"start":{"line":117,"column":4},"end":{"line":124,"column":5}},"type":"if","locations":[{"start":{"line":117,"column":4},"end":{"line":124,"column":5}},{"start":{"line":117,"column":4},"end":{"line":124,"column":5}}],"line":117},"9":{"loc":{"start":{"line":136,"column":2},"end":{"line":138,"column":4}},"type":"if","locations":[{"start":{"line":136,"column":2},"end":{"line":138,"column":4}},{"start":{"line":136,"column":2},"end":{"line":138,"column":4}}],"line":136},"10":{"loc":{"start":{"line":145,"column":2},"end":{"line":147,"column":3}},"type":"if","locations":[{"start":{"line":145,"column":2},"end":{"line":147,"column":3}},{"start":{"line":145,"column":2},"end":{"line":147,"column":3}}],"line":145},"11":{"loc":{"start":{"line":166,"column":4},"end":{"line":166,"column":49}},"type":"if","locations":[{"start":{"line":166,"column":4},"end":{"line":166,"column":49}},{"start":{"line":166,"column":4},"end":{"line":166,"column":49}}],"line":166},"12":{"loc":{"start":{"line":177,"column":4},"end":{"line":179,"column":5}},"type":"if","locations":[{"start":{"line":177,"column":4},"end":{"line":179,"column":5}},{"start":{"line":177,"column":4},"end":{"line":179,"column":5}}],"line":177},"13":{"loc":{"start":{"line":177,"column":8},"end":{"line":177,"column":24}},"type":"binary-expr","locations":[{"start":{"line":177,"column":8},"end":{"line":177,"column":14}},{"start":{"line":177,"column":18},"end":{"line":177,"column":24}}],"line":177},"14":{"loc":{"start":{"line":178,"column":13},"end":{"line":178,"column":37}},"type":"cond-expr","locations":[{"start":{"line":178,"column":31},"end":{"line":178,"column":32}},{"start":{"line":178,"column":35},"end":{"line":178,"column":37}}],"line":178},"15":{"loc":{"start":{"line":186,"column":2},"end":{"line":188,"column":3}},"type":"if","locations":[{"start":{"line":186,"column":2},"end":{"line":188,"column":3}},{"start":{"line":186,"column":2},"end":{"line":188,"column":3}}],"line":186},"16":{"loc":{"start":{"line":186,"column":6},"end":{"line":186,"column":55}},"type":"binary-expr","locations":[{"start":{"line":186,"column":6},"end":{"line":186,"column":18}},{"start":{"line":186,"column":22},"end":{"line":186,"column":55}}],"line":186},"17":{"loc":{"start":{"line":191,"column":32},"end":{"line":191,"column":42}},"type":"default-arg","locations":[{"start":{"line":191,"column":40},"end":{"line":191,"column":42}}],"line":191},"18":{"loc":{"start":{"line":192,"column":2},"end":{"line":194,"column":3}},"type":"if","locations":[{"start":{"line":192,"column":2},"end":{"line":194,"column":3}},{"start":{"line":192,"column":2},"end":{"line":194,"column":3}}],"line":192},"19":{"loc":{"start":{"line":200,"column":4},"end":{"line":202,"column":5}},"type":"if","locations":[{"start":{"line":200,"column":4},"end":{"line":202,"column":5}},{"start":{"line":200,"column":4},"end":{"line":202,"column":5}}],"line":200},"20":{"loc":{"start":{"line":200,"column":8},"end":{"line":200,"column":56}},"type":"binary-expr","locations":[{"start":{"line":200,"column":8},"end":{"line":200,"column":39}},{"start":{"line":200,"column":43},"end":{"line":200,"column":56}}],"line":200},"21":{"loc":{"start":{"line":207,"column":41},"end":{"line":207,"column":58}},"type":"default-arg","locations":[{"start":{"line":207,"column":56},"end":{"line":207,"column":58}}],"line":207},"22":{"loc":{"start":{"line":210,"column":11},"end":{"line":210,"column":42}},"type":"binary-expr","locations":[{"start":{"line":210,"column":11},"end":{"line":210,"column":16}},{"start":{"line":210,"column":20},"end":{"line":210,"column":30}},{"start":{"line":210,"column":34},"end":{"line":210,"column":42}}],"line":210},"23":{"loc":{"start":{"line":217,"column":14},"end":{"line":217,"column":34}},"type":"binary-expr","locations":[{"start":{"line":217,"column":14},"end":{"line":217,"column":28}},{"start":{"line":217,"column":32},"end":{"line":217,"column":34}}],"line":217}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1,"24":1,"25":1,"26":1,"27":1,"28":1,"29":5,"30":252,"31":252,"32":4,"33":232,"34":232,"35":123,"36":30,"37":30,"38":88,"39":88,"40":0,"41":110,"42":110,"43":109,"44":1,"45":48,"46":48,"47":48,"48":48,"49":1,"50":1045,"51":156,"52":14,"53":142,"54":889,"55":34,"56":5,"57":4,"58":4,"59":4,"60":100,"61":24,"62":76,"63":76,"64":34,"65":10,"66":10,"67":10,"68":4,"69":74,"70":6,"71":1,"72":5,"73":82,"74":1,"75":81,"76":81,"77":81,"78":218,"79":81,"80":729,"81":658,"82":81,"83":118,"84":118,"85":118,"86":463,"87":463,"88":118,"89":0,"90":10,"91":4,"92":4,"93":0,"94":13,"95":13,"96":50,"97":4,"98":13,"99":33,"100":33,"101":25,"102":28,"103":5,"104":20,"105":20,"106":17},"f":{"0":5,"1":252,"2":232,"3":30,"4":88,"5":88,"6":110,"7":48,"8":1045,"9":34,"10":5,"11":4,"12":100,"13":10,"14":74,"15":6,"16":82,"17":218,"18":729,"19":118,"20":10,"21":4,"22":13,"23":50,"24":33,"25":25,"26":20,"27":20,"28":17},"b":{"0":[1,4],"1":[5,5],"2":[30,0],"3":[88,88],"4":[0,48],"5":[156,889],"6":[14,142],"7":[24,76],"8":[34,42],"9":[1,5],"10":[1,81],"11":[658,71],"12":[118,345],"13":[463,118],"14":[48,70],"15":[4,6],"16":[10,4],"17":[4],"18":[0,4],"19":[4,46],"20":[50,8],"21":[13],"22":[28,6,22],"23":[20,1]},"inputSourceMap":{"version":3,"sources":["utils.js"],"names":["isDirectory","isFile","getFiles","loadJSON","dumpJSON","existsMustBeDir","toConfigFn","stripIdentifiers","sanitize","hoursAsInteger","formatResults","recordsSorter","clearTenantFlags","ensureProp","clearClientArrays","convertClientIdToName","mapClientID2NameSorted","f","fs","statSync","path","resolve","err","folder","exts","readdirSync","map","join","filter","includes","extname","file","mappings","content","JSON","parse","e","Error","message","log","info","jsonBody","stringify","writeFileSync","endsWith","existsSync","data","key","auth0","assets","updated","ignore","handlers","forEach","h","type","exist","Array","isArray","o","newObj","id","str","replacement","property","hours","Number","isInteger","Math","round","item","importantFields","name","client_id","audience","template","identifier","strategy","script","stage","result","Object","entries","sort","value","keys","a","b","i","length","tenant","flags","obj","props","dotProp","has","set","client","propsToClear","prop","indexOf","clientId","knownClients","found","find","c","enabledClients","toLowerCase","localeCompare"],"mappings":"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","sourceRoot":"/home/circleci/repo/src/","sourcesContent":["import fs from 'fs-extra';\nimport path from 'path';\nimport sanitizeName from 'sanitize-filename';\nimport dotProp from 'dot-prop';\nimport { loadFile } from './tools';\nimport log from './logger';\n\nexport function isDirectory(f) {\n  try {\n    return fs.statSync(path.resolve(f))\n      .isDirectory();\n  } catch (err) {\n    return false;\n  }\n}\n\nexport function isFile(f) {\n  try {\n    return fs.statSync(path.resolve(f))\n      .isFile();\n  } catch (err) {\n    return false;\n  }\n}\n\nexport function getFiles(folder, exts) {\n  if (isDirectory(folder)) {\n    return fs.readdirSync(folder)\n      .map((f) => path.join(folder, f))\n      .filter((f) => isFile(f) && exts.includes(path.extname(f)));\n  }\n  return [];\n}\n\nexport function loadJSON(file, mappings) {\n  try {\n    const content = loadFile(file, mappings);\n    return JSON.parse(content);\n  } catch (e) {\n    throw new Error(`Error parsing JSON from metadata file: ${file}, because: ${e.message}`);\n  }\n}\n\nexport function dumpJSON(file, mappings) {\n  try {\n    log.info(`Writing ${file}`);\n    const jsonBody = JSON.stringify(mappings, null, 2);\n    fs.writeFileSync(\n      file,\n      jsonBody.endsWith('\\n') ? jsonBody : `${jsonBody}\\n`\n    );\n  } catch (e) {\n    throw new Error(`Error writing JSON to metadata file: ${file}, because: ${e.message}`);\n  }\n}\n\nexport function existsMustBeDir(folder) {\n  if (fs.existsSync(folder)) {\n    if (!isDirectory(folder)) {\n      throw new Error(`Expected ${folder} to be a folder but got a file?`);\n    }\n    return true;\n  }\n  return false;\n}\n\nexport function toConfigFn(data) {\n  return (key) => data[key];\n}\n\nexport function stripIdentifiers(auth0, assets) {\n  const updated = { ...assets };\n\n  // Some of the object identifiers are required to perform updates.\n  // Don't strip these object id's\n  const ignore = [\n    'actions',\n    'rulesConfigs',\n    'emailTemplates',\n    'guardianFactors',\n    'guardianFactorProviders',\n    'guardianFactorTemplates'\n  ];\n\n  // Optionally Strip identifiers\n  auth0.handlers.forEach((h) => {\n    if (ignore.includes(h.type)) return;\n    const exist = updated[h.type];\n    // All objects with the identifier field is an array. This could change in future.\n    if (Array.isArray(exist)) {\n      updated[h.type] = exist.map((o) => {\n        const newObj = { ...o };\n        delete newObj[h.id];\n        return newObj;\n      });\n    }\n  });\n\n  return updated;\n}\n\nexport function sanitize(str) {\n  return sanitizeName(str, { replacement: '-' });\n}\n\nexport function hoursAsInteger(property, hours) {\n  if (Number.isInteger(hours)) return { [property]: hours };\n  return { [`${property}_in_minutes`]: Math.round(hours * 60) };\n}\n\nexport function formatResults(item) {\n  if (typeof item !== 'object') {\n    return item;\n  }\n  const importantFields = {\n    name: null,\n    client_id: null,\n    audience: null,\n    template: null,\n    identifier: null,\n    strategy: null,\n    script: null,\n    stage: null,\n    id: null\n  };\n  const result = { ...importantFields };\n\n  Object.entries(item).sort().forEach(([ key, value ]) => {\n    result[key] = value;\n  });\n\n  Object.keys(importantFields).forEach((key) => {\n    if (result[key] === null) delete result[key];\n  });\n\n  return result;\n}\n\nexport function recordsSorter(a, b) {\n  const importantFields = [\n    'name',\n    'key',\n    'client_id',\n    'template'\n  ];\n\n  for (let i = 0; i < importantFields.length; i += 1) {\n    const key = importantFields[i];\n\n    if (a[key] && b[key]) {\n      return a[key] > b[key] ? 1 : -1;\n    }\n  }\n\n  return 0;\n}\n\nexport function clearTenantFlags(tenant) {\n  if (tenant.flags && !Object.keys(tenant.flags).length) {\n    delete tenant.flags;\n  }\n}\n\nexport function ensureProp(obj, props, value = '') {\n  if (!dotProp.has(obj, props)) {\n    dotProp.set(obj, props, value);\n  }\n}\n\nexport function clearClientArrays(client) {\n  const propsToClear = [ 'allowed_clients', 'allowed_logout_urls', 'allowed_origins', 'callbacks' ];\n  Object.keys(client).forEach((prop) => {\n    if (propsToClear.indexOf(prop) >= 0 && !client[prop]) {\n      client[prop] = [];\n    }\n  });\n\n  return client;\n}\n\nexport function convertClientIdToName(clientId, knownClients = []) {\n  try {\n    const found = knownClients.find((c) => c.client_id === clientId);\n    return (found && found.name) || clientId;\n  } catch (e) {\n    return clientId;\n  }\n}\n\nexport function mapClientID2NameSorted(enabledClients, knownClients) {\n  return [\n    ...(enabledClients || []).map((clientId) => convertClientIdToName(clientId, knownClients))\n  ].sort((a, b) => a.toLowerCase().localeCompare(b.toLowerCase()));\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"ebfd8233912be00645eac6da8ef2b9265e98d77e","contentHash":"4235532ae3d4f34381086fb60295a7da1ec93f7ae1e49dcb2d4d1c12288626d4"},"/home/circleci/repo/src/context/yaml/handlers/index.js":{"path":"/home/circleci/repo/src/context/yaml/handlers/index.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":13},"end":{"line":7,"column":31}},"2":{"start":{"line":9,"column":14},"end":{"line":9,"column":44}},"3":{"start":{"line":11,"column":13},"end":{"line":11,"column":31}},"4":{"start":{"line":13,"column":14},"end":{"line":13,"column":44}},"5":{"start":{"line":15,"column":13},"end":{"line":15,"column":31}},"6":{"start":{"line":17,"column":14},"end":{"line":17,"column":44}},"7":{"start":{"line":19,"column":15},"end":{"line":19,"column":35}},"8":{"start":{"line":21,"column":16},"end":{"line":21,"column":48}},"9":{"start":{"line":23,"column":14},"end":{"line":23,"column":33}},"10":{"start":{"line":25,"column":15},"end":{"line":25,"column":46}},"11":{"start":{"line":27,"column":21},"end":{"line":27,"column":47}},"12":{"start":{"line":29,"column":22},"end":{"line":29,"column":60}},"13":{"start":{"line":31,"column":19},"end":{"line":31,"column":43}},"14":{"start":{"line":33,"column":20},"end":{"line":33,"column":56}},"15":{"start":{"line":35,"column":17},"end":{"line":35,"column":39}},"16":{"start":{"line":37,"column":18},"end":{"line":37,"column":52}},"17":{"start":{"line":39,"column":22},"end":{"line":39,"column":49}},"18":{"start":{"line":41,"column":23},"end":{"line":41,"column":62}},"19":{"start":{"line":43,"column":20},"end":{"line":43,"column":45}},"20":{"start":{"line":45,"column":21},"end":{"line":45,"column":58}},"21":{"start":{"line":47,"column":20},"end":{"line":47,"column":45}},"22":{"start":{"line":49,"column":21},"end":{"line":49,"column":58}},"23":{"start":{"line":51,"column":23},"end":{"line":51,"column":51}},"24":{"start":{"line":53,"column":24},"end":{"line":53,"column":64}},"25":{"start":{"line":55,"column":23},"end":{"line":55,"column":51}},"26":{"start":{"line":57,"column":24},"end":{"line":57,"column":64}},"27":{"start":{"line":59,"column":31},"end":{"line":59,"column":67}},"28":{"start":{"line":61,"column":32},"end":{"line":61,"column":80}},"29":{"start":{"line":63,"column":31},"end":{"line":63,"column":67}},"30":{"start":{"line":65,"column":32},"end":{"line":65,"column":80}},"31":{"start":{"line":67,"column":39},"end":{"line":67,"column":83}},"32":{"start":{"line":69,"column":40},"end":{"line":69,"column":96}},"33":{"start":{"line":71,"column":43},"end":{"line":71,"column":91}},"34":{"start":{"line":73,"column":44},"end":{"line":73,"column":104}},"35":{"start":{"line":75,"column":24},"end":{"line":75,"column":53}},"36":{"start":{"line":77,"column":25},"end":{"line":77,"column":66}},"37":{"start":{"line":79,"column":13},"end":{"line":79,"column":31}},"38":{"start":{"line":81,"column":14},"end":{"line":81,"column":44}},"39":{"start":{"line":83,"column":21},"end":{"line":83,"column":47}},"40":{"start":{"line":85,"column":22},"end":{"line":85,"column":60}},"41":{"start":{"line":87,"column":18},"end":{"line":87,"column":41}},"42":{"start":{"line":89,"column":19},"end":{"line":89,"column":54}},"43":{"start":{"line":91,"column":15},"end":{"line":91,"column":35}},"44":{"start":{"line":93,"column":16},"end":{"line":93,"column":48}},"45":{"start":{"line":95,"column":16},"end":{"line":95,"column":37}},"46":{"start":{"line":97,"column":17},"end":{"line":97,"column":50}},"47":{"start":{"line":99,"column":39},"end":{"line":99,"column":93}},"48":{"start":{"line":101,"column":0},"end":{"line":125,"column":2}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":99,"column":9},"end":{"line":99,"column":31}},"loc":{"start":{"line":99,"column":37},"end":{"line":99,"column":95}},"line":99}},"branchMap":{"0":{"loc":{"start":{"line":99,"column":46},"end":{"line":99,"column":92}},"type":"cond-expr","locations":[{"start":{"line":99,"column":70},"end":{"line":99,"column":73}},{"start":{"line":99,"column":76},"end":{"line":99,"column":92}}],"line":99},"1":{"loc":{"start":{"line":99,"column":46},"end":{"line":99,"column":67}},"type":"binary-expr","locations":[{"start":{"line":99,"column":46},"end":{"line":99,"column":49}},{"start":{"line":99,"column":53},"end":{"line":99,"column":67}}],"line":99}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1,"24":1,"25":1,"26":1,"27":1,"28":1,"29":1,"30":1,"31":1,"32":1,"33":1,"34":1,"35":1,"36":1,"37":1,"38":1,"39":1,"40":1,"41":1,"42":1,"43":1,"44":1,"45":1,"46":1,"47":23,"48":1},"f":{"0":23},"b":{"0":[23,0],"1":[23,23]},"inputSourceMap":{"version":3,"sources":["index.js"],"names":["rules","hooks","rulesConfigs","pages","databases","clientGrants","resourceServers","clients","connections","tenant","emailProvider","emailTemplates","guardianFactors","guardianFactorProviders","guardianFactorTemplates","roles","migrations","guardianPhoneFactorMessageTypes","guardianPhoneFactorSelectedProvider","guardianPolicies","actions","organizations","triggers"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;kBAEe;AACbA,EAAAA,KAAK,EAALA,eADa;AAEbC,EAAAA,KAAK,EAALA,eAFa;AAGbC,EAAAA,YAAY,EAAZA,sBAHa;AAIbC,EAAAA,KAAK,EAALA,eAJa;AAKbC,EAAAA,SAAS,EAATA,mBALa;AAMbC,EAAAA,YAAY,EAAZA,sBANa;AAObC,EAAAA,eAAe,EAAfA,yBAPa;AAQbC,EAAAA,OAAO,EAAPA,iBARa;AASbC,EAAAA,WAAW,EAAXA,qBATa;AAUbC,EAAAA,MAAM,EAANA,gBAVa;AAWbC,EAAAA,aAAa,EAAbA,uBAXa;AAYbC,EAAAA,cAAc,EAAdA,wBAZa;AAabC,EAAAA,eAAe,EAAfA,yBAba;AAcbC,EAAAA,uBAAuB,EAAvBA,iCAda;AAebC,EAAAA,uBAAuB,EAAvBA,iCAfa;AAgBbC,EAAAA,KAAK,EAALA,eAhBa;AAiBbC,EAAAA,UAAU,EAAVA,oBAjBa;AAkBbC,EAAAA,+BAA+B,EAA/BA,yCAlBa;AAmBbC,EAAAA,mCAAmC,EAAnCA,6CAnBa;AAoBbC,EAAAA,gBAAgB,EAAhBA,0BApBa;AAqBbC,EAAAA,OAAO,EAAPA,iBArBa;AAsBbC,EAAAA,aAAa,EAAbA,uBAtBa;AAuBbC,EAAAA,QAAQ,EAARA;AAvBa,C","sourceRoot":"/home/circleci/repo/src/context/yaml/handlers/","sourcesContent":["import pages from './pages';\nimport rules from './rules';\nimport hooks from './hooks';\nimport clients from './clients';\nimport tenant from './tenant';\nimport emailProvider from './emailProvider';\nimport connections from './connections';\nimport databases from './databases';\nimport emailTemplates from './emailTemplates';\nimport clientGrants from './clientGrants';\nimport rulesConfigs from './rulesConfigs';\nimport resourceServers from './resourceServers';\nimport guardianFactors from './guardianFactors';\nimport guardianFactorProviders from './guardianFactorProviders';\nimport guardianFactorTemplates from './guardianFactorTemplates';\nimport guardianPhoneFactorMessageTypes from './guardianPhoneFactorMessageTypes';\nimport guardianPhoneFactorSelectedProvider from './guardianPhoneFactorSelectedProvider';\nimport guardianPolicies from './guardianPolicies';\nimport roles from './roles';\nimport organizations from './organizations';\nimport migrations from './migrations';\nimport actions from './actions';\nimport triggers from './triggers';\n\nexport default {\n  rules,\n  hooks,\n  rulesConfigs,\n  pages,\n  databases,\n  clientGrants,\n  resourceServers,\n  clients,\n  connections,\n  tenant,\n  emailProvider,\n  emailTemplates,\n  guardianFactors,\n  guardianFactorProviders,\n  guardianFactorTemplates,\n  roles,\n  migrations,\n  guardianPhoneFactorMessageTypes,\n  guardianPhoneFactorSelectedProvider,\n  guardianPolicies,\n  actions,\n  organizations,\n  triggers\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"797d67a9fb7eec6bd62c308d93eef6b8fd437364","contentHash":"e34fcd4f0bf57cc481cd319251ab4030bd0e43b041273a627e76d096bfdd78ac"},"/home/circleci/repo/src/context/yaml/handlers/pages.js":{"path":"/home/circleci/repo/src/context/yaml/handlers/pages.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":12},"end":{"line":7,"column":27}},"2":{"start":{"line":9,"column":13},"end":{"line":9,"column":42}},"3":{"start":{"line":11,"column":15},"end":{"line":11,"column":34}},"4":{"start":{"line":13,"column":16},"end":{"line":13,"column":48}},"5":{"start":{"line":15,"column":14},"end":{"line":15,"column":40}},"6":{"start":{"line":17,"column":15},"end":{"line":17,"column":46}},"7":{"start":{"line":19,"column":39},"end":{"line":19,"column":93}},"8":{"start":{"line":22,"column":2},"end":{"line":22,"column":39}},"9":{"start":{"line":22,"column":29},"end":{"line":22,"column":39}},"10":{"start":{"line":23,"column":2},"end":{"line":27,"column":4}},"11":{"start":{"line":24,"column":49},"end":{"line":26,"column":5}},"12":{"start":{"line":31,"column":14},"end":{"line":31,"column":47}},"13":{"start":{"line":33,"column":2},"end":{"line":53,"column":3}},"14":{"start":{"line":34,"column":24},"end":{"line":34,"column":70}},"15":{"start":{"line":36,"column":4},"end":{"line":36,"column":49}},"16":{"start":{"line":38,"column":4},"end":{"line":52,"column":7}},"17":{"start":{"line":39,"column":6},"end":{"line":41,"column":7}},"18":{"start":{"line":40,"column":8},"end":{"line":40,"column":20}},"19":{"start":{"line":43,"column":23},"end":{"line":43,"column":76}},"20":{"start":{"line":45,"column":6},"end":{"line":45,"column":51}},"21":{"start":{"line":47,"column":6},"end":{"line":47,"column":59}},"22":{"start":{"line":49,"column":6},"end":{"line":51,"column":8}},"23":{"start":{"line":55,"column":2},"end":{"line":57,"column":4}},"24":{"start":{"line":60,"column":0},"end":{"line":63,"column":2}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":19,"column":9},"end":{"line":19,"column":31}},"loc":{"start":{"line":19,"column":37},"end":{"line":19,"column":95}},"line":19},"1":{"name":"parse","decl":{"start":{"line":21,"column":15},"end":{"line":21,"column":20}},"loc":{"start":{"line":21,"column":30},"end":{"line":28,"column":1}},"line":21},"2":{"name":"(anonymous_2)","decl":{"start":{"line":24,"column":40},"end":{"line":24,"column":41}},"loc":{"start":{"line":24,"column":49},"end":{"line":26,"column":5}},"line":24},"3":{"name":"dump","decl":{"start":{"line":30,"column":15},"end":{"line":30,"column":19}},"loc":{"start":{"line":30,"column":29},"end":{"line":58,"column":1}},"line":30},"4":{"name":"(anonymous_4)","decl":{"start":{"line":38,"column":22},"end":{"line":38,"column":23}},"loc":{"start":{"line":38,"column":30},"end":{"line":52,"column":5}},"line":38}},"branchMap":{"0":{"loc":{"start":{"line":19,"column":46},"end":{"line":19,"column":92}},"type":"cond-expr","locations":[{"start":{"line":19,"column":70},"end":{"line":19,"column":73}},{"start":{"line":19,"column":76},"end":{"line":19,"column":92}}],"line":19},"1":{"loc":{"start":{"line":19,"column":46},"end":{"line":19,"column":67}},"type":"binary-expr","locations":[{"start":{"line":19,"column":46},"end":{"line":19,"column":49}},{"start":{"line":19,"column":53},"end":{"line":19,"column":67}}],"line":19},"2":{"loc":{"start":{"line":22,"column":2},"end":{"line":22,"column":39}},"type":"if","locations":[{"start":{"line":22,"column":2},"end":{"line":22,"column":39}},{"start":{"line":22,"column":2},"end":{"line":22,"column":39}}],"line":22},"3":{"loc":{"start":{"line":25,"column":12},"end":{"line":25,"column":56}},"type":"cond-expr","locations":[{"start":{"line":25,"column":24},"end":{"line":25,"column":51}},{"start":{"line":25,"column":54},"end":{"line":25,"column":56}}],"line":25},"4":{"loc":{"start":{"line":31,"column":19},"end":{"line":31,"column":45}},"type":"binary-expr","locations":[{"start":{"line":31,"column":19},"end":{"line":31,"column":39}},{"start":{"line":31,"column":43},"end":{"line":31,"column":45}}],"line":31},"5":{"loc":{"start":{"line":33,"column":2},"end":{"line":53,"column":3}},"type":"if","locations":[{"start":{"line":33,"column":2},"end":{"line":53,"column":3}},{"start":{"line":33,"column":2},"end":{"line":53,"column":3}}],"line":33},"6":{"loc":{"start":{"line":39,"column":6},"end":{"line":41,"column":7}},"type":"if","locations":[{"start":{"line":39,"column":6},"end":{"line":41,"column":7}},{"start":{"line":39,"column":6},"end":{"line":41,"column":7}}],"line":39},"7":{"loc":{"start":{"line":39,"column":10},"end":{"line":39,"column":63}},"type":"binary-expr","locations":[{"start":{"line":39,"column":10},"end":{"line":39,"column":36}},{"start":{"line":39,"column":40},"end":{"line":39,"column":63}}],"line":39}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":3,"8":28,"9":26,"10":2,"11":5,"12":7,"13":7,"14":7,"15":7,"16":7,"17":10,"18":1,"19":9,"20":9,"21":9,"22":9,"23":7,"24":1},"f":{"0":3,"1":28,"2":5,"3":7,"4":10},"b":{"0":[1,2],"1":[3,3],"2":[26,2],"3":[4,1],"4":[7,0],"5":[7,0],"6":[1,9],"7":[10,3]},"inputSourceMap":{"version":3,"sources":["pages.js"],"names":["parse","context","assets","pages","map","page","html","loadFile","dump","length","pagesFolder","path","join","basePath","fs","ensureDirSync","name","undefined","htmlFile","log","info","writeFileSync"],"mappings":";;;;;;AAAA;;;;AACA;;;;AAEA;;;;;;AAEA,eAAeA,KAAf,CAAqBC,OAArB,EAA8B;AAG5B,MAAI,CAACA,OAAO,CAACC,MAAR,CAAeC,KAApB,EAA2B,OAAO,EAAP;AAE3B,SAAO;AACLA,IAAAA,KAAK,EAAE,CACL,GAAGF,OAAO,CAACC,MAAR,CAAeC,KAAf,CAAqBC,GAArB,CAA0BC,IAAD,KAAW,EACrC,GAAGA,IADkC;AAErCC,MAAAA,IAAI,EAAED,IAAI,CAACC,IAAL,GAAYL,OAAO,CAACM,QAAR,CAAiBF,IAAI,CAACC,IAAtB,CAAZ,GAA0C;AAFX,KAAX,CAAzB,CADE;AADF,GAAP;AAQD;;AAED,eAAeE,IAAf,CAAoBP,OAApB,EAA6B;AAC3B,MAAIE,KAAK,GAAG,CAAE,IAAGF,OAAO,CAACC,MAAR,CAAeC,KAAf,IAAwB,EAA3B,CAAF,CAAZ;;AAEA,MAAIA,KAAK,CAACM,MAAN,GAAe,CAAnB,EAAsB;AAEpB,UAAMC,WAAW,GAAGC,eAAKC,IAAL,CAAUX,OAAO,CAACY,QAAlB,EAA4B,OAA5B,CAApB;;AACAC,sBAAGC,aAAH,CAAiBL,WAAjB;;AAEAP,IAAAA,KAAK,GAAGA,KAAK,CAACC,GAAN,CAAWC,IAAD,IAAU;AAC1B,UAAIA,IAAI,CAACW,IAAL,KAAc,YAAd,IAA8BX,IAAI,CAACC,IAAL,KAAcW,SAAhD,EAA2D;AACzD,eAAOZ,IAAP;AACD;;AAGD,YAAMa,QAAQ,GAAGP,eAAKC,IAAL,CAAUF,WAAV,EAAwB,GAAEL,IAAI,CAACW,IAAK,OAApC,CAAjB;;AACAG,uBAAIC,IAAJ,CAAU,WAAUF,QAAS,EAA7B;;AACAJ,wBAAGO,aAAH,CAAiBH,QAAjB,EAA2Bb,IAAI,CAACC,IAAhC;;AACA,aAAO,EACL,GAAGD,IADE;AAELC,QAAAA,IAAI,EAAG,WAAUD,IAAI,CAACW,IAAK;AAFtB,OAAP;AAID,KAbO,CAAR;AAcD;;AAED,SAAO;AAAEb,IAAAA;AAAF,GAAP;AACD;;kBAEc;AACbH,EAAAA,KADa;AAEbQ,EAAAA;AAFa,C","sourceRoot":"/home/circleci/repo/src/context/yaml/handlers/","sourcesContent":["import path from 'path';\nimport fs from 'fs-extra';\n\nimport log from '../../../logger';\n\nasync function parse(context) {\n  // Load the HTML file for each page\n\n  if (!context.assets.pages) return {};\n\n  return {\n    pages: [\n      ...context.assets.pages.map((page) => ({\n        ...page,\n        html: page.html ? context.loadFile(page.html) : ''\n      }))\n    ]\n  };\n}\n\nasync function dump(context) {\n  let pages = [ ...context.assets.pages || [] ];\n\n  if (pages.length > 0) {\n    // Create Pages folder\n    const pagesFolder = path.join(context.basePath, 'pages');\n    fs.ensureDirSync(pagesFolder);\n\n    pages = pages.map((page) => {\n      if (page.name === 'error_page' && page.html === undefined) {\n        return page;\n      }\n\n      // Dump html to file\n      const htmlFile = path.join(pagesFolder, `${page.name}.html`);\n      log.info(`Writing ${htmlFile}`);\n      fs.writeFileSync(htmlFile, page.html);\n      return {\n        ...page,\n        html: `./pages/${page.name}.html`\n      };\n    });\n  }\n\n  return { pages };\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"6b054d2094838f2688c1c1a22b0c389ccee7a5b6","contentHash":"56be0447b6203eb4eea6961e0c17af211cb3c13cf2ef95b68bdabac124b4f1a0"},"/home/circleci/repo/src/context/yaml/handlers/rules.js":{"path":"/home/circleci/repo/src/context/yaml/handlers/rules.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":12},"end":{"line":7,"column":27}},"2":{"start":{"line":9,"column":13},"end":{"line":9,"column":42}},"3":{"start":{"line":11,"column":15},"end":{"line":11,"column":34}},"4":{"start":{"line":13,"column":16},"end":{"line":13,"column":48}},"5":{"start":{"line":15,"column":13},"end":{"line":15,"column":38}},"6":{"start":{"line":17,"column":14},"end":{"line":17,"column":40}},"7":{"start":{"line":19,"column":15},"end":{"line":19,"column":46}},"8":{"start":{"line":21,"column":39},"end":{"line":21,"column":93}},"9":{"start":{"line":24,"column":2},"end":{"line":24,"column":39}},"10":{"start":{"line":24,"column":29},"end":{"line":24,"column":39}},"11":{"start":{"line":25,"column":2},"end":{"line":29,"column":4}},"12":{"start":{"line":26,"column":49},"end":{"line":28,"column":5}},"13":{"start":{"line":33,"column":14},"end":{"line":33,"column":47}},"14":{"start":{"line":35,"column":2},"end":{"line":53,"column":3}},"15":{"start":{"line":36,"column":24},"end":{"line":36,"column":70}},"16":{"start":{"line":38,"column":4},"end":{"line":38,"column":49}},"17":{"start":{"line":40,"column":4},"end":{"line":52,"column":7}},"18":{"start":{"line":41,"column":25},"end":{"line":41,"column":64}},"19":{"start":{"line":43,"column":25},"end":{"line":43,"column":69}},"20":{"start":{"line":45,"column":6},"end":{"line":45,"column":53}},"21":{"start":{"line":47,"column":6},"end":{"line":47,"column":63}},"22":{"start":{"line":49,"column":6},"end":{"line":51,"column":8}},"23":{"start":{"line":55,"column":2},"end":{"line":57,"column":4}},"24":{"start":{"line":60,"column":0},"end":{"line":63,"column":2}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":21,"column":9},"end":{"line":21,"column":31}},"loc":{"start":{"line":21,"column":37},"end":{"line":21,"column":95}},"line":21},"1":{"name":"parse","decl":{"start":{"line":23,"column":15},"end":{"line":23,"column":20}},"loc":{"start":{"line":23,"column":30},"end":{"line":30,"column":1}},"line":23},"2":{"name":"(anonymous_2)","decl":{"start":{"line":26,"column":40},"end":{"line":26,"column":41}},"loc":{"start":{"line":26,"column":49},"end":{"line":28,"column":5}},"line":26},"3":{"name":"dump","decl":{"start":{"line":32,"column":15},"end":{"line":32,"column":19}},"loc":{"start":{"line":32,"column":29},"end":{"line":58,"column":1}},"line":32},"4":{"name":"(anonymous_4)","decl":{"start":{"line":40,"column":22},"end":{"line":40,"column":23}},"loc":{"start":{"line":40,"column":30},"end":{"line":52,"column":5}},"line":40}},"branchMap":{"0":{"loc":{"start":{"line":21,"column":46},"end":{"line":21,"column":92}},"type":"cond-expr","locations":[{"start":{"line":21,"column":70},"end":{"line":21,"column":73}},{"start":{"line":21,"column":76},"end":{"line":21,"column":92}}],"line":21},"1":{"loc":{"start":{"line":21,"column":46},"end":{"line":21,"column":67}},"type":"binary-expr","locations":[{"start":{"line":21,"column":46},"end":{"line":21,"column":49}},{"start":{"line":21,"column":53},"end":{"line":21,"column":67}}],"line":21},"2":{"loc":{"start":{"line":24,"column":2},"end":{"line":24,"column":39}},"type":"if","locations":[{"start":{"line":24,"column":2},"end":{"line":24,"column":39}},{"start":{"line":24,"column":2},"end":{"line":24,"column":39}}],"line":24},"3":{"loc":{"start":{"line":33,"column":19},"end":{"line":33,"column":45}},"type":"binary-expr","locations":[{"start":{"line":33,"column":19},"end":{"line":33,"column":39}},{"start":{"line":33,"column":43},"end":{"line":33,"column":45}}],"line":33},"4":{"loc":{"start":{"line":35,"column":2},"end":{"line":53,"column":3}},"type":"if","locations":[{"start":{"line":35,"column":2},"end":{"line":53,"column":3}},{"start":{"line":35,"column":2},"end":{"line":53,"column":3}}],"line":35}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":3,"9":28,"10":27,"11":1,"12":1,"13":6,"14":6,"15":2,"16":2,"17":2,"18":2,"19":2,"20":2,"21":2,"22":2,"23":6,"24":1},"f":{"0":3,"1":28,"2":1,"3":6,"4":2},"b":{"0":[1,2],"1":[3,3],"2":[27,1],"3":[6,0],"4":[2,4]},"inputSourceMap":{"version":3,"sources":["rules.js"],"names":["parse","context","assets","rules","map","rule","script","loadFile","dump","length","rulesFolder","path","join","basePath","fs","ensureDirSync","scriptName","name","scriptFile","log","info","writeFileSync"],"mappings":";;;;;;AAAA;;;;AACA;;;;AAEA;;AACA;;;;;;AAEA,eAAeA,KAAf,CAAqBC,OAArB,EAA8B;AAE5B,MAAI,CAACA,OAAO,CAACC,MAAR,CAAeC,KAApB,EAA2B,OAAO,EAAP;AAE3B,SAAO;AACLA,IAAAA,KAAK,EAAE,CACL,GAAGF,OAAO,CAACC,MAAR,CAAeC,KAAf,CAAqBC,GAArB,CAA0BC,IAAD,KAAW,EACrC,GAAGA,IADkC;AAErCC,MAAAA,MAAM,EAAEL,OAAO,CAACM,QAAR,CAAiBF,IAAI,CAACC,MAAtB;AAF6B,KAAX,CAAzB,CADE;AADF,GAAP;AAQD;;AAED,eAAeE,IAAf,CAAoBP,OAApB,EAA6B;AAC3B,MAAIE,KAAK,GAAG,CAAE,IAAGF,OAAO,CAACC,MAAR,CAAeC,KAAf,IAAwB,EAA3B,CAAF,CAAZ;;AAEA,MAAIA,KAAK,CAACM,MAAN,GAAe,CAAnB,EAAsB;AAEpB,UAAMC,WAAW,GAAGC,eAAKC,IAAL,CAAUX,OAAO,CAACY,QAAlB,EAA4B,OAA5B,CAApB;;AACAC,sBAAGC,aAAH,CAAiBL,WAAjB;;AAEAP,IAAAA,KAAK,GAAGA,KAAK,CAACC,GAAN,CAAWC,IAAD,IAAU;AAE1B,YAAMW,UAAU,GAAG,qBAAU,GAAEX,IAAI,CAACY,IAAK,KAAtB,CAAnB;;AACA,YAAMC,UAAU,GAAGP,eAAKC,IAAL,CAAUF,WAAV,EAAuBM,UAAvB,CAAnB;;AACAG,uBAAIC,IAAJ,CAAU,WAAUF,UAAW,EAA/B;;AACAJ,wBAAGO,aAAH,CAAiBH,UAAjB,EAA6Bb,IAAI,CAACC,MAAlC;;AACA,aAAO,EAAE,GAAGD,IAAL;AAAWC,QAAAA,MAAM,EAAG,WAAUU,UAAW;AAAzC,OAAP;AACD,KAPO,CAAR;AAQD;;AAED,SAAO;AAAEb,IAAAA;AAAF,GAAP;AACD;;kBAEc;AACbH,EAAAA,KADa;AAEbQ,EAAAA;AAFa,C","sourceRoot":"/home/circleci/repo/src/context/yaml/handlers/","sourcesContent":["import path from 'path';\nimport fs from 'fs-extra';\n\nimport { sanitize } from '../../../utils';\nimport log from '../../../logger';\n\nasync function parse(context) {\n  // Load the script file for each rule\n  if (!context.assets.rules) return {};\n\n  return {\n    rules: [\n      ...context.assets.rules.map((rule) => ({\n        ...rule,\n        script: context.loadFile(rule.script)\n      }))\n    ]\n  };\n}\n\nasync function dump(context) {\n  let rules = [ ...context.assets.rules || [] ];\n\n  if (rules.length > 0) {\n    // Create Rules folder\n    const rulesFolder = path.join(context.basePath, 'rules');\n    fs.ensureDirSync(rulesFolder);\n\n    rules = rules.map((rule) => {\n      // Dump rule to file\n      const scriptName = sanitize(`${rule.name}.js`);\n      const scriptFile = path.join(rulesFolder, scriptName);\n      log.info(`Writing ${scriptFile}`);\n      fs.writeFileSync(scriptFile, rule.script);\n      return { ...rule, script: `./rules/${scriptName}` };\n    });\n  }\n\n  return { rules };\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"b67ad0146745273b83c055b59621d449cae9c5dc","contentHash":"b2782f402e665e93a15a16a3281896190f7de1023b1a0fbbd22895a44533603a"},"/home/circleci/repo/src/context/yaml/handlers/hooks.js":{"path":"/home/circleci/repo/src/context/yaml/handlers/hooks.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":12},"end":{"line":7,"column":27}},"2":{"start":{"line":9,"column":13},"end":{"line":9,"column":42}},"3":{"start":{"line":11,"column":15},"end":{"line":11,"column":34}},"4":{"start":{"line":13,"column":16},"end":{"line":13,"column":48}},"5":{"start":{"line":15,"column":13},"end":{"line":15,"column":38}},"6":{"start":{"line":17,"column":13},"end":{"line":17,"column":38}},"7":{"start":{"line":19,"column":14},"end":{"line":19,"column":40}},"8":{"start":{"line":21,"column":15},"end":{"line":21,"column":46}},"9":{"start":{"line":23,"column":39},"end":{"line":23,"column":93}},"10":{"start":{"line":26,"column":2},"end":{"line":26,"column":39}},"11":{"start":{"line":26,"column":29},"end":{"line":26,"column":39}},"12":{"start":{"line":27,"column":2},"end":{"line":37,"column":4}},"13":{"start":{"line":29,"column":6},"end":{"line":31,"column":7}},"14":{"start":{"line":30,"column":8},"end":{"line":30,"column":86}},"15":{"start":{"line":33,"column":6},"end":{"line":33,"column":62}},"16":{"start":{"line":34,"column":6},"end":{"line":35,"column":8}},"17":{"start":{"line":41,"column":14},"end":{"line":41,"column":47}},"18":{"start":{"line":43,"column":2},"end":{"line":62,"column":3}},"19":{"start":{"line":44,"column":24},"end":{"line":44,"column":70}},"20":{"start":{"line":46,"column":4},"end":{"line":46,"column":49}},"21":{"start":{"line":48,"column":4},"end":{"line":61,"column":7}},"22":{"start":{"line":49,"column":6},"end":{"line":49,"column":39}},"23":{"start":{"line":50,"column":23},"end":{"line":50,"column":62}},"24":{"start":{"line":52,"column":23},"end":{"line":52,"column":65}},"25":{"start":{"line":54,"column":6},"end":{"line":54,"column":51}},"26":{"start":{"line":56,"column":6},"end":{"line":56,"column":61}},"27":{"start":{"line":58,"column":6},"end":{"line":60,"column":8}},"28":{"start":{"line":64,"column":2},"end":{"line":66,"column":4}},"29":{"start":{"line":69,"column":0},"end":{"line":72,"column":2}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":23,"column":9},"end":{"line":23,"column":31}},"loc":{"start":{"line":23,"column":37},"end":{"line":23,"column":95}},"line":23},"1":{"name":"parse","decl":{"start":{"line":25,"column":15},"end":{"line":25,"column":20}},"loc":{"start":{"line":25,"column":30},"end":{"line":38,"column":1}},"line":25},"2":{"name":"(anonymous_2)","decl":{"start":{"line":28,"column":40},"end":{"line":28,"column":41}},"loc":{"start":{"line":28,"column":48},"end":{"line":36,"column":5}},"line":28},"3":{"name":"dump","decl":{"start":{"line":40,"column":15},"end":{"line":40,"column":19}},"loc":{"start":{"line":40,"column":29},"end":{"line":67,"column":1}},"line":40},"4":{"name":"(anonymous_4)","decl":{"start":{"line":48,"column":22},"end":{"line":48,"column":23}},"loc":{"start":{"line":48,"column":30},"end":{"line":61,"column":5}},"line":48}},"branchMap":{"0":{"loc":{"start":{"line":23,"column":46},"end":{"line":23,"column":92}},"type":"cond-expr","locations":[{"start":{"line":23,"column":70},"end":{"line":23,"column":73}},{"start":{"line":23,"column":76},"end":{"line":23,"column":92}}],"line":23},"1":{"loc":{"start":{"line":23,"column":46},"end":{"line":23,"column":67}},"type":"binary-expr","locations":[{"start":{"line":23,"column":46},"end":{"line":23,"column":49}},{"start":{"line":23,"column":53},"end":{"line":23,"column":67}}],"line":23},"2":{"loc":{"start":{"line":26,"column":2},"end":{"line":26,"column":39}},"type":"if","locations":[{"start":{"line":26,"column":2},"end":{"line":26,"column":39}},{"start":{"line":26,"column":2},"end":{"line":26,"column":39}}],"line":26},"3":{"loc":{"start":{"line":29,"column":6},"end":{"line":31,"column":7}},"type":"if","locations":[{"start":{"line":29,"column":6},"end":{"line":31,"column":7}},{"start":{"line":29,"column":6},"end":{"line":31,"column":7}}],"line":29},"4":{"loc":{"start":{"line":41,"column":19},"end":{"line":41,"column":45}},"type":"binary-expr","locations":[{"start":{"line":41,"column":19},"end":{"line":41,"column":39}},{"start":{"line":41,"column":43},"end":{"line":41,"column":45}}],"line":41},"5":{"loc":{"start":{"line":43,"column":2},"end":{"line":62,"column":3}},"type":"if","locations":[{"start":{"line":43,"column":2},"end":{"line":62,"column":3}},{"start":{"line":43,"column":2},"end":{"line":62,"column":3}}],"line":43},"6":{"loc":{"start":{"line":49,"column":18},"end":{"line":49,"column":38}},"type":"binary-expr","locations":[{"start":{"line":49,"column":18},"end":{"line":49,"column":27}},{"start":{"line":49,"column":31},"end":{"line":49,"column":38}}],"line":49}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":3,"10":28,"11":27,"12":1,"13":1,"14":1,"15":1,"16":1,"17":6,"18":6,"19":2,"20":2,"21":2,"22":3,"23":3,"24":3,"25":3,"26":3,"27":3,"28":6,"29":1},"f":{"0":3,"1":28,"2":1,"3":6,"4":3},"b":{"0":[1,2],"1":[3,3],"2":[27,1],"3":[1,0],"4":[6,0],"5":[2,4],"6":[3,1]},"inputSourceMap":{"version":3,"sources":["hooks.js"],"names":["parse","context","assets","hooks","map","hook","script","loadFile","constants","HOOKS_DIRECTORY","name","toLowerCase","replace","dump","length","hooksFolder","path","join","basePath","fs","ensureDirSync","id","codeName","codeFile","log","info","writeFileSync"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;AAEA;;AACA;;;;;;AAEA,eAAeA,KAAf,CAAqBC,OAArB,EAA8B;AAE5B,MAAI,CAACA,OAAO,CAACC,MAAR,CAAeC,KAApB,EAA2B,OAAO,EAAP;AAE3B,SAAO;AACLA,IAAAA,KAAK,EAAE,CACL,GAAGF,OAAO,CAACC,MAAR,CAAeC,KAAf,CAAqBC,GAArB,CAA0BC,IAAD,IAAU;AACpC,UAAIA,IAAI,CAACC,MAAT,EAAiB;AACfD,QAAAA,IAAI,CAACC,MAAL,GAAcL,OAAO,CAACM,QAAR,CAAiBF,IAAI,CAACC,MAAtB,EAA8BE,iBAAUC,eAAxC,CAAd;AACD;;AAEDJ,MAAAA,IAAI,CAACK,IAAL,GAAYL,IAAI,CAACK,IAAL,CAAUC,WAAV,GAAwBC,OAAxB,CAAgC,KAAhC,EAAuC,GAAvC,CAAZ;AAEA,aAAO,EAAE,GAAGP;AAAL,OAAP;AACD,KARE,CADE;AADF,GAAP;AAaD;;AAED,eAAeQ,IAAf,CAAoBZ,OAApB,EAA6B;AAC3B,MAAIE,KAAK,GAAG,CAAE,IAAGF,OAAO,CAACC,MAAR,CAAeC,KAAf,IAAwB,EAA3B,CAAF,CAAZ;;AAEA,MAAIA,KAAK,CAACW,MAAN,GAAe,CAAnB,EAAsB;AAEpB,UAAMC,WAAW,GAAGC,eAAKC,IAAL,CAAUhB,OAAO,CAACiB,QAAlB,EAA4B,OAA5B,CAApB;;AACAC,sBAAGC,aAAH,CAAiBL,WAAjB;;AAEAZ,IAAAA,KAAK,GAAGA,KAAK,CAACC,GAAN,CAAWC,IAAD,IAAU;AAG1BA,MAAAA,IAAI,CAACK,IAAL,GAAYL,IAAI,CAACK,IAAL,IAAaL,IAAI,CAACgB,EAA9B;AACA,YAAMC,QAAQ,GAAG,qBAAU,GAAEjB,IAAI,CAACK,IAAK,KAAtB,CAAjB;;AACA,YAAMa,QAAQ,GAAGP,eAAKC,IAAL,CAAUF,WAAV,EAAuBO,QAAvB,CAAjB;;AACAE,uBAAIC,IAAJ,CAAU,WAAUF,QAAS,EAA7B;;AACAJ,wBAAGO,aAAH,CAAiBH,QAAjB,EAA2BlB,IAAI,CAACC,MAAhC;;AAEA,aAAO,EAAE,GAAGD,IAAL;AAAWC,QAAAA,MAAM,EAAG,WAAUgB,QAAS;AAAvC,OAAP;AACD,KAVO,CAAR;AAWD;;AAED,SAAO;AAAEnB,IAAAA;AAAF,GAAP;AACD;;kBAEc;AACbH,EAAAA,KADa;AAEba,EAAAA;AAFa,C","sourceRoot":"/home/circleci/repo/src/context/yaml/handlers/","sourcesContent":["import path from 'path';\nimport fs from 'fs-extra';\nimport { constants } from '../../../tools';\n\nimport { sanitize } from '../../../utils';\nimport log from '../../../logger';\n\nasync function parse(context) {\n  // Load the script file for each hook\n  if (!context.assets.hooks) return {};\n\n  return {\n    hooks: [\n      ...context.assets.hooks.map((hook) => {\n        if (hook.script) {\n          hook.script = context.loadFile(hook.script, constants.HOOKS_DIRECTORY);\n        }\n\n        hook.name = hook.name.toLowerCase().replace(/\\s/g, '-');\n\n        return { ...hook };\n      })\n    ]\n  };\n}\n\nasync function dump(context) {\n  let hooks = [ ...context.assets.hooks || [] ];\n\n  if (hooks.length > 0) {\n    // Create hooks folder\n    const hooksFolder = path.join(context.basePath, 'hooks');\n    fs.ensureDirSync(hooksFolder);\n\n    hooks = hooks.map((hook) => {\n      // Dump hook code to file\n      // For cases when hook does not have `meta['hook-name']`\n      hook.name = hook.name || hook.id;\n      const codeName = sanitize(`${hook.name}.js`);\n      const codeFile = path.join(hooksFolder, codeName);\n      log.info(`Writing ${codeFile}`);\n      fs.writeFileSync(codeFile, hook.script);\n\n      return { ...hook, script: `./hooks/${codeName}` };\n    });\n  }\n\n  return { hooks };\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"4b19d55bf517b359bce8b9cd50b625d0849d2f47","contentHash":"cfa550b26d1fe342e190aeab275c5018f443cbc79ea51e66eb568a48d9c76a1e"},"/home/circleci/repo/src/context/yaml/handlers/clients.js":{"path":"/home/circleci/repo/src/context/yaml/handlers/clients.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":12},"end":{"line":7,"column":27}},"2":{"start":{"line":9,"column":13},"end":{"line":9,"column":42}},"3":{"start":{"line":11,"column":15},"end":{"line":11,"column":34}},"4":{"start":{"line":13,"column":16},"end":{"line":13,"column":48}},"5":{"start":{"line":15,"column":13},"end":{"line":15,"column":38}},"6":{"start":{"line":17,"column":14},"end":{"line":17,"column":40}},"7":{"start":{"line":19,"column":15},"end":{"line":19,"column":46}},"8":{"start":{"line":21,"column":13},"end":{"line":21,"column":38}},"9":{"start":{"line":23,"column":39},"end":{"line":23,"column":93}},"10":{"start":{"line":28,"column":6},"end":{"line":28,"column":20}},"11":{"start":{"line":30,"column":24},"end":{"line":30,"column":97}},"12":{"start":{"line":32,"column":2},"end":{"line":36,"column":3}},"13":{"start":{"line":33,"column":4},"end":{"line":35,"column":6}},"14":{"start":{"line":38,"column":2},"end":{"line":50,"column":4}},"15":{"start":{"line":40,"column":6},"end":{"line":46,"column":7}},"16":{"start":{"line":41,"column":29},"end":{"line":41,"column":89}},"17":{"start":{"line":43,"column":8},"end":{"line":45,"column":9}},"18":{"start":{"line":44,"column":10},"end":{"line":44,"column":68}},"19":{"start":{"line":48,"column":6},"end":{"line":48,"column":20}},"20":{"start":{"line":54,"column":24},"end":{"line":54,"column":97}},"21":{"start":{"line":56,"column":2},"end":{"line":75,"column":4}},"22":{"start":{"line":58,"column":6},"end":{"line":71,"column":7}},"23":{"start":{"line":59,"column":27},"end":{"line":59,"column":60}},"24":{"start":{"line":60,"column":21},"end":{"line":60,"column":45}},"25":{"start":{"line":62,"column":32},"end":{"line":62,"column":106}},"26":{"start":{"line":64,"column":8},"end":{"line":64,"column":60}},"27":{"start":{"line":66,"column":8},"end":{"line":66,"column":55}},"28":{"start":{"line":68,"column":8},"end":{"line":68,"column":63}},"29":{"start":{"line":70,"column":8},"end":{"line":70,"column":76}},"30":{"start":{"line":73,"column":6},"end":{"line":73,"column":51}},"31":{"start":{"line":78,"column":0},"end":{"line":81,"column":2}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":23,"column":9},"end":{"line":23,"column":31}},"loc":{"start":{"line":23,"column":37},"end":{"line":23,"column":95}},"line":23},"1":{"name":"parse","decl":{"start":{"line":25,"column":15},"end":{"line":25,"column":20}},"loc":{"start":{"line":25,"column":30},"end":{"line":51,"column":1}},"line":25},"2":{"name":"(anonymous_2)","decl":{"start":{"line":39,"column":29},"end":{"line":39,"column":30}},"loc":{"start":{"line":39,"column":39},"end":{"line":49,"column":5}},"line":39},"3":{"name":"dump","decl":{"start":{"line":53,"column":15},"end":{"line":53,"column":19}},"loc":{"start":{"line":53,"column":29},"end":{"line":76,"column":1}},"line":53},"4":{"name":"(anonymous_4)","decl":{"start":{"line":57,"column":44},"end":{"line":57,"column":45}},"loc":{"start":{"line":57,"column":54},"end":{"line":74,"column":5}},"line":57}},"branchMap":{"0":{"loc":{"start":{"line":23,"column":46},"end":{"line":23,"column":92}},"type":"cond-expr","locations":[{"start":{"line":23,"column":70},"end":{"line":23,"column":73}},{"start":{"line":23,"column":76},"end":{"line":23,"column":92}}],"line":23},"1":{"loc":{"start":{"line":23,"column":46},"end":{"line":23,"column":67}},"type":"binary-expr","locations":[{"start":{"line":23,"column":46},"end":{"line":23,"column":49}},{"start":{"line":23,"column":53},"end":{"line":23,"column":67}}],"line":23},"2":{"loc":{"start":{"line":32,"column":2},"end":{"line":36,"column":3}},"type":"if","locations":[{"start":{"line":32,"column":2},"end":{"line":36,"column":3}},{"start":{"line":32,"column":2},"end":{"line":36,"column":3}}],"line":32},"3":{"loc":{"start":{"line":32,"column":6},"end":{"line":32,"column":33}},"type":"binary-expr","locations":[{"start":{"line":32,"column":6},"end":{"line":32,"column":14}},{"start":{"line":32,"column":18},"end":{"line":32,"column":33}}],"line":32},"4":{"loc":{"start":{"line":40,"column":6},"end":{"line":46,"column":7}},"type":"if","locations":[{"start":{"line":40,"column":6},"end":{"line":46,"column":7}},{"start":{"line":40,"column":6},"end":{"line":46,"column":7}}],"line":40},"5":{"loc":{"start":{"line":43,"column":8},"end":{"line":45,"column":9}},"type":"if","locations":[{"start":{"line":43,"column":8},"end":{"line":45,"column":9}},{"start":{"line":43,"column":8},"end":{"line":45,"column":9}}],"line":43},"6":{"loc":{"start":{"line":58,"column":6},"end":{"line":71,"column":7}},"type":"if","locations":[{"start":{"line":58,"column":6},"end":{"line":71,"column":7}},{"start":{"line":58,"column":6},"end":{"line":71,"column":7}}],"line":58}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":3,"10":28,"11":28,"12":28,"13":27,"14":1,"15":3,"16":1,"17":1,"18":1,"19":3,"20":5,"21":5,"22":6,"23":5,"24":5,"25":5,"26":5,"27":5,"28":5,"29":5,"30":6,"31":1},"f":{"0":3,"1":28,"2":3,"3":5,"4":6},"b":{"0":[1,2],"1":[3,3],"2":[27,1],"3":[28,1],"4":[1,2],"5":[1,0],"6":[5,1]},"inputSourceMap":{"version":3,"sources":["clients.js"],"names":["parse","context","clients","assets","clientsFolder","path","join","basePath","constants","CLIENTS_DIRECTORY","length","map","client","custom_login_page","htmlFileName","loadFile","dump","clientName","name","html","customLoginHtml","log","info","fs","ensureDirSync","writeFileSync"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;AAEA;;;;AACA;;;;AAEA,eAAeA,KAAf,CAAqBC,OAArB,EAA8B;AAG5B,QAAM;AAAEC,IAAAA;AAAF,MAAcD,OAAO,CAACE,MAA5B;;AACA,QAAMC,aAAa,GAAGC,eAAKC,IAAL,CAAUL,OAAO,CAACM,QAAlB,EAA4BC,iBAAUC,iBAAtC,CAAtB;;AAEA,MAAI,CAACP,OAAD,IAAY,CAACA,OAAO,CAACQ,MAAzB,EAAiC;AAC/B,WAAO;AAAER,MAAAA,OAAO,EAAED,OAAO,CAACE,MAAR,CAAeD;AAA1B,KAAP;AACD;;AAED,SAAO;AACLA,IAAAA,OAAO,EAAE,CACP,GAAGA,OAAO,CAACS,GAAR,CAAaC,MAAD,IAAY;AACzB,UAAIA,MAAM,CAACC,iBAAX,EAA8B;AAC5B,cAAMC,YAAY,GAAGT,eAAKC,IAAL,CAAUF,aAAV,EAAyBQ,MAAM,CAACC,iBAAhC,CAArB;;AAEA,YAAI,mBAAOC,YAAP,CAAJ,EAA0B;AACxBF,UAAAA,MAAM,CAACC,iBAAP,GAA2BZ,OAAO,CAACc,QAAR,CAAiBD,YAAjB,CAA3B;AACD;AACF;;AAED,aAAOF,MAAP;AACD,KAVE,CADI;AADJ,GAAP;AAeD;;AAED,eAAeI,IAAf,CAAoBf,OAApB,EAA6B;AAE3B,QAAMG,aAAa,GAAGC,eAAKC,IAAL,CAAUL,OAAO,CAACM,QAAlB,EAA4BC,iBAAUC,iBAAtC,CAAtB;;AAEA,SAAO;AACLP,IAAAA,OAAO,EAAE,CAAE,GAAGD,OAAO,CAACE,MAAR,CAAeD,OAAf,CAAuBS,GAAvB,CAA4BC,MAAD,IAAY;AACnD,UAAIA,MAAM,CAACC,iBAAX,EAA8B;AAC5B,cAAMI,UAAU,GAAG,qBAASL,MAAM,CAACM,IAAhB,CAAnB;AACA,cAAMC,IAAI,GAAGP,MAAM,CAACC,iBAApB;;AACA,cAAMO,eAAe,GAAGf,eAAKC,IAAL,CAAUF,aAAV,EAA0B,GAAEa,UAAW,yBAAvC,CAAxB;;AAEAI,yBAAIC,IAAJ,CAAU,WAAUF,eAAgB,EAApC;;AACAG,0BAAGC,aAAH,CAAiBpB,aAAjB;;AACAmB,0BAAGE,aAAH,CAAiBL,eAAjB,EAAkCD,IAAlC;;AAEAP,QAAAA,MAAM,CAACC,iBAAP,GAA4B,KAAII,UAAW,yBAA3C;AACD;;AAED,aAAO,8BAAkBL,MAAlB,CAAP;AACD,KAda,CAAL;AADJ,GAAP;AAiBD;;kBAEc;AACbZ,EAAAA,KADa;AAEbgB,EAAAA;AAFa,C","sourceRoot":"/home/circleci/repo/src/context/yaml/handlers/","sourcesContent":["import path from 'path';\nimport fs from 'fs-extra';\nimport { constants } from '../../../tools';\n\nimport log from '../../../logger';\nimport { isFile, sanitize, clearClientArrays } from '../../../utils';\n\nasync function parse(context) {\n  // Load the HTML file for custom_login_page\n\n  const { clients } = context.assets;\n  const clientsFolder = path.join(context.basePath, constants.CLIENTS_DIRECTORY);\n\n  if (!clients || !clients.length) {\n    return { clients: context.assets.clients };\n  }\n\n  return {\n    clients: [\n      ...clients.map((client) => {\n        if (client.custom_login_page) {\n          const htmlFileName = path.join(clientsFolder, client.custom_login_page);\n\n          if (isFile(htmlFileName)) {\n            client.custom_login_page = context.loadFile(htmlFileName);\n          }\n        }\n\n        return client;\n      })\n    ]\n  };\n}\n\nasync function dump(context) {\n  // Save custom_login_page to a separate html file\n  const clientsFolder = path.join(context.basePath, constants.CLIENTS_DIRECTORY);\n\n  return {\n    clients: [ ...context.assets.clients.map((client) => {\n      if (client.custom_login_page) {\n        const clientName = sanitize(client.name);\n        const html = client.custom_login_page;\n        const customLoginHtml = path.join(clientsFolder, `${clientName}_custom_login_page.html`);\n\n        log.info(`Writing ${customLoginHtml}`);\n        fs.ensureDirSync(clientsFolder);\n        fs.writeFileSync(customLoginHtml, html);\n\n        client.custom_login_page = `./${clientName}_custom_login_page.html`;\n      }\n\n      return clearClientArrays(client);\n    }) ]\n  };\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"b3126edbc230295f5a6dd4563569fd7bcc782d53","contentHash":"cec09d1ef185c900869a3cbbdbf7c4aec6402b48832ca12f009576e6a9fed413"},"/home/circleci/repo/src/context/yaml/handlers/tenant.js":{"path":"/home/circleci/repo/src/context/yaml/handlers/tenant.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":13},"end":{"line":7,"column":38}},"2":{"start":{"line":10,"column":2},"end":{"line":10,"column":40}},"3":{"start":{"line":10,"column":30},"end":{"line":10,"column":40}},"4":{"start":{"line":15,"column":6},"end":{"line":15,"column":27}},"5":{"start":{"line":16,"column":2},"end":{"line":16,"column":39}},"6":{"start":{"line":17,"column":2},"end":{"line":19,"column":4}},"7":{"start":{"line":23,"column":17},"end":{"line":24,"column":3}},"8":{"start":{"line":25,"column":2},"end":{"line":25,"column":39}},"9":{"start":{"line":26,"column":2},"end":{"line":28,"column":4}},"10":{"start":{"line":31,"column":0},"end":{"line":34,"column":2}}},"fnMap":{"0":{"name":"parse","decl":{"start":{"line":9,"column":15},"end":{"line":9,"column":20}},"loc":{"start":{"line":9,"column":30},"end":{"line":20,"column":1}},"line":9},"1":{"name":"dump","decl":{"start":{"line":22,"column":15},"end":{"line":22,"column":19}},"loc":{"start":{"line":22,"column":29},"end":{"line":29,"column":1}},"line":22}},"branchMap":{"0":{"loc":{"start":{"line":10,"column":2},"end":{"line":10,"column":40}},"type":"if","locations":[{"start":{"line":10,"column":2},"end":{"line":10,"column":40}},{"start":{"line":10,"column":2},"end":{"line":10,"column":40}}],"line":10},"1":{"loc":{"start":{"line":18,"column":34},"end":{"line":18,"column":118}},"type":"binary-expr","locations":[{"start":{"line":18,"column":34},"end":{"line":18,"column":50}},{"start":{"line":18,"column":54},"end":{"line":18,"column":118}}],"line":18},"2":{"loc":{"start":{"line":18,"column":120},"end":{"line":18,"column":219}},"type":"binary-expr","locations":[{"start":{"line":18,"column":120},"end":{"line":18,"column":141}},{"start":{"line":18,"column":145},"end":{"line":18,"column":219}}],"line":18},"3":{"loc":{"start":{"line":23,"column":23},"end":{"line":23,"column":50}},"type":"binary-expr","locations":[{"start":{"line":23,"column":23},"end":{"line":23,"column":44}},{"start":{"line":23,"column":48},"end":{"line":23,"column":50}}],"line":23}},"s":{"0":1,"1":1,"2":28,"3":27,"4":1,"5":1,"6":1,"7":6,"8":6,"9":6,"10":1},"f":{"0":28,"1":6},"b":{"0":[27,1],"1":[1,1],"2":[1,1],"3":[6,0]},"inputSourceMap":{"version":3,"sources":["tenant.js"],"names":["parse","context","assets","tenant","session_lifetime","idle_session_lifetime","Object","assign","dump"],"mappings":";;;;;;AAAA;;AAEA,eAAeA,KAAf,CAAqBC,OAArB,EAA8B;AAE5B,MAAI,CAACA,OAAO,CAACC,MAAR,CAAeC,MAApB,EAA4B,OAAO,EAAP;AAG5B,QAAM;AACJC,IAAAA,gBADI;AAEJC,IAAAA,qBAFI;AAGJ,OAAGF;AAHC,MAIFF,OAAO,CAACC,MAAR,CAAeC,MAJnB;AAMA,+BAAiBA,MAAjB;AAEA,SAAO;AACLA,IAAAA,MAAM,EAAEG,MAAM,CAACC,MAAP,CACNJ,MADM,EAENC,gBAAgB,IAAI,2BAAe,kBAAf,EAAmCA,gBAAnC,CAFd,EAGNC,qBAAqB,IAAI,2BAAe,uBAAf,EAAwCA,qBAAxC,CAHnB;AADH,GAAP;AAQD;;AAED,eAAeG,IAAf,CAAoBP,OAApB,EAA6B;AAC3B,QAAME,MAAM,GAAG,EAAE,IAAGF,OAAO,CAACC,MAAR,CAAeC,MAAf,IAAyB,EAA5B;AAAF,GAAf;AAEA,+BAAiBA,MAAjB;AAEA,SAAO;AAAEA,IAAAA;AAAF,GAAP;AACD;;kBAEc;AACbH,EAAAA,KADa;AAEbQ,EAAAA;AAFa,C","sourceRoot":"/home/circleci/repo/src/context/yaml/handlers/","sourcesContent":["import { hoursAsInteger, clearTenantFlags } from '../../../utils';\n\nasync function parse(context) {\n  // Nothing to do\n  if (!context.assets.tenant) return {};\n\n  /* eslint-disable camelcase */\n  const {\n    session_lifetime,\n    idle_session_lifetime,\n    ...tenant\n  } = context.assets.tenant;\n\n  clearTenantFlags(tenant);\n\n  return {\n    tenant: Object.assign(\n      tenant,\n      session_lifetime && hoursAsInteger('session_lifetime', session_lifetime),\n      idle_session_lifetime && hoursAsInteger('idle_session_lifetime', idle_session_lifetime)\n    )\n  };\n  /* eslint-enable camelcase */\n}\n\nasync function dump(context) {\n  const tenant = { ...context.assets.tenant || {} };\n\n  clearTenantFlags(tenant);\n\n  return { tenant };\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"ba5369750e31753fb67dcbe2b738d60c074b58db","contentHash":"616a0cb9e5fbd3e335168a8df12dbb5c1af3831162af74bbfa3fc15259131ba4"},"/home/circleci/repo/src/context/yaml/handlers/emailProvider.js":{"path":"/home/circleci/repo/src/context/yaml/handlers/emailProvider.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":16},"end":{"line":7,"column":41}},"2":{"start":{"line":10,"column":2},"end":{"line":13,"column":4}},"3":{"start":{"line":19,"column":6},"end":{"line":19,"column":20}},"4":{"start":{"line":20,"column":27},"end":{"line":20,"column":64}},"5":{"start":{"line":22,"column":2},"end":{"line":24,"column":3}},"6":{"start":{"line":23,"column":4},"end":{"line":23,"column":72}},"7":{"start":{"line":26,"column":2},"end":{"line":28,"column":4}},"8":{"start":{"line":31,"column":0},"end":{"line":34,"column":2}}},"fnMap":{"0":{"name":"parse","decl":{"start":{"line":9,"column":15},"end":{"line":9,"column":20}},"loc":{"start":{"line":9,"column":30},"end":{"line":14,"column":1}},"line":9},"1":{"name":"dump","decl":{"start":{"line":16,"column":15},"end":{"line":16,"column":19}},"loc":{"start":{"line":16,"column":29},"end":{"line":29,"column":1}},"line":16}},"branchMap":{"0":{"loc":{"start":{"line":11,"column":25},"end":{"line":11,"column":59}},"type":"binary-expr","locations":[{"start":{"line":11,"column":25},"end":{"line":11,"column":53}},{"start":{"line":11,"column":57},"end":{"line":11,"column":59}}],"line":11},"1":{"loc":{"start":{"line":20,"column":27},"end":{"line":20,"column":64}},"type":"binary-expr","locations":[{"start":{"line":20,"column":27},"end":{"line":20,"column":58}},{"start":{"line":20,"column":62},"end":{"line":20,"column":64}}],"line":20},"2":{"loc":{"start":{"line":22,"column":2},"end":{"line":24,"column":3}},"type":"if","locations":[{"start":{"line":22,"column":2},"end":{"line":24,"column":3}},{"start":{"line":22,"column":2},"end":{"line":24,"column":3}}],"line":22},"3":{"loc":{"start":{"line":22,"column":6},"end":{"line":22,"column":66}},"type":"binary-expr","locations":[{"start":{"line":22,"column":6},"end":{"line":22,"column":19}},{"start":{"line":22,"column":23},"end":{"line":22,"column":66}}],"line":22},"4":{"loc":{"start":{"line":27,"column":19},"end":{"line":27,"column":38}},"type":"binary-expr","locations":[{"start":{"line":27,"column":19},"end":{"line":27,"column":32}},{"start":{"line":27,"column":36},"end":{"line":27,"column":38}}],"line":27}},"s":{"0":1,"1":1,"2":28,"3":6,"4":6,"5":6,"6":4,"7":6,"8":1},"f":{"0":28,"1":6},"b":{"0":[28,27],"1":[6,0],"2":[4,2],"3":[6,6],"4":[6,0]},"inputSourceMap":{"version":3,"sources":["emailProvider.js"],"names":["parse","context","emailProvider","assets","dump","excludedDefaults","exclude","defaults","includes"],"mappings":";;;;;;AAAA;;AAEA,eAAeA,KAAf,CAAqBC,OAArB,EAA8B;AAE5B,SAAO;AACLC,IAAAA,aAAa,EAAE,EAAE,IAAGD,OAAO,CAACE,MAAR,CAAeD,aAAf,IAAgC,EAAnC;AAAF;AADV,GAAP;AAGD;;AAED,eAAeE,IAAf,CAAoBH,OAApB,EAA6B;AAC3B,MAAI;AAAEC,IAAAA;AAAF,MAAoBD,OAAO,CAACE,MAAhC;AAEA,QAAME,gBAAgB,GAAGJ,OAAO,CAACE,MAAR,CAAeG,OAAf,CAAuBC,QAAvB,IAAmC,EAA5D;;AACA,MAAIL,aAAa,IAAI,CAACG,gBAAgB,CAACG,QAAjB,CAA0B,eAA1B,CAAtB,EAAkE;AAEhEN,IAAAA,aAAa,GAAG,qCAAsBA,aAAtB,CAAhB;AACD;;AAED,SAAO;AACLA,IAAAA,aAAa,EAAEA,aAAa,IAAI;AAD3B,GAAP;AAGD;;kBAEc;AACbF,EAAAA,KADa;AAEbI,EAAAA;AAFa,C","sourceRoot":"/home/circleci/repo/src/context/yaml/handlers/","sourcesContent":["import { emailProviderDefaults } from '../../defaults';\n\nasync function parse(context) {\n  // nothing to do, set default if empty\n  return {\n    emailProvider: { ...context.assets.emailProvider || {} }\n  };\n}\n\nasync function dump(context) {\n  let { emailProvider } = context.assets;\n\n  const excludedDefaults = context.assets.exclude.defaults || [];\n  if (emailProvider && !excludedDefaults.includes('emailProvider')) {\n    // Add placeholder for credentials as they cannot be exported\n    emailProvider = emailProviderDefaults(emailProvider);\n  }\n\n  return {\n    emailProvider: emailProvider || {}\n  };\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"675ee030927f4d7af2016c58724d7767fea379c6","contentHash":"751e0ce6c4264c826b4be82e2c7a6e6fa8b261e8d5bf2ee58b8fc2e56ec95c6a"},"/home/circleci/repo/src/context/defaults.js":{"path":"/home/circleci/repo/src/context/defaults.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":54}},"2":{"start":{"line":9,"column":18},"end":{"line":10,"column":3}},"3":{"start":{"line":11,"column":26},"end":{"line":11,"column":74}},"4":{"start":{"line":14,"column":6},"end":{"line":14,"column":13}},"5":{"start":{"line":16,"column":2},"end":{"line":21,"column":3}},"6":{"start":{"line":17,"column":4},"end":{"line":20,"column":6}},"7":{"start":{"line":23,"column":2},"end":{"line":31,"column":3}},"8":{"start":{"line":24,"column":4},"end":{"line":30,"column":6}},"9":{"start":{"line":33,"column":2},"end":{"line":40,"column":3}},"10":{"start":{"line":34,"column":4},"end":{"line":39,"column":6}},"11":{"start":{"line":42,"column":2},"end":{"line":42,"column":17}}},"fnMap":{"0":{"name":"emailProviderDefaults","decl":{"start":{"line":8,"column":9},"end":{"line":8,"column":30}},"loc":{"start":{"line":8,"column":46},"end":{"line":43,"column":1}},"line":8}},"branchMap":{"0":{"loc":{"start":{"line":16,"column":2},"end":{"line":21,"column":3}},"type":"if","locations":[{"start":{"line":16,"column":2},"end":{"line":21,"column":3}},{"start":{"line":16,"column":2},"end":{"line":21,"column":3}}],"line":16},"1":{"loc":{"start":{"line":19,"column":10},"end":{"line":19,"column":35}},"type":"binary-expr","locations":[{"start":{"line":19,"column":10},"end":{"line":19,"column":29}},{"start":{"line":19,"column":33},"end":{"line":19,"column":35}}],"line":19},"2":{"loc":{"start":{"line":23,"column":2},"end":{"line":31,"column":3}},"type":"if","locations":[{"start":{"line":23,"column":2},"end":{"line":31,"column":3}},{"start":{"line":23,"column":2},"end":{"line":31,"column":3}}],"line":23},"3":{"loc":{"start":{"line":29,"column":10},"end":{"line":29,"column":35}},"type":"binary-expr","locations":[{"start":{"line":29,"column":10},"end":{"line":29,"column":29}},{"start":{"line":29,"column":33},"end":{"line":29,"column":35}}],"line":29},"4":{"loc":{"start":{"line":33,"column":2},"end":{"line":40,"column":3}},"type":"if","locations":[{"start":{"line":33,"column":2},"end":{"line":40,"column":3}},{"start":{"line":33,"column":2},"end":{"line":40,"column":3}}],"line":33},"5":{"loc":{"start":{"line":38,"column":10},"end":{"line":38,"column":35}},"type":"binary-expr","locations":[{"start":{"line":38,"column":10},"end":{"line":38,"column":29}},{"start":{"line":38,"column":33},"end":{"line":38,"column":35}}],"line":38}},"s":{"0":1,"1":1,"2":11,"3":11,"4":11,"5":11,"6":4,"7":11,"8":6,"9":11,"10":1,"11":11},"f":{"0":11},"b":{"0":[4,7],"1":[4,4],"2":[6,5],"3":[6,6],"4":[1,10],"5":[1,1]},"inputSourceMap":{"version":3,"sources":["defaults.js"],"names":["emailProviderDefaults","emailProvider","updated","apiKeyProviders","name","includes","credentials","api_key","toUpperCase","smtp_host","smtp_port","smtp_user","smtp_pass","accessKeyId","secretAccessKey","region"],"mappings":";;;;;QAAgBA,qB,GAAAA,qB;;AAAT,SAASA,qBAAT,CAA+BC,aAA/B,EAA8C;AACnD,QAAMC,OAAO,GAAG,EAAE,GAAGD;AAAL,GAAhB;AAEA,QAAME,eAAe,GAAG,CAAE,SAAF,EAAa,UAAb,EAAyB,UAAzB,EAAqC,WAArC,CAAxB;AAGA,QAAM;AAAEC,IAAAA;AAAF,MAAWF,OAAjB;;AAEA,MAAIC,eAAe,CAACE,QAAhB,CAAyBD,IAAzB,CAAJ,EAAoC;AAClCF,IAAAA,OAAO,CAACI,WAAR,GAAsB;AACpBC,MAAAA,OAAO,EAAG,KAAIH,IAAI,CAACI,WAAL,EAAmB,YADb;AAEpB,UAAGN,OAAO,CAACI,WAAR,IAAuB,EAA1B;AAFoB,KAAtB;AAID;;AAED,MAAIF,IAAI,KAAK,MAAb,EAAqB;AACnBF,IAAAA,OAAO,CAACI,WAAR,GAAsB;AACpBG,MAAAA,SAAS,EAAE,mBADS;AAEpBC,MAAAA,SAAS,EAAE,eAFS;AAGpBC,MAAAA,SAAS,EAAE,eAHS;AAIpBC,MAAAA,SAAS,EAAE,eAJS;AAKpB,UAAGV,OAAO,CAACI,WAAR,IAAuB,EAA1B;AALoB,KAAtB;AAOD;;AAED,MAAIF,IAAI,KAAK,KAAb,EAAoB;AAClBF,IAAAA,OAAO,CAACI,WAAR,GAAsB;AACpBO,MAAAA,WAAW,EAAE,uBADO;AAEpBC,MAAAA,eAAe,EAAE,2BAFG;AAGpBC,MAAAA,MAAM,EAAE,oBAHY;AAIpB,UAAGb,OAAO,CAACI,WAAR,IAAuB,EAA1B;AAJoB,KAAtB;AAMD;;AAED,SAAOJ,OAAP;AACD","sourceRoot":"/home/circleci/repo/src/context/","sourcesContent":["export function emailProviderDefaults(emailProvider) {  // eslint-disable-line\n  const updated = { ...emailProvider };\n\n  const apiKeyProviders = [ 'mailgun', 'mandrill', 'sendgrid', 'sparkpost' ];\n\n  // Add placeholder for credentials as they cannot be exported\n  const { name } = updated;\n\n  if (apiKeyProviders.includes(name)) {\n    updated.credentials = {\n      api_key: `##${name.toUpperCase()}_API_KEY##`,\n      ...updated.credentials || {}\n    };\n  }\n\n  if (name === 'smtp') {\n    updated.credentials = {\n      smtp_host: '##SMTP_HOSTNAME##',\n      smtp_port: '##SMTP_PORT##',\n      smtp_user: '##SMTP_USER##',\n      smtp_pass: '##SMTP_PASS##',\n      ...updated.credentials || {}\n    };\n  }\n\n  if (name === 'ses') {\n    updated.credentials = {\n      accessKeyId: '##SES_ACCESS_KEY_ID##',\n      secretAccessKey: '##SES_ACCESS_SECRET_KEY##',\n      region: '##SES_AWS_REGION##',\n      ...updated.credentials || {}\n    };\n  }\n\n  return updated;\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"f496dfd74ce171704205658ba0af56f7d9bcee6e","contentHash":"da39413b97766ef1fa849a4f382a121bc51e551c4c34dfeff5b22a31f84c7a3d"},"/home/circleci/repo/src/context/yaml/handlers/connections.js":{"path":"/home/circleci/repo/src/context/yaml/handlers/connections.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":12},"end":{"line":7,"column":27}},"2":{"start":{"line":9,"column":13},"end":{"line":9,"column":42}},"3":{"start":{"line":11,"column":15},"end":{"line":11,"column":34}},"4":{"start":{"line":13,"column":16},"end":{"line":13,"column":48}},"5":{"start":{"line":15,"column":13},"end":{"line":15,"column":38}},"6":{"start":{"line":17,"column":14},"end":{"line":17,"column":40}},"7":{"start":{"line":19,"column":15},"end":{"line":19,"column":46}},"8":{"start":{"line":21,"column":13},"end":{"line":21,"column":38}},"9":{"start":{"line":23,"column":39},"end":{"line":23,"column":93}},"10":{"start":{"line":28,"column":6},"end":{"line":28,"column":20}},"11":{"start":{"line":30,"column":28},"end":{"line":30,"column":105}},"12":{"start":{"line":32,"column":2},"end":{"line":36,"column":3}},"13":{"start":{"line":33,"column":4},"end":{"line":35,"column":6}},"14":{"start":{"line":38,"column":2},"end":{"line":52,"column":4}},"15":{"start":{"line":40,"column":6},"end":{"line":48,"column":7}},"16":{"start":{"line":41,"column":8},"end":{"line":41,"column":65}},"17":{"start":{"line":43,"column":29},"end":{"line":43,"column":98}},"18":{"start":{"line":45,"column":8},"end":{"line":47,"column":9}},"19":{"start":{"line":46,"column":10},"end":{"line":46,"column":73}},"20":{"start":{"line":50,"column":6},"end":{"line":50,"column":24}},"21":{"start":{"line":55,"column":28},"end":{"line":67,"column":1}},"22":{"start":{"line":56,"column":2},"end":{"line":66,"column":3}},"23":{"start":{"line":57,"column":4},"end":{"line":63,"column":6}},"24":{"start":{"line":65,"column":4},"end":{"line":65,"column":14}},"25":{"start":{"line":72,"column":6},"end":{"line":72,"column":20}},"26":{"start":{"line":73,"column":2},"end":{"line":73,"column":30}},"27":{"start":{"line":73,"column":20},"end":{"line":73,"column":30}},"28":{"start":{"line":74,"column":2},"end":{"line":104,"column":4}},"29":{"start":{"line":76,"column":31},"end":{"line":81,"column":7}},"30":{"start":{"line":83,"column":6},"end":{"line":100,"column":7}},"31":{"start":{"line":84,"column":8},"end":{"line":84,"column":65}},"32":{"start":{"line":86,"column":34},"end":{"line":86,"column":111}},"33":{"start":{"line":88,"column":31},"end":{"line":88,"column":74}},"34":{"start":{"line":89,"column":21},"end":{"line":89,"column":56}},"35":{"start":{"line":91,"column":36},"end":{"line":91,"column":100}},"36":{"start":{"line":93,"column":8},"end":{"line":93,"column":64}},"37":{"start":{"line":95,"column":8},"end":{"line":95,"column":59}},"38":{"start":{"line":97,"column":8},"end":{"line":97,"column":67}},"39":{"start":{"line":99,"column":8},"end":{"line":99,"column":73}},"40":{"start":{"line":102,"column":6},"end":{"line":102,"column":30}},"41":{"start":{"line":107,"column":0},"end":{"line":110,"column":2}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":23,"column":9},"end":{"line":23,"column":31}},"loc":{"start":{"line":23,"column":37},"end":{"line":23,"column":95}},"line":23},"1":{"name":"parse","decl":{"start":{"line":25,"column":15},"end":{"line":25,"column":20}},"loc":{"start":{"line":25,"column":30},"end":{"line":53,"column":1}},"line":25},"2":{"name":"(anonymous_2)","decl":{"start":{"line":39,"column":37},"end":{"line":39,"column":38}},"loc":{"start":{"line":39,"column":51},"end":{"line":51,"column":5}},"line":39},"3":{"name":"(anonymous_3)","decl":{"start":{"line":55,"column":28},"end":{"line":55,"column":29}},"loc":{"start":{"line":55,"column":53},"end":{"line":67,"column":1}},"line":55},"4":{"name":"dump","decl":{"start":{"line":69,"column":15},"end":{"line":69,"column":19}},"loc":{"start":{"line":69,"column":29},"end":{"line":105,"column":1}},"line":69},"5":{"name":"(anonymous_5)","decl":{"start":{"line":75,"column":33},"end":{"line":75,"column":34}},"loc":{"start":{"line":75,"column":47},"end":{"line":103,"column":5}},"line":75}},"branchMap":{"0":{"loc":{"start":{"line":23,"column":46},"end":{"line":23,"column":92}},"type":"cond-expr","locations":[{"start":{"line":23,"column":70},"end":{"line":23,"column":73}},{"start":{"line":23,"column":76},"end":{"line":23,"column":92}}],"line":23},"1":{"loc":{"start":{"line":23,"column":46},"end":{"line":23,"column":67}},"type":"binary-expr","locations":[{"start":{"line":23,"column":46},"end":{"line":23,"column":49}},{"start":{"line":23,"column":53},"end":{"line":23,"column":67}}],"line":23},"2":{"loc":{"start":{"line":32,"column":2},"end":{"line":36,"column":3}},"type":"if","locations":[{"start":{"line":32,"column":2},"end":{"line":36,"column":3}},{"start":{"line":32,"column":2},"end":{"line":36,"column":3}}],"line":32},"3":{"loc":{"start":{"line":32,"column":6},"end":{"line":32,"column":41}},"type":"binary-expr","locations":[{"start":{"line":32,"column":6},"end":{"line":32,"column":18}},{"start":{"line":32,"column":22},"end":{"line":32,"column":41}}],"line":32},"4":{"loc":{"start":{"line":40,"column":6},"end":{"line":48,"column":7}},"type":"if","locations":[{"start":{"line":40,"column":6},"end":{"line":48,"column":7}},{"start":{"line":40,"column":6},"end":{"line":48,"column":7}}],"line":40},"5":{"loc":{"start":{"line":45,"column":8},"end":{"line":47,"column":9}},"type":"if","locations":[{"start":{"line":45,"column":8},"end":{"line":47,"column":9}},{"start":{"line":45,"column":8},"end":{"line":47,"column":9}}],"line":45},"6":{"loc":{"start":{"line":73,"column":2},"end":{"line":73,"column":30}},"type":"if","locations":[{"start":{"line":73,"column":2},"end":{"line":73,"column":30}},{"start":{"line":73,"column":2},"end":{"line":73,"column":30}}],"line":73},"7":{"loc":{"start":{"line":78,"column":12},"end":{"line":80,"column":9}},"type":"binary-expr","locations":[{"start":{"line":78,"column":12},"end":{"line":78,"column":38}},{"start":{"line":78,"column":42},"end":{"line":80,"column":9}}],"line":78},"8":{"loc":{"start":{"line":83,"column":6},"end":{"line":100,"column":7}},"type":"if","locations":[{"start":{"line":83,"column":6},"end":{"line":100,"column":7}},{"start":{"line":83,"column":6},"end":{"line":100,"column":7}}],"line":83}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":3,"10":28,"11":28,"12":28,"13":27,"14":1,"15":3,"16":1,"17":1,"18":1,"19":1,"20":3,"21":1,"22":5,"23":5,"24":2,"25":5,"26":5,"27":0,"28":5,"29":5,"30":5,"31":1,"32":1,"33":1,"34":1,"35":1,"36":1,"37":1,"38":1,"39":1,"40":5,"41":1},"f":{"0":3,"1":28,"2":3,"3":5,"4":5,"5":5},"b":{"0":[1,2],"1":[3,3],"2":[27,1],"3":[28,1],"4":[1,2],"5":[1,0],"6":[0,5],"7":[5,5],"8":[1,4]},"inputSourceMap":{"version":3,"sources":["connections.js"],"names":["parse","context","connections","assets","connectionsFolder","path","join","basePath","constants","CONNECTIONS_DIRECTORY","length","map","connection","strategy","htmlFileName","options","email","body","loadFile","getFormattedOptions","clients","idpinitiated","client_id","e","dump","dumpedConnection","enabled_clients","connectionName","name","html","emailConnectionHtml","log","info","fs","ensureDirSync","writeFileSync"],"mappings":"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","sourceRoot":"/home/circleci/repo/src/context/yaml/handlers/","sourcesContent":["import path from 'path';\nimport fs from 'fs-extra';\nimport { constants } from '../../../tools';\n\nimport log from '../../../logger';\nimport {\n  isFile, sanitize, ensureProp, convertClientIdToName, mapClientID2NameSorted\n} from '../../../utils';\n\nasync function parse(context) {\n  // Load the HTML file for email connections\n\n  const { connections } = context.assets;\n  const connectionsFolder = path.join(context.basePath, constants.CONNECTIONS_DIRECTORY);\n\n  if (!connections || !connections.length) {\n    return { connections: context.assets.connections };\n  }\n\n  return {\n    connections: [\n      ...connections.map((connection) => {\n        if (connection.strategy === 'email') {\n          ensureProp(connection, 'options.email.body');\n          const htmlFileName = path.join(connectionsFolder, connection.options.email.body);\n\n          if (isFile(htmlFileName)) {\n            connection.options.email.body = context.loadFile(htmlFileName);\n          }\n        }\n\n        return connection;\n      })\n    ]\n  };\n}\n\nconst getFormattedOptions = (connection, clients) => {\n  try {\n    return {\n      options: {\n        ...connection.options,\n        idpinitiated: {\n          ...connection.options.idpinitiated,\n          client_id: convertClientIdToName(\n            connection.options.idpinitiated.client_id,\n            clients\n          )\n        }\n      }\n    };\n  } catch (e) {\n    return {};\n  }\n};\n\nasync function dump(context) {\n  const { connections } = context.assets;\n\n  // Nothing to do\n  if (!connections) return {};\n\n  // nothing to do, set default if empty\n  return {\n    connections: connections.map((connection) => {\n      const dumpedConnection = {\n        ...connection,\n        ...getFormattedOptions(connection, context.assets.clients),\n        ...(connection.enabled_clients && { enabled_clients: mapClientID2NameSorted(connection.enabled_clients, context.assets.clients) })\n      };\n\n      if (dumpedConnection.strategy === 'email') {\n        ensureProp(connection, 'options.email.body');\n        const connectionsFolder = path.join(context.basePath, constants.CONNECTIONS_DIRECTORY);\n        const connectionName = sanitize(dumpedConnection.name);\n        const html = dumpedConnection.options.email.body;\n        const emailConnectionHtml = path.join(connectionsFolder, `${connectionName}.html`);\n\n        log.info(`Writing ${emailConnectionHtml}`);\n        fs.ensureDirSync(connectionsFolder);\n        fs.writeFileSync(emailConnectionHtml, html);\n\n        dumpedConnection.options.email.body = `./${connectionName}.html`;\n      }\n\n      return dumpedConnection;\n    })\n  };\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"bb02c8bfc923941d29819d346d3d4cdd35a3bbbf","contentHash":"ba66d1806e0bb90db72382be1dda27d5f1f2d24b7d524bf434ddf9e5783b432c"},"/home/circleci/repo/src/context/yaml/handlers/databases.js":{"path":"/home/circleci/repo/src/context/yaml/handlers/databases.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":15},"end":{"line":7,"column":34}},"2":{"start":{"line":9,"column":16},"end":{"line":9,"column":48}},"3":{"start":{"line":11,"column":12},"end":{"line":11,"column":27}},"4":{"start":{"line":13,"column":13},"end":{"line":13,"column":42}},"5":{"start":{"line":15,"column":13},"end":{"line":15,"column":38}},"6":{"start":{"line":17,"column":14},"end":{"line":17,"column":40}},"7":{"start":{"line":19,"column":15},"end":{"line":19,"column":46}},"8":{"start":{"line":21,"column":39},"end":{"line":21,"column":93}},"9":{"start":{"line":24,"column":2},"end":{"line":24,"column":43}},"10":{"start":{"line":24,"column":33},"end":{"line":24,"column":43}},"11":{"start":{"line":25,"column":2},"end":{"line":35,"column":4}},"12":{"start":{"line":26,"column":61},"end":{"line":34,"column":5}},"13":{"start":{"line":29,"column":109},"end":{"line":31,"column":11}},"14":{"start":{"line":41,"column":6},"end":{"line":41,"column":20}},"15":{"start":{"line":42,"column":2},"end":{"line":42,"column":28}},"16":{"start":{"line":42,"column":18},"end":{"line":42,"column":28}},"17":{"start":{"line":44,"column":28},"end":{"line":47,"column":3}},"18":{"start":{"line":45,"column":4},"end":{"line":45,"column":34}},"19":{"start":{"line":45,"column":25},"end":{"line":45,"column":34}},"20":{"start":{"line":46,"column":4},"end":{"line":46,"column":34}},"21":{"start":{"line":49,"column":2},"end":{"line":77,"column":4}},"22":{"start":{"line":50,"column":46},"end":{"line":76,"column":5}},"23":{"start":{"line":57,"column":27},"end":{"line":57,"column":62}},"24":{"start":{"line":59,"column":29},"end":{"line":59,"column":109}},"25":{"start":{"line":61,"column":12},"end":{"line":61,"column":54}},"26":{"start":{"line":63,"column":31},"end":{"line":63,"column":57}},"27":{"start":{"line":65,"column":31},"end":{"line":65,"column":80}},"28":{"start":{"line":67,"column":12},"end":{"line":67,"column":59}},"29":{"start":{"line":69,"column":12},"end":{"line":69,"column":64}},"30":{"start":{"line":71,"column":12},"end":{"line":71,"column":69}},"31":{"start":{"line":72,"column":12},"end":{"line":72,"column":27}},"32":{"start":{"line":80,"column":0},"end":{"line":83,"column":2}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":21,"column":9},"end":{"line":21,"column":31}},"loc":{"start":{"line":21,"column":37},"end":{"line":21,"column":95}},"line":21},"1":{"name":"parse","decl":{"start":{"line":23,"column":15},"end":{"line":23,"column":20}},"loc":{"start":{"line":23,"column":30},"end":{"line":36,"column":1}},"line":23},"2":{"name":"(anonymous_2)","decl":{"start":{"line":26,"column":48},"end":{"line":26,"column":49}},"loc":{"start":{"line":26,"column":61},"end":{"line":34,"column":5}},"line":26},"3":{"name":"(anonymous_3)","decl":{"start":{"line":29,"column":79},"end":{"line":29,"column":80}},"loc":{"start":{"line":29,"column":109},"end":{"line":31,"column":11}},"line":29},"4":{"name":"dump","decl":{"start":{"line":38,"column":15},"end":{"line":38,"column":19}},"loc":{"start":{"line":38,"column":29},"end":{"line":78,"column":1}},"line":38},"5":{"name":"(anonymous_5)","decl":{"start":{"line":44,"column":28},"end":{"line":44,"column":29}},"loc":{"start":{"line":44,"column":50},"end":{"line":47,"column":3}},"line":44},"6":{"name":"(anonymous_6)","decl":{"start":{"line":50,"column":33},"end":{"line":50,"column":34}},"loc":{"start":{"line":50,"column":46},"end":{"line":76,"column":5}},"line":50},"7":{"name":"(anonymous_7)","decl":{"start":{"line":56,"column":103},"end":{"line":56,"column":104}},"loc":{"start":{"line":56,"column":132},"end":{"line":73,"column":11}},"line":56}},"branchMap":{"0":{"loc":{"start":{"line":21,"column":46},"end":{"line":21,"column":92}},"type":"cond-expr","locations":[{"start":{"line":21,"column":70},"end":{"line":21,"column":73}},{"start":{"line":21,"column":76},"end":{"line":21,"column":92}}],"line":21},"1":{"loc":{"start":{"line":21,"column":46},"end":{"line":21,"column":67}},"type":"binary-expr","locations":[{"start":{"line":21,"column":46},"end":{"line":21,"column":49}},{"start":{"line":21,"column":53},"end":{"line":21,"column":67}}],"line":21},"2":{"loc":{"start":{"line":24,"column":2},"end":{"line":24,"column":43}},"type":"if","locations":[{"start":{"line":24,"column":2},"end":{"line":24,"column":43}},{"start":{"line":24,"column":2},"end":{"line":24,"column":43}}],"line":24},"3":{"loc":{"start":{"line":28,"column":12},"end":{"line":32,"column":9}},"type":"binary-expr","locations":[{"start":{"line":28,"column":12},"end":{"line":28,"column":42}},{"start":{"line":28,"column":46},"end":{"line":32,"column":9}}],"line":28},"4":{"loc":{"start":{"line":42,"column":2},"end":{"line":42,"column":28}},"type":"if","locations":[{"start":{"line":42,"column":2},"end":{"line":42,"column":28}},{"start":{"line":42,"column":2},"end":{"line":42,"column":28}}],"line":42},"5":{"loc":{"start":{"line":45,"column":4},"end":{"line":45,"column":34}},"type":"if","locations":[{"start":{"line":45,"column":4},"end":{"line":45,"column":34}},{"start":{"line":45,"column":4},"end":{"line":45,"column":34}}],"line":45},"6":{"loc":{"start":{"line":46,"column":11},"end":{"line":46,"column":33}},"type":"cond-expr","locations":[{"start":{"line":46,"column":27},"end":{"line":46,"column":28}},{"start":{"line":46,"column":31},"end":{"line":46,"column":33}}],"line":46},"7":{"loc":{"start":{"line":51,"column":10},"end":{"line":53,"column":7}},"type":"binary-expr","locations":[{"start":{"line":51,"column":10},"end":{"line":51,"column":34}},{"start":{"line":51,"column":38},"end":{"line":53,"column":7}}],"line":51},"8":{"loc":{"start":{"line":55,"column":12},"end":{"line":74,"column":9}},"type":"binary-expr","locations":[{"start":{"line":55,"column":12},"end":{"line":55,"column":42}},{"start":{"line":55,"column":46},"end":{"line":74,"column":9}}],"line":55}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":3,"9":28,"10":26,"11":2,"12":2,"13":7,"14":7,"15":7,"16":0,"17":7,"18":6,"19":0,"20":6,"21":7,"22":3,"23":8,"24":8,"25":8,"26":8,"27":8,"28":8,"29":8,"30":8,"31":8,"32":1},"f":{"0":3,"1":28,"2":2,"3":7,"4":7,"5":6,"6":3,"7":8},"b":{"0":[1,2],"1":[3,3],"2":[26,2],"3":[2,1],"4":[0,7],"5":[0,6],"6":[6,0],"7":[3,3],"8":[3,2]},"inputSourceMap":{"version":3,"sources":["databases.js"],"names":["parse","context","assets","databases","map","database","options","customScripts","Object","entries","reduce","scripts","name","script","loadFile","dump","sortCustomScripts","name1","name2","enabled_clients","clients","sort","dbName","dbFolder","path","join","basePath","fs","ensureDirSync","scriptName","scriptFile","log","info","writeFileSync"],"mappings":";;;;;;AAAA;;;;AACA;;;;AAEA;;AACA;;;;;;AAEA,eAAeA,KAAf,CAAqBC,OAArB,EAA8B;AAE5B,MAAI,CAACA,OAAO,CAACC,MAAR,CAAeC,SAApB,EAA+B,OAAO,EAAP;AAE/B,SAAO;AACLA,IAAAA,SAAS,EAAE,CACT,GAAGF,OAAO,CAACC,MAAR,CAAeC,SAAf,CAAyBC,GAAzB,CAA8BC,QAAD,KAAe,EAC7C,GAAGA,QAD0C;AAE7CC,MAAAA,OAAO,EAAE,EACP,GAAGD,QAAQ,CAACC,OADL;AAGP,YAAID,QAAQ,CAACC,OAAT,CAAiBC,aAAjB,IAAkC;AACpCA,UAAAA,aAAa,EAAEC,MAAM,CAACC,OAAP,CAAeJ,QAAQ,CAACC,OAAT,CAAiBC,aAAhC,EAA+CG,MAA/C,CAAsD,CAACC,OAAD,EAAU,CAAEC,IAAF,EAAQC,MAAR,CAAV,MAAgC,EACnG,GAAGF,OADgG;AAEnG,aAACC,IAAD,GAAQX,OAAO,CAACa,QAAR,CAAiBD,MAAjB;AAF2F,WAAhC,CAAtD,EAGX,EAHW;AADqB,SAAtC;AAHO;AAFoC,KAAf,CAA7B,CADM;AADN,GAAP;AAiBD;;AAED,eAAeE,IAAf,CAAoBd,OAApB,EAA6B;AAC3B,QAAM;AAAEE,IAAAA;AAAF,MAAgBF,OAAO,CAACC,MAA9B;AAGA,MAAI,CAACC,SAAL,EAAgB,OAAO,EAAP;;AAEhB,QAAMa,iBAAiB,GAAG,CAAC,CAAEC,KAAF,CAAD,EAAY,CAAEC,KAAF,CAAZ,KAA0B;AAClD,QAAID,KAAK,KAAKC,KAAd,EAAqB,OAAO,CAAP;AACrB,WAAOD,KAAK,GAAGC,KAAR,GAAgB,CAAhB,GAAoB,CAAC,CAA5B;AACD,GAHD;;AAKA,SAAO;AACLf,IAAAA,SAAS,EAAE,CACT,GAAGA,SAAS,CAACC,GAAV,CAAeC,QAAD,KAAe,EAC9B,GAAGA,QAD2B;AAE9B,UAAIA,QAAQ,CAACc,eAAT,IAA4B;AAAEA,QAAAA,eAAe,EAAE,mCAAuBd,QAAQ,CAACc,eAAhC,EAAiDlB,OAAO,CAACC,MAAR,CAAekB,OAAhE;AAAnB,OAAhC,CAF8B;AAG9Bd,MAAAA,OAAO,EAAE,EACP,GAAGD,QAAQ,CAACC,OADL;AAGP,YAAID,QAAQ,CAACC,OAAT,CAAiBC,aAAjB,IAAkC;AACpCA,UAAAA,aAAa,EAAEC,MAAM,CAACC,OAAP,CAAeJ,QAAQ,CAACC,OAAT,CAAiBC,aAAhC,EAA+Cc,IAA/C,CAAoDL,iBAApD,EAAuEN,MAAvE,CAA8E,CAACC,OAAD,EAAU,CAAEC,IAAF,EAAQC,MAAR,CAAV,KAA+B;AAE1H,kBAAMS,MAAM,GAAG,qBAASjB,QAAQ,CAACO,IAAlB,CAAf;;AACA,kBAAMW,QAAQ,GAAGC,eAAKC,IAAL,CAAUxB,OAAO,CAACyB,QAAlB,EAA4B,WAA5B,EAAyC,qBAASJ,MAAT,CAAzC,CAAjB;;AACAK,8BAAGC,aAAH,CAAiBL,QAAjB;;AAGA,kBAAMM,UAAU,GAAG,qBAASjB,IAAT,CAAnB;;AACA,kBAAMkB,UAAU,GAAGN,eAAKC,IAAL,CAAUF,QAAV,EAAqB,GAAEM,UAAW,KAAlC,CAAnB;;AACAE,6BAAIC,IAAJ,CAAU,WAAUF,UAAW,EAA/B;;AACAH,8BAAGM,aAAH,CAAiBH,UAAjB,EAA6BjB,MAA7B;;AACAF,YAAAA,OAAO,CAACC,IAAD,CAAP,GAAiB,eAAcU,MAAO,IAAGO,UAAW,KAApD;AACA,mBAAOlB,OAAP;AACD,WAbc,EAaZ,EAbY;AADqB,SAAtC;AAHO;AAHqB,KAAf,CAAd,CADM;AADN,GAAP;AA4BD;;kBAEc;AACbX,EAAAA,KADa;AAEbe,EAAAA;AAFa,C","sourceRoot":"/home/circleci/repo/src/context/yaml/handlers/","sourcesContent":["import fs from 'fs-extra';\nimport path from 'path';\n\nimport { mapClientID2NameSorted, sanitize } from '../../../utils';\nimport log from '../../../logger';\n\nasync function parse(context) {\n  // Load the script file for custom db\n  if (!context.assets.databases) return {};\n\n  return {\n    databases: [\n      ...context.assets.databases.map((database) => ({\n        ...database,\n        options: {\n          ...database.options,\n          // customScripts option only written if there are scripts\n          ...(database.options.customScripts && {\n            customScripts: Object.entries(database.options.customScripts).reduce((scripts, [ name, script ]) => ({\n              ...scripts,\n              [name]: context.loadFile(script)\n            }), {})\n          })\n        }\n      }))\n    ]\n  };\n}\n\nasync function dump(context) {\n  const { databases } = context.assets;\n\n  // Nothing to do\n  if (!databases) return {};\n\n  const sortCustomScripts = ([ name1 ], [ name2 ]) => {\n    if (name1 === name2) return 0;\n    return name1 > name2 ? 1 : -1;\n  };\n\n  return {\n    databases: [\n      ...databases.map((database) => ({\n        ...database,\n        ...(database.enabled_clients && { enabled_clients: mapClientID2NameSorted(database.enabled_clients, context.assets.clients) }),\n        options: {\n          ...database.options,\n          // customScripts option only written if there are scripts\n          ...(database.options.customScripts && {\n            customScripts: Object.entries(database.options.customScripts).sort(sortCustomScripts).reduce((scripts, [ name, script ]) => {\n              // Create Database folder\n              const dbName = sanitize(database.name);\n              const dbFolder = path.join(context.basePath, 'databases', sanitize(dbName));\n              fs.ensureDirSync(dbFolder);\n\n              // Dump custom script to file\n              const scriptName = sanitize(name);\n              const scriptFile = path.join(dbFolder, `${scriptName}.js`);\n              log.info(`Writing ${scriptFile}`);\n              fs.writeFileSync(scriptFile, script);\n              scripts[name] = `./databases/${dbName}/${scriptName}.js`;\n              return scripts;\n            }, {})\n          })\n        }\n      }))\n    ]\n  };\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"b8948731f339cf76be5c08231f8fa749a854db9d","contentHash":"865527a25964369d54fe0d4581e617315cbb957043f9c492526279e007c8f4a8"},"/home/circleci/repo/src/context/yaml/handlers/emailTemplates.js":{"path":"/home/circleci/repo/src/context/yaml/handlers/emailTemplates.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":15},"end":{"line":7,"column":34}},"2":{"start":{"line":9,"column":16},"end":{"line":9,"column":48}},"3":{"start":{"line":11,"column":12},"end":{"line":11,"column":27}},"4":{"start":{"line":13,"column":13},"end":{"line":13,"column":42}},"5":{"start":{"line":15,"column":14},"end":{"line":15,"column":40}},"6":{"start":{"line":17,"column":15},"end":{"line":17,"column":46}},"7":{"start":{"line":19,"column":39},"end":{"line":19,"column":93}},"8":{"start":{"line":22,"column":25},"end":{"line":22,"column":60}},"9":{"start":{"line":23,"column":2},"end":{"line":27,"column":4}},"10":{"start":{"line":24,"column":50},"end":{"line":26,"column":5}},"11":{"start":{"line":31,"column":23},"end":{"line":31,"column":65}},"12":{"start":{"line":33,"column":2},"end":{"line":49,"column":3}},"13":{"start":{"line":34,"column":28},"end":{"line":34,"column":83}},"14":{"start":{"line":36,"column":4},"end":{"line":36,"column":53}},"15":{"start":{"line":38,"column":4},"end":{"line":48,"column":7}},"16":{"start":{"line":39,"column":27},"end":{"line":39,"column":92}},"17":{"start":{"line":41,"column":6},"end":{"line":41,"column":55}},"18":{"start":{"line":43,"column":6},"end":{"line":43,"column":67}},"19":{"start":{"line":45,"column":6},"end":{"line":47,"column":8}},"20":{"start":{"line":51,"column":2},"end":{"line":53,"column":4}},"21":{"start":{"line":56,"column":0},"end":{"line":59,"column":2}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":19,"column":9},"end":{"line":19,"column":31}},"loc":{"start":{"line":19,"column":37},"end":{"line":19,"column":95}},"line":19},"1":{"name":"parse","decl":{"start":{"line":21,"column":15},"end":{"line":21,"column":20}},"loc":{"start":{"line":21,"column":30},"end":{"line":28,"column":1}},"line":21},"2":{"name":"(anonymous_2)","decl":{"start":{"line":24,"column":43},"end":{"line":24,"column":44}},"loc":{"start":{"line":24,"column":50},"end":{"line":26,"column":5}},"line":24},"3":{"name":"dump","decl":{"start":{"line":30,"column":15},"end":{"line":30,"column":19}},"loc":{"start":{"line":30,"column":29},"end":{"line":54,"column":1}},"line":30},"4":{"name":"(anonymous_4)","decl":{"start":{"line":38,"column":40},"end":{"line":38,"column":41}},"loc":{"start":{"line":38,"column":52},"end":{"line":48,"column":5}},"line":38}},"branchMap":{"0":{"loc":{"start":{"line":19,"column":46},"end":{"line":19,"column":92}},"type":"cond-expr","locations":[{"start":{"line":19,"column":70},"end":{"line":19,"column":73}},{"start":{"line":19,"column":76},"end":{"line":19,"column":92}}],"line":19},"1":{"loc":{"start":{"line":19,"column":46},"end":{"line":19,"column":67}},"type":"binary-expr","locations":[{"start":{"line":19,"column":46},"end":{"line":19,"column":49}},{"start":{"line":19,"column":53},"end":{"line":19,"column":67}}],"line":19},"2":{"loc":{"start":{"line":22,"column":25},"end":{"line":22,"column":60}},"type":"binary-expr","locations":[{"start":{"line":22,"column":25},"end":{"line":22,"column":54}},{"start":{"line":22,"column":58},"end":{"line":22,"column":60}}],"line":22},"3":{"loc":{"start":{"line":31,"column":28},"end":{"line":31,"column":63}},"type":"binary-expr","locations":[{"start":{"line":31,"column":28},"end":{"line":31,"column":57}},{"start":{"line":31,"column":61},"end":{"line":31,"column":63}}],"line":31},"4":{"loc":{"start":{"line":33,"column":2},"end":{"line":49,"column":3}},"type":"if","locations":[{"start":{"line":33,"column":2},"end":{"line":49,"column":3}},{"start":{"line":33,"column":2},"end":{"line":49,"column":3}}],"line":33}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":3,"8":28,"9":28,"10":2,"11":5,"12":5,"13":5,"14":5,"15":5,"16":46,"17":46,"18":46,"19":46,"20":5,"21":1},"f":{"0":3,"1":28,"2":2,"3":5,"4":46},"b":{"0":[1,2],"1":[3,3],"2":[28,27],"3":[5,0],"4":[5,0]},"inputSourceMap":{"version":3,"sources":["emailTemplates.js"],"names":["parse","context","emailTemplates","assets","map","et","body","loadFile","dump","length","templatesFolder","path","join","basePath","fs","ensureDirSync","template","templateFile","log","info","writeFileSync"],"mappings":";;;;;;AAAA;;;;AACA;;;;AAEA;;;;;;AAEA,eAAeA,KAAf,CAAqBC,OAArB,EAA8B;AAG5B,QAAMC,cAAc,GAAGD,OAAO,CAACE,MAAR,CAAeD,cAAf,IAAiC,EAAxD;AACA,SAAO;AACLA,IAAAA,cAAc,EAAE,CACd,GAAGA,cAAc,CAACE,GAAf,CAAoBC,EAAD,KAAS,EAC7B,GAAGA,EAD0B;AAE7BC,MAAAA,IAAI,EAAEL,OAAO,CAACM,QAAR,CAAiBF,EAAE,CAACC,IAApB;AAFuB,KAAT,CAAnB,CADW;AADX,GAAP;AAQD;;AAED,eAAeE,IAAf,CAAoBP,OAApB,EAA6B;AAC3B,MAAIC,cAAc,GAAG,CAAE,IAAGD,OAAO,CAACE,MAAR,CAAeD,cAAf,IAAiC,EAApC,CAAF,CAArB;;AAEA,MAAIA,cAAc,CAACO,MAAf,GAAwB,CAA5B,EAA+B;AAE7B,UAAMC,eAAe,GAAGC,eAAKC,IAAL,CAAUX,OAAO,CAACY,QAAlB,EAA4B,gBAA5B,CAAxB;;AACAC,sBAAGC,aAAH,CAAiBL,eAAjB;;AACAR,IAAAA,cAAc,GAAGA,cAAc,CAACE,GAAf,CAAoBY,QAAD,IAAc;AAEhD,YAAMC,YAAY,GAAGN,eAAKC,IAAL,CAAUF,eAAV,EAA4B,GAAEM,QAAQ,CAACA,QAAS,OAAhD,CAArB;;AACAE,uBAAIC,IAAJ,CAAU,WAAUF,YAAa,EAAjC;;AACAH,wBAAGM,aAAH,CAAiBH,YAAjB,EAA+BD,QAAQ,CAACV,IAAxC;;AACA,aAAO,EAAE,GAAGU,QAAL;AAAeV,QAAAA,IAAI,EAAG,oBAAmBU,QAAQ,CAACA,QAAS;AAA3D,OAAP;AACD,KANgB,CAAjB;AAOD;;AAED,SAAO;AAAEd,IAAAA;AAAF,GAAP;AACD;;kBAEc;AACbF,EAAAA,KADa;AAEbQ,EAAAA;AAFa,C","sourceRoot":"/home/circleci/repo/src/context/yaml/handlers/","sourcesContent":["import fs from 'fs-extra';\nimport path from 'path';\n\nimport log from '../../../logger';\n\nasync function parse(context) {\n  // Load the HTML file for each page\n\n  const emailTemplates = context.assets.emailTemplates || [];\n  return {\n    emailTemplates: [\n      ...emailTemplates.map((et) => ({\n        ...et,\n        body: context.loadFile(et.body)\n      }))\n    ]\n  };\n}\n\nasync function dump(context) {\n  let emailTemplates = [ ...context.assets.emailTemplates || [] ];\n\n  if (emailTemplates.length > 0) {\n    // Create Templates folder\n    const templatesFolder = path.join(context.basePath, 'emailTemplates');\n    fs.ensureDirSync(templatesFolder);\n    emailTemplates = emailTemplates.map((template) => {\n      // Dump template to file\n      const templateFile = path.join(templatesFolder, `${template.template}.html`);\n      log.info(`Writing ${templateFile}`);\n      fs.writeFileSync(templateFile, template.body);\n      return { ...template, body: `./emailTemplates/${template.template}.html` };\n    });\n  }\n\n  return { emailTemplates };\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"c65a66830c38352277055238f708d0f5643808ca","contentHash":"a3de2be8b3da08cac522a980fae8af8f1e6edbe851588a8f620f5212fdb7c681"},"/home/circleci/repo/src/context/yaml/handlers/clientGrants.js":{"path":"/home/circleci/repo/src/context/yaml/handlers/clientGrants.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":13},"end":{"line":7,"column":38}},"2":{"start":{"line":10,"column":2},"end":{"line":12,"column":4}},"3":{"start":{"line":18,"column":6},"end":{"line":18,"column":20}},"4":{"start":{"line":19,"column":2},"end":{"line":19,"column":31}},"5":{"start":{"line":19,"column":21},"end":{"line":19,"column":31}},"6":{"start":{"line":20,"column":2},"end":{"line":27,"column":4}},"7":{"start":{"line":22,"column":24},"end":{"line":23,"column":7}},"8":{"start":{"line":24,"column":6},"end":{"line":24,"column":107}},"9":{"start":{"line":25,"column":6},"end":{"line":25,"column":23}},"10":{"start":{"line":30,"column":0},"end":{"line":33,"column":2}}},"fnMap":{"0":{"name":"parse","decl":{"start":{"line":9,"column":15},"end":{"line":9,"column":20}},"loc":{"start":{"line":9,"column":30},"end":{"line":13,"column":1}},"line":9},"1":{"name":"dump","decl":{"start":{"line":15,"column":15},"end":{"line":15,"column":19}},"loc":{"start":{"line":15,"column":29},"end":{"line":28,"column":1}},"line":15},"2":{"name":"(anonymous_2)","decl":{"start":{"line":21,"column":35},"end":{"line":21,"column":36}},"loc":{"start":{"line":21,"column":44},"end":{"line":26,"column":5}},"line":21}},"branchMap":{"0":{"loc":{"start":{"line":19,"column":2},"end":{"line":19,"column":31}},"type":"if","locations":[{"start":{"line":19,"column":2},"end":{"line":19,"column":31}},{"start":{"line":19,"column":2},"end":{"line":19,"column":31}}],"line":19}},"s":{"0":1,"1":1,"2":28,"3":5,"4":5,"5":0,"6":5,"7":1,"8":1,"9":1,"10":1},"f":{"0":28,"1":5,"2":1},"b":{"0":[0,5]},"inputSourceMap":{"version":3,"sources":["clientGrants.js"],"names":["parse","context","clientGrants","assets","dump","map","grant","dumpGrant","client_id","clients"],"mappings":";;;;;;AAAA;;AAEA,eAAeA,KAAf,CAAqBC,OAArB,EAA8B;AAE5B,SAAO;AACLC,IAAAA,YAAY,EAAED,OAAO,CAACE,MAAR,CAAeD;AADxB,GAAP;AAGD;;AAED,eAAeE,IAAf,CAAoBH,OAApB,EAA6B;AAC3B,QAAM;AAAEC,IAAAA;AAAF,MAAmBD,OAAO,CAACE,MAAjC;AAGA,MAAI,CAACD,YAAL,EAAmB,OAAO,EAAP;AAGnB,SAAO;AACLA,IAAAA,YAAY,EAAEA,YAAY,CAACG,GAAb,CAAkBC,KAAD,IAAW;AACxC,YAAMC,SAAS,GAAG,EAAE,GAAGD;AAAL,OAAlB;AACAC,MAAAA,SAAS,CAACC,SAAV,GAAsB,kCAAsBD,SAAS,CAACC,SAAhC,EAA2CP,OAAO,CAACE,MAAR,CAAeM,OAA1D,CAAtB;AACA,aAAOF,SAAP;AACD,KAJa;AADT,GAAP;AAOD;;kBAEc;AACbP,EAAAA,KADa;AAEbI,EAAAA;AAFa,C","sourceRoot":"/home/circleci/repo/src/context/yaml/handlers/","sourcesContent":["import { convertClientIdToName } from '../../../utils';\n\nasync function parse(context) {\n  // nothing to do, set default empty\n  return {\n    clientGrants: context.assets.clientGrants\n  };\n}\n\nasync function dump(context) {\n  const { clientGrants } = context.assets;\n\n  // Nothing to do\n  if (!clientGrants) return {};\n\n  // Convert client_id to the client name for readability\n  return {\n    clientGrants: clientGrants.map((grant) => {\n      const dumpGrant = { ...grant };\n      dumpGrant.client_id = convertClientIdToName(dumpGrant.client_id, context.assets.clients);\n      return dumpGrant;\n    })\n  };\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"4c0596ad95fd3033094a3be5fd999e37e51d1601","contentHash":"eff5d9b5d7ce914e88389bd50c24102b1123c4363b0f8712a8c6ab8125336ff4"},"/home/circleci/repo/src/context/yaml/handlers/rulesConfigs.js":{"path":"/home/circleci/repo/src/context/yaml/handlers/rulesConfigs.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":8,"column":2},"end":{"line":10,"column":4}},"2":{"start":{"line":14,"column":2},"end":{"line":16,"column":4}},"3":{"start":{"line":19,"column":0},"end":{"line":22,"column":2}}},"fnMap":{"0":{"name":"parse","decl":{"start":{"line":7,"column":15},"end":{"line":7,"column":20}},"loc":{"start":{"line":7,"column":30},"end":{"line":11,"column":1}},"line":7},"1":{"name":"dump","decl":{"start":{"line":13,"column":15},"end":{"line":13,"column":19}},"loc":{"start":{"line":13,"column":22},"end":{"line":17,"column":1}},"line":13}},"branchMap":{},"s":{"0":1,"1":28,"2":5,"3":1},"f":{"0":28,"1":5},"b":{},"inputSourceMap":{"version":3,"sources":["rulesConfigs.js"],"names":["parse","context","rulesConfigs","assets","dump"],"mappings":";;;;;;AAAA,eAAeA,KAAf,CAAqBC,OAArB,EAA8B;AAE5B,SAAO;AACLC,IAAAA,YAAY,EAAED,OAAO,CAACE,MAAR,CAAeD;AADxB,GAAP;AAGD;;AAED,eAAeE,IAAf,GAAsB;AAEpB,SAAO;AACLF,IAAAA,YAAY,EAAE;AADT,GAAP;AAGD;;kBAEc;AACbF,EAAAA,KADa;AAEbI,EAAAA;AAFa,C","sourceRoot":"/home/circleci/repo/src/context/yaml/handlers/","sourcesContent":["async function parse(context) {\n  // nothing to do, set default if empty\n  return {\n    rulesConfigs: context.assets.rulesConfigs\n  };\n}\n\nasync function dump() {\n  // do not export rulesConfigs as its values cannot be extracted\n  return {\n    rulesConfigs: []\n  };\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"82b28d81a712331ca63fed7eb9439aa9a9347fd7","contentHash":"2a0570656b9291a6ebb434b11f81f61f2860e63dddc36ae6cd721fddf3c46788"},"/home/circleci/repo/src/context/yaml/handlers/resourceServers.js":{"path":"/home/circleci/repo/src/context/yaml/handlers/resourceServers.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":8,"column":2},"end":{"line":10,"column":4}},"2":{"start":{"line":14,"column":2},"end":{"line":16,"column":4}},"3":{"start":{"line":19,"column":0},"end":{"line":22,"column":2}}},"fnMap":{"0":{"name":"parse","decl":{"start":{"line":7,"column":15},"end":{"line":7,"column":20}},"loc":{"start":{"line":7,"column":30},"end":{"line":11,"column":1}},"line":7},"1":{"name":"dump","decl":{"start":{"line":13,"column":15},"end":{"line":13,"column":19}},"loc":{"start":{"line":13,"column":29},"end":{"line":17,"column":1}},"line":13}},"branchMap":{"0":{"loc":{"start":{"line":15,"column":26},"end":{"line":15,"column":62}},"type":"binary-expr","locations":[{"start":{"line":15,"column":26},"end":{"line":15,"column":56}},{"start":{"line":15,"column":60},"end":{"line":15,"column":62}}],"line":15}},"s":{"0":1,"1":28,"2":5,"3":1},"f":{"0":28,"1":5},"b":{"0":[5,0]},"inputSourceMap":{"version":3,"sources":["resourceServers.js"],"names":["parse","context","resourceServers","assets","dump"],"mappings":";;;;;;AAAA,eAAeA,KAAf,CAAqBC,OAArB,EAA8B;AAE5B,SAAO;AACLC,IAAAA,eAAe,EAAED,OAAO,CAACE,MAAR,CAAeD;AAD3B,GAAP;AAGD;;AAED,eAAeE,IAAf,CAAoBH,OAApB,EAA6B;AAE3B,SAAO;AACLC,IAAAA,eAAe,EAAE,CAAE,IAAGD,OAAO,CAACE,MAAR,CAAeD,eAAf,IAAkC,EAArC,CAAF;AADZ,GAAP;AAGD;;kBAEc;AACbF,EAAAA,KADa;AAEbI,EAAAA;AAFa,C","sourceRoot":"/home/circleci/repo/src/context/yaml/handlers/","sourcesContent":["async function parse(context) {\n  // nothing to do, set default if empty\n  return {\n    resourceServers: context.assets.resourceServers\n  };\n}\n\nasync function dump(context) {\n  // nothing to do, set default if empty\n  return {\n    resourceServers: [ ...context.assets.resourceServers || [] ]\n  };\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"5a67a34a6d6f6d5d5df946e01105de2f0ee3fe3c","contentHash":"286b8b37e1e2229e809793ed584307602b68c318906d07b3bdc4ac3e39489a5a"},"/home/circleci/repo/src/context/yaml/handlers/guardianFactors.js":{"path":"/home/circleci/repo/src/context/yaml/handlers/guardianFactors.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":8,"column":2},"end":{"line":10,"column":4}},"2":{"start":{"line":14,"column":2},"end":{"line":16,"column":4}},"3":{"start":{"line":19,"column":0},"end":{"line":22,"column":2}}},"fnMap":{"0":{"name":"parse","decl":{"start":{"line":7,"column":15},"end":{"line":7,"column":20}},"loc":{"start":{"line":7,"column":30},"end":{"line":11,"column":1}},"line":7},"1":{"name":"dump","decl":{"start":{"line":13,"column":15},"end":{"line":13,"column":19}},"loc":{"start":{"line":13,"column":29},"end":{"line":17,"column":1}},"line":13}},"branchMap":{"0":{"loc":{"start":{"line":9,"column":26},"end":{"line":9,"column":62}},"type":"binary-expr","locations":[{"start":{"line":9,"column":26},"end":{"line":9,"column":56}},{"start":{"line":9,"column":60},"end":{"line":9,"column":62}}],"line":9},"1":{"loc":{"start":{"line":15,"column":26},"end":{"line":15,"column":62}},"type":"binary-expr","locations":[{"start":{"line":15,"column":26},"end":{"line":15,"column":56}},{"start":{"line":15,"column":60},"end":{"line":15,"column":62}}],"line":15}},"s":{"0":1,"1":28,"2":5,"3":1},"f":{"0":28,"1":5},"b":{"0":[28,27],"1":[5,0]},"inputSourceMap":{"version":3,"sources":["guardianFactors.js"],"names":["parse","context","guardianFactors","assets","dump"],"mappings":";;;;;;AAAA,eAAeA,KAAf,CAAqBC,OAArB,EAA8B;AAE5B,SAAO;AACLC,IAAAA,eAAe,EAAE,CAAE,IAAGD,OAAO,CAACE,MAAR,CAAeD,eAAf,IAAkC,EAArC,CAAF;AADZ,GAAP;AAGD;;AAED,eAAeE,IAAf,CAAoBH,OAApB,EAA6B;AAE3B,SAAO;AACLC,IAAAA,eAAe,EAAE,CAAE,IAAGD,OAAO,CAACE,MAAR,CAAeD,eAAf,IAAkC,EAArC,CAAF;AADZ,GAAP;AAGD;;kBAEc;AACbF,EAAAA,KADa;AAEbI,EAAAA;AAFa,C","sourceRoot":"/home/circleci/repo/src/context/yaml/handlers/","sourcesContent":["async function parse(context) {\n  // nothing to do, set default if empty\n  return {\n    guardianFactors: [ ...context.assets.guardianFactors || [] ]\n  };\n}\n\nasync function dump(context) {\n  // nothing to do, set default empty\n  return {\n    guardianFactors: [ ...context.assets.guardianFactors || [] ]\n  };\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"f0746337a2efd3f5d5d084093ce8cdbc751e0afd","contentHash":"fdf112126c8a91b2ad1790ddc5c88c58fe9dc93b45862d8b56501a6d2af0ce68"},"/home/circleci/repo/src/context/yaml/handlers/guardianFactorProviders.js":{"path":"/home/circleci/repo/src/context/yaml/handlers/guardianFactorProviders.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":8,"column":2},"end":{"line":10,"column":4}},"2":{"start":{"line":14,"column":2},"end":{"line":16,"column":4}},"3":{"start":{"line":19,"column":0},"end":{"line":22,"column":2}}},"fnMap":{"0":{"name":"parse","decl":{"start":{"line":7,"column":15},"end":{"line":7,"column":20}},"loc":{"start":{"line":7,"column":30},"end":{"line":11,"column":1}},"line":7},"1":{"name":"dump","decl":{"start":{"line":13,"column":15},"end":{"line":13,"column":19}},"loc":{"start":{"line":13,"column":29},"end":{"line":17,"column":1}},"line":13}},"branchMap":{"0":{"loc":{"start":{"line":9,"column":34},"end":{"line":9,"column":78}},"type":"binary-expr","locations":[{"start":{"line":9,"column":34},"end":{"line":9,"column":72}},{"start":{"line":9,"column":76},"end":{"line":9,"column":78}}],"line":9},"1":{"loc":{"start":{"line":15,"column":34},"end":{"line":15,"column":78}},"type":"binary-expr","locations":[{"start":{"line":15,"column":34},"end":{"line":15,"column":72}},{"start":{"line":15,"column":76},"end":{"line":15,"column":78}}],"line":15}},"s":{"0":1,"1":28,"2":5,"3":1},"f":{"0":28,"1":5},"b":{"0":[28,27],"1":[5,0]},"inputSourceMap":{"version":3,"sources":["guardianFactorProviders.js"],"names":["parse","context","guardianFactorProviders","assets","dump"],"mappings":";;;;;;AAAA,eAAeA,KAAf,CAAqBC,OAArB,EAA8B;AAE5B,SAAO;AACLC,IAAAA,uBAAuB,EAAE,CAAE,IAAGD,OAAO,CAACE,MAAR,CAAeD,uBAAf,IAA0C,EAA7C,CAAF;AADpB,GAAP;AAGD;;AAED,eAAeE,IAAf,CAAoBH,OAApB,EAA6B;AAE3B,SAAO;AACLC,IAAAA,uBAAuB,EAAE,CAAE,IAAGD,OAAO,CAACE,MAAR,CAAeD,uBAAf,IAA0C,EAA7C,CAAF;AADpB,GAAP;AAGD;;kBAEc;AACbF,EAAAA,KADa;AAEbI,EAAAA;AAFa,C","sourceRoot":"/home/circleci/repo/src/context/yaml/handlers/","sourcesContent":["async function parse(context) {\n  // nothing to do, set default if empty\n  return {\n    guardianFactorProviders: [ ...context.assets.guardianFactorProviders || [] ]\n  };\n}\n\nasync function dump(context) {\n  // nothing to do, set default empty\n  return {\n    guardianFactorProviders: [ ...context.assets.guardianFactorProviders || [] ]\n  };\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"f05a8fa179b0f8b4142e890e0b03d99d38fe4d23","contentHash":"a877337b83a51e38e6b85ebb1cd12b81f37f09dc20eaa82fa3338572f664d842"},"/home/circleci/repo/src/context/yaml/handlers/guardianFactorTemplates.js":{"path":"/home/circleci/repo/src/context/yaml/handlers/guardianFactorTemplates.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":8,"column":2},"end":{"line":10,"column":4}},"2":{"start":{"line":14,"column":2},"end":{"line":16,"column":4}},"3":{"start":{"line":19,"column":0},"end":{"line":22,"column":2}}},"fnMap":{"0":{"name":"parse","decl":{"start":{"line":7,"column":15},"end":{"line":7,"column":20}},"loc":{"start":{"line":7,"column":30},"end":{"line":11,"column":1}},"line":7},"1":{"name":"dump","decl":{"start":{"line":13,"column":15},"end":{"line":13,"column":19}},"loc":{"start":{"line":13,"column":29},"end":{"line":17,"column":1}},"line":13}},"branchMap":{"0":{"loc":{"start":{"line":9,"column":34},"end":{"line":9,"column":78}},"type":"binary-expr","locations":[{"start":{"line":9,"column":34},"end":{"line":9,"column":72}},{"start":{"line":9,"column":76},"end":{"line":9,"column":78}}],"line":9},"1":{"loc":{"start":{"line":15,"column":34},"end":{"line":15,"column":78}},"type":"binary-expr","locations":[{"start":{"line":15,"column":34},"end":{"line":15,"column":72}},{"start":{"line":15,"column":76},"end":{"line":15,"column":78}}],"line":15}},"s":{"0":1,"1":28,"2":5,"3":1},"f":{"0":28,"1":5},"b":{"0":[28,27],"1":[5,0]},"inputSourceMap":{"version":3,"sources":["guardianFactorTemplates.js"],"names":["parse","context","guardianFactorTemplates","assets","dump"],"mappings":";;;;;;AAAA,eAAeA,KAAf,CAAqBC,OAArB,EAA8B;AAE5B,SAAO;AACLC,IAAAA,uBAAuB,EAAE,CAAE,IAAGD,OAAO,CAACE,MAAR,CAAeD,uBAAf,IAA0C,EAA7C,CAAF;AADpB,GAAP;AAGD;;AAED,eAAeE,IAAf,CAAoBH,OAApB,EAA6B;AAE3B,SAAO;AACLC,IAAAA,uBAAuB,EAAE,CAAE,IAAGD,OAAO,CAACE,MAAR,CAAeD,uBAAf,IAA0C,EAA7C,CAAF;AADpB,GAAP;AAGD;;kBAEc;AACbF,EAAAA,KADa;AAEbI,EAAAA;AAFa,C","sourceRoot":"/home/circleci/repo/src/context/yaml/handlers/","sourcesContent":["async function parse(context) {\n  // nothing to do, set default if empty\n  return {\n    guardianFactorTemplates: [ ...context.assets.guardianFactorTemplates || [] ]\n  };\n}\n\nasync function dump(context) {\n  // nothing to do, set default empty\n  return {\n    guardianFactorTemplates: [ ...context.assets.guardianFactorTemplates || [] ]\n  };\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"5e299d9ffe69ba8bff5df61a7e8ad4143f15c6f7","contentHash":"c02e9de80a237bcb1b2549f9198aab2ead46aa41086e513091210f2d58bde1a2"},"/home/circleci/repo/src/context/yaml/handlers/guardianPhoneFactorMessageTypes.js":{"path":"/home/circleci/repo/src/context/yaml/handlers/guardianPhoneFactorMessageTypes.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":8,"column":2},"end":{"line":11,"column":4}},"2":{"start":{"line":15,"column":2},"end":{"line":18,"column":4}},"3":{"start":{"line":21,"column":0},"end":{"line":24,"column":2}}},"fnMap":{"0":{"name":"parse","decl":{"start":{"line":7,"column":15},"end":{"line":7,"column":20}},"loc":{"start":{"line":7,"column":30},"end":{"line":12,"column":1}},"line":7},"1":{"name":"dump","decl":{"start":{"line":14,"column":15},"end":{"line":14,"column":19}},"loc":{"start":{"line":14,"column":29},"end":{"line":19,"column":1}},"line":14}},"branchMap":{"0":{"loc":{"start":{"line":9,"column":43},"end":{"line":9,"column":95}},"type":"binary-expr","locations":[{"start":{"line":9,"column":43},"end":{"line":9,"column":89}},{"start":{"line":9,"column":93},"end":{"line":9,"column":95}}],"line":9},"1":{"loc":{"start":{"line":16,"column":43},"end":{"line":16,"column":95}},"type":"binary-expr","locations":[{"start":{"line":16,"column":43},"end":{"line":16,"column":89}},{"start":{"line":16,"column":93},"end":{"line":16,"column":95}}],"line":16}},"s":{"0":1,"1":28,"2":5,"3":1},"f":{"0":28,"1":5},"b":{"0":[28,27],"1":[5,0]},"inputSourceMap":{"version":3,"sources":["guardianPhoneFactorMessageTypes.js"],"names":["parse","context","guardianPhoneFactorMessageTypes","assets","dump"],"mappings":";;;;;;AAAA,eAAeA,KAAf,CAAqBC,OAArB,EAA8B;AAE5B,SAAO;AACLC,IAAAA,+BAA+B,EAAE,EAAE,IAAGD,OAAO,CAACE,MAAR,CAAeD,+BAAf,IAAkD,EAArD;AAAF;AAD5B,GAAP;AAGD;;AAED,eAAeE,IAAf,CAAoBH,OAApB,EAA6B;AAE3B,SAAO;AACLC,IAAAA,+BAA+B,EAAE,EAAE,IAAGD,OAAO,CAACE,MAAR,CAAeD,+BAAf,IAAkD,EAArD;AAAF;AAD5B,GAAP;AAGD;;kBAEc;AACbF,EAAAA,KADa;AAEbI,EAAAA;AAFa,C","sourceRoot":"/home/circleci/repo/src/context/yaml/handlers/","sourcesContent":["async function parse(context) {\n  // nothing to do, set default if empty\n  return {\n    guardianPhoneFactorMessageTypes: { ...context.assets.guardianPhoneFactorMessageTypes || {} }\n  };\n}\n\nasync function dump(context) {\n  // nothing to do, set default empty\n  return {\n    guardianPhoneFactorMessageTypes: { ...context.assets.guardianPhoneFactorMessageTypes || {} }\n  };\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"20143c9d58981ee6a0372eb167db2d7e6d8fce85","contentHash":"bd38573107d62f84befbfd62880a8ed7b4b62258d88f38c3516371ba1d5b08ea"},"/home/circleci/repo/src/context/yaml/handlers/guardianPhoneFactorSelectedProvider.js":{"path":"/home/circleci/repo/src/context/yaml/handlers/guardianPhoneFactorSelectedProvider.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":8,"column":2},"end":{"line":11,"column":4}},"2":{"start":{"line":15,"column":2},"end":{"line":18,"column":4}},"3":{"start":{"line":21,"column":0},"end":{"line":24,"column":2}}},"fnMap":{"0":{"name":"parse","decl":{"start":{"line":7,"column":15},"end":{"line":7,"column":20}},"loc":{"start":{"line":7,"column":30},"end":{"line":12,"column":1}},"line":7},"1":{"name":"dump","decl":{"start":{"line":14,"column":15},"end":{"line":14,"column":19}},"loc":{"start":{"line":14,"column":29},"end":{"line":19,"column":1}},"line":14}},"branchMap":{"0":{"loc":{"start":{"line":9,"column":47},"end":{"line":9,"column":103}},"type":"binary-expr","locations":[{"start":{"line":9,"column":47},"end":{"line":9,"column":97}},{"start":{"line":9,"column":101},"end":{"line":9,"column":103}}],"line":9},"1":{"loc":{"start":{"line":16,"column":47},"end":{"line":16,"column":103}},"type":"binary-expr","locations":[{"start":{"line":16,"column":47},"end":{"line":16,"column":97}},{"start":{"line":16,"column":101},"end":{"line":16,"column":103}}],"line":16}},"s":{"0":1,"1":28,"2":5,"3":1},"f":{"0":28,"1":5},"b":{"0":[28,27],"1":[5,0]},"inputSourceMap":{"version":3,"sources":["guardianPhoneFactorSelectedProvider.js"],"names":["parse","context","guardianPhoneFactorSelectedProvider","assets","dump"],"mappings":";;;;;;AAAA,eAAeA,KAAf,CAAqBC,OAArB,EAA8B;AAE5B,SAAO;AACLC,IAAAA,mCAAmC,EAAE,EAAE,IAAGD,OAAO,CAACE,MAAR,CAAeD,mCAAf,IAAsD,EAAzD;AAAF;AADhC,GAAP;AAGD;;AAED,eAAeE,IAAf,CAAoBH,OAApB,EAA6B;AAE3B,SAAO;AACLC,IAAAA,mCAAmC,EAAE,EAAE,IAAGD,OAAO,CAACE,MAAR,CAAeD,mCAAf,IAAsD,EAAzD;AAAF;AADhC,GAAP;AAGD;;kBAEc;AACbF,EAAAA,KADa;AAEbI,EAAAA;AAFa,C","sourceRoot":"/home/circleci/repo/src/context/yaml/handlers/","sourcesContent":["async function parse(context) {\n  // nothing to do, set default if empty\n  return {\n    guardianPhoneFactorSelectedProvider: { ...context.assets.guardianPhoneFactorSelectedProvider || {} }\n  };\n}\n\nasync function dump(context) {\n  // nothing to do, set default empty\n  return {\n    guardianPhoneFactorSelectedProvider: { ...context.assets.guardianPhoneFactorSelectedProvider || {} }\n  };\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"664e4c7c0ec9cc893ae0ed73c4db4fd2e823b79d","contentHash":"f025f6906c980a99209d359fe4fb57f53480ca0525b435a9b6569a9a80a920d7"},"/home/circleci/repo/src/context/yaml/handlers/guardianPolicies.js":{"path":"/home/circleci/repo/src/context/yaml/handlers/guardianPolicies.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":8,"column":2},"end":{"line":11,"column":4}},"2":{"start":{"line":15,"column":2},"end":{"line":18,"column":4}},"3":{"start":{"line":21,"column":0},"end":{"line":24,"column":2}}},"fnMap":{"0":{"name":"parse","decl":{"start":{"line":7,"column":15},"end":{"line":7,"column":20}},"loc":{"start":{"line":7,"column":30},"end":{"line":12,"column":1}},"line":7},"1":{"name":"dump","decl":{"start":{"line":14,"column":15},"end":{"line":14,"column":19}},"loc":{"start":{"line":14,"column":29},"end":{"line":19,"column":1}},"line":14}},"branchMap":{"0":{"loc":{"start":{"line":9,"column":28},"end":{"line":9,"column":65}},"type":"binary-expr","locations":[{"start":{"line":9,"column":28},"end":{"line":9,"column":59}},{"start":{"line":9,"column":63},"end":{"line":9,"column":65}}],"line":9},"1":{"loc":{"start":{"line":16,"column":28},"end":{"line":16,"column":65}},"type":"binary-expr","locations":[{"start":{"line":16,"column":28},"end":{"line":16,"column":59}},{"start":{"line":16,"column":63},"end":{"line":16,"column":65}}],"line":16}},"s":{"0":1,"1":28,"2":5,"3":1},"f":{"0":28,"1":5},"b":{"0":[28,26],"1":[5,0]},"inputSourceMap":{"version":3,"sources":["guardianPolicies.js"],"names":["parse","context","guardianPolicies","assets","dump"],"mappings":";;;;;;AAAA,eAAeA,KAAf,CAAqBC,OAArB,EAA8B;AAE5B,SAAO;AACLC,IAAAA,gBAAgB,EAAE,EAAE,IAAGD,OAAO,CAACE,MAAR,CAAeD,gBAAf,IAAmC,EAAtC;AAAF;AADb,GAAP;AAGD;;AAED,eAAeE,IAAf,CAAoBH,OAApB,EAA6B;AAE3B,SAAO;AACLC,IAAAA,gBAAgB,EAAE,EAAE,IAAGD,OAAO,CAACE,MAAR,CAAeD,gBAAf,IAAmC,EAAtC;AAAF;AADb,GAAP;AAGD;;kBAEc;AACbF,EAAAA,KADa;AAEbI,EAAAA;AAFa,C","sourceRoot":"/home/circleci/repo/src/context/yaml/handlers/","sourcesContent":["async function parse(context) {\n  // nothing to do, set default if empty\n  return {\n    guardianPolicies: { ...context.assets.guardianPolicies || {} }\n  };\n}\n\nasync function dump(context) {\n  // nothing to do, set default empty\n  return {\n    guardianPolicies: { ...context.assets.guardianPolicies || {} }\n  };\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"e221d569084bede8577a8cb9708f4b1a6afafe5a","contentHash":"88725fc6c2dfa3d24157900ee3bec5920592a57392ac8204f6cf59b2ffda0752"},"/home/circleci/repo/src/context/yaml/handlers/roles.js":{"path":"/home/circleci/repo/src/context/yaml/handlers/roles.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":8,"column":2},"end":{"line":10,"column":4}},"2":{"start":{"line":14,"column":2},"end":{"line":22,"column":4}},"3":{"start":{"line":16,"column":6},"end":{"line":18,"column":7}},"4":{"start":{"line":17,"column":8},"end":{"line":17,"column":32}},"5":{"start":{"line":20,"column":6},"end":{"line":20,"column":18}},"6":{"start":{"line":25,"column":0},"end":{"line":28,"column":2}}},"fnMap":{"0":{"name":"parse","decl":{"start":{"line":7,"column":15},"end":{"line":7,"column":20}},"loc":{"start":{"line":7,"column":30},"end":{"line":11,"column":1}},"line":7},"1":{"name":"dump","decl":{"start":{"line":13,"column":15},"end":{"line":13,"column":19}},"loc":{"start":{"line":13,"column":29},"end":{"line":23,"column":1}},"line":13},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":48},"end":{"line":15,"column":49}},"loc":{"start":{"line":15,"column":56},"end":{"line":21,"column":5}},"line":15}},"branchMap":{"0":{"loc":{"start":{"line":15,"column":16},"end":{"line":15,"column":42}},"type":"binary-expr","locations":[{"start":{"line":15,"column":16},"end":{"line":15,"column":36}},{"start":{"line":15,"column":40},"end":{"line":15,"column":42}}],"line":15},"1":{"loc":{"start":{"line":16,"column":6},"end":{"line":18,"column":7}},"type":"if","locations":[{"start":{"line":16,"column":6},"end":{"line":18,"column":7}},{"start":{"line":16,"column":6},"end":{"line":18,"column":7}}],"line":16}},"s":{"0":1,"1":28,"2":5,"3":6,"4":0,"5":6,"6":1},"f":{"0":28,"1":5,"2":6},"b":{"0":[5,0],"1":[0,6]},"inputSourceMap":{"version":3,"sources":["roles.js"],"names":["parse","context","roles","assets","dump","map","role","description"],"mappings":";;;;;;AAAA,eAAeA,KAAf,CAAqBC,OAArB,EAA8B;AAE5B,SAAO;AACLC,IAAAA,KAAK,EAAED,OAAO,CAACE,MAAR,CAAeD;AADjB,GAAP;AAGD;;AAED,eAAeE,IAAf,CAAoBH,OAApB,EAA6B;AAE3B,SAAO;AACLC,IAAAA,KAAK,EAAE,CACL,GAAG,CAACD,OAAO,CAACE,MAAR,CAAeD,KAAf,IAAwB,EAAzB,EAA6BG,GAA7B,CAAkCC,IAAD,IAAU;AAC5C,UAAIA,IAAI,CAACC,WAAL,KAAqB,IAAzB,EAA+B;AAC7B,eAAOD,IAAI,CAACC,WAAZ;AACD;;AAED,aAAOD,IAAP;AACD,KANE,CADE;AADF,GAAP;AAWD;;kBAEc;AACbN,EAAAA,KADa;AAEbI,EAAAA;AAFa,C","sourceRoot":"/home/circleci/repo/src/context/yaml/handlers/","sourcesContent":["async function parse(context) {\n  // nothing to do, set default empty\n  return {\n    roles: context.assets.roles\n  };\n}\n\nasync function dump(context) {\n  // remove empty descriptions\n  return {\n    roles: [\n      ...(context.assets.roles || []).map((role) => {\n        if (role.description === null) {\n          delete role.description;\n        }\n\n        return role;\n      })\n    ]\n  };\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"b78ae500afc334a79f9c4cdf2a7066b1e121da71","contentHash":"188a563df7d4c385b0a4512d2d5ff8f8e7ef445d61b0e31ba3af75f76ca507f4"},"/home/circleci/repo/src/context/yaml/handlers/organizations.js":{"path":"/home/circleci/repo/src/context/yaml/handlers/organizations.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":10,"column":6},"end":{"line":10,"column":20}},"2":{"start":{"line":11,"column":2},"end":{"line":13,"column":4}},"3":{"start":{"line":19,"column":6},"end":{"line":19,"column":20}},"4":{"start":{"line":20,"column":2},"end":{"line":36,"column":4}},"5":{"start":{"line":22,"column":6},"end":{"line":32,"column":7}},"6":{"start":{"line":23,"column":8},"end":{"line":31,"column":11}},"7":{"start":{"line":24,"column":23},"end":{"line":24,"column":56}},"8":{"start":{"line":25,"column":10},"end":{"line":25,"column":33}},"9":{"start":{"line":26,"column":10},"end":{"line":26,"column":30}},"10":{"start":{"line":27,"column":10},"end":{"line":30,"column":12}},"11":{"start":{"line":34,"column":6},"end":{"line":34,"column":17}},"12":{"start":{"line":39,"column":0},"end":{"line":42,"column":2}}},"fnMap":{"0":{"name":"parse","decl":{"start":{"line":7,"column":15},"end":{"line":7,"column":20}},"loc":{"start":{"line":7,"column":30},"end":{"line":14,"column":1}},"line":7},"1":{"name":"dump","decl":{"start":{"line":16,"column":15},"end":{"line":16,"column":19}},"loc":{"start":{"line":16,"column":29},"end":{"line":37,"column":1}},"line":16},"2":{"name":"(anonymous_2)","decl":{"start":{"line":21,"column":49},"end":{"line":21,"column":50}},"loc":{"start":{"line":21,"column":56},"end":{"line":35,"column":5}},"line":21},"3":{"name":"(anonymous_3)","decl":{"start":{"line":23,"column":46},"end":{"line":23,"column":47}},"loc":{"start":{"line":23,"column":51},"end":{"line":31,"column":9}},"line":23}},"branchMap":{"0":{"loc":{"start":{"line":12,"column":19},"end":{"line":12,"column":38}},"type":"binary-expr","locations":[{"start":{"line":12,"column":19},"end":{"line":12,"column":32}},{"start":{"line":12,"column":36},"end":{"line":12,"column":38}}],"line":12},"1":{"loc":{"start":{"line":21,"column":24},"end":{"line":21,"column":43}},"type":"binary-expr","locations":[{"start":{"line":21,"column":24},"end":{"line":21,"column":37}},{"start":{"line":21,"column":41},"end":{"line":21,"column":43}}],"line":21},"2":{"loc":{"start":{"line":22,"column":6},"end":{"line":32,"column":7}},"type":"if","locations":[{"start":{"line":22,"column":6},"end":{"line":32,"column":7}},{"start":{"line":22,"column":6},"end":{"line":32,"column":7}}],"line":22},"3":{"loc":{"start":{"line":24,"column":23},"end":{"line":24,"column":56}},"type":"binary-expr","locations":[{"start":{"line":24,"column":23},"end":{"line":24,"column":35}},{"start":{"line":24,"column":39},"end":{"line":24,"column":56}}],"line":24}},"s":{"0":1,"1":28,"2":28,"3":5,"4":5,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1},"f":{"0":28,"1":5,"2":1,"3":1},"b":{"0":[28,27],"1":[5,0],"2":[1,0],"3":[1,1]},"inputSourceMap":{"version":3,"sources":["organizations.js"],"names":["parse","context","organizations","assets","dump","map","org","connections","length","c","name","connection","connection_id"],"mappings":";;;;;;AAAA,eAAeA,KAAf,CAAqBC,OAArB,EAA8B;AAC5B,QAAM;AAAEC,IAAAA;AAAF,MAAoBD,OAAO,CAACE,MAAlC;AAEA,SAAO;AACLD,IAAAA,aAAa,EAAEA,aAAa,IAAI;AAD3B,GAAP;AAGD;;AAED,eAAeE,IAAf,CAAoBH,OAApB,EAA6B;AAC3B,QAAM;AAAEC,IAAAA;AAAF,MAAoBD,OAAO,CAACE,MAAlC;AAEA,SAAO;AACLD,IAAAA,aAAa,EAAE,CACb,GAAG,CAACA,aAAa,IAAI,EAAlB,EAAsBG,GAAtB,CAA2BC,GAAD,IAAS;AACpC,UAAIA,GAAG,CAACC,WAAJ,CAAgBC,MAAhB,GAAyB,CAA7B,EAAgC;AAC9BF,QAAAA,GAAG,CAACC,WAAJ,GAAkBD,GAAG,CAACC,WAAJ,CAAgBF,GAAhB,CAAqBI,CAAD,IAAO;AAE3C,gBAAMC,IAAI,GAAGD,CAAC,CAACE,UAAF,IAAgBF,CAAC,CAACE,UAAF,CAAaD,IAA1C;AACA,iBAAOD,CAAC,CAACG,aAAT;AACA,iBAAOH,CAAC,CAACE,UAAT;AAEA,iBAAO;AACLD,YAAAA,IADK;AAEL,eAAGD;AAFE,WAAP;AAID,SAViB,CAAlB;AAWD;;AAED,aAAOH,GAAP;AACD,KAhBE,CADU;AADV,GAAP;AAqBD;;kBAEc;AACbN,EAAAA,KADa;AAEbI,EAAAA;AAFa,C","sourceRoot":"/home/circleci/repo/src/context/yaml/handlers/","sourcesContent":["async function parse(context) {\n  const { organizations } = context.assets;\n\n  return {\n    organizations: organizations || []\n  };\n}\n\nasync function dump(context) {\n  const { organizations } = context.assets;\n\n  return {\n    organizations: [\n      ...(organizations || []).map((org) => {\n        if (org.connections.length > 0) {\n          org.connections = org.connections.map((c) => {\n            // connection is a computed field\n            const name = c.connection && c.connection.name;\n            delete c.connection_id;\n            delete c.connection;\n\n            return {\n              name,\n              ...c\n            };\n          });\n        }\n\n        return org;\n      })\n    ]\n  };\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"2d0d3999f2f7948266f42441f9bf427b0eca301f","contentHash":"d47b5f59779638c37f491c8943b320b54d3b603e33724675fb3705c4180c422c"},"/home/circleci/repo/src/context/yaml/handlers/migrations.js":{"path":"/home/circleci/repo/src/context/yaml/handlers/migrations.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":10,"column":6},"end":{"line":10,"column":20}},"2":{"start":{"line":11,"column":2},"end":{"line":13,"column":4}},"3":{"start":{"line":19,"column":6},"end":{"line":19,"column":20}},"4":{"start":{"line":20,"column":2},"end":{"line":22,"column":4}},"5":{"start":{"line":25,"column":0},"end":{"line":28,"column":2}}},"fnMap":{"0":{"name":"parse","decl":{"start":{"line":7,"column":15},"end":{"line":7,"column":20}},"loc":{"start":{"line":7,"column":30},"end":{"line":14,"column":1}},"line":7},"1":{"name":"dump","decl":{"start":{"line":16,"column":15},"end":{"line":16,"column":19}},"loc":{"start":{"line":16,"column":29},"end":{"line":23,"column":1}},"line":16}},"branchMap":{"0":{"loc":{"start":{"line":21,"column":16},"end":{"line":21,"column":32}},"type":"binary-expr","locations":[{"start":{"line":21,"column":16},"end":{"line":21,"column":26}},{"start":{"line":21,"column":30},"end":{"line":21,"column":32}}],"line":21}},"s":{"0":1,"1":28,"2":28,"3":6,"4":6,"5":1},"f":{"0":28,"1":6},"b":{"0":[6,4]},"inputSourceMap":{"version":3,"sources":["migrations.js"],"names":["parse","context","migrations","assets","dump"],"mappings":";;;;;;AAAA,eAAeA,KAAf,CAAqBC,OAArB,EAA8B;AAC5B,QAAM;AAAEC,IAAAA;AAAF,MAAiBD,OAAO,CAACE,MAA/B;AACA,SAAO;AAAED,IAAAA;AAAF,GAAP;AACD;;AAED,eAAeE,IAAf,CAAoBH,OAApB,EAA6B;AAC3B,QAAM;AAAEC,IAAAA;AAAF,MAAiBD,OAAO,CAACE,MAA/B;AAEA,SAAO;AAAED,IAAAA,UAAU,EAAEA,UAAU,IAAI;AAA5B,GAAP;AACD;;kBAEc;AACbF,EAAAA,KADa;AAEbI,EAAAA;AAFa,C","sourceRoot":"/home/circleci/repo/src/context/yaml/handlers/","sourcesContent":["async function parse(context) {\n  const { migrations } = context.assets;\n  return { migrations };\n}\n\nasync function dump(context) {\n  const { migrations } = context.assets;\n\n  return { migrations: migrations || {} };\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"c93b63de1b45ebabaae6723a9a3268a4659ff9d2","contentHash":"61ce148cb5a81dd18355e97e663d22e17ed2acd4a92e2fcf1f9641100b5dc13d"},"/home/circleci/repo/src/context/yaml/handlers/actions.js":{"path":"/home/circleci/repo/src/context/yaml/handlers/actions.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":12},"end":{"line":7,"column":27}},"2":{"start":{"line":9,"column":13},"end":{"line":9,"column":42}},"3":{"start":{"line":11,"column":15},"end":{"line":11,"column":34}},"4":{"start":{"line":13,"column":16},"end":{"line":13,"column":48}},"5":{"start":{"line":15,"column":13},"end":{"line":15,"column":38}},"6":{"start":{"line":17,"column":13},"end":{"line":17,"column":38}},"7":{"start":{"line":19,"column":14},"end":{"line":19,"column":40}},"8":{"start":{"line":21,"column":15},"end":{"line":21,"column":46}},"9":{"start":{"line":23,"column":39},"end":{"line":23,"column":93}},"10":{"start":{"line":26,"column":2},"end":{"line":28,"column":3}},"11":{"start":{"line":27,"column":4},"end":{"line":27,"column":70}},"12":{"start":{"line":32,"column":2},"end":{"line":32,"column":41}},"13":{"start":{"line":32,"column":31},"end":{"line":32,"column":41}},"14":{"start":{"line":33,"column":18},"end":{"line":37,"column":3}},"15":{"start":{"line":34,"column":55},"end":{"line":36,"column":5}},"16":{"start":{"line":38,"column":2},"end":{"line":38,"column":17}},"17":{"start":{"line":42,"column":2},"end":{"line":47,"column":3}},"18":{"start":{"line":43,"column":4},"end":{"line":46,"column":8}},"19":{"start":{"line":43,"column":34},"end":{"line":46,"column":5}},"20":{"start":{"line":49,"column":2},"end":{"line":49,"column":12}},"21":{"start":{"line":55,"column":6},"end":{"line":55,"column":12}},"22":{"start":{"line":57,"column":2},"end":{"line":59,"column":3}},"23":{"start":{"line":58,"column":4},"end":{"line":58,"column":14}},"24":{"start":{"line":61,"column":21},"end":{"line":61,"column":54}},"25":{"start":{"line":63,"column":31},"end":{"line":63,"column":108}},"26":{"start":{"line":65,"column":2},"end":{"line":65,"column":56}},"27":{"start":{"line":67,"column":19},"end":{"line":67,"column":71}},"28":{"start":{"line":69,"column":2},"end":{"line":69,"column":47}},"29":{"start":{"line":71,"column":2},"end":{"line":71,"column":50}},"30":{"start":{"line":73,"column":2},"end":{"line":73,"column":73}},"31":{"start":{"line":79,"column":6},"end":{"line":79,"column":20}},"32":{"start":{"line":80,"column":2},"end":{"line":80,"column":23}},"33":{"start":{"line":80,"column":16},"end":{"line":80,"column":23}},"34":{"start":{"line":81,"column":2},"end":{"line":92,"column":4}},"35":{"start":{"line":82,"column":36},"end":{"line":91,"column":5}},"36":{"start":{"line":95,"column":0},"end":{"line":98,"column":2}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":23,"column":9},"end":{"line":23,"column":31}},"loc":{"start":{"line":23,"column":37},"end":{"line":23,"column":95}},"line":23},"1":{"name":"parseCode","decl":{"start":{"line":25,"column":9},"end":{"line":25,"column":18}},"loc":{"start":{"line":25,"column":34},"end":{"line":29,"column":1}},"line":25},"2":{"name":"parse","decl":{"start":{"line":31,"column":15},"end":{"line":31,"column":20}},"loc":{"start":{"line":31,"column":30},"end":{"line":39,"column":1}},"line":31},"3":{"name":"(anonymous_3)","decl":{"start":{"line":34,"column":44},"end":{"line":34,"column":45}},"loc":{"start":{"line":34,"column":55},"end":{"line":36,"column":5}},"line":34},"4":{"name":"mapSecrets","decl":{"start":{"line":41,"column":9},"end":{"line":41,"column":19}},"loc":{"start":{"line":41,"column":29},"end":{"line":50,"column":1}},"line":41},"5":{"name":"(anonymous_5)","decl":{"start":{"line":43,"column":23},"end":{"line":43,"column":24}},"loc":{"start":{"line":43,"column":34},"end":{"line":46,"column":5}},"line":43},"6":{"name":"mapActionCode","decl":{"start":{"line":52,"column":9},"end":{"line":52,"column":22}},"loc":{"start":{"line":52,"column":41},"end":{"line":74,"column":1}},"line":52},"7":{"name":"dump","decl":{"start":{"line":76,"column":15},"end":{"line":76,"column":19}},"loc":{"start":{"line":76,"column":29},"end":{"line":93,"column":1}},"line":76},"8":{"name":"(anonymous_8)","decl":{"start":{"line":82,"column":25},"end":{"line":82,"column":26}},"loc":{"start":{"line":82,"column":36},"end":{"line":91,"column":5}},"line":82}},"branchMap":{"0":{"loc":{"start":{"line":23,"column":46},"end":{"line":23,"column":92}},"type":"cond-expr","locations":[{"start":{"line":23,"column":70},"end":{"line":23,"column":73}},{"start":{"line":23,"column":76},"end":{"line":23,"column":92}}],"line":23},"1":{"loc":{"start":{"line":23,"column":46},"end":{"line":23,"column":67}},"type":"binary-expr","locations":[{"start":{"line":23,"column":46},"end":{"line":23,"column":49}},{"start":{"line":23,"column":53},"end":{"line":23,"column":67}}],"line":23},"2":{"loc":{"start":{"line":26,"column":2},"end":{"line":28,"column":3}},"type":"if","locations":[{"start":{"line":26,"column":2},"end":{"line":28,"column":3}},{"start":{"line":26,"column":2},"end":{"line":28,"column":3}}],"line":26},"3":{"loc":{"start":{"line":32,"column":2},"end":{"line":32,"column":41}},"type":"if","locations":[{"start":{"line":32,"column":2},"end":{"line":32,"column":41}},{"start":{"line":32,"column":2},"end":{"line":32,"column":41}}],"line":32},"4":{"loc":{"start":{"line":42,"column":2},"end":{"line":47,"column":3}},"type":"if","locations":[{"start":{"line":42,"column":2},"end":{"line":47,"column":3}},{"start":{"line":42,"column":2},"end":{"line":47,"column":3}}],"line":42},"5":{"loc":{"start":{"line":42,"column":6},"end":{"line":42,"column":35}},"type":"binary-expr","locations":[{"start":{"line":42,"column":6},"end":{"line":42,"column":13}},{"start":{"line":42,"column":17},"end":{"line":42,"column":35}}],"line":42},"6":{"loc":{"start":{"line":57,"column":2},"end":{"line":59,"column":3}},"type":"if","locations":[{"start":{"line":57,"column":2},"end":{"line":59,"column":3}},{"start":{"line":57,"column":2},"end":{"line":59,"column":3}}],"line":57},"7":{"loc":{"start":{"line":80,"column":2},"end":{"line":80,"column":23}},"type":"if","locations":[{"start":{"line":80,"column":2},"end":{"line":80,"column":23}},{"start":{"line":80,"column":2},"end":{"line":80,"column":23}}],"line":80},"8":{"loc":{"start":{"line":84,"column":16},"end":{"line":84,"column":62}},"type":"binary-expr","locations":[{"start":{"line":84,"column":16},"end":{"line":84,"column":31}},{"start":{"line":84,"column":35},"end":{"line":84,"column":62}}],"line":84},"9":{"loc":{"start":{"line":87,"column":20},"end":{"line":87,"column":45}},"type":"binary-expr","locations":[{"start":{"line":87,"column":20},"end":{"line":87,"column":39}},{"start":{"line":87,"column":43},"end":{"line":87,"column":45}}],"line":87}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":3,"10":1,"11":1,"12":28,"13":27,"14":1,"15":1,"16":1,"17":1,"18":0,"19":0,"20":1,"21":1,"22":1,"23":0,"24":1,"25":1,"26":1,"27":1,"28":1,"29":1,"30":1,"31":5,"32":5,"33":0,"34":5,"35":1,"36":1},"f":{"0":3,"1":1,"2":28,"3":1,"4":1,"5":0,"6":1,"7":5,"8":1},"b":{"0":[1,2],"1":[3,3],"2":[1,0],"3":[27,1],"4":[0,1],"5":[1,1],"6":[0,1],"7":[0,5],"8":[1,0],"9":[1,0]},"inputSourceMap":{"version":3,"sources":["actions.js"],"names":["parseCode","context","code","loadFile","constants","ACTIONS_DIRECTORY","parse","assets","actions","map","action","mapSecrets","secrets","length","secret","name","value","mapActionCode","basePath","actionName","actionVersionsFolder","path","join","fs","ensureDirSync","codeFile","log","info","writeFileSync","dump","deployed","all_changes_deployed","runtime","dependencies","status","supported_triggers"],"mappings":";;;;;;AACA;;;;AACA;;;;AACA;;AACA;;AACA;;;;;;AAEA,SAASA,SAAT,CAAmBC,OAAnB,EAA4BC,IAA5B,EAAkC;AAChC,MAAIA,IAAJ,EAAU;AACR,WAAOD,OAAO,CAACE,QAAR,CAAiBD,IAAjB,EAAuBE,iBAAUC,iBAAjC,CAAP;AACD;AACF;;AAED,eAAeC,KAAf,CAAqBL,OAArB,EAA8B;AAE5B,MAAI,CAACA,OAAO,CAACM,MAAR,CAAeC,OAApB,EAA6B,OAAO,EAAP;AAC7B,QAAMA,OAAO,GAAG;AACdA,IAAAA,OAAO,EAAE,CACP,GAAGP,OAAO,CAACM,MAAR,CAAeC,OAAf,CAAuBC,GAAvB,CAA4BC,MAAD,KAAa,EACzC,GAAGA,MADsC;AAEzCR,MAAAA,IAAI,EAAEF,SAAS,CAACC,OAAD,EAAUS,MAAM,CAACR,IAAjB;AAF0B,KAAb,CAA3B,CADI;AADK,GAAhB;AAQA,SAAOM,OAAP;AACD;;AAED,SAASG,UAAT,CAAoBC,OAApB,EAA6B;AAC3B,MAAIA,OAAO,IAAIA,OAAO,CAACC,MAAR,GAAiB,CAAhC,EAAmC;AACjC,WAAOD,OAAO,CAACH,GAAR,CAAaK,MAAD,KAAa;AAAEC,MAAAA,IAAI,EAAED,MAAM,CAACC,IAAf;AAAqBC,MAAAA,KAAK,EAAEF,MAAM,CAACE;AAAnC,KAAb,CAAZ,CAAP;AACD;;AACD,SAAO,EAAP;AACD;;AAED,SAASC,aAAT,CAAuBC,QAAvB,EAAiCR,MAAjC,EAAyC;AACvC,QAAM;AAAER,IAAAA;AAAF,MAAWQ,MAAjB;;AAEA,MAAI,CAACR,IAAL,EAAW;AACT,WAAO,EAAP;AACD;;AAED,QAAMiB,UAAU,GAAG,qBAAST,MAAM,CAACK,IAAhB,CAAnB;;AACA,QAAMK,oBAAoB,GAAGC,eAAKC,IAAL,CAC3BJ,QAD2B,EAE3Bd,iBAAUC,iBAFiB,EAG3Bc,UAH2B,CAA7B;;AAKAI,oBAAGC,aAAH,CAAiBJ,oBAAjB;;AAEA,QAAMK,QAAQ,GAAGJ,eAAKC,IAAL,CAAUF,oBAAV,EAAgC,SAAhC,CAAjB;;AACAM,mBAAIC,IAAJ,CAAU,WAAUF,QAAS,EAA7B;;AACAF,oBAAGK,aAAH,CAAiBH,QAAjB,EAA2BvB,IAA3B;;AAEA,SAAQ,KAAIE,iBAAUC,iBAAkB,IAAGc,UAAW,UAAtD;AACD;;AAED,eAAeU,IAAf,CAAoB5B,OAApB,EAA6B;AAC3B,QAAM;AAAEO,IAAAA;AAAF,MAAcP,OAAO,CAACM,MAA5B;AAEA,MAAI,CAACC,OAAL,EAAc;AACd,SAAO;AACLA,IAAAA,OAAO,EAAEA,OAAO,CAACC,GAAR,CAAaC,MAAD,KAAa;AAChCK,MAAAA,IAAI,EAAEL,MAAM,CAACK,IADmB;AAEhCe,MAAAA,QAAQ,EAAEpB,MAAM,CAACoB,QAAP,IAAmBpB,MAAM,CAACqB,oBAFJ;AAGhC7B,MAAAA,IAAI,EAAEe,aAAa,CAAChB,OAAO,CAACiB,QAAT,EAAmBR,MAAnB,CAHa;AAIhCsB,MAAAA,OAAO,EAAEtB,MAAM,CAACsB,OAJgB;AAKhCC,MAAAA,YAAY,EAAEvB,MAAM,CAACuB,YAAP,IAAuB,EALL;AAMhCC,MAAAA,MAAM,EAAExB,MAAM,CAACwB,MANiB;AAOhCtB,MAAAA,OAAO,EAAED,UAAU,CAACD,MAAM,CAACE,OAAR,CAPa;AAQhCuB,MAAAA,kBAAkB,EAAEzB,MAAM,CAACyB;AARK,KAAb,CAAZ;AADJ,GAAP;AAYD;;kBAEc;AACb7B,EAAAA,KADa;AAEbuB,EAAAA;AAFa,C","sourceRoot":"/home/circleci/repo/src/context/yaml/handlers/","sourcesContent":["/* eslint-disable consistent-return */\nimport path from 'path';\nimport fs from 'fs-extra';\nimport { constants } from '../../../tools';\nimport { sanitize } from '../../../utils';\nimport log from '../../../logger';\n\nfunction parseCode(context, code) {\n  if (code) {\n    return context.loadFile(code, constants.ACTIONS_DIRECTORY);\n  }\n}\n\nasync function parse(context) {\n  // Load the script file for each action\n  if (!context.assets.actions) return [];\n  const actions = {\n    actions: [\n      ...context.assets.actions.map((action) => ({\n        ...action,\n        code: parseCode(context, action.code)\n      }))\n    ]\n  };\n  return actions;\n}\n\nfunction mapSecrets(secrets) {\n  if (secrets && secrets.length > 0) {\n    return secrets.map((secret) => ({ name: secret.name, value: secret.value }));\n  }\n  return [];\n}\n\nfunction mapActionCode(basePath, action) {\n  const { code } = action;\n\n  if (!code) {\n    return '';\n  }\n\n  const actionName = sanitize(action.name);\n  const actionVersionsFolder = path.join(\n    basePath,\n    constants.ACTIONS_DIRECTORY,\n    actionName\n  );\n  fs.ensureDirSync(actionVersionsFolder);\n\n  const codeFile = path.join(actionVersionsFolder, 'code.js');\n  log.info(`Writing ${codeFile}`);\n  fs.writeFileSync(codeFile, code);\n\n  return `./${constants.ACTIONS_DIRECTORY}/${actionName}/code.js`;\n}\n\nasync function dump(context) {\n  const { actions } = context.assets;\n  // Nothing to do\n  if (!actions) return;\n  return {\n    actions: actions.map((action) => ({\n      name: action.name,\n      deployed: action.deployed || action.all_changes_deployed,\n      code: mapActionCode(context.basePath, action),\n      runtime: action.runtime,\n      dependencies: action.dependencies || [],\n      status: action.status,\n      secrets: mapSecrets(action.secrets),\n      supported_triggers: action.supported_triggers\n    }))\n  };\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"e4a33ede5ce15fce6cbd7b7aa12a5f2e525d5cf5","contentHash":"2219d3193325d38da4a14b1d0095759ac44877dfa65ff7287002518429f7bee4"},"/home/circleci/repo/src/context/yaml/handlers/triggers.js":{"path":"/home/circleci/repo/src/context/yaml/handlers/triggers.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":8,"column":2},"end":{"line":8,"column":42}},"2":{"start":{"line":8,"column":32},"end":{"line":8,"column":42}},"3":{"start":{"line":9,"column":2},"end":{"line":11,"column":4}},"4":{"start":{"line":17,"column":6},"end":{"line":17,"column":20}},"5":{"start":{"line":18,"column":2},"end":{"line":18,"column":27}},"6":{"start":{"line":18,"column":17},"end":{"line":18,"column":27}},"7":{"start":{"line":19,"column":2},"end":{"line":21,"column":4}},"8":{"start":{"line":24,"column":0},"end":{"line":27,"column":2}}},"fnMap":{"0":{"name":"parse","decl":{"start":{"line":7,"column":15},"end":{"line":7,"column":20}},"loc":{"start":{"line":7,"column":30},"end":{"line":12,"column":1}},"line":7},"1":{"name":"dump","decl":{"start":{"line":14,"column":15},"end":{"line":14,"column":19}},"loc":{"start":{"line":14,"column":29},"end":{"line":22,"column":1}},"line":14}},"branchMap":{"0":{"loc":{"start":{"line":8,"column":2},"end":{"line":8,"column":42}},"type":"if","locations":[{"start":{"line":8,"column":2},"end":{"line":8,"column":42}},{"start":{"line":8,"column":2},"end":{"line":8,"column":42}}],"line":8},"1":{"loc":{"start":{"line":18,"column":2},"end":{"line":18,"column":27}},"type":"if","locations":[{"start":{"line":18,"column":2},"end":{"line":18,"column":27}},{"start":{"line":18,"column":2},"end":{"line":18,"column":27}}],"line":18}},"s":{"0":1,"1":28,"2":27,"3":1,"4":5,"5":5,"6":0,"7":5,"8":1},"f":{"0":28,"1":5},"b":{"0":[27,1],"1":[0,5]},"inputSourceMap":{"version":3,"sources":["triggers.js"],"names":["parse","context","assets","triggers","dump"],"mappings":";;;;;;AAAA,eAAeA,KAAf,CAAqBC,OAArB,EAA8B;AAE5B,MAAI,CAACA,OAAO,CAACC,MAAR,CAAeC,QAApB,EAA8B,OAAO,EAAP;AAC9B,SAAO;AACLA,IAAAA,QAAQ,EAAEF,OAAO,CAACC,MAAR,CAAeC;AADpB,GAAP;AAGD;;AAED,eAAeC,IAAf,CAAoBH,OAApB,EAA6B;AAC3B,QAAM;AAAEE,IAAAA;AAAF,MAAeF,OAAO,CAACC,MAA7B;AAEA,MAAI,CAACC,QAAL,EAAe,OAAO,EAAP;AACf,SAAO;AACLA,IAAAA,QAAQ,EAAEA;AADL,GAAP;AAGD;;kBAEc;AACbH,EAAAA,KADa;AAEbI,EAAAA;AAFa,C","sourceRoot":"/home/circleci/repo/src/context/yaml/handlers/","sourcesContent":["async function parse(context) {\n  // Load the script file for each action\n  if (!context.assets.triggers) return {};\n  return {\n    triggers: context.assets.triggers\n  };\n}\n\nasync function dump(context) {\n  const { triggers } = context.assets;\n  // Nothing to do\n  if (!triggers) return {};\n  return {\n    triggers: triggers\n  };\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"650141ea5fffc0c48deadfc42133d04f773fd7de","contentHash":"50056800e98ee66665dafc8b249aca5c3265192242bd55f5fcb15068635018a6"},"/home/circleci/repo/src/readonly.js":{"path":"/home/circleci/repo/src/readonly.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":30}},"2":{"start":{"line":8,"column":15},"end":{"line":8,"column":34}},"3":{"start":{"line":10,"column":16},"end":{"line":10,"column":48}},"4":{"start":{"line":12,"column":14},"end":{"line":12,"column":31}},"5":{"start":{"line":14,"column":15},"end":{"line":14,"column":46}},"6":{"start":{"line":16,"column":39},"end":{"line":16,"column":93}},"7":{"start":{"line":18,"column":17},"end":{"line":24,"column":1}},"8":{"start":{"line":27,"column":25},"end":{"line":28,"column":3}},"9":{"start":{"line":32,"column":6},"end":{"line":32,"column":12}},"10":{"start":{"line":33,"column":2},"end":{"line":33,"column":50}},"11":{"start":{"line":33,"column":36},"end":{"line":33,"column":50}},"12":{"start":{"line":34,"column":2},"end":{"line":34,"column":50}},"13":{"start":{"line":34,"column":36},"end":{"line":34,"column":50}},"14":{"start":{"line":35,"column":2},"end":{"line":43,"column":5}},"15":{"start":{"line":36,"column":26},"end":{"line":36,"column":98}},"16":{"start":{"line":36,"column":49},"end":{"line":36,"column":97}},"17":{"start":{"line":38,"column":4},"end":{"line":40,"column":5}},"18":{"start":{"line":39,"column":6},"end":{"line":39,"column":153}},"19":{"start":{"line":42,"column":4},"end":{"line":42,"column":71}},"20":{"start":{"line":44,"column":2},"end":{"line":48,"column":5}},"21":{"start":{"line":45,"column":4},"end":{"line":47,"column":5}},"22":{"start":{"line":46,"column":6},"end":{"line":46,"column":91}},"23":{"start":{"line":46,"column":66},"end":{"line":46,"column":89}},"24":{"start":{"line":49,"column":2},"end":{"line":49,"column":24}},"25":{"start":{"line":53,"column":17},"end":{"line":54,"column":3}},"26":{"start":{"line":55,"column":2},"end":{"line":55,"column":57}},"27":{"start":{"line":55,"column":20},"end":{"line":55,"column":55}},"28":{"start":{"line":56,"column":2},"end":{"line":56,"column":16}},"29":{"start":{"line":60,"column":18},"end":{"line":61,"column":3}},"30":{"start":{"line":62,"column":25},"end":{"line":62,"column":50}},"31":{"start":{"line":63,"column":2},"end":{"line":72,"column":5}},"32":{"start":{"line":64,"column":16},"end":{"line":64,"column":29}},"33":{"start":{"line":65,"column":4},"end":{"line":65,"column":21}},"34":{"start":{"line":65,"column":14},"end":{"line":65,"column":21}},"35":{"start":{"line":67,"column":4},"end":{"line":71,"column":5}},"36":{"start":{"line":68,"column":6},"end":{"line":68,"column":58}},"37":{"start":{"line":68,"column":35},"end":{"line":68,"column":56}},"38":{"start":{"line":70,"column":6},"end":{"line":70,"column":56}},"39":{"start":{"line":73,"column":2},"end":{"line":73,"column":69}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":16,"column":9},"end":{"line":16,"column":31}},"loc":{"start":{"line":16,"column":37},"end":{"line":16,"column":95}},"line":16},"1":{"name":"getExcludedFields","decl":{"start":{"line":26,"column":9},"end":{"line":26,"column":26}},"loc":{"start":{"line":26,"column":35},"end":{"line":50,"column":1}},"line":26},"2":{"name":"(anonymous_2)","decl":{"start":{"line":35,"column":35},"end":{"line":35,"column":36}},"loc":{"start":{"line":35,"column":55},"end":{"line":43,"column":3}},"line":35},"3":{"name":"(anonymous_3)","decl":{"start":{"line":36,"column":40},"end":{"line":36,"column":41}},"loc":{"start":{"line":36,"column":49},"end":{"line":36,"column":97}},"line":36},"4":{"name":"(anonymous_4)","decl":{"start":{"line":44,"column":35},"end":{"line":44,"column":36}},"loc":{"start":{"line":44,"column":55},"end":{"line":48,"column":3}},"line":44},"5":{"name":"(anonymous_5)","decl":{"start":{"line":46,"column":57},"end":{"line":46,"column":58}},"loc":{"start":{"line":46,"column":66},"end":{"line":46,"column":89}},"line":46},"6":{"name":"deleteKeys","decl":{"start":{"line":52,"column":9},"end":{"line":52,"column":19}},"loc":{"start":{"line":52,"column":31},"end":{"line":57,"column":1}},"line":52},"7":{"name":"(anonymous_7)","decl":{"start":{"line":55,"column":15},"end":{"line":55,"column":16}},"loc":{"start":{"line":55,"column":20},"end":{"line":55,"column":55}},"line":55},"8":{"name":"cleanAssets","decl":{"start":{"line":59,"column":9},"end":{"line":59,"column":20}},"loc":{"start":{"line":59,"column":37},"end":{"line":74,"column":1}},"line":59},"9":{"name":"(anonymous_9)","decl":{"start":{"line":63,"column":41},"end":{"line":63,"column":42}},"loc":{"start":{"line":63,"column":61},"end":{"line":72,"column":3}},"line":63},"10":{"name":"(anonymous_10)","decl":{"start":{"line":68,"column":30},"end":{"line":68,"column":31}},"loc":{"start":{"line":68,"column":35},"end":{"line":68,"column":56}},"line":68}},"branchMap":{"0":{"loc":{"start":{"line":16,"column":46},"end":{"line":16,"column":92}},"type":"cond-expr","locations":[{"start":{"line":16,"column":70},"end":{"line":16,"column":73}},{"start":{"line":16,"column":76},"end":{"line":16,"column":92}}],"line":16},"1":{"loc":{"start":{"line":16,"column":46},"end":{"line":16,"column":67}},"type":"binary-expr","locations":[{"start":{"line":16,"column":46},"end":{"line":16,"column":49}},{"start":{"line":16,"column":53},"end":{"line":16,"column":67}}],"line":16},"2":{"loc":{"start":{"line":33,"column":2},"end":{"line":33,"column":50}},"type":"if","locations":[{"start":{"line":33,"column":2},"end":{"line":33,"column":50}},{"start":{"line":33,"column":2},"end":{"line":33,"column":50}}],"line":33},"3":{"loc":{"start":{"line":34,"column":2},"end":{"line":34,"column":50}},"type":"if","locations":[{"start":{"line":34,"column":2},"end":{"line":34,"column":50}},{"start":{"line":34,"column":2},"end":{"line":34,"column":50}}],"line":34},"4":{"loc":{"start":{"line":36,"column":49},"end":{"line":36,"column":97}},"type":"binary-expr","locations":[{"start":{"line":36,"column":49},"end":{"line":36,"column":63}},{"start":{"line":36,"column":67},"end":{"line":36,"column":97}}],"line":36},"5":{"loc":{"start":{"line":38,"column":4},"end":{"line":40,"column":5}},"type":"if","locations":[{"start":{"line":38,"column":4},"end":{"line":40,"column":5}},{"start":{"line":38,"column":4},"end":{"line":40,"column":5}}],"line":38},"6":{"loc":{"start":{"line":42,"column":28},"end":{"line":42,"column":54}},"type":"binary-expr","locations":[{"start":{"line":42,"column":28},"end":{"line":42,"column":48}},{"start":{"line":42,"column":52},"end":{"line":42,"column":54}}],"line":42},"7":{"loc":{"start":{"line":45,"column":4},"end":{"line":47,"column":5}},"type":"if","locations":[{"start":{"line":45,"column":4},"end":{"line":47,"column":5}},{"start":{"line":45,"column":4},"end":{"line":47,"column":5}}],"line":45},"8":{"loc":{"start":{"line":65,"column":4},"end":{"line":65,"column":21}},"type":"if","locations":[{"start":{"line":65,"column":4},"end":{"line":65,"column":21}},{"start":{"line":65,"column":4},"end":{"line":65,"column":21}}],"line":65},"9":{"loc":{"start":{"line":67,"column":4},"end":{"line":71,"column":5}},"type":"if","locations":[{"start":{"line":67,"column":4},"end":{"line":71,"column":5}},{"start":{"line":67,"column":4},"end":{"line":71,"column":5}}],"line":67}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":2,"7":1,"8":5,"9":5,"10":5,"11":3,"12":5,"13":3,"14":5,"15":3,"16":4,"17":3,"18":1,"19":2,"20":4,"21":1,"22":1,"23":9,"24":4,"25":8,"26":8,"27":44,"28":8,"29":5,"30":5,"31":4,"32":21,"33":21,"34":4,"35":17,"36":13,"37":4,"38":4,"39":4},"f":{"0":2,"1":5,"2":3,"3":4,"4":1,"5":9,"6":8,"7":44,"8":5,"9":21,"10":4},"b":{"0":[0,2],"1":[2,2],"2":[3,2],"3":[3,2],"4":[4,3],"5":[1,2],"6":[2,1],"7":[1,0],"8":[4,17],"9":[13,4]},"inputSourceMap":{"version":3,"sources":["readonly.js"],"names":["cleanAssets","readOnly","guardianFactors","connections","databases","tenant","clients","getExcludedFields","config","strippedFields","EXCLUDED_PROPS","excluded","INCLUDED_PROPS","included","Object","entries","forEach","name","fields","intersections","filter","field","includes","length","Error","join","concat","deleteKeys","obj","keys","newObj","k","dotProp","delete","assets","cleaned","excludedFields","Array","isArray","map","o","_","pickBy","identity"],"mappings":"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","sourceRoot":"/home/circleci/repo/src/","sourcesContent":["import dotProp from 'dot-prop';\nimport _ from 'lodash';\n// Filter out known read only fields during dump\nconst readOnly = {\n  guardianFactors: [\n    'trial_expired'\n  ],\n  connections: [\n    'provisioning_ticket_url',\n    'realms'\n  ],\n  databases: [\n    'options.configuration'\n  ],\n  tenant: [\n    'sandbox_version',\n    'sandbox_versions_available',\n    'flags.allow_changing_enable_sso',\n    'flags.enable_sso',\n    'flags.disable_impersonation',\n    'flags.remove_stale_idp_attributes'\n  ],\n  clients: [\n    'client_secret',\n    'callback_url_template',\n    'signing_keys',\n    'global',\n    'tenant',\n    'custom_login_page_preview',\n    'config_route',\n    'owners'\n  ]\n};\n\nfunction getExcludedFields(config) {\n  const strippedFields = { ...readOnly };\n\n  let { EXCLUDED_PROPS: excluded, INCLUDED_PROPS: included } = config;\n  if (typeof excluded !== 'object') excluded = {};\n  if (typeof included !== 'object') included = {};\n\n  Object.entries(excluded).forEach(([ name, fields ]) => {\n    // Do not allow same field to be included and excluded at the same time\n    const intersections = fields.filter((field) => included[name] && included[name].includes(field));\n    if (intersections.length > 0) {\n      throw new Error(`EXCLUDED_PROPS should NOT have any intersections with INCLUDED_PROPS. Intersections found: ${name}: ${intersections.join(', ')}`);\n    }\n    strippedFields[name] = (strippedFields[name] || []).concat(fields);\n  });\n\n  Object.entries(included).forEach(([ name, fields ]) => {\n    if (strippedFields[name]) {\n      strippedFields[name] = strippedFields[name].filter((field) => !fields.includes(field));\n    }\n  });\n\n  return strippedFields;\n}\n\nfunction deleteKeys(obj, keys) {\n  const newObj = { ...obj };\n  keys.forEach((k) => dotProp.delete(newObj, k));\n  return newObj;\n}\n\nexport default function cleanAssets(assets, config) {\n  const cleaned = { ...assets };\n  const excludedFields = getExcludedFields(config);\n\n  Object.entries(excludedFields).forEach(([ name, fields ]) => {\n    const obj = cleaned[name];\n    if (!obj) return;\n\n    if (Array.isArray(obj)) {\n      cleaned[name] = obj.map((o) => deleteKeys(o, fields));\n    } else {\n      cleaned[name] = deleteKeys(cleaned[name], fields);\n    }\n  });\n\n  return _.pickBy(cleaned, _.identity);\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"642ce892c58697c9b30f993f64a6a70c501bd034","contentHash":"9bf8cb8373e41318eda6c11f9c5418fd459a5791c498c5fc6b5b66c1f50c250c"},"/home/circleci/repo/src/context/directory/index.js":{"path":"/home/circleci/repo/src/context/directory/index.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":12},"end":{"line":7,"column":27}},"2":{"start":{"line":9,"column":11},"end":{"line":9,"column":41}},"3":{"start":{"line":11,"column":13},"end":{"line":11,"column":35}},"4":{"start":{"line":13,"column":16},"end":{"line":13,"column":41}},"5":{"start":{"line":15,"column":17},"end":{"line":15,"column":50}},"6":{"start":{"line":17,"column":14},"end":{"line":17,"column":37}},"7":{"start":{"line":19,"column":15},"end":{"line":19,"column":46}},"8":{"start":{"line":21,"column":16},"end":{"line":21,"column":37}},"9":{"start":{"line":23,"column":17},"end":{"line":23,"column":50}},"10":{"start":{"line":25,"column":13},"end":{"line":25,"column":35}},"11":{"start":{"line":27,"column":39},"end":{"line":27,"column":93}},"12":{"start":{"line":29,"column":49},"end":{"line":29,"column":96}},"13":{"start":{"line":29,"column":84},"end":{"line":29,"column":96}},"14":{"start":{"line":29,"column":121},"end":{"line":29,"column":134}},"15":{"start":{"line":29,"column":159},"end":{"line":29,"column":172}},"16":{"start":{"line":29,"column":174},"end":{"line":29,"column":309}},"17":{"start":{"line":29,"column":234},"end":{"line":29,"column":292}},"18":{"start":{"line":31,"column":53},"end":{"line":31,"column":111}},"19":{"start":{"line":31,"column":98},"end":{"line":31,"column":109}},"20":{"start":{"line":31,"column":112},"end":{"line":31,"column":214}},"21":{"start":{"line":31,"column":188},"end":{"line":31,"column":212}},"22":{"start":{"line":31,"column":227},"end":{"line":31,"column":264}},"23":{"start":{"line":31,"column":266},"end":{"line":31,"column":321}},"24":{"start":{"line":31,"column":297},"end":{"line":31,"column":319}},"25":{"start":{"line":31,"column":335},"end":{"line":31,"column":337}},"26":{"start":{"line":31,"column":367},"end":{"line":31,"column":423}},"27":{"start":{"line":31,"column":425},"end":{"line":31,"column":726}},"28":{"start":{"line":31,"column":448},"end":{"line":31,"column":724}},"29":{"start":{"line":31,"column":534},"end":{"line":31,"column":606}},"30":{"start":{"line":31,"column":608},"end":{"line":31,"column":722}},"31":{"start":{"line":31,"column":646},"end":{"line":31,"column":687}},"32":{"start":{"line":31,"column":697},"end":{"line":31,"column":720}},"33":{"start":{"line":31,"column":727},"end":{"line":31,"column":748}},"34":{"start":{"line":31,"column":749},"end":{"line":31,"column":787}},"35":{"start":{"line":31,"column":762},"end":{"line":31,"column":785}},"36":{"start":{"line":31,"column":788},"end":{"line":31,"column":802}},"37":{"start":{"line":33,"column":0},"end":{"line":107,"column":2}},"38":{"start":{"line":35,"column":4},"end":{"line":35,"column":44}},"39":{"start":{"line":36,"column":4},"end":{"line":36,"column":25}},"40":{"start":{"line":37,"column":4},"end":{"line":37,"column":58}},"41":{"start":{"line":38,"column":4},"end":{"line":38,"column":33}},"42":{"start":{"line":39,"column":4},"end":{"line":48,"column":6}},"43":{"start":{"line":52,"column":21},"end":{"line":52,"column":53}},"44":{"start":{"line":53,"column":17},"end":{"line":53,"column":39}},"45":{"start":{"line":55,"column":4},"end":{"line":57,"column":5}},"46":{"start":{"line":56,"column":6},"end":{"line":56,"column":17}},"47":{"start":{"line":59,"column":4},"end":{"line":59,"column":55}},"48":{"start":{"line":63,"column":4},"end":{"line":73,"column":5}},"49":{"start":{"line":64,"column":6},"end":{"line":64,"column":69}},"50":{"start":{"line":66,"column":6},"end":{"line":71,"column":9}},"51":{"start":{"line":67,"column":23},"end":{"line":67,"column":42}},"52":{"start":{"line":68,"column":8},"end":{"line":70,"column":11}},"53":{"start":{"line":69,"column":10},"end":{"line":69,"column":29}},"54":{"start":{"line":72,"column":6},"end":{"line":72,"column":13}},"55":{"start":{"line":75,"column":4},"end":{"line":75,"column":94}},"56":{"start":{"line":79,"column":18},"end":{"line":79,"column":101}},"57":{"start":{"line":81,"column":4},"end":{"line":81,"column":55}},"58":{"start":{"line":83,"column":4},"end":{"line":83,"column":26}},"59":{"start":{"line":84,"column":4},"end":{"line":84,"column":31}},"60":{"start":{"line":85,"column":4},"end":{"line":85,"column":68}},"61":{"start":{"line":86,"column":4},"end":{"line":86,"column":55}},"62":{"start":{"line":88,"column":4},"end":{"line":90,"column":5}},"63":{"start":{"line":89,"column":6},"end":{"line":89,"column":69}},"64":{"start":{"line":92,"column":4},"end":{"line":104,"column":8}},"65":{"start":{"line":93,"column":6},"end":{"line":103,"column":7}},"66":{"start":{"line":94,"column":21},"end":{"line":94,"column":45}},"67":{"start":{"line":96,"column":8},"end":{"line":98,"column":9}},"68":{"start":{"line":97,"column":10},"end":{"line":97,"column":53}},"69":{"start":{"line":100,"column":8},"end":{"line":100,"column":42}},"70":{"start":{"line":102,"column":8},"end":{"line":102,"column":53}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":27,"column":9},"end":{"line":27,"column":31}},"loc":{"start":{"line":27,"column":37},"end":{"line":27,"column":95}},"line":27},"1":{"name":"_getRequireWildcardCache","decl":{"start":{"line":29,"column":9},"end":{"line":29,"column":33}},"loc":{"start":{"line":29,"column":47},"end":{"line":29,"column":311}},"line":29},"2":{"name":"(anonymous_2)","decl":{"start":{"line":29,"column":209},"end":{"line":29,"column":210}},"loc":{"start":{"line":29,"column":232},"end":{"line":29,"column":294}},"line":29},"3":{"name":"_interopRequireWildcard","decl":{"start":{"line":31,"column":9},"end":{"line":31,"column":32}},"loc":{"start":{"line":31,"column":51},"end":{"line":31,"column":804}},"line":31},"4":{"name":"(anonymous_4)","decl":{"start":{"line":34,"column":2},"end":{"line":34,"column":3}},"loc":{"start":{"line":34,"column":34},"end":{"line":49,"column":3}},"line":34},"5":{"name":"(anonymous_5)","decl":{"start":{"line":51,"column":2},"end":{"line":51,"column":3}},"loc":{"start":{"line":51,"column":22},"end":{"line":60,"column":3}},"line":51},"6":{"name":"(anonymous_6)","decl":{"start":{"line":62,"column":2},"end":{"line":62,"column":3}},"loc":{"start":{"line":62,"column":15},"end":{"line":76,"column":3}},"line":62},"7":{"name":"(anonymous_7)","decl":{"start":{"line":66,"column":48},"end":{"line":66,"column":49}},"loc":{"start":{"line":66,"column":59},"end":{"line":71,"column":7}},"line":66},"8":{"name":"(anonymous_8)","decl":{"start":{"line":68,"column":39},"end":{"line":68,"column":40}},"loc":{"start":{"line":68,"column":51},"end":{"line":70,"column":9}},"line":68},"9":{"name":"(anonymous_9)","decl":{"start":{"line":78,"column":2},"end":{"line":78,"column":3}},"loc":{"start":{"line":78,"column":15},"end":{"line":105,"column":3}},"line":78},"10":{"name":"(anonymous_10)","decl":{"start":{"line":92,"column":61},"end":{"line":92,"column":62}},"loc":{"start":{"line":92,"column":88},"end":{"line":104,"column":5}},"line":92}},"branchMap":{"0":{"loc":{"start":{"line":27,"column":46},"end":{"line":27,"column":92}},"type":"cond-expr","locations":[{"start":{"line":27,"column":70},"end":{"line":27,"column":73}},{"start":{"line":27,"column":76},"end":{"line":27,"column":92}}],"line":27},"1":{"loc":{"start":{"line":27,"column":46},"end":{"line":27,"column":67}},"type":"binary-expr","locations":[{"start":{"line":27,"column":46},"end":{"line":27,"column":49}},{"start":{"line":27,"column":53},"end":{"line":27,"column":67}}],"line":27},"2":{"loc":{"start":{"line":29,"column":49},"end":{"line":29,"column":96}},"type":"if","locations":[{"start":{"line":29,"column":49},"end":{"line":29,"column":96}},{"start":{"line":29,"column":49},"end":{"line":29,"column":96}}],"line":29},"3":{"loc":{"start":{"line":29,"column":241},"end":{"line":29,"column":291}},"type":"cond-expr","locations":[{"start":{"line":29,"column":255},"end":{"line":29,"column":271}},{"start":{"line":29,"column":274},"end":{"line":29,"column":291}}],"line":29},"4":{"loc":{"start":{"line":31,"column":53},"end":{"line":31,"column":111}},"type":"if","locations":[{"start":{"line":31,"column":53},"end":{"line":31,"column":111}},{"start":{"line":31,"column":53},"end":{"line":31,"column":111}}],"line":31},"5":{"loc":{"start":{"line":31,"column":57},"end":{"line":31,"column":94}},"type":"binary-expr","locations":[{"start":{"line":31,"column":57},"end":{"line":31,"column":69}},{"start":{"line":31,"column":73},"end":{"line":31,"column":76}},{"start":{"line":31,"column":80},"end":{"line":31,"column":94}}],"line":31},"6":{"loc":{"start":{"line":31,"column":112},"end":{"line":31,"column":214}},"type":"if","locations":[{"start":{"line":31,"column":112},"end":{"line":31,"column":214}},{"start":{"line":31,"column":112},"end":{"line":31,"column":214}}],"line":31},"7":{"loc":{"start":{"line":31,"column":116},"end":{"line":31,"column":184}},"type":"binary-expr","locations":[{"start":{"line":31,"column":116},"end":{"line":31,"column":128}},{"start":{"line":31,"column":132},"end":{"line":31,"column":155}},{"start":{"line":31,"column":159},"end":{"line":31,"column":184}}],"line":31},"8":{"loc":{"start":{"line":31,"column":266},"end":{"line":31,"column":321}},"type":"if","locations":[{"start":{"line":31,"column":266},"end":{"line":31,"column":321}},{"start":{"line":31,"column":266},"end":{"line":31,"column":321}}],"line":31},"9":{"loc":{"start":{"line":31,"column":270},"end":{"line":31,"column":293}},"type":"binary-expr","locations":[{"start":{"line":31,"column":270},"end":{"line":31,"column":275}},{"start":{"line":31,"column":279},"end":{"line":31,"column":293}}],"line":31},"10":{"loc":{"start":{"line":31,"column":367},"end":{"line":31,"column":423}},"type":"binary-expr","locations":[{"start":{"line":31,"column":367},"end":{"line":31,"column":388}},{"start":{"line":31,"column":392},"end":{"line":31,"column":423}}],"line":31},"11":{"loc":{"start":{"line":31,"column":448},"end":{"line":31,"column":724}},"type":"if","locations":[{"start":{"line":31,"column":448},"end":{"line":31,"column":724}},{"start":{"line":31,"column":448},"end":{"line":31,"column":724}}],"line":31},"12":{"loc":{"start":{"line":31,"column":452},"end":{"line":31,"column":519}},"type":"binary-expr","locations":[{"start":{"line":31,"column":452},"end":{"line":31,"column":469}},{"start":{"line":31,"column":473},"end":{"line":31,"column":519}}],"line":31},"13":{"loc":{"start":{"line":31,"column":534},"end":{"line":31,"column":606}},"type":"cond-expr","locations":[{"start":{"line":31,"column":558},"end":{"line":31,"column":599}},{"start":{"line":31,"column":602},"end":{"line":31,"column":606}}],"line":31},"14":{"loc":{"start":{"line":31,"column":608},"end":{"line":31,"column":722}},"type":"if","locations":[{"start":{"line":31,"column":608},"end":{"line":31,"column":722}},{"start":{"line":31,"column":608},"end":{"line":31,"column":722}}],"line":31},"15":{"loc":{"start":{"line":31,"column":612},"end":{"line":31,"column":642}},"type":"binary-expr","locations":[{"start":{"line":31,"column":612},"end":{"line":31,"column":616}},{"start":{"line":31,"column":621},"end":{"line":31,"column":629}},{"start":{"line":31,"column":633},"end":{"line":31,"column":641}}],"line":31},"16":{"loc":{"start":{"line":31,"column":749},"end":{"line":31,"column":787}},"type":"if","locations":[{"start":{"line":31,"column":749},"end":{"line":31,"column":787}},{"start":{"line":31,"column":749},"end":{"line":31,"column":787}}],"line":31},"17":{"loc":{"start":{"line":41,"column":15},"end":{"line":41,"column":48}},"type":"binary-expr","locations":[{"start":{"line":41,"column":15},"end":{"line":41,"column":42}},{"start":{"line":41,"column":46},"end":{"line":41,"column":48}}],"line":41},"18":{"loc":{"start":{"line":42,"column":17},"end":{"line":42,"column":52}},"type":"binary-expr","locations":[{"start":{"line":42,"column":17},"end":{"line":42,"column":46}},{"start":{"line":42,"column":50},"end":{"line":42,"column":52}}],"line":42},"19":{"loc":{"start":{"line":43,"column":19},"end":{"line":43,"column":56}},"type":"binary-expr","locations":[{"start":{"line":43,"column":19},"end":{"line":43,"column":50}},{"start":{"line":43,"column":54},"end":{"line":43,"column":56}}],"line":43},"20":{"loc":{"start":{"line":44,"column":21},"end":{"line":44,"column":60}},"type":"binary-expr","locations":[{"start":{"line":44,"column":21},"end":{"line":44,"column":54}},{"start":{"line":44,"column":58},"end":{"line":44,"column":60}}],"line":44},"21":{"loc":{"start":{"line":45,"column":25},"end":{"line":45,"column":69}},"type":"binary-expr","locations":[{"start":{"line":45,"column":25},"end":{"line":45,"column":63}},{"start":{"line":45,"column":67},"end":{"line":45,"column":69}}],"line":45},"22":{"loc":{"start":{"line":46,"column":18},"end":{"line":46,"column":54}},"type":"binary-expr","locations":[{"start":{"line":46,"column":18},"end":{"line":46,"column":48}},{"start":{"line":46,"column":52},"end":{"line":46,"column":54}}],"line":46},"23":{"loc":{"start":{"line":55,"column":4},"end":{"line":57,"column":5}},"type":"if","locations":[{"start":{"line":55,"column":4},"end":{"line":57,"column":5}},{"start":{"line":55,"column":4},"end":{"line":57,"column":5}}],"line":55},"24":{"loc":{"start":{"line":63,"column":4},"end":{"line":73,"column":5}},"type":"if","locations":[{"start":{"line":63,"column":4},"end":{"line":73,"column":5}},{"start":{"line":63,"column":4},"end":{"line":73,"column":5}}],"line":63},"25":{"loc":{"start":{"line":88,"column":4},"end":{"line":90,"column":5}},"type":"if","locations":[{"start":{"line":88,"column":4},"end":{"line":90,"column":5}},{"start":{"line":88,"column":4},"end":{"line":90,"column":5}}],"line":88},"26":{"loc":{"start":{"line":96,"column":8},"end":{"line":98,"column":9}},"type":"if","locations":[{"start":{"line":96,"column":8},"end":{"line":98,"column":9}},{"start":{"line":96,"column":8},"end":{"line":98,"column":9}}],"line":96}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":3,"12":1,"13":0,"14":1,"15":1,"16":1,"17":1,"18":1,"19":0,"20":1,"21":0,"22":1,"23":1,"24":0,"25":1,"26":1,"27":1,"28":16,"29":16,"30":16,"31":0,"32":16,"33":1,"34":1,"35":1,"36":1,"37":1,"38":94,"39":94,"40":94,"41":94,"42":94,"43":10,"44":10,"45":10,"46":2,"47":10,"48":55,"49":53,"50":53,"51":1043,"52":1029,"53":778,"54":39,"55":2,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0},"f":{"0":3,"1":1,"2":1,"3":1,"4":94,"5":10,"6":55,"7":1043,"8":778,"9":0,"10":0},"b":{"0":[3,0],"1":[3,3],"2":[0,1],"3":[0,1],"4":[0,1],"5":[1,1,1],"6":[0,1],"7":[1,1,0],"8":[0,1],"9":[1,1],"10":[1,1],"11":[16,0],"12":[16,16],"13":[16,0],"14":[0,16],"15":[16,16,16],"16":[1,0],"17":[94,93],"18":[94,93],"19":[94,93],"20":[94,93],"21":[94,93],"22":[94,93],"23":[2,8],"24":[53,2],"25":[0,0],"26":[0,0]},"inputSourceMap":{"version":3,"sources":["index.js"],"names":["path","constructor","config","mgmtClient","filePath","AUTH0_INPUT_FILE","mappings","AUTH0_KEYWORD_REPLACE_MAPPINGS","assets","exclude","rules","AUTH0_EXCLUDED_RULES","clients","AUTH0_EXCLUDED_CLIENTS","databases","AUTH0_EXCLUDED_DATABASES","connections","AUTH0_EXCLUDED_CONNECTIONS","resourceServers","AUTH0_EXCLUDED_RESOURCE_SERVERS","defaults","AUTH0_EXCLUDED_DEFAULTS","loadFile","f","folder","basePath","join","toLoad","load","log","info","Object","values","handlers","forEach","handler","parsed","parse","entries","k","v","Error","dump","auth0","Auth0","loadAll","clientsOrig","AUTH0_EXPORT_IDENTIFIERS","Promise","all","map","name","data","err","debug","stack"],"mappings":"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","sourceRoot":"/home/circleci/repo/src/context/directory/","sourcesContent":["import * as path from 'path';\nimport { loadFile, Auth0 } from '../../tools';\n\nimport cleanAssets from '../../readonly';\nimport log from '../../logger';\nimport handlers from './handlers';\nimport {\n  isDirectory, isFile, stripIdentifiers, toConfigFn\n} from '../../utils';\n\nexport default class {\n  constructor(config, mgmtClient) {\n    this.filePath = config.AUTH0_INPUT_FILE;\n    this.config = config;\n    this.mappings = config.AUTH0_KEYWORD_REPLACE_MAPPINGS;\n    this.mgmtClient = mgmtClient;\n\n    // Get excluded rules\n    this.assets = {\n      exclude: {\n        rules: config.AUTH0_EXCLUDED_RULES || [],\n        clients: config.AUTH0_EXCLUDED_CLIENTS || [],\n        databases: config.AUTH0_EXCLUDED_DATABASES || [],\n        connections: config.AUTH0_EXCLUDED_CONNECTIONS || [],\n        resourceServers: config.AUTH0_EXCLUDED_RESOURCE_SERVERS || [],\n        defaults: config.AUTH0_EXCLUDED_DEFAULTS || []\n      }\n    };\n  }\n\n  loadFile(f, folder) {\n    const basePath = path.join(this.filePath, folder);\n    let toLoad = path.join(basePath, f);\n    if (!isFile(toLoad)) {\n      // try load not relative to yaml file\n      toLoad = f;\n    }\n    return loadFile(toLoad, this.mappings);\n  }\n\n  async load() {\n    if (isDirectory(this.filePath)) {\n      /* If this is a directory, look for each file in the directory */\n      log.info(`Processing directory ${this.filePath}`);\n\n      Object.values(handlers)\n        .forEach((handler) => {\n          const parsed = handler.parse(this);\n          Object.entries(parsed)\n            .forEach(([ k, v ]) => {\n              this.assets[k] = v;\n            });\n        });\n      return;\n    }\n    throw new Error(`Not sure what to do with, ${this.filePath} as it is not a directory...`);\n  }\n\n  async dump() {\n    const auth0 = new Auth0(this.mgmtClient, this.assets, toConfigFn(this.config));\n    log.info('Loading Auth0 Tenant Data');\n    await auth0.loadAll();\n    this.assets = auth0.assets;\n\n    // Clean known read only fields\n    this.assets = cleanAssets(this.assets, this.config);\n\n    // Copy clients to be used by handlers which require converting client_id to the name\n    // Must copy as the client_id will be stripped if AUTH0_EXPORT_IDENTIFIERS is false\n    this.assets.clientsOrig = [ ...this.assets.clients ];\n\n    // Optionally Strip identifiers\n    if (!this.config.AUTH0_EXPORT_IDENTIFIERS) {\n      this.assets = stripIdentifiers(auth0, this.assets);\n    }\n\n    await Promise.all(Object.entries(handlers).map(async ([ name, handler ]) => {\n      try {\n        const data = await handler.dump(this);\n        if (data) {\n          log.info(`Exporting ${name}`);\n        }\n      } catch (err) {\n        log.debug(err.stack);\n        throw new Error(`Problem exporting ${name}`);\n      }\n    }));\n  }\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"3217b8f8797995521cb1b228fac9aed1c7c17241","contentHash":"9f093a11675c4e06c663a8109d047dc7d5e15872700019021ba4442ffe553d4b"},"/home/circleci/repo/src/context/directory/handlers/index.js":{"path":"/home/circleci/repo/src/context/directory/handlers/index.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":13},"end":{"line":7,"column":31}},"2":{"start":{"line":9,"column":14},"end":{"line":9,"column":44}},"3":{"start":{"line":11,"column":13},"end":{"line":11,"column":31}},"4":{"start":{"line":13,"column":14},"end":{"line":13,"column":44}},"5":{"start":{"line":15,"column":13},"end":{"line":15,"column":31}},"6":{"start":{"line":17,"column":14},"end":{"line":17,"column":44}},"7":{"start":{"line":19,"column":15},"end":{"line":19,"column":35}},"8":{"start":{"line":21,"column":16},"end":{"line":21,"column":48}},"9":{"start":{"line":23,"column":14},"end":{"line":23,"column":33}},"10":{"start":{"line":25,"column":15},"end":{"line":25,"column":46}},"11":{"start":{"line":27,"column":21},"end":{"line":27,"column":47}},"12":{"start":{"line":29,"column":22},"end":{"line":29,"column":60}},"13":{"start":{"line":31,"column":19},"end":{"line":31,"column":43}},"14":{"start":{"line":33,"column":20},"end":{"line":33,"column":56}},"15":{"start":{"line":35,"column":17},"end":{"line":35,"column":39}},"16":{"start":{"line":37,"column":18},"end":{"line":37,"column":52}},"17":{"start":{"line":39,"column":22},"end":{"line":39,"column":49}},"18":{"start":{"line":41,"column":23},"end":{"line":41,"column":62}},"19":{"start":{"line":43,"column":20},"end":{"line":43,"column":45}},"20":{"start":{"line":45,"column":21},"end":{"line":45,"column":58}},"21":{"start":{"line":47,"column":20},"end":{"line":47,"column":45}},"22":{"start":{"line":49,"column":21},"end":{"line":49,"column":58}},"23":{"start":{"line":51,"column":23},"end":{"line":51,"column":51}},"24":{"start":{"line":53,"column":24},"end":{"line":53,"column":64}},"25":{"start":{"line":55,"column":23},"end":{"line":55,"column":51}},"26":{"start":{"line":57,"column":24},"end":{"line":57,"column":64}},"27":{"start":{"line":59,"column":31},"end":{"line":59,"column":67}},"28":{"start":{"line":61,"column":32},"end":{"line":61,"column":80}},"29":{"start":{"line":63,"column":31},"end":{"line":63,"column":67}},"30":{"start":{"line":65,"column":32},"end":{"line":65,"column":80}},"31":{"start":{"line":67,"column":39},"end":{"line":67,"column":83}},"32":{"start":{"line":69,"column":40},"end":{"line":69,"column":96}},"33":{"start":{"line":71,"column":43},"end":{"line":71,"column":91}},"34":{"start":{"line":73,"column":44},"end":{"line":73,"column":104}},"35":{"start":{"line":75,"column":24},"end":{"line":75,"column":53}},"36":{"start":{"line":77,"column":25},"end":{"line":77,"column":66}},"37":{"start":{"line":79,"column":13},"end":{"line":79,"column":31}},"38":{"start":{"line":81,"column":14},"end":{"line":81,"column":44}},"39":{"start":{"line":83,"column":18},"end":{"line":83,"column":41}},"40":{"start":{"line":85,"column":19},"end":{"line":85,"column":54}},"41":{"start":{"line":87,"column":15},"end":{"line":87,"column":35}},"42":{"start":{"line":89,"column":16},"end":{"line":89,"column":48}},"43":{"start":{"line":91,"column":21},"end":{"line":91,"column":47}},"44":{"start":{"line":93,"column":22},"end":{"line":93,"column":60}},"45":{"start":{"line":95,"column":16},"end":{"line":95,"column":37}},"46":{"start":{"line":97,"column":17},"end":{"line":97,"column":50}},"47":{"start":{"line":99,"column":39},"end":{"line":99,"column":93}},"48":{"start":{"line":101,"column":0},"end":{"line":125,"column":2}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":99,"column":9},"end":{"line":99,"column":31}},"loc":{"start":{"line":99,"column":37},"end":{"line":99,"column":95}},"line":99}},"branchMap":{"0":{"loc":{"start":{"line":99,"column":46},"end":{"line":99,"column":92}},"type":"cond-expr","locations":[{"start":{"line":99,"column":70},"end":{"line":99,"column":73}},{"start":{"line":99,"column":76},"end":{"line":99,"column":92}}],"line":99},"1":{"loc":{"start":{"line":99,"column":46},"end":{"line":99,"column":67}},"type":"binary-expr","locations":[{"start":{"line":99,"column":46},"end":{"line":99,"column":49}},{"start":{"line":99,"column":53},"end":{"line":99,"column":67}}],"line":99}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1,"24":1,"25":1,"26":1,"27":1,"28":1,"29":1,"30":1,"31":1,"32":1,"33":1,"34":1,"35":1,"36":1,"37":1,"38":1,"39":1,"40":1,"41":1,"42":1,"43":1,"44":1,"45":1,"46":1,"47":23,"48":1},"f":{"0":23},"b":{"0":[23,0],"1":[23,23]},"inputSourceMap":{"version":3,"sources":["index.js"],"names":["rules","rulesConfigs","hooks","pages","databases","clientGrants","resourceServers","clients","connections","tenant","emailProvider","emailTemplates","guardianFactors","guardianFactorProviders","guardianFactorTemplates","migrations","guardianPhoneFactorMessageTypes","guardianPhoneFactorSelectedProvider","guardianPolicies","roles","actions","organizations","triggers"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;kBAEe;AACbA,EAAAA,KAAK,EAALA,eADa;AAEbC,EAAAA,YAAY,EAAZA,sBAFa;AAGbC,EAAAA,KAAK,EAALA,eAHa;AAIbC,EAAAA,KAAK,EAALA,eAJa;AAKbC,EAAAA,SAAS,EAATA,mBALa;AAMbC,EAAAA,YAAY,EAAZA,sBANa;AAObC,EAAAA,eAAe,EAAfA,yBAPa;AAQbC,EAAAA,OAAO,EAAPA,iBARa;AASbC,EAAAA,WAAW,EAAXA,qBATa;AAUbC,EAAAA,MAAM,EAANA,gBAVa;AAWbC,EAAAA,aAAa,EAAbA,uBAXa;AAYbC,EAAAA,cAAc,EAAdA,wBAZa;AAabC,EAAAA,eAAe,EAAfA,yBAba;AAcbC,EAAAA,uBAAuB,EAAvBA,iCAda;AAebC,EAAAA,uBAAuB,EAAvBA,iCAfa;AAgBbC,EAAAA,UAAU,EAAVA,oBAhBa;AAiBbC,EAAAA,+BAA+B,EAA/BA,yCAjBa;AAkBbC,EAAAA,mCAAmC,EAAnCA,6CAlBa;AAmBbC,EAAAA,gBAAgB,EAAhBA,0BAnBa;AAoBbC,EAAAA,KAAK,EAALA,eApBa;AAqBbC,EAAAA,OAAO,EAAPA,iBArBa;AAsBbC,EAAAA,aAAa,EAAbA,uBAtBa;AAuBbC,EAAAA,QAAQ,EAARA;AAvBa,C","sourceRoot":"/home/circleci/repo/src/context/directory/handlers/","sourcesContent":["import pages from './pages';\nimport rules from './rules';\nimport hooks from './hooks';\nimport clients from './clients';\nimport tenant from './tenant';\nimport emailProvider from './emailProvider';\nimport connections from './connections';\nimport databases from './databases';\nimport emailTemplates from './emailTemplates';\nimport clientGrants from './clientGrants';\nimport rulesConfigs from './rulesConfigs';\nimport resourceServers from './resourceServers';\nimport guardianFactors from './guardianFactors';\nimport guardianFactorProviders from './guardianFactorProviders';\nimport guardianFactorTemplates from './guardianFactorTemplates';\nimport guardianPhoneFactorMessageTypes from './guardianPhoneFactorMessageTypes';\nimport guardianPhoneFactorSelectedProvider from './guardianPhoneFactorSelectedProvider';\nimport guardianPolicies from './guardianPolicies';\nimport roles from './roles';\nimport migrations from './migrations';\nimport actions from './actions';\nimport organizations from './organizations';\nimport triggers from './triggers';\n\nexport default {\n  rules,\n  rulesConfigs,\n  hooks,\n  pages,\n  databases,\n  clientGrants,\n  resourceServers,\n  clients,\n  connections,\n  tenant,\n  emailProvider,\n  emailTemplates,\n  guardianFactors,\n  guardianFactorProviders,\n  guardianFactorTemplates,\n  migrations,\n  guardianPhoneFactorMessageTypes,\n  guardianPhoneFactorSelectedProvider,\n  guardianPolicies,\n  roles,\n  actions,\n  organizations,\n  triggers\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"56c1e56cf1c6400b0b810745f69ea04fe1751fc5","contentHash":"6533ef4f6eb0908cd688f5420b2c3b3296af8503ffd63be956e38dea7b6808b1"},"/home/circleci/repo/src/context/directory/handlers/pages.js":{"path":"/home/circleci/repo/src/context/directory/handlers/pages.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":15},"end":{"line":7,"column":34}},"2":{"start":{"line":9,"column":16},"end":{"line":9,"column":48}},"3":{"start":{"line":11,"column":12},"end":{"line":11,"column":27}},"4":{"start":{"line":13,"column":13},"end":{"line":13,"column":42}},"5":{"start":{"line":15,"column":13},"end":{"line":15,"column":38}},"6":{"start":{"line":17,"column":14},"end":{"line":17,"column":40}},"7":{"start":{"line":19,"column":15},"end":{"line":19,"column":46}},"8":{"start":{"line":21,"column":13},"end":{"line":21,"column":38}},"9":{"start":{"line":23,"column":39},"end":{"line":23,"column":93}},"10":{"start":{"line":26,"column":22},"end":{"line":26,"column":93}},"11":{"start":{"line":28,"column":2},"end":{"line":30,"column":4}},"12":{"start":{"line":28,"column":49},"end":{"line":30,"column":4}},"13":{"start":{"line":31,"column":16},"end":{"line":31,"column":69}},"14":{"start":{"line":32,"column":17},"end":{"line":32,"column":19}},"15":{"start":{"line":33,"column":2},"end":{"line":42,"column":5}},"16":{"start":{"line":37,"column":8},"end":{"line":37,"column":34}},"17":{"start":{"line":39,"column":4},"end":{"line":39,"column":41}},"18":{"start":{"line":39,"column":23},"end":{"line":39,"column":41}},"19":{"start":{"line":40,"column":4},"end":{"line":40,"column":50}},"20":{"start":{"line":40,"column":25},"end":{"line":40,"column":50}},"21":{"start":{"line":41,"column":4},"end":{"line":41,"column":50}},"22":{"start":{"line":41,"column":25},"end":{"line":41,"column":50}},"23":{"start":{"line":43,"column":16},"end":{"line":43,"column":18}},"24":{"start":{"line":44,"column":2},"end":{"line":54,"column":5}},"25":{"start":{"line":45,"column":4},"end":{"line":53,"column":5}},"26":{"start":{"line":46,"column":6},"end":{"line":46,"column":106}},"27":{"start":{"line":47,"column":11},"end":{"line":53,"column":5}},"28":{"start":{"line":48,"column":6},"end":{"line":48,"column":102}},"29":{"start":{"line":50,"column":6},"end":{"line":52,"column":9}},"30":{"start":{"line":55,"column":2},"end":{"line":57,"column":4}},"31":{"start":{"line":61,"column":16},"end":{"line":61,"column":49}},"32":{"start":{"line":62,"column":2},"end":{"line":62,"column":21}},"33":{"start":{"line":62,"column":14},"end":{"line":62,"column":21}},"34":{"start":{"line":64,"column":22},"end":{"line":64,"column":93}},"35":{"start":{"line":66,"column":2},"end":{"line":66,"column":47}},"36":{"start":{"line":68,"column":2},"end":{"line":85,"column":5}},"37":{"start":{"line":69,"column":19},"end":{"line":70,"column":5}},"38":{"start":{"line":72,"column":4},"end":{"line":80,"column":5}},"39":{"start":{"line":73,"column":23},"end":{"line":73,"column":76}},"40":{"start":{"line":75,"column":6},"end":{"line":75,"column":51}},"41":{"start":{"line":77,"column":6},"end":{"line":77,"column":59}},"42":{"start":{"line":79,"column":6},"end":{"line":79,"column":44}},"43":{"start":{"line":82,"column":21},"end":{"line":82,"column":74}},"44":{"start":{"line":84,"column":4},"end":{"line":84,"column":45}},"45":{"start":{"line":88,"column":0},"end":{"line":91,"column":2}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":23,"column":9},"end":{"line":23,"column":31}},"loc":{"start":{"line":23,"column":37},"end":{"line":23,"column":95}},"line":23},"1":{"name":"parse","decl":{"start":{"line":25,"column":9},"end":{"line":25,"column":14}},"loc":{"start":{"line":25,"column":24},"end":{"line":58,"column":1}},"line":25},"2":{"name":"(anonymous_2)","decl":{"start":{"line":33,"column":16},"end":{"line":33,"column":17}},"loc":{"start":{"line":33,"column":24},"end":{"line":42,"column":3}},"line":33},"3":{"name":"(anonymous_3)","decl":{"start":{"line":44,"column":32},"end":{"line":44,"column":33}},"loc":{"start":{"line":44,"column":40},"end":{"line":54,"column":3}},"line":44},"4":{"name":"dump","decl":{"start":{"line":60,"column":15},"end":{"line":60,"column":19}},"loc":{"start":{"line":60,"column":29},"end":{"line":86,"column":1}},"line":60},"5":{"name":"(anonymous_5)","decl":{"start":{"line":68,"column":16},"end":{"line":68,"column":17}},"loc":{"start":{"line":68,"column":24},"end":{"line":85,"column":3}},"line":68}},"branchMap":{"0":{"loc":{"start":{"line":23,"column":46},"end":{"line":23,"column":92}},"type":"cond-expr","locations":[{"start":{"line":23,"column":70},"end":{"line":23,"column":73}},{"start":{"line":23,"column":76},"end":{"line":23,"column":92}}],"line":23},"1":{"loc":{"start":{"line":23,"column":46},"end":{"line":23,"column":67}},"type":"binary-expr","locations":[{"start":{"line":23,"column":46},"end":{"line":23,"column":49}},{"start":{"line":23,"column":53},"end":{"line":23,"column":67}}],"line":23},"2":{"loc":{"start":{"line":28,"column":2},"end":{"line":30,"column":4}},"type":"if","locations":[{"start":{"line":28,"column":2},"end":{"line":30,"column":4}},{"start":{"line":28,"column":2},"end":{"line":30,"column":4}}],"line":28},"3":{"loc":{"start":{"line":39,"column":4},"end":{"line":39,"column":41}},"type":"if","locations":[{"start":{"line":39,"column":4},"end":{"line":39,"column":41}},{"start":{"line":39,"column":4},"end":{"line":39,"column":41}}],"line":39},"4":{"loc":{"start":{"line":40,"column":4},"end":{"line":40,"column":50}},"type":"if","locations":[{"start":{"line":40,"column":4},"end":{"line":40,"column":50}},{"start":{"line":40,"column":4},"end":{"line":40,"column":50}}],"line":40},"5":{"loc":{"start":{"line":41,"column":4},"end":{"line":41,"column":50}},"type":"if","locations":[{"start":{"line":41,"column":4},"end":{"line":41,"column":50}},{"start":{"line":41,"column":4},"end":{"line":41,"column":50}}],"line":41},"6":{"loc":{"start":{"line":45,"column":4},"end":{"line":53,"column":5}},"type":"if","locations":[{"start":{"line":45,"column":4},"end":{"line":53,"column":5}},{"start":{"line":45,"column":4},"end":{"line":53,"column":5}}],"line":45},"7":{"loc":{"start":{"line":47,"column":11},"end":{"line":53,"column":5}},"type":"if","locations":[{"start":{"line":47,"column":11},"end":{"line":53,"column":5}},{"start":{"line":47,"column":11},"end":{"line":53,"column":5}}],"line":47},"8":{"loc":{"start":{"line":61,"column":21},"end":{"line":61,"column":47}},"type":"binary-expr","locations":[{"start":{"line":61,"column":21},"end":{"line":61,"column":41}},{"start":{"line":61,"column":45},"end":{"line":61,"column":47}}],"line":61},"9":{"loc":{"start":{"line":62,"column":2},"end":{"line":62,"column":21}},"type":"if","locations":[{"start":{"line":62,"column":2},"end":{"line":62,"column":21}},{"start":{"line":62,"column":2},"end":{"line":62,"column":21}}],"line":62},"10":{"loc":{"start":{"line":72,"column":4},"end":{"line":80,"column":5}},"type":"if","locations":[{"start":{"line":72,"column":4},"end":{"line":80,"column":5}},{"start":{"line":72,"column":4},"end":{"line":80,"column":5}}],"line":72},"11":{"loc":{"start":{"line":72,"column":8},"end":{"line":72,"column":61}},"type":"binary-expr","locations":[{"start":{"line":72,"column":8},"end":{"line":72,"column":34}},{"start":{"line":72,"column":38},"end":{"line":72,"column":61}}],"line":72}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":3,"10":50,"11":50,"12":47,"13":2,"14":2,"15":2,"16":16,"17":16,"18":8,"19":16,"20":8,"21":16,"22":8,"23":2,"24":2,"25":8,"26":0,"27":8,"28":0,"29":8,"30":2,"31":2,"32":2,"33":0,"34":2,"35":2,"36":2,"37":5,"38":5,"39":4,"40":4,"41":4,"42":4,"43":5,"44":5,"45":1},"f":{"0":3,"1":50,"2":16,"3":8,"4":2,"5":5},"b":{"0":[1,2],"1":[3,3],"2":[47,2],"3":[8,8],"4":[8,8],"5":[8,8],"6":[0,8],"7":[0,8],"8":[2,0],"9":[0,2],"10":[4,1],"11":[5,2]},"inputSourceMap":{"version":3,"sources":["pages.js"],"names":["parse","context","pagesFolder","path","join","filePath","constants","PAGES_DIRECTORY","pages","undefined","files","sorted","forEach","file","ext","name","meta","html","Object","values","data","log","warn","push","mappings","dump","assets","fs","ensureDirSync","page","metadata","htmlFile","info","writeFileSync","pageFile"],"mappings":"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","sourceRoot":"/home/circleci/repo/src/context/directory/handlers/","sourcesContent":["import fs from 'fs-extra';\nimport path from 'path';\nimport { constants, loadFile } from '../../../tools';\n\nimport log from '../../../logger';\nimport {\n  getFiles, existsMustBeDir, dumpJSON, loadJSON\n} from '../../../utils';\n\nfunction parse(context) {\n  const pagesFolder = path.join(context.filePath, constants.PAGES_DIRECTORY);\n  if (!existsMustBeDir(pagesFolder)) return { pages: undefined }; // Skip\n\n  const files = getFiles(pagesFolder, [ '.json', '.html' ]);\n\n  const sorted = {};\n\n  files.forEach((file) => {\n    const { ext, name } = path.parse(file);\n    if (!sorted[name]) sorted[name] = {};\n    if (ext === '.json') sorted[name].meta = file;\n    if (ext === '.html') sorted[name].html = file;\n  });\n\n  const pages = [];\n  Object.values(sorted).forEach((data) => {\n    if (!data.meta) {\n      log.warn(`Skipping pages file ${data.html} as missing the corresponding '.json' file`);\n    } else if (!data.html) {\n      log.warn(`Skipping pages file ${data.meta} as missing corresponding '.html' file`);\n    } else {\n      pages.push({\n        ...loadJSON(data.meta, context.mappings),\n        html: loadFile(data.html, context.mappings)\n      });\n    }\n  });\n\n  return {\n    pages\n  };\n}\n\nasync function dump(context) {\n  const pages = [ ...context.assets.pages || [] ];\n\n  if (!pages) return; // Skip, nothing to dump\n\n  // Create Pages folder\n  const pagesFolder = path.join(context.filePath, constants.PAGES_DIRECTORY);\n  fs.ensureDirSync(pagesFolder);\n\n  pages.forEach((page) => {\n    var metadata = { ...page };\n\n    if (page.name !== 'error_page' || page.html !== undefined) {\n      // Dump template html to file\n      const htmlFile = path.join(pagesFolder, `${page.name}.html`);\n      log.info(`Writing ${htmlFile}`);\n      fs.writeFileSync(htmlFile, page.html);\n      metadata.html = `./${page.name}.html`;\n    }\n\n    // Dump page metadata\n    const pageFile = path.join(pagesFolder, `${page.name}.json`);\n    dumpJSON(pageFile, metadata);\n  });\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"f34a7fd87221d50d843d5355e46724e6dc52e358","contentHash":"ea2f09c04672639072120d95973dedce0c0a967c34d6adddc7f17ea6fd16e256"},"/home/circleci/repo/src/context/directory/handlers/rules.js":{"path":"/home/circleci/repo/src/context/directory/handlers/rules.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":15},"end":{"line":7,"column":34}},"2":{"start":{"line":9,"column":16},"end":{"line":9,"column":48}},"3":{"start":{"line":11,"column":12},"end":{"line":11,"column":27}},"4":{"start":{"line":13,"column":13},"end":{"line":13,"column":42}},"5":{"start":{"line":15,"column":13},"end":{"line":15,"column":38}},"6":{"start":{"line":17,"column":14},"end":{"line":17,"column":40}},"7":{"start":{"line":19,"column":15},"end":{"line":19,"column":46}},"8":{"start":{"line":21,"column":13},"end":{"line":21,"column":38}},"9":{"start":{"line":23,"column":39},"end":{"line":23,"column":93}},"10":{"start":{"line":26,"column":22},"end":{"line":26,"column":93}},"11":{"start":{"line":28,"column":2},"end":{"line":30,"column":4}},"12":{"start":{"line":28,"column":49},"end":{"line":30,"column":4}},"13":{"start":{"line":31,"column":16},"end":{"line":31,"column":60}},"14":{"start":{"line":32,"column":16},"end":{"line":41,"column":4}},"15":{"start":{"line":33,"column":17},"end":{"line":34,"column":5}},"16":{"start":{"line":36,"column":4},"end":{"line":38,"column":5}},"17":{"start":{"line":37,"column":6},"end":{"line":37,"column":84}},"18":{"start":{"line":40,"column":4},"end":{"line":40,"column":16}},"19":{"start":{"line":42,"column":2},"end":{"line":44,"column":4}},"20":{"start":{"line":48,"column":16},"end":{"line":48,"column":49}},"21":{"start":{"line":49,"column":2},"end":{"line":49,"column":21}},"22":{"start":{"line":49,"column":14},"end":{"line":49,"column":21}},"23":{"start":{"line":51,"column":22},"end":{"line":51,"column":93}},"24":{"start":{"line":53,"column":2},"end":{"line":53,"column":47}},"25":{"start":{"line":55,"column":2},"end":{"line":69,"column":5}},"26":{"start":{"line":56,"column":17},"end":{"line":56,"column":48}},"27":{"start":{"line":58,"column":19},"end":{"line":58,"column":65}},"28":{"start":{"line":60,"column":4},"end":{"line":60,"column":47}},"29":{"start":{"line":62,"column":4},"end":{"line":62,"column":57}},"30":{"start":{"line":64,"column":21},"end":{"line":64,"column":69}},"31":{"start":{"line":66,"column":4},"end":{"line":68,"column":7}},"32":{"start":{"line":72,"column":0},"end":{"line":75,"column":2}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":23,"column":9},"end":{"line":23,"column":31}},"loc":{"start":{"line":23,"column":37},"end":{"line":23,"column":95}},"line":23},"1":{"name":"parse","decl":{"start":{"line":25,"column":9},"end":{"line":25,"column":14}},"loc":{"start":{"line":25,"column":24},"end":{"line":45,"column":1}},"line":25},"2":{"name":"(anonymous_2)","decl":{"start":{"line":32,"column":26},"end":{"line":32,"column":27}},"loc":{"start":{"line":32,"column":31},"end":{"line":41,"column":3}},"line":32},"3":{"name":"dump","decl":{"start":{"line":47,"column":15},"end":{"line":47,"column":19}},"loc":{"start":{"line":47,"column":29},"end":{"line":70,"column":1}},"line":47},"4":{"name":"(anonymous_4)","decl":{"start":{"line":55,"column":16},"end":{"line":55,"column":17}},"loc":{"start":{"line":55,"column":24},"end":{"line":69,"column":3}},"line":55}},"branchMap":{"0":{"loc":{"start":{"line":23,"column":46},"end":{"line":23,"column":92}},"type":"cond-expr","locations":[{"start":{"line":23,"column":70},"end":{"line":23,"column":73}},{"start":{"line":23,"column":76},"end":{"line":23,"column":92}}],"line":23},"1":{"loc":{"start":{"line":23,"column":46},"end":{"line":23,"column":67}},"type":"binary-expr","locations":[{"start":{"line":23,"column":46},"end":{"line":23,"column":49}},{"start":{"line":23,"column":53},"end":{"line":23,"column":67}}],"line":23},"2":{"loc":{"start":{"line":28,"column":2},"end":{"line":30,"column":4}},"type":"if","locations":[{"start":{"line":28,"column":2},"end":{"line":30,"column":4}},{"start":{"line":28,"column":2},"end":{"line":30,"column":4}}],"line":28},"3":{"loc":{"start":{"line":36,"column":4},"end":{"line":38,"column":5}},"type":"if","locations":[{"start":{"line":36,"column":4},"end":{"line":38,"column":5}},{"start":{"line":36,"column":4},"end":{"line":38,"column":5}}],"line":36},"4":{"loc":{"start":{"line":48,"column":21},"end":{"line":48,"column":47}},"type":"binary-expr","locations":[{"start":{"line":48,"column":21},"end":{"line":48,"column":41}},{"start":{"line":48,"column":45},"end":{"line":48,"column":47}}],"line":48},"5":{"loc":{"start":{"line":49,"column":2},"end":{"line":49,"column":21}},"type":"if","locations":[{"start":{"line":49,"column":2},"end":{"line":49,"column":21}},{"start":{"line":49,"column":2},"end":{"line":49,"column":21}}],"line":49}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":3,"10":53,"11":53,"12":50,"13":2,"14":2,"15":4,"16":4,"17":4,"18":4,"19":2,"20":2,"21":2,"22":0,"23":2,"24":2,"25":2,"26":2,"27":2,"28":2,"29":2,"30":2,"31":2,"32":1},"f":{"0":3,"1":53,"2":4,"3":2,"4":2},"b":{"0":[1,2],"1":[3,3],"2":[50,2],"3":[4,0],"4":[2,0],"5":[0,2]},"inputSourceMap":{"version":3,"sources":["rules.js"],"names":["parse","context","rulesFolder","path","join","filePath","constants","RULES_DIRECTORY","rules","undefined","files","map","f","rule","mappings","script","loadFile","dump","assets","fs","ensureDirSync","forEach","name","ruleJS","log","info","writeFileSync","ruleFile"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;AAEA;;;;AACA;;;;AAIA,SAASA,KAAT,CAAeC,OAAf,EAAwB;AACtB,QAAMC,WAAW,GAAGC,eAAKC,IAAL,CAAUH,OAAO,CAACI,QAAlB,EAA4BC,iBAAUC,eAAtC,CAApB;;AACA,MAAI,CAAC,4BAAgBL,WAAhB,CAAL,EAAmC,OAAO;AAAEM,IAAAA,KAAK,EAAEC;AAAT,GAAP;AAEnC,QAAMC,KAAK,GAAG,qBAASR,WAAT,EAAsB,CAAE,OAAF,CAAtB,CAAd;AAEA,QAAMM,KAAK,GAAGE,KAAK,CAACC,GAAN,CAAWC,CAAD,IAAO;AAC7B,UAAMC,IAAI,GAAG,EAAE,GAAG,qBAASD,CAAT,EAAYX,OAAO,CAACa,QAApB;AAAL,KAAb;;AACA,QAAID,IAAI,CAACE,MAAT,EAAiB;AACfF,MAAAA,IAAI,CAACE,MAAL,GAAcd,OAAO,CAACe,QAAR,CAAiBH,IAAI,CAACE,MAAtB,EAA8BT,iBAAUC,eAAxC,CAAd;AACD;;AACD,WAAOM,IAAP;AACD,GANa,CAAd;AAQA,SAAO;AACLL,IAAAA;AADK,GAAP;AAGD;;AAED,eAAeS,IAAf,CAAoBhB,OAApB,EAA6B;AAC3B,QAAMO,KAAK,GAAG,CAAE,IAAGP,OAAO,CAACiB,MAAR,CAAeV,KAAf,IAAwB,EAA3B,CAAF,CAAd;AAEA,MAAI,CAACA,KAAL,EAAY;;AAGZ,QAAMN,WAAW,GAAGC,eAAKC,IAAL,CAAUH,OAAO,CAACI,QAAlB,EAA4BC,iBAAUC,eAAtC,CAApB;;AACAY,oBAAGC,aAAH,CAAiBlB,WAAjB;;AACAM,EAAAA,KAAK,CAACa,OAAN,CAAeR,IAAD,IAAU;AAEtB,UAAMS,IAAI,GAAG,qBAAST,IAAI,CAACS,IAAd,CAAb;;AACA,UAAMC,MAAM,GAAGpB,eAAKC,IAAL,CAAUF,WAAV,EAAwB,GAAEoB,IAAK,KAA/B,CAAf;;AACAE,qBAAIC,IAAJ,CAAU,WAAUF,MAAO,EAA3B;;AACAJ,sBAAGO,aAAH,CAAiBH,MAAjB,EAAyBV,IAAI,CAACE,MAA9B;;AAGA,UAAMY,QAAQ,GAAGxB,eAAKC,IAAL,CAAUF,WAAV,EAAwB,GAAEoB,IAAK,OAA/B,CAAjB;;AACA,yBAASK,QAAT,EAAmB,EAAE,GAAGd,IAAL;AAAWE,MAAAA,MAAM,EAAG,KAAIO,IAAK;AAA7B,KAAnB;AACD,GAVD;AAWD;;kBAEc;AACbtB,EAAAA,KADa;AAEbiB,EAAAA;AAFa,C","sourceRoot":"/home/circleci/repo/src/context/directory/handlers/","sourcesContent":["import fs from 'fs-extra';\nimport path from 'path';\nimport { constants } from '../../../tools';\n\nimport log from '../../../logger';\nimport {\n  getFiles, existsMustBeDir, dumpJSON, loadJSON, sanitize\n} from '../../../utils';\n\nfunction parse(context) {\n  const rulesFolder = path.join(context.filePath, constants.RULES_DIRECTORY);\n  if (!existsMustBeDir(rulesFolder)) return { rules: undefined }; // Skip\n\n  const files = getFiles(rulesFolder, [ '.json' ]);\n\n  const rules = files.map((f) => {\n    const rule = { ...loadJSON(f, context.mappings) };\n    if (rule.script) {\n      rule.script = context.loadFile(rule.script, constants.RULES_DIRECTORY);\n    }\n    return rule;\n  });\n\n  return {\n    rules\n  };\n}\n\nasync function dump(context) {\n  const rules = [ ...context.assets.rules || [] ];\n\n  if (!rules) return; // Skip, nothing to dump\n\n  // Create Rules folder\n  const rulesFolder = path.join(context.filePath, constants.RULES_DIRECTORY);\n  fs.ensureDirSync(rulesFolder);\n  rules.forEach((rule) => {\n    // Dump script to file\n    const name = sanitize(rule.name);\n    const ruleJS = path.join(rulesFolder, `${name}.js`);\n    log.info(`Writing ${ruleJS}`);\n    fs.writeFileSync(ruleJS, rule.script);\n\n    // Dump template metadata\n    const ruleFile = path.join(rulesFolder, `${name}.json`);\n    dumpJSON(ruleFile, { ...rule, script: `./${name}.js` });\n  });\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"59efefddbde1732c5a2db130fe28aaefa72103a0","contentHash":"3904ec860c4c78998c3fb65c41ff380178d401aeba0ff991d0e0195f25ccd6e3"},"/home/circleci/repo/src/context/directory/handlers/hooks.js":{"path":"/home/circleci/repo/src/context/directory/handlers/hooks.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":15},"end":{"line":7,"column":34}},"2":{"start":{"line":9,"column":16},"end":{"line":9,"column":48}},"3":{"start":{"line":11,"column":12},"end":{"line":11,"column":27}},"4":{"start":{"line":13,"column":13},"end":{"line":13,"column":42}},"5":{"start":{"line":15,"column":13},"end":{"line":15,"column":38}},"6":{"start":{"line":17,"column":13},"end":{"line":17,"column":38}},"7":{"start":{"line":19,"column":14},"end":{"line":19,"column":40}},"8":{"start":{"line":21,"column":15},"end":{"line":21,"column":46}},"9":{"start":{"line":23,"column":39},"end":{"line":23,"column":93}},"10":{"start":{"line":26,"column":22},"end":{"line":26,"column":93}},"11":{"start":{"line":28,"column":2},"end":{"line":30,"column":4}},"12":{"start":{"line":28,"column":49},"end":{"line":30,"column":4}},"13":{"start":{"line":31,"column":16},"end":{"line":31,"column":60}},"14":{"start":{"line":32,"column":16},"end":{"line":42,"column":4}},"15":{"start":{"line":33,"column":17},"end":{"line":34,"column":5}},"16":{"start":{"line":36,"column":4},"end":{"line":38,"column":5}},"17":{"start":{"line":37,"column":6},"end":{"line":37,"column":84}},"18":{"start":{"line":40,"column":4},"end":{"line":40,"column":60}},"19":{"start":{"line":41,"column":4},"end":{"line":41,"column":16}},"20":{"start":{"line":43,"column":2},"end":{"line":45,"column":4}},"21":{"start":{"line":49,"column":16},"end":{"line":49,"column":49}},"22":{"start":{"line":50,"column":2},"end":{"line":50,"column":31}},"23":{"start":{"line":50,"column":24},"end":{"line":50,"column":31}},"24":{"start":{"line":52,"column":22},"end":{"line":52,"column":93}},"25":{"start":{"line":54,"column":2},"end":{"line":54,"column":47}},"26":{"start":{"line":56,"column":2},"end":{"line":71,"column":5}},"27":{"start":{"line":57,"column":4},"end":{"line":57,"column":37}},"28":{"start":{"line":58,"column":17},"end":{"line":58,"column":48}},"29":{"start":{"line":60,"column":21},"end":{"line":60,"column":67}},"30":{"start":{"line":62,"column":4},"end":{"line":62,"column":49}},"31":{"start":{"line":64,"column":4},"end":{"line":64,"column":59}},"32":{"start":{"line":66,"column":21},"end":{"line":66,"column":69}},"33":{"start":{"line":68,"column":4},"end":{"line":70,"column":7}},"34":{"start":{"line":74,"column":0},"end":{"line":77,"column":2}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":23,"column":9},"end":{"line":23,"column":31}},"loc":{"start":{"line":23,"column":37},"end":{"line":23,"column":95}},"line":23},"1":{"name":"parse","decl":{"start":{"line":25,"column":9},"end":{"line":25,"column":14}},"loc":{"start":{"line":25,"column":24},"end":{"line":46,"column":1}},"line":25},"2":{"name":"(anonymous_2)","decl":{"start":{"line":32,"column":26},"end":{"line":32,"column":27}},"loc":{"start":{"line":32,"column":31},"end":{"line":42,"column":3}},"line":32},"3":{"name":"dump","decl":{"start":{"line":48,"column":15},"end":{"line":48,"column":19}},"loc":{"start":{"line":48,"column":29},"end":{"line":72,"column":1}},"line":48},"4":{"name":"(anonymous_4)","decl":{"start":{"line":56,"column":16},"end":{"line":56,"column":17}},"loc":{"start":{"line":56,"column":24},"end":{"line":71,"column":3}},"line":56}},"branchMap":{"0":{"loc":{"start":{"line":23,"column":46},"end":{"line":23,"column":92}},"type":"cond-expr","locations":[{"start":{"line":23,"column":70},"end":{"line":23,"column":73}},{"start":{"line":23,"column":76},"end":{"line":23,"column":92}}],"line":23},"1":{"loc":{"start":{"line":23,"column":46},"end":{"line":23,"column":67}},"type":"binary-expr","locations":[{"start":{"line":23,"column":46},"end":{"line":23,"column":49}},{"start":{"line":23,"column":53},"end":{"line":23,"column":67}}],"line":23},"2":{"loc":{"start":{"line":28,"column":2},"end":{"line":30,"column":4}},"type":"if","locations":[{"start":{"line":28,"column":2},"end":{"line":30,"column":4}},{"start":{"line":28,"column":2},"end":{"line":30,"column":4}}],"line":28},"3":{"loc":{"start":{"line":36,"column":4},"end":{"line":38,"column":5}},"type":"if","locations":[{"start":{"line":36,"column":4},"end":{"line":38,"column":5}},{"start":{"line":36,"column":4},"end":{"line":38,"column":5}}],"line":36},"4":{"loc":{"start":{"line":49,"column":21},"end":{"line":49,"column":47}},"type":"binary-expr","locations":[{"start":{"line":49,"column":21},"end":{"line":49,"column":41}},{"start":{"line":49,"column":45},"end":{"line":49,"column":47}}],"line":49},"5":{"loc":{"start":{"line":50,"column":2},"end":{"line":50,"column":31}},"type":"if","locations":[{"start":{"line":50,"column":2},"end":{"line":50,"column":31}},{"start":{"line":50,"column":2},"end":{"line":50,"column":31}}],"line":50},"6":{"loc":{"start":{"line":57,"column":16},"end":{"line":57,"column":36}},"type":"binary-expr","locations":[{"start":{"line":57,"column":16},"end":{"line":57,"column":25}},{"start":{"line":57,"column":29},"end":{"line":57,"column":36}}],"line":57}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":3,"10":51,"11":51,"12":48,"13":2,"14":2,"15":4,"16":4,"17":4,"18":4,"19":4,"20":2,"21":2,"22":2,"23":0,"24":2,"25":2,"26":2,"27":3,"28":3,"29":3,"30":3,"31":3,"32":3,"33":3,"34":1},"f":{"0":3,"1":51,"2":4,"3":2,"4":3},"b":{"0":[1,2],"1":[3,3],"2":[48,2],"3":[4,0],"4":[2,0],"5":[0,2],"6":[3,1]},"inputSourceMap":{"version":3,"sources":["hooks.js"],"names":["parse","context","hooksFolder","path","join","filePath","constants","HOOKS_DIRECTORY","hooks","undefined","files","map","f","hook","mappings","script","loadFile","name","toLowerCase","replace","dump","assets","length","fs","ensureDirSync","forEach","id","hookCode","log","info","writeFileSync","hookFile"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;AAEA;;AAGA;;;;;;AAEA,SAASA,KAAT,CAAeC,OAAf,EAAwB;AACtB,QAAMC,WAAW,GAAGC,eAAKC,IAAL,CAAUH,OAAO,CAACI,QAAlB,EAA4BC,iBAAUC,eAAtC,CAApB;;AACA,MAAI,CAAC,4BAAgBL,WAAhB,CAAL,EAAmC,OAAO;AAAEM,IAAAA,KAAK,EAAEC;AAAT,GAAP;AAEnC,QAAMC,KAAK,GAAG,qBAASR,WAAT,EAAsB,CAAE,OAAF,CAAtB,CAAd;AAEA,QAAMM,KAAK,GAAGE,KAAK,CAACC,GAAN,CAAWC,CAAD,IAAO;AAC7B,UAAMC,IAAI,GAAG,EAAE,GAAG,qBAASD,CAAT,EAAYX,OAAO,CAACa,QAApB;AAAL,KAAb;;AACA,QAAID,IAAI,CAACE,MAAT,EAAiB;AACfF,MAAAA,IAAI,CAACE,MAAL,GAAcd,OAAO,CAACe,QAAR,CAAiBH,IAAI,CAACE,MAAtB,EAA8BT,iBAAUC,eAAxC,CAAd;AACD;;AAEDM,IAAAA,IAAI,CAACI,IAAL,GAAYJ,IAAI,CAACI,IAAL,CAAUC,WAAV,GAAwBC,OAAxB,CAAgC,KAAhC,EAAuC,GAAvC,CAAZ;AAEA,WAAON,IAAP;AACD,GATa,CAAd;AAWA,SAAO;AACLL,IAAAA;AADK,GAAP;AAGD;;AAED,eAAeY,IAAf,CAAoBnB,OAApB,EAA6B;AAC3B,QAAMO,KAAK,GAAG,CAAE,IAAGP,OAAO,CAACoB,MAAR,CAAeb,KAAf,IAAwB,EAA3B,CAAF,CAAd;AAEA,MAAIA,KAAK,CAACc,MAAN,GAAe,CAAnB,EAAsB;;AAGtB,QAAMpB,WAAW,GAAGC,eAAKC,IAAL,CAAUH,OAAO,CAACI,QAAlB,EAA4BC,iBAAUC,eAAtC,CAApB;;AACAgB,oBAAGC,aAAH,CAAiBtB,WAAjB;;AACAM,EAAAA,KAAK,CAACiB,OAAN,CAAeZ,IAAD,IAAU;AAGtBA,IAAAA,IAAI,CAACI,IAAL,GAAYJ,IAAI,CAACI,IAAL,IAAaJ,IAAI,CAACa,EAA9B;AACA,UAAMT,IAAI,GAAG,qBAASJ,IAAI,CAACI,IAAd,CAAb;;AACA,UAAMU,QAAQ,GAAGxB,eAAKC,IAAL,CAAUF,WAAV,EAAwB,GAAEe,IAAK,KAA/B,CAAjB;;AACAW,qBAAIC,IAAJ,CAAU,WAAUF,QAAS,EAA7B;;AACAJ,sBAAGO,aAAH,CAAiBH,QAAjB,EAA2Bd,IAAI,CAACE,MAAhC;;AAGA,UAAMgB,QAAQ,GAAG5B,eAAKC,IAAL,CAAUF,WAAV,EAAwB,GAAEe,IAAK,OAA/B,CAAjB;;AACA,yBAASc,QAAT,EAAmB,EAAE,GAAGlB,IAAL;AAAWE,MAAAA,MAAM,EAAG,KAAIE,IAAK;AAA7B,KAAnB;AACD,GAZD;AAaD;;kBAEc;AACbjB,EAAAA,KADa;AAEboB,EAAAA;AAFa,C","sourceRoot":"/home/circleci/repo/src/context/directory/handlers/","sourcesContent":["import fs from 'fs-extra';\nimport path from 'path';\nimport { constants } from '../../../tools';\n\nimport {\n  getFiles, existsMustBeDir, dumpJSON, loadJSON, sanitize\n} from '../../../utils';\nimport log from '../../../logger';\n\nfunction parse(context) {\n  const hooksFolder = path.join(context.filePath, constants.HOOKS_DIRECTORY);\n  if (!existsMustBeDir(hooksFolder)) return { hooks: undefined }; // Skip\n\n  const files = getFiles(hooksFolder, [ '.json' ]);\n\n  const hooks = files.map((f) => {\n    const hook = { ...loadJSON(f, context.mappings) };\n    if (hook.script) {\n      hook.script = context.loadFile(hook.script, constants.HOOKS_DIRECTORY);\n    }\n\n    hook.name = hook.name.toLowerCase().replace(/\\s/g, '-');\n\n    return hook;\n  });\n\n  return {\n    hooks\n  };\n}\n\nasync function dump(context) {\n  const hooks = [ ...context.assets.hooks || [] ];\n\n  if (hooks.length < 1) return;\n\n  // Create Hooks folder\n  const hooksFolder = path.join(context.filePath, constants.HOOKS_DIRECTORY);\n  fs.ensureDirSync(hooksFolder);\n  hooks.forEach((hook) => {\n    // Dump script to file\n    // For cases when hook does not have `meta['hook-name']`\n    hook.name = hook.name || hook.id;\n    const name = sanitize(hook.name);\n    const hookCode = path.join(hooksFolder, `${name}.js`);\n    log.info(`Writing ${hookCode}`);\n    fs.writeFileSync(hookCode, hook.script);\n\n    // Dump template metadata\n    const hookFile = path.join(hooksFolder, `${name}.json`);\n    dumpJSON(hookFile, { ...hook, script: `./${name}.js` });\n  });\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"44e440d8b8ccc19c52f462fd4da2dfedb18b37cb","contentHash":"6d60fb123fbc49c3c4cd5e6cf29e3c58defc68648e0c7f6f4cc091726d715b0a"},"/home/circleci/repo/src/context/directory/handlers/clients.js":{"path":"/home/circleci/repo/src/context/directory/handlers/clients.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":15},"end":{"line":7,"column":34}},"2":{"start":{"line":9,"column":16},"end":{"line":9,"column":48}},"3":{"start":{"line":11,"column":12},"end":{"line":11,"column":27}},"4":{"start":{"line":13,"column":13},"end":{"line":13,"column":42}},"5":{"start":{"line":15,"column":13},"end":{"line":15,"column":38}},"6":{"start":{"line":17,"column":14},"end":{"line":17,"column":40}},"7":{"start":{"line":19,"column":15},"end":{"line":19,"column":46}},"8":{"start":{"line":21,"column":13},"end":{"line":21,"column":38}},"9":{"start":{"line":23,"column":39},"end":{"line":23,"column":93}},"10":{"start":{"line":26,"column":24},"end":{"line":26,"column":97}},"11":{"start":{"line":28,"column":2},"end":{"line":30,"column":4}},"12":{"start":{"line":28,"column":51},"end":{"line":30,"column":4}},"13":{"start":{"line":31,"column":21},"end":{"line":31,"column":67}},"14":{"start":{"line":32,"column":18},"end":{"line":44,"column":43}},"15":{"start":{"line":33,"column":19},"end":{"line":33,"column":60}},"16":{"start":{"line":35,"column":4},"end":{"line":41,"column":5}},"17":{"start":{"line":36,"column":27},"end":{"line":36,"column":87}},"18":{"start":{"line":38,"column":6},"end":{"line":40,"column":7}},"19":{"start":{"line":39,"column":8},"end":{"line":39,"column":88}},"20":{"start":{"line":43,"column":4},"end":{"line":43,"column":18}},"21":{"start":{"line":44,"column":17},"end":{"line":44,"column":42}},"22":{"start":{"line":45,"column":2},"end":{"line":47,"column":4}},"23":{"start":{"line":53,"column":6},"end":{"line":53,"column":20}},"24":{"start":{"line":54,"column":2},"end":{"line":54,"column":23}},"25":{"start":{"line":54,"column":16},"end":{"line":54,"column":23}},"26":{"start":{"line":56,"column":24},"end":{"line":56,"column":97}},"27":{"start":{"line":58,"column":2},"end":{"line":58,"column":49}},"28":{"start":{"line":60,"column":2},"end":{"line":78,"column":5}},"29":{"start":{"line":61,"column":23},"end":{"line":61,"column":56}},"30":{"start":{"line":63,"column":23},"end":{"line":63,"column":79}},"31":{"start":{"line":65,"column":4},"end":{"line":75,"column":5}},"32":{"start":{"line":66,"column":19},"end":{"line":66,"column":43}},"33":{"start":{"line":68,"column":30},"end":{"line":68,"column":104}},"34":{"start":{"line":70,"column":6},"end":{"line":70,"column":58}},"35":{"start":{"line":72,"column":6},"end":{"line":72,"column":61}},"36":{"start":{"line":74,"column":6},"end":{"line":74,"column":74}},"37":{"start":{"line":77,"column":4},"end":{"line":77,"column":76}},"38":{"start":{"line":81,"column":0},"end":{"line":84,"column":2}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":23,"column":9},"end":{"line":23,"column":31}},"loc":{"start":{"line":23,"column":37},"end":{"line":23,"column":95}},"line":23},"1":{"name":"parse","decl":{"start":{"line":25,"column":9},"end":{"line":25,"column":14}},"loc":{"start":{"line":25,"column":24},"end":{"line":48,"column":1}},"line":25},"2":{"name":"(anonymous_2)","decl":{"start":{"line":32,"column":33},"end":{"line":32,"column":34}},"loc":{"start":{"line":32,"column":38},"end":{"line":44,"column":3}},"line":32},"3":{"name":"(anonymous_3)","decl":{"start":{"line":44,"column":12},"end":{"line":44,"column":13}},"loc":{"start":{"line":44,"column":17},"end":{"line":44,"column":42}},"line":44},"4":{"name":"dump","decl":{"start":{"line":50,"column":15},"end":{"line":50,"column":19}},"loc":{"start":{"line":50,"column":29},"end":{"line":79,"column":1}},"line":50},"5":{"name":"(anonymous_5)","decl":{"start":{"line":60,"column":18},"end":{"line":60,"column":19}},"loc":{"start":{"line":60,"column":28},"end":{"line":78,"column":3}},"line":60}},"branchMap":{"0":{"loc":{"start":{"line":23,"column":46},"end":{"line":23,"column":92}},"type":"cond-expr","locations":[{"start":{"line":23,"column":70},"end":{"line":23,"column":73}},{"start":{"line":23,"column":76},"end":{"line":23,"column":92}}],"line":23},"1":{"loc":{"start":{"line":23,"column":46},"end":{"line":23,"column":67}},"type":"binary-expr","locations":[{"start":{"line":23,"column":46},"end":{"line":23,"column":49}},{"start":{"line":23,"column":53},"end":{"line":23,"column":67}}],"line":23},"2":{"loc":{"start":{"line":28,"column":2},"end":{"line":30,"column":4}},"type":"if","locations":[{"start":{"line":28,"column":2},"end":{"line":30,"column":4}},{"start":{"line":28,"column":2},"end":{"line":30,"column":4}}],"line":28},"3":{"loc":{"start":{"line":35,"column":4},"end":{"line":41,"column":5}},"type":"if","locations":[{"start":{"line":35,"column":4},"end":{"line":41,"column":5}},{"start":{"line":35,"column":4},"end":{"line":41,"column":5}}],"line":35},"4":{"loc":{"start":{"line":38,"column":6},"end":{"line":40,"column":7}},"type":"if","locations":[{"start":{"line":38,"column":6},"end":{"line":40,"column":7}},{"start":{"line":38,"column":6},"end":{"line":40,"column":7}}],"line":38},"5":{"loc":{"start":{"line":54,"column":2},"end":{"line":54,"column":23}},"type":"if","locations":[{"start":{"line":54,"column":2},"end":{"line":54,"column":23}},{"start":{"line":54,"column":2},"end":{"line":54,"column":23}}],"line":54},"6":{"loc":{"start":{"line":65,"column":4},"end":{"line":75,"column":5}},"type":"if","locations":[{"start":{"line":65,"column":4},"end":{"line":75,"column":5}},{"start":{"line":65,"column":4},"end":{"line":75,"column":5}}],"line":65}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":3,"10":47,"11":47,"12":44,"13":2,"14":2,"15":4,"16":4,"17":1,"18":1,"19":1,"20":4,"21":4,"22":2,"23":2,"24":2,"25":0,"26":2,"27":2,"28":2,"29":5,"30":5,"31":5,"32":1,"33":1,"34":1,"35":1,"36":1,"37":5,"38":1},"f":{"0":3,"1":47,"2":4,"3":4,"4":2,"5":5},"b":{"0":[1,2],"1":[3,3],"2":[44,2],"3":[1,3],"4":[1,0],"5":[0,2],"6":[1,4]},"inputSourceMap":{"version":3,"sources":["clients.js"],"names":["parse","context","clientsFolder","path","join","filePath","constants","CLIENTS_DIRECTORY","clients","undefined","foundFiles","map","f","client","mappings","custom_login_page","htmlFileName","filter","p","Object","keys","length","dump","assets","fs","ensureDirSync","forEach","clientName","name","clientFile","html","customLoginHtml","log","info","writeFileSync"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;AAEA;;;;AACA;;;;AAIA,SAASA,KAAT,CAAeC,OAAf,EAAwB;AACtB,QAAMC,aAAa,GAAGC,eAAKC,IAAL,CAAUH,OAAO,CAACI,QAAlB,EAA4BC,iBAAUC,iBAAtC,CAAtB;;AACA,MAAI,CAAC,4BAAgBL,aAAhB,CAAL,EAAqC,OAAO;AAAEM,IAAAA,OAAO,EAAEC;AAAX,GAAP;AAErC,QAAMC,UAAU,GAAG,qBAASR,aAAT,EAAwB,CAAE,OAAF,CAAxB,CAAnB;AAEA,QAAMM,OAAO,GAAGE,UAAU,CACvBC,GADa,CACRC,CAAD,IAAO;AACV,UAAMC,MAAM,GAAG,qBAASD,CAAT,EAAYX,OAAO,CAACa,QAApB,CAAf;;AAEA,QAAID,MAAM,CAACE,iBAAX,EAA8B;AAC5B,YAAMC,YAAY,GAAGb,eAAKC,IAAL,CAAUF,aAAV,EAAyBW,MAAM,CAACE,iBAAhC,CAArB;;AAEA,UAAI,mBAAOC,YAAP,CAAJ,EAA0B;AACxBH,QAAAA,MAAM,CAACE,iBAAP,GAA2B,qBAASC,YAAT,EAAuBf,OAAO,CAACa,QAA/B,CAA3B;AACD;AACF;;AAED,WAAOD,MAAP;AACD,GAba,EAcbI,MAda,CAcLC,CAAD,IAAOC,MAAM,CAACC,IAAP,CAAYF,CAAZ,EAAeG,MAAf,GAAwB,CAdzB,CAAhB;AAgBA,SAAO;AACLb,IAAAA;AADK,GAAP;AAGD;;AAED,eAAec,IAAf,CAAoBrB,OAApB,EAA6B;AAC3B,QAAM;AAAEO,IAAAA;AAAF,MAAcP,OAAO,CAACsB,MAA5B;AAEA,MAAI,CAACf,OAAL,EAAc;;AAEd,QAAMN,aAAa,GAAGC,eAAKC,IAAL,CAAUH,OAAO,CAACI,QAAlB,EAA4BC,iBAAUC,iBAAtC,CAAtB;;AACAiB,oBAAGC,aAAH,CAAiBvB,aAAjB;;AAEAM,EAAAA,OAAO,CAACkB,OAAR,CAAiBb,MAAD,IAAY;AAC1B,UAAMc,UAAU,GAAG,qBAASd,MAAM,CAACe,IAAhB,CAAnB;;AACA,UAAMC,UAAU,GAAG1B,eAAKC,IAAL,CAAUF,aAAV,EAA0B,GAAEyB,UAAW,OAAvC,CAAnB;;AAEA,QAAId,MAAM,CAACE,iBAAX,EAA8B;AAC5B,YAAMe,IAAI,GAAGjB,MAAM,CAACE,iBAApB;;AACA,YAAMgB,eAAe,GAAG5B,eAAKC,IAAL,CAAUF,aAAV,EAA0B,GAAEyB,UAAW,yBAAvC,CAAxB;;AAEAK,uBAAIC,IAAJ,CAAU,WAAUF,eAAgB,EAApC;;AACAP,wBAAGU,aAAH,CAAiBH,eAAjB,EAAkCD,IAAlC;;AAEAjB,MAAAA,MAAM,CAACE,iBAAP,GAA4B,KAAIY,UAAW,yBAA3C;AACD;;AACD,yBAASE,UAAT,EAAqB,8BAAkBhB,MAAlB,CAArB;AACD,GAdD;AAeD;;kBAEc;AACbb,EAAAA,KADa;AAEbsB,EAAAA;AAFa,C","sourceRoot":"/home/circleci/repo/src/context/directory/handlers/","sourcesContent":["import fs from 'fs-extra';\nimport path from 'path';\nimport { constants, loadFile } from '../../../tools';\n\nimport log from '../../../logger';\nimport {\n  isFile, getFiles, existsMustBeDir, dumpJSON, loadJSON, sanitize, clearClientArrays\n} from '../../../utils';\n\nfunction parse(context) {\n  const clientsFolder = path.join(context.filePath, constants.CLIENTS_DIRECTORY);\n  if (!existsMustBeDir(clientsFolder)) return { clients: undefined }; // Skip\n\n  const foundFiles = getFiles(clientsFolder, [ '.json' ]);\n\n  const clients = foundFiles\n    .map((f) => {\n      const client = loadJSON(f, context.mappings);\n\n      if (client.custom_login_page) {\n        const htmlFileName = path.join(clientsFolder, client.custom_login_page);\n\n        if (isFile(htmlFileName)) {\n          client.custom_login_page = loadFile(htmlFileName, context.mappings);\n        }\n      }\n\n      return client;\n    })\n    .filter((p) => Object.keys(p).length > 0); // Filter out empty clients\n\n  return {\n    clients\n  };\n}\n\nasync function dump(context) {\n  const { clients } = context.assets;\n\n  if (!clients) return; // Skip, nothing to dump\n\n  const clientsFolder = path.join(context.filePath, constants.CLIENTS_DIRECTORY);\n  fs.ensureDirSync(clientsFolder);\n\n  clients.forEach((client) => {\n    const clientName = sanitize(client.name);\n    const clientFile = path.join(clientsFolder, `${clientName}.json`);\n\n    if (client.custom_login_page) {\n      const html = client.custom_login_page;\n      const customLoginHtml = path.join(clientsFolder, `${clientName}_custom_login_page.html`);\n\n      log.info(`Writing ${customLoginHtml}`);\n      fs.writeFileSync(customLoginHtml, html);\n\n      client.custom_login_page = `./${clientName}_custom_login_page.html`;\n    }\n    dumpJSON(clientFile, clearClientArrays(client));\n  });\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"869f16014b41b20b42004846804a91aeea6d452c","contentHash":"fe1d9ce5266eb290600909ad77d34b629a88972910f732cf05a21b016fbde20a"},"/home/circleci/repo/src/context/directory/handlers/tenant.js":{"path":"/home/circleci/repo/src/context/directory/handlers/tenant.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":12},"end":{"line":7,"column":27}},"2":{"start":{"line":9,"column":13},"end":{"line":9,"column":42}},"3":{"start":{"line":11,"column":13},"end":{"line":11,"column":38}},"4":{"start":{"line":13,"column":39},"end":{"line":13,"column":93}},"5":{"start":{"line":16,"column":21},"end":{"line":16,"column":58}},"6":{"start":{"line":18,"column":2},"end":{"line":18,"column":58}},"7":{"start":{"line":18,"column":48},"end":{"line":18,"column":58}},"8":{"start":{"line":20,"column":21},"end":{"line":20,"column":67}},"9":{"start":{"line":22,"column":2},"end":{"line":32,"column":3}},"10":{"start":{"line":27,"column":8},"end":{"line":27,"column":58}},"11":{"start":{"line":28,"column":4},"end":{"line":28,"column":41}},"12":{"start":{"line":29,"column":4},"end":{"line":31,"column":6}},"13":{"start":{"line":34,"column":2},"end":{"line":34,"column":12}},"14":{"start":{"line":40,"column":6},"end":{"line":40,"column":20}},"15":{"start":{"line":41,"column":2},"end":{"line":41,"column":22}},"16":{"start":{"line":41,"column":15},"end":{"line":41,"column":22}},"17":{"start":{"line":42,"column":2},"end":{"line":42,"column":39}},"18":{"start":{"line":44,"column":21},"end":{"line":44,"column":73}},"19":{"start":{"line":46,"column":2},"end":{"line":46,"column":43}},"20":{"start":{"line":49,"column":0},"end":{"line":52,"column":2}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":13,"column":9},"end":{"line":13,"column":31}},"loc":{"start":{"line":13,"column":37},"end":{"line":13,"column":95}},"line":13},"1":{"name":"parse","decl":{"start":{"line":15,"column":9},"end":{"line":15,"column":14}},"loc":{"start":{"line":15,"column":24},"end":{"line":35,"column":1}},"line":15},"2":{"name":"dump","decl":{"start":{"line":37,"column":15},"end":{"line":37,"column":19}},"loc":{"start":{"line":37,"column":29},"end":{"line":47,"column":1}},"line":37}},"branchMap":{"0":{"loc":{"start":{"line":13,"column":46},"end":{"line":13,"column":92}},"type":"cond-expr","locations":[{"start":{"line":13,"column":70},"end":{"line":13,"column":73}},{"start":{"line":13,"column":76},"end":{"line":13,"column":92}}],"line":13},"1":{"loc":{"start":{"line":13,"column":46},"end":{"line":13,"column":67}},"type":"binary-expr","locations":[{"start":{"line":13,"column":46},"end":{"line":13,"column":49}},{"start":{"line":13,"column":53},"end":{"line":13,"column":67}}],"line":13},"2":{"loc":{"start":{"line":18,"column":2},"end":{"line":18,"column":58}},"type":"if","locations":[{"start":{"line":18,"column":2},"end":{"line":18,"column":58}},{"start":{"line":18,"column":2},"end":{"line":18,"column":58}}],"line":18},"3":{"loc":{"start":{"line":22,"column":2},"end":{"line":32,"column":3}},"type":"if","locations":[{"start":{"line":22,"column":2},"end":{"line":32,"column":3}},{"start":{"line":22,"column":2},"end":{"line":32,"column":3}}],"line":22},"4":{"loc":{"start":{"line":30,"column":36},"end":{"line":30,"column":120}},"type":"binary-expr","locations":[{"start":{"line":30,"column":36},"end":{"line":30,"column":52}},{"start":{"line":30,"column":56},"end":{"line":30,"column":120}}],"line":30},"5":{"loc":{"start":{"line":30,"column":122},"end":{"line":30,"column":221}},"type":"binary-expr","locations":[{"start":{"line":30,"column":122},"end":{"line":30,"column":143}},{"start":{"line":30,"column":147},"end":{"line":30,"column":221}}],"line":30},"6":{"loc":{"start":{"line":41,"column":2},"end":{"line":41,"column":22}},"type":"if","locations":[{"start":{"line":41,"column":2},"end":{"line":41,"column":22}},{"start":{"line":41,"column":2},"end":{"line":41,"column":22}}],"line":41}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":44,"6":44,"7":0,"8":44,"9":44,"10":1,"11":1,"12":1,"13":43,"14":2,"15":2,"16":0,"17":2,"18":2,"19":2,"20":1},"f":{"0":1,"1":44,"2":2},"b":{"0":[0,1],"1":[1,1],"2":[0,44],"3":[1,43],"4":[1,1],"5":[1,1],"6":[0,2]},"inputSourceMap":{"version":3,"sources":["tenant.js"],"names":["parse","context","baseFolder","path","join","filePath","tenantFile","session_lifetime","idle_session_lifetime","tenant","mappings","Object","assign","dump","assets"],"mappings":";;;;;;AAAA;;;;AACA;;;;AAIA,SAASA,KAAT,CAAeC,OAAf,EAAwB;AACtB,QAAMC,UAAU,GAAGC,eAAKC,IAAL,CAAUH,OAAO,CAACI,QAAlB,CAAnB;;AACA,MAAI,CAAC,4BAAgBH,UAAhB,CAAL,EAAkC,OAAO,EAAP;;AAElC,QAAMI,UAAU,GAAGH,eAAKC,IAAL,CAAUF,UAAV,EAAsB,aAAtB,CAAnB;;AAEA,MAAI,mBAAOI,UAAP,CAAJ,EAAwB;AAEtB,UAAM;AACJC,MAAAA,gBADI;AAEJC,MAAAA,qBAFI;AAGJ,SAAGC;AAHC,QAIF,qBAASH,UAAT,EAAqBL,OAAO,CAACS,QAA7B,CAJJ;AAMA,iCAAiBD,MAAjB;AAEA,WAAO;AACLA,MAAAA,MAAM,EAAEE,MAAM,CAACC,MAAP,CACNH,MADM,EAENF,gBAAgB,IAAI,2BAAe,kBAAf,EAAmCA,gBAAnC,CAFd,EAGNC,qBAAqB,IAAI,2BAAe,uBAAf,EAAwCA,qBAAxC,CAHnB;AADH,KAAP;AAQD;;AAED,SAAO,EAAP;AACD;;AAED,eAAeK,IAAf,CAAoBZ,OAApB,EAA6B;AAC3B,QAAM;AAAEQ,IAAAA;AAAF,MAAaR,OAAO,CAACa,MAA3B;AAEA,MAAI,CAACL,MAAL,EAAa;AAEb,+BAAiBA,MAAjB;;AAEA,QAAMH,UAAU,GAAGH,eAAKC,IAAL,CAAUH,OAAO,CAACI,QAAlB,EAA4B,aAA5B,CAAnB;;AACA,uBAASC,UAAT,EAAqBG,MAArB;AACD;;kBAEc;AACbT,EAAAA,KADa;AAEba,EAAAA;AAFa,C","sourceRoot":"/home/circleci/repo/src/context/directory/handlers/","sourcesContent":["import path from 'path';\nimport {\n  existsMustBeDir, isFile, dumpJSON, loadJSON, hoursAsInteger, clearTenantFlags\n} from '../../../utils';\n\nfunction parse(context) {\n  const baseFolder = path.join(context.filePath);\n  if (!existsMustBeDir(baseFolder)) return {}; // Skip\n\n  const tenantFile = path.join(baseFolder, 'tenant.json');\n\n  if (isFile(tenantFile)) {\n    /* eslint-disable camelcase */\n    const {\n      session_lifetime,\n      idle_session_lifetime,\n      ...tenant\n    } = loadJSON(tenantFile, context.mappings);\n\n    clearTenantFlags(tenant);\n\n    return {\n      tenant: Object.assign(\n        tenant,\n        session_lifetime && hoursAsInteger('session_lifetime', session_lifetime),\n        idle_session_lifetime && hoursAsInteger('idle_session_lifetime', idle_session_lifetime)\n      )\n    };\n    /* eslint-enable camelcase */\n  }\n\n  return {};\n}\n\nasync function dump(context) {\n  const { tenant } = context.assets;\n\n  if (!tenant) return; // Skip, nothing to dump\n\n  clearTenantFlags(tenant);\n\n  const tenantFile = path.join(context.filePath, 'tenant.json');\n  dumpJSON(tenantFile, tenant);\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"1f589f684b39f57856a913c3dfee654cb1d74f93","contentHash":"4d247f99128074ad772ea1881ed6b69311db4437212e9c6ad1020e027e8da2bc"},"/home/circleci/repo/src/context/directory/handlers/emailProvider.js":{"path":"/home/circleci/repo/src/context/directory/handlers/emailProvider.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":15},"end":{"line":7,"column":34}},"2":{"start":{"line":9,"column":16},"end":{"line":9,"column":48}},"3":{"start":{"line":11,"column":12},"end":{"line":11,"column":27}},"4":{"start":{"line":13,"column":13},"end":{"line":13,"column":42}},"5":{"start":{"line":15,"column":13},"end":{"line":15,"column":38}},"6":{"start":{"line":17,"column":13},"end":{"line":17,"column":38}},"7":{"start":{"line":19,"column":16},"end":{"line":19,"column":41}},"8":{"start":{"line":21,"column":39},"end":{"line":21,"column":93}},"9":{"start":{"line":24,"column":23},"end":{"line":24,"column":104}},"10":{"start":{"line":26,"column":2},"end":{"line":26,"column":60}},"11":{"start":{"line":26,"column":50},"end":{"line":26,"column":60}},"12":{"start":{"line":28,"column":23},"end":{"line":28,"column":73}},"13":{"start":{"line":30,"column":2},"end":{"line":34,"column":3}},"14":{"start":{"line":31,"column":4},"end":{"line":33,"column":6}},"15":{"start":{"line":36,"column":2},"end":{"line":36,"column":12}},"16":{"start":{"line":42,"column":6},"end":{"line":42,"column":20}},"17":{"start":{"line":43,"column":2},"end":{"line":43,"column":29}},"18":{"start":{"line":43,"column":22},"end":{"line":43,"column":29}},"19":{"start":{"line":44,"column":27},"end":{"line":44,"column":64}},"20":{"start":{"line":46,"column":2},"end":{"line":48,"column":3}},"21":{"start":{"line":47,"column":4},"end":{"line":47,"column":72}},"22":{"start":{"line":50,"column":23},"end":{"line":50,"column":104}},"23":{"start":{"line":52,"column":2},"end":{"line":52,"column":48}},"24":{"start":{"line":54,"column":28},"end":{"line":54,"column":78}},"25":{"start":{"line":56,"column":2},"end":{"line":56,"column":57}},"26":{"start":{"line":59,"column":0},"end":{"line":62,"column":2}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":21,"column":9},"end":{"line":21,"column":31}},"loc":{"start":{"line":21,"column":37},"end":{"line":21,"column":95}},"line":21},"1":{"name":"parse","decl":{"start":{"line":23,"column":9},"end":{"line":23,"column":14}},"loc":{"start":{"line":23,"column":24},"end":{"line":37,"column":1}},"line":23},"2":{"name":"dump","decl":{"start":{"line":39,"column":15},"end":{"line":39,"column":19}},"loc":{"start":{"line":39,"column":29},"end":{"line":57,"column":1}},"line":39}},"branchMap":{"0":{"loc":{"start":{"line":21,"column":46},"end":{"line":21,"column":92}},"type":"cond-expr","locations":[{"start":{"line":21,"column":70},"end":{"line":21,"column":73}},{"start":{"line":21,"column":76},"end":{"line":21,"column":92}}],"line":21},"1":{"loc":{"start":{"line":21,"column":46},"end":{"line":21,"column":67}},"type":"binary-expr","locations":[{"start":{"line":21,"column":46},"end":{"line":21,"column":49}},{"start":{"line":21,"column":53},"end":{"line":21,"column":67}}],"line":21},"2":{"loc":{"start":{"line":26,"column":2},"end":{"line":26,"column":60}},"type":"if","locations":[{"start":{"line":26,"column":2},"end":{"line":26,"column":60}},{"start":{"line":26,"column":2},"end":{"line":26,"column":60}}],"line":26},"3":{"loc":{"start":{"line":30,"column":2},"end":{"line":34,"column":3}},"type":"if","locations":[{"start":{"line":30,"column":2},"end":{"line":34,"column":3}},{"start":{"line":30,"column":2},"end":{"line":34,"column":3}}],"line":30},"4":{"loc":{"start":{"line":43,"column":2},"end":{"line":43,"column":29}},"type":"if","locations":[{"start":{"line":43,"column":2},"end":{"line":43,"column":29}},{"start":{"line":43,"column":2},"end":{"line":43,"column":29}}],"line":43},"5":{"loc":{"start":{"line":44,"column":27},"end":{"line":44,"column":64}},"type":"binary-expr","locations":[{"start":{"line":44,"column":27},"end":{"line":44,"column":58}},{"start":{"line":44,"column":62},"end":{"line":44,"column":64}}],"line":44},"6":{"loc":{"start":{"line":46,"column":2},"end":{"line":48,"column":3}},"type":"if","locations":[{"start":{"line":46,"column":2},"end":{"line":48,"column":3}},{"start":{"line":46,"column":2},"end":{"line":48,"column":3}}],"line":46}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":2,"9":44,"10":44,"11":40,"12":3,"13":3,"14":3,"15":0,"16":2,"17":2,"18":0,"19":2,"20":2,"21":1,"22":2,"23":2,"24":2,"25":2,"26":1},"f":{"0":2,"1":44,"2":2},"b":{"0":[0,2],"1":[2,2],"2":[40,3],"3":[3,0],"4":[0,2],"5":[2,0],"6":[1,1]},"inputSourceMap":{"version":3,"sources":["emailProvider.js"],"names":["parse","context","emailsFolder","path","join","filePath","constants","EMAIL_TEMPLATES_DIRECTORY","providerFile","emailProvider","mappings","dump","assets","excludedDefaults","exclude","defaults","includes","fs","ensureDirSync","emailProviderFile"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;AAEA;;AAGA;;;;AAEA,SAASA,KAAT,CAAeC,OAAf,EAAwB;AACtB,QAAMC,YAAY,GAAGC,eAAKC,IAAL,CAAUH,OAAO,CAACI,QAAlB,EAA4BC,iBAAUC,yBAAtC,CAArB;;AACA,MAAI,CAAC,4BAAgBL,YAAhB,CAAL,EAAoC,OAAO,EAAP;;AAEpC,QAAMM,YAAY,GAAGL,eAAKC,IAAL,CAAUF,YAAV,EAAwB,eAAxB,CAArB;;AAEA,MAAI,mBAAOM,YAAP,CAAJ,EAA0B;AACxB,WAAO;AACLC,MAAAA,aAAa,EAAE,qBAASD,YAAT,EAAuBP,OAAO,CAACS,QAA/B;AADV,KAAP;AAGD;;AAED,SAAO,EAAP;AACD;;AAED,eAAeC,IAAf,CAAoBV,OAApB,EAA6B;AAC3B,MAAI;AAAEQ,IAAAA;AAAF,MAAoBR,OAAO,CAACW,MAAhC;AAEA,MAAI,CAACH,aAAL,EAAoB;AAEpB,QAAMI,gBAAgB,GAAGZ,OAAO,CAACW,MAAR,CAAeE,OAAf,CAAuBC,QAAvB,IAAmC,EAA5D;;AACA,MAAI,CAACF,gBAAgB,CAACG,QAAjB,CAA0B,eAA1B,CAAL,EAAiD;AAE/CP,IAAAA,aAAa,GAAG,qCAAsBA,aAAtB,CAAhB;AACD;;AAED,QAAMP,YAAY,GAAGC,eAAKC,IAAL,CAAUH,OAAO,CAACI,QAAlB,EAA4BC,iBAAUC,yBAAtC,CAArB;;AACAU,oBAAGC,aAAH,CAAiBhB,YAAjB;;AAEA,QAAMiB,iBAAiB,GAAGhB,eAAKC,IAAL,CAAUF,YAAV,EAAwB,eAAxB,CAA1B;;AACA,uBAASiB,iBAAT,EAA4BV,aAA5B;AACD;;kBAEc;AACbT,EAAAA,KADa;AAEbW,EAAAA;AAFa,C","sourceRoot":"/home/circleci/repo/src/context/directory/handlers/","sourcesContent":["import fs from 'fs-extra';\nimport path from 'path';\nimport { constants } from '../../../tools';\n\nimport {\n  existsMustBeDir, isFile, dumpJSON, loadJSON\n} from '../../../utils';\nimport { emailProviderDefaults } from '../../defaults';\n\nfunction parse(context) {\n  const emailsFolder = path.join(context.filePath, constants.EMAIL_TEMPLATES_DIRECTORY);\n  if (!existsMustBeDir(emailsFolder)) return {}; // Skip\n\n  const providerFile = path.join(emailsFolder, 'provider.json');\n\n  if (isFile(providerFile)) {\n    return {\n      emailProvider: loadJSON(providerFile, context.mappings)\n    };\n  }\n\n  return {};\n}\n\nasync function dump(context) {\n  let { emailProvider } = context.assets;\n\n  if (!emailProvider) return; // Skip, nothing to dump\n\n  const excludedDefaults = context.assets.exclude.defaults || [];\n  if (!excludedDefaults.includes('emailProvider')) {\n    // Add placeholder for credentials as they cannot be exported\n    emailProvider = emailProviderDefaults(emailProvider);\n  }\n\n  const emailsFolder = path.join(context.filePath, constants.EMAIL_TEMPLATES_DIRECTORY);\n  fs.ensureDirSync(emailsFolder);\n\n  const emailProviderFile = path.join(emailsFolder, 'provider.json');\n  dumpJSON(emailProviderFile, emailProvider);\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"7e449980078a0d0d7f07796f172a2ed2b615ea53","contentHash":"fcd43a9df5f22827cee2fa8f97bf99729f11f8b2252bef7d511b6c39a5b4b3d9"},"/home/circleci/repo/src/context/directory/handlers/connections.js":{"path":"/home/circleci/repo/src/context/directory/handlers/connections.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":15},"end":{"line":7,"column":34}},"2":{"start":{"line":9,"column":16},"end":{"line":9,"column":48}},"3":{"start":{"line":11,"column":12},"end":{"line":11,"column":27}},"4":{"start":{"line":13,"column":13},"end":{"line":13,"column":42}},"5":{"start":{"line":15,"column":13},"end":{"line":15,"column":38}},"6":{"start":{"line":17,"column":14},"end":{"line":17,"column":40}},"7":{"start":{"line":19,"column":15},"end":{"line":19,"column":46}},"8":{"start":{"line":21,"column":13},"end":{"line":21,"column":38}},"9":{"start":{"line":23,"column":39},"end":{"line":23,"column":93}},"10":{"start":{"line":26,"column":30},"end":{"line":26,"column":114}},"11":{"start":{"line":28,"column":28},"end":{"line":28,"column":86}},"12":{"start":{"line":30,"column":2},"end":{"line":32,"column":4}},"13":{"start":{"line":30,"column":55},"end":{"line":32,"column":4}},"14":{"start":{"line":33,"column":21},"end":{"line":33,"column":71}},"15":{"start":{"line":34,"column":22},"end":{"line":48,"column":43}},"16":{"start":{"line":35,"column":23},"end":{"line":35,"column":64}},"17":{"start":{"line":37,"column":4},"end":{"line":45,"column":5}},"18":{"start":{"line":38,"column":6},"end":{"line":38,"column":63}},"19":{"start":{"line":40,"column":27},"end":{"line":40,"column":96}},"20":{"start":{"line":42,"column":6},"end":{"line":44,"column":7}},"21":{"start":{"line":43,"column":8},"end":{"line":43,"column":93}},"22":{"start":{"line":47,"column":4},"end":{"line":47,"column":22}},"23":{"start":{"line":48,"column":17},"end":{"line":48,"column":42}},"24":{"start":{"line":49,"column":2},"end":{"line":51,"column":4}},"25":{"start":{"line":57,"column":6},"end":{"line":57,"column":20}},"26":{"start":{"line":58,"column":2},"end":{"line":58,"column":27}},"27":{"start":{"line":58,"column":20},"end":{"line":58,"column":27}},"28":{"start":{"line":60,"column":28},"end":{"line":60,"column":105}},"29":{"start":{"line":62,"column":2},"end":{"line":62,"column":53}},"30":{"start":{"line":64,"column":2},"end":{"line":88,"column":5}},"31":{"start":{"line":65,"column":29},"end":{"line":69,"column":5}},"32":{"start":{"line":70,"column":27},"end":{"line":70,"column":70}},"33":{"start":{"line":72,"column":4},"end":{"line":83,"column":5}},"34":{"start":{"line":73,"column":6},"end":{"line":73,"column":69}},"35":{"start":{"line":74,"column":19},"end":{"line":74,"column":54}},"36":{"start":{"line":76,"column":34},"end":{"line":76,"column":98}},"37":{"start":{"line":78,"column":6},"end":{"line":78,"column":62}},"38":{"start":{"line":80,"column":6},"end":{"line":80,"column":65}},"39":{"start":{"line":82,"column":6},"end":{"line":82,"column":71}},"40":{"start":{"line":85,"column":27},"end":{"line":85,"column":91}},"41":{"start":{"line":87,"column":4},"end":{"line":87,"column":59}},"42":{"start":{"line":91,"column":0},"end":{"line":94,"column":2}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":23,"column":9},"end":{"line":23,"column":31}},"loc":{"start":{"line":23,"column":37},"end":{"line":23,"column":95}},"line":23},"1":{"name":"parse","decl":{"start":{"line":25,"column":9},"end":{"line":25,"column":14}},"loc":{"start":{"line":25,"column":24},"end":{"line":52,"column":1}},"line":25},"2":{"name":"(anonymous_2)","decl":{"start":{"line":34,"column":37},"end":{"line":34,"column":38}},"loc":{"start":{"line":34,"column":42},"end":{"line":48,"column":3}},"line":34},"3":{"name":"(anonymous_3)","decl":{"start":{"line":48,"column":12},"end":{"line":48,"column":13}},"loc":{"start":{"line":48,"column":17},"end":{"line":48,"column":42}},"line":48},"4":{"name":"dump","decl":{"start":{"line":54,"column":15},"end":{"line":54,"column":19}},"loc":{"start":{"line":54,"column":29},"end":{"line":89,"column":1}},"line":54},"5":{"name":"(anonymous_5)","decl":{"start":{"line":64,"column":22},"end":{"line":64,"column":23}},"loc":{"start":{"line":64,"column":36},"end":{"line":88,"column":3}},"line":64}},"branchMap":{"0":{"loc":{"start":{"line":23,"column":46},"end":{"line":23,"column":92}},"type":"cond-expr","locations":[{"start":{"line":23,"column":70},"end":{"line":23,"column":73}},{"start":{"line":23,"column":76},"end":{"line":23,"column":92}}],"line":23},"1":{"loc":{"start":{"line":23,"column":46},"end":{"line":23,"column":67}},"type":"binary-expr","locations":[{"start":{"line":23,"column":46},"end":{"line":23,"column":49}},{"start":{"line":23,"column":53},"end":{"line":23,"column":67}}],"line":23},"2":{"loc":{"start":{"line":26,"column":30},"end":{"line":26,"column":114}},"type":"binary-expr","locations":[{"start":{"line":26,"column":30},"end":{"line":26,"column":72}},{"start":{"line":26,"column":76},"end":{"line":26,"column":114}}],"line":26},"3":{"loc":{"start":{"line":30,"column":2},"end":{"line":32,"column":4}},"type":"if","locations":[{"start":{"line":30,"column":2},"end":{"line":32,"column":4}},{"start":{"line":30,"column":2},"end":{"line":32,"column":4}}],"line":30},"4":{"loc":{"start":{"line":37,"column":4},"end":{"line":45,"column":5}},"type":"if","locations":[{"start":{"line":37,"column":4},"end":{"line":45,"column":5}},{"start":{"line":37,"column":4},"end":{"line":45,"column":5}}],"line":37},"5":{"loc":{"start":{"line":42,"column":6},"end":{"line":44,"column":7}},"type":"if","locations":[{"start":{"line":42,"column":6},"end":{"line":44,"column":7}},{"start":{"line":42,"column":6},"end":{"line":44,"column":7}}],"line":42},"6":{"loc":{"start":{"line":58,"column":2},"end":{"line":58,"column":27}},"type":"if","locations":[{"start":{"line":58,"column":2},"end":{"line":58,"column":27}},{"start":{"line":58,"column":2},"end":{"line":58,"column":27}}],"line":58},"7":{"loc":{"start":{"line":66,"column":10},"end":{"line":68,"column":7}},"type":"binary-expr","locations":[{"start":{"line":66,"column":10},"end":{"line":66,"column":36}},{"start":{"line":66,"column":40},"end":{"line":68,"column":7}}],"line":66},"8":{"loc":{"start":{"line":72,"column":4},"end":{"line":83,"column":5}},"type":"if","locations":[{"start":{"line":72,"column":4},"end":{"line":83,"column":5}},{"start":{"line":72,"column":4},"end":{"line":83,"column":5}}],"line":72}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":3,"10":46,"11":46,"12":46,"13":41,"14":3,"15":3,"16":5,"17":5,"18":1,"19":1,"20":1,"21":1,"22":5,"23":5,"24":3,"25":3,"26":3,"27":0,"28":3,"29":3,"30":3,"31":5,"32":5,"33":5,"34":1,"35":1,"36":1,"37":1,"38":1,"39":1,"40":5,"41":5,"42":1},"f":{"0":3,"1":46,"2":5,"3":5,"4":3,"5":5},"b":{"0":[1,2],"1":[3,3],"2":[46,45],"3":[41,3],"4":[1,4],"5":[1,0],"6":[0,3],"7":[5,5],"8":[1,4]},"inputSourceMap":{"version":3,"sources":["connections.js"],"names":["parse","context","connectionDirectory","config","AUTH0_CONNECTIONS_DIRECTORY","constants","CONNECTIONS_DIRECTORY","connectionsFolder","path","join","filePath","connections","undefined","foundFiles","map","f","connection","mappings","strategy","htmlFileName","options","email","body","filter","p","Object","keys","length","dump","assets","fs","ensureDirSync","forEach","dumpedConnection","enabled_clients","clientsOrig","connectionName","name","html","emailConnectionHtml","log","info","writeFileSync","connectionFile"],"mappings":"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","sourceRoot":"/home/circleci/repo/src/context/directory/handlers/","sourcesContent":["import fs from 'fs-extra';\nimport path from 'path';\nimport { constants, loadFile } from '../../../tools';\n\nimport log from '../../../logger';\nimport {\n  isFile,\n  getFiles,\n  existsMustBeDir,\n  dumpJSON,\n  loadJSON,\n  sanitize,\n  ensureProp,\n  mapClientID2NameSorted\n} from '../../../utils';\n\nfunction parse(context) {\n  const connectionDirectory = context.config.AUTH0_CONNECTIONS_DIRECTORY || constants.CONNECTIONS_DIRECTORY;\n  const connectionsFolder = path.join(context.filePath, connectionDirectory);\n  if (!existsMustBeDir(connectionsFolder)) return { connections: undefined }; // Skip\n\n  const foundFiles = getFiles(connectionsFolder, [ '.json' ]);\n\n  const connections = foundFiles\n    .map((f) => {\n      const connection = loadJSON(f, context.mappings);\n\n      if (connection.strategy === 'email') {\n        ensureProp(connection, 'options.email.body');\n        const htmlFileName = path.join(connectionsFolder, connection.options.email.body);\n\n        if (isFile(htmlFileName)) {\n          connection.options.email.body = loadFile(htmlFileName, context.mappings);\n        }\n      }\n\n      return connection;\n    })\n    .filter((p) => Object.keys(p).length > 0); // Filter out empty connections\n\n  return {\n    connections\n  };\n}\n\nasync function dump(context) {\n  const { connections } = context.assets;\n\n  if (!connections) return; // Skip, nothing to dump\n\n  const connectionsFolder = path.join(context.filePath, constants.CONNECTIONS_DIRECTORY);\n  fs.ensureDirSync(connectionsFolder);\n\n  // Convert enabled_clients from id to name\n  connections.forEach((connection) => {\n    const dumpedConnection = {\n      ...connection,\n      ...(connection.enabled_clients && { enabled_clients: mapClientID2NameSorted(connection.enabled_clients, context.assets.clientsOrig) })\n    };\n\n    const connectionName = sanitize(dumpedConnection.name);\n\n    if (dumpedConnection.strategy === 'email') {\n      ensureProp(dumpedConnection, 'options.email.body');\n      const html = dumpedConnection.options.email.body;\n      const emailConnectionHtml = path.join(connectionsFolder, `${connectionName}.html`);\n\n      log.info(`Writing ${emailConnectionHtml}`);\n      fs.writeFileSync(emailConnectionHtml, html);\n\n      dumpedConnection.options.email.body = `./${connectionName}.html`;\n    }\n\n    const connectionFile = path.join(connectionsFolder, `${connectionName}.json`);\n    dumpJSON(connectionFile, dumpedConnection);\n  });\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"7bd2092532fb305107996513414a5ef48b39f975","contentHash":"794dccea936f6c647a6da1d05522d217fdd74c486c38961350df7f72969ec9c0"},"/home/circleci/repo/src/context/directory/handlers/databases.js":{"path":"/home/circleci/repo/src/context/directory/handlers/databases.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":12},"end":{"line":7,"column":27}},"2":{"start":{"line":9,"column":13},"end":{"line":9,"column":42}},"3":{"start":{"line":11,"column":15},"end":{"line":11,"column":34}},"4":{"start":{"line":13,"column":16},"end":{"line":13,"column":48}},"5":{"start":{"line":15,"column":13},"end":{"line":15,"column":38}},"6":{"start":{"line":17,"column":14},"end":{"line":17,"column":40}},"7":{"start":{"line":19,"column":15},"end":{"line":19,"column":46}},"8":{"start":{"line":21,"column":13},"end":{"line":21,"column":38}},"9":{"start":{"line":23,"column":39},"end":{"line":23,"column":93}},"10":{"start":{"line":26,"column":19},"end":{"line":26,"column":63}},"11":{"start":{"line":28,"column":17},"end":{"line":28,"column":19}},"12":{"start":{"line":30,"column":2},"end":{"line":36,"column":3}},"13":{"start":{"line":31,"column":4},"end":{"line":31,"column":56}},"14":{"start":{"line":33,"column":4},"end":{"line":33,"column":99}},"15":{"start":{"line":35,"column":4},"end":{"line":35,"column":14}},"16":{"start":{"line":38,"column":2},"end":{"line":42,"column":3}},"17":{"start":{"line":39,"column":4},"end":{"line":39,"column":88}},"18":{"start":{"line":41,"column":4},"end":{"line":41,"column":14}},"19":{"start":{"line":44,"column":19},"end":{"line":50,"column":3}},"20":{"start":{"line":52,"column":2},"end":{"line":60,"column":3}},"21":{"start":{"line":53,"column":4},"end":{"line":59,"column":7}},"22":{"start":{"line":54,"column":6},"end":{"line":58,"column":7}},"23":{"start":{"line":55,"column":8},"end":{"line":55,"column":82}},"24":{"start":{"line":57,"column":8},"end":{"line":57,"column":115}},"25":{"start":{"line":62,"column":2},"end":{"line":62,"column":18}},"26":{"start":{"line":66,"column":25},"end":{"line":66,"column":111}},"27":{"start":{"line":68,"column":2},"end":{"line":70,"column":4}},"28":{"start":{"line":68,"column":52},"end":{"line":70,"column":4}},"29":{"start":{"line":72,"column":18},"end":{"line":72,"column":152}},"30":{"start":{"line":72,"column":73},"end":{"line":72,"column":111}},"31":{"start":{"line":72,"column":125},"end":{"line":72,"column":151}},"32":{"start":{"line":74,"column":20},"end":{"line":74,"column":109}},"33":{"start":{"line":74,"column":37},"end":{"line":74,"column":69}},"34":{"start":{"line":74,"column":83},"end":{"line":74,"column":108}},"35":{"start":{"line":75,"column":2},"end":{"line":77,"column":4}},"36":{"start":{"line":83,"column":6},"end":{"line":83,"column":20}},"37":{"start":{"line":84,"column":2},"end":{"line":84,"column":25}},"38":{"start":{"line":84,"column":18},"end":{"line":84,"column":25}},"39":{"start":{"line":86,"column":26},"end":{"line":86,"column":112}},"40":{"start":{"line":88,"column":2},"end":{"line":88,"column":51}},"41":{"start":{"line":90,"column":2},"end":{"line":125,"column":5}},"42":{"start":{"line":91,"column":21},"end":{"line":91,"column":94}},"43":{"start":{"line":93,"column":4},"end":{"line":93,"column":46}},"44":{"start":{"line":95,"column":30},"end":{"line":98,"column":5}},"45":{"start":{"line":96,"column":6},"end":{"line":96,"column":36}},"46":{"start":{"line":96,"column":27},"end":{"line":96,"column":36}},"47":{"start":{"line":97,"column":6},"end":{"line":97,"column":36}},"48":{"start":{"line":100,"column":22},"end":{"line":120,"column":5}},"49":{"start":{"line":107,"column":31},"end":{"line":107,"column":65}},"50":{"start":{"line":109,"column":31},"end":{"line":109,"column":72}},"51":{"start":{"line":111,"column":12},"end":{"line":111,"column":59}},"52":{"start":{"line":113,"column":12},"end":{"line":113,"column":64}},"53":{"start":{"line":115,"column":12},"end":{"line":115,"column":46}},"54":{"start":{"line":116,"column":12},"end":{"line":116,"column":27}},"55":{"start":{"line":122,"column":25},"end":{"line":122,"column":71}},"56":{"start":{"line":124,"column":4},"end":{"line":124,"column":50}},"57":{"start":{"line":128,"column":0},"end":{"line":131,"column":2}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":23,"column":9},"end":{"line":23,"column":31}},"loc":{"start":{"line":23,"column":37},"end":{"line":23,"column":95}},"line":23},"1":{"name":"getDatabase","decl":{"start":{"line":25,"column":9},"end":{"line":25,"column":20}},"loc":{"start":{"line":25,"column":39},"end":{"line":63,"column":1}},"line":25},"2":{"name":"(anonymous_2)","decl":{"start":{"line":53,"column":59},"end":{"line":53,"column":60}},"loc":{"start":{"line":53,"column":79},"end":{"line":59,"column":5}},"line":53},"3":{"name":"parse","decl":{"start":{"line":65,"column":9},"end":{"line":65,"column":14}},"loc":{"start":{"line":65,"column":24},"end":{"line":78,"column":1}},"line":65},"4":{"name":"(anonymous_4)","decl":{"start":{"line":72,"column":68},"end":{"line":72,"column":69}},"loc":{"start":{"line":72,"column":73},"end":{"line":72,"column":111}},"line":72},"5":{"name":"(anonymous_5)","decl":{"start":{"line":72,"column":120},"end":{"line":72,"column":121}},"loc":{"start":{"line":72,"column":125},"end":{"line":72,"column":151}},"line":72},"6":{"name":"(anonymous_6)","decl":{"start":{"line":74,"column":32},"end":{"line":74,"column":33}},"loc":{"start":{"line":74,"column":37},"end":{"line":74,"column":69}},"line":74},"7":{"name":"(anonymous_7)","decl":{"start":{"line":74,"column":78},"end":{"line":74,"column":79}},"loc":{"start":{"line":74,"column":83},"end":{"line":74,"column":108}},"line":74},"8":{"name":"dump","decl":{"start":{"line":80,"column":15},"end":{"line":80,"column":19}},"loc":{"start":{"line":80,"column":29},"end":{"line":126,"column":1}},"line":80},"9":{"name":"(anonymous_9)","decl":{"start":{"line":90,"column":20},"end":{"line":90,"column":21}},"loc":{"start":{"line":90,"column":32},"end":{"line":125,"column":3}},"line":90},"10":{"name":"(anonymous_10)","decl":{"start":{"line":95,"column":30},"end":{"line":95,"column":31}},"loc":{"start":{"line":95,"column":52},"end":{"line":98,"column":5}},"line":95},"11":{"name":"(anonymous_11)","decl":{"start":{"line":106,"column":103},"end":{"line":106,"column":104}},"loc":{"start":{"line":106,"column":132},"end":{"line":117,"column":11}},"line":106}},"branchMap":{"0":{"loc":{"start":{"line":23,"column":46},"end":{"line":23,"column":92}},"type":"cond-expr","locations":[{"start":{"line":23,"column":70},"end":{"line":23,"column":73}},{"start":{"line":23,"column":76},"end":{"line":23,"column":92}}],"line":23},"1":{"loc":{"start":{"line":23,"column":46},"end":{"line":23,"column":67}},"type":"binary-expr","locations":[{"start":{"line":23,"column":46},"end":{"line":23,"column":49}},{"start":{"line":23,"column":53},"end":{"line":23,"column":67}}],"line":23},"2":{"loc":{"start":{"line":38,"column":2},"end":{"line":42,"column":3}},"type":"if","locations":[{"start":{"line":38,"column":2},"end":{"line":42,"column":3}},{"start":{"line":38,"column":2},"end":{"line":42,"column":3}}],"line":38},"3":{"loc":{"start":{"line":46,"column":10},"end":{"line":48,"column":7}},"type":"binary-expr","locations":[{"start":{"line":46,"column":10},"end":{"line":46,"column":32}},{"start":{"line":46,"column":36},"end":{"line":48,"column":7}}],"line":46},"4":{"loc":{"start":{"line":52,"column":2},"end":{"line":60,"column":3}},"type":"if","locations":[{"start":{"line":52,"column":2},"end":{"line":60,"column":3}},{"start":{"line":52,"column":2},"end":{"line":60,"column":3}}],"line":52},"5":{"loc":{"start":{"line":54,"column":6},"end":{"line":58,"column":7}},"type":"if","locations":[{"start":{"line":54,"column":6},"end":{"line":58,"column":7}},{"start":{"line":54,"column":6},"end":{"line":58,"column":7}}],"line":54},"6":{"loc":{"start":{"line":68,"column":2},"end":{"line":70,"column":4}},"type":"if","locations":[{"start":{"line":68,"column":2},"end":{"line":70,"column":4}},{"start":{"line":68,"column":2},"end":{"line":70,"column":4}}],"line":68},"7":{"loc":{"start":{"line":84,"column":2},"end":{"line":84,"column":25}},"type":"if","locations":[{"start":{"line":84,"column":2},"end":{"line":84,"column":25}},{"start":{"line":84,"column":2},"end":{"line":84,"column":25}}],"line":84},"8":{"loc":{"start":{"line":96,"column":6},"end":{"line":96,"column":36}},"type":"if","locations":[{"start":{"line":96,"column":6},"end":{"line":96,"column":36}},{"start":{"line":96,"column":6},"end":{"line":96,"column":36}}],"line":96},"9":{"loc":{"start":{"line":97,"column":13},"end":{"line":97,"column":35}},"type":"cond-expr","locations":[{"start":{"line":97,"column":29},"end":{"line":97,"column":30}},{"start":{"line":97,"column":33},"end":{"line":97,"column":35}}],"line":97},"10":{"loc":{"start":{"line":101,"column":10},"end":{"line":103,"column":7}},"type":"binary-expr","locations":[{"start":{"line":101,"column":10},"end":{"line":101,"column":34}},{"start":{"line":101,"column":38},"end":{"line":103,"column":7}}],"line":101},"11":{"loc":{"start":{"line":105,"column":12},"end":{"line":118,"column":9}},"type":"binary-expr","locations":[{"start":{"line":105,"column":12},"end":{"line":105,"column":42}},{"start":{"line":105,"column":46},"end":{"line":118,"column":9}}],"line":105}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":3,"10":4,"11":4,"12":4,"13":4,"14":1,"15":1,"16":3,"17":0,"18":0,"19":3,"20":3,"21":2,"22":14,"23":0,"24":14,"25":3,"26":49,"27":49,"28":45,"29":4,"30":4,"31":4,"32":4,"33":4,"34":4,"35":4,"36":4,"37":4,"38":0,"39":4,"40":4,"41":4,"42":4,"43":4,"44":4,"45":6,"46":0,"47":6,"48":4,"49":8,"50":8,"51":8,"52":8,"53":8,"54":8,"55":4,"56":4,"57":1},"f":{"0":3,"1":4,"2":14,"3":49,"4":4,"5":4,"6":4,"7":4,"8":4,"9":4,"10":6,"11":8},"b":{"0":[1,2],"1":[3,3],"2":[0,3],"3":[3,0],"4":[2,1],"5":[0,14],"6":[45,4],"7":[0,4],"8":[0,6],"9":[6,0],"10":[4,4],"11":[4,2]},"inputSourceMap":{"version":3,"sources":["databases.js"],"names":["getDatabase","folder","mappings","metaFile","path","join","metaData","err","log","warn","database","options","customScripts","Object","entries","forEach","name","script","constants","DATABASE_SCRIPTS","includes","parse","context","databaseFolder","filePath","DATABASE_CONNECTIONS_DIRECTORY","databases","undefined","folders","fs","readdirSync","map","f","filter","p","keys","length","dump","assets","databasesFolder","ensureDirSync","dbFolder","sortCustomScripts","name1","name2","formatted","enabled_clients","clientsOrig","sort","reduce","scripts","scriptName","scriptFile","info","writeFileSync","databaseFile"],"mappings":"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","sourceRoot":"/home/circleci/repo/src/context/directory/handlers/","sourcesContent":["import path from 'path';\nimport fs from 'fs-extra';\nimport { constants, loadFile } from '../../../tools';\n\nimport log from '../../../logger';\nimport {\n  isDirectory,\n  existsMustBeDir,\n  dumpJSON,\n  loadJSON,\n  sanitize,\n  mapClientID2NameSorted\n} from '../../../utils';\n\nfunction getDatabase(folder, mappings) {\n  const metaFile = path.join(folder, 'database.json');\n  let metaData = {};\n\n  // First load database.json\n  try {\n    metaData = loadJSON(metaFile, mappings);\n  } catch (err) {\n    log.warn(`Skipping database folder ${folder} as cannot find or read ${metaFile}`);\n    return {};\n  }\n\n  if (!metaData) {\n    log.warn(`Skipping database folder ${folder} as ${metaFile} is empty`);\n    return {};\n  }\n\n  const database = {\n    ...metaData,\n    options: {\n      ...metaData.options,\n      // customScripts option only written if there are scripts\n      ...(metaData.customScripts && {\n        customScripts: metaData.customScripts\n      })\n    }\n  };\n\n  // If any customScripts configured then load content of files\n  if (database.options.customScripts) {\n    Object.entries(database.options.customScripts).forEach(([ name, script ]) => {\n      if (!constants.DATABASE_SCRIPTS.includes(name)) {\n        // skip invalid keys in customScripts object\n        log.warn('Skipping invalid database configuration: ' + name);\n      } else {\n        database.options.customScripts[name] = loadFile(\n          path.join(folder, script),\n          mappings\n        );\n      }\n    });\n  }\n\n  return database;\n}\n\nfunction parse(context) {\n  const databaseFolder = path.join(context.filePath, constants.DATABASE_CONNECTIONS_DIRECTORY);\n  if (!existsMustBeDir(databaseFolder)) return { databases: undefined }; // Skip\n\n  const folders = fs.readdirSync(databaseFolder)\n    .map((f) => path.join(databaseFolder, f))\n    .filter((f) => isDirectory(f));\n\n  const databases = folders.map((f) => getDatabase(f, context.mappings))\n    .filter((p) => Object.keys(p).length > 1);\n\n  return {\n    databases\n  };\n}\n\nasync function dump(context) {\n  const { databases } = context.assets;\n\n  if (!databases) return; // Skip, nothing to dump\n\n  const databasesFolder = path.join(context.filePath, constants.DATABASE_CONNECTIONS_DIRECTORY);\n  fs.ensureDirSync(databasesFolder);\n\n  databases.forEach((database) => {\n    const dbFolder = path.join(databasesFolder, sanitize(database.name));\n    fs.ensureDirSync(dbFolder);\n\n    const sortCustomScripts = ([ name1 ], [ name2 ]) => {\n      if (name1 === name2) return 0;\n      return name1 > name2 ? 1 : -1;\n    };\n\n    const formatted = {\n      ...database,\n      ...(database.enabled_clients && { enabled_clients: mapClientID2NameSorted(database.enabled_clients, context.assets.clientsOrig) }),\n      options: {\n        ...database.options,\n        // customScripts option only written if there are scripts\n        ...(database.options.customScripts && {\n          customScripts: Object.entries(database.options.customScripts).sort(sortCustomScripts).reduce((scripts, [ name, script ]) => {\n            // Dump custom script to file\n            const scriptName = sanitize(`${name}.js`);\n            const scriptFile = path.join(dbFolder, scriptName);\n            log.info(`Writing ${scriptFile}`);\n            fs.writeFileSync(scriptFile, script);\n            scripts[name] = `./${scriptName}`;\n            return scripts;\n          }, {})\n        })\n      }\n    };\n\n    const databaseFile = path.join(dbFolder, 'database.json');\n    dumpJSON(databaseFile, formatted);\n  });\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"d0d3f79642e4d3cee0e78011b9b892c26c106ec4","contentHash":"e7907d207befd2b4746d75121d04cfbb9a3fae5ea758677811f5a142998702d3"},"/home/circleci/repo/src/context/directory/handlers/emailTemplates.js":{"path":"/home/circleci/repo/src/context/directory/handlers/emailTemplates.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":15},"end":{"line":7,"column":34}},"2":{"start":{"line":9,"column":16},"end":{"line":9,"column":48}},"3":{"start":{"line":11,"column":12},"end":{"line":11,"column":27}},"4":{"start":{"line":13,"column":13},"end":{"line":13,"column":42}},"5":{"start":{"line":15,"column":13},"end":{"line":15,"column":38}},"6":{"start":{"line":17,"column":14},"end":{"line":17,"column":40}},"7":{"start":{"line":19,"column":15},"end":{"line":19,"column":46}},"8":{"start":{"line":21,"column":13},"end":{"line":21,"column":38}},"9":{"start":{"line":23,"column":39},"end":{"line":23,"column":93}},"10":{"start":{"line":26,"column":23},"end":{"line":26,"column":104}},"11":{"start":{"line":28,"column":2},"end":{"line":30,"column":4}},"12":{"start":{"line":28,"column":50},"end":{"line":30,"column":4}},"13":{"start":{"line":31,"column":16},"end":{"line":31,"column":130}},"14":{"start":{"line":31,"column":83},"end":{"line":31,"column":129}},"15":{"start":{"line":32,"column":17},"end":{"line":32,"column":19}},"16":{"start":{"line":33,"column":2},"end":{"line":42,"column":5}},"17":{"start":{"line":37,"column":8},"end":{"line":37,"column":34}},"18":{"start":{"line":39,"column":4},"end":{"line":39,"column":41}},"19":{"start":{"line":39,"column":23},"end":{"line":39,"column":41}},"20":{"start":{"line":40,"column":4},"end":{"line":40,"column":50}},"21":{"start":{"line":40,"column":25},"end":{"line":40,"column":50}},"22":{"start":{"line":41,"column":4},"end":{"line":41,"column":50}},"23":{"start":{"line":41,"column":25},"end":{"line":41,"column":50}},"24":{"start":{"line":43,"column":25},"end":{"line":43,"column":27}},"25":{"start":{"line":44,"column":2},"end":{"line":54,"column":5}},"26":{"start":{"line":45,"column":4},"end":{"line":53,"column":5}},"27":{"start":{"line":46,"column":6},"end":{"line":46,"column":115}},"28":{"start":{"line":47,"column":11},"end":{"line":53,"column":5}},"29":{"start":{"line":48,"column":6},"end":{"line":48,"column":111}},"30":{"start":{"line":50,"column":6},"end":{"line":52,"column":9}},"31":{"start":{"line":55,"column":2},"end":{"line":57,"column":4}},"32":{"start":{"line":61,"column":25},"end":{"line":61,"column":67}},"33":{"start":{"line":62,"column":2},"end":{"line":62,"column":30}},"34":{"start":{"line":62,"column":23},"end":{"line":62,"column":30}},"35":{"start":{"line":64,"column":26},"end":{"line":64,"column":107}},"36":{"start":{"line":66,"column":2},"end":{"line":66,"column":51}},"37":{"start":{"line":68,"column":2},"end":{"line":80,"column":5}},"38":{"start":{"line":69,"column":25},"end":{"line":69,"column":90}},"39":{"start":{"line":71,"column":4},"end":{"line":71,"column":53}},"40":{"start":{"line":73,"column":4},"end":{"line":73,"column":65}},"41":{"start":{"line":75,"column":25},"end":{"line":75,"column":90}},"42":{"start":{"line":77,"column":4},"end":{"line":79,"column":7}},"43":{"start":{"line":83,"column":0},"end":{"line":86,"column":2}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":23,"column":9},"end":{"line":23,"column":31}},"loc":{"start":{"line":23,"column":37},"end":{"line":23,"column":95}},"line":23},"1":{"name":"parse","decl":{"start":{"line":25,"column":9},"end":{"line":25,"column":14}},"loc":{"start":{"line":25,"column":24},"end":{"line":58,"column":1}},"line":25},"2":{"name":"(anonymous_2)","decl":{"start":{"line":31,"column":78},"end":{"line":31,"column":79}},"loc":{"start":{"line":31,"column":83},"end":{"line":31,"column":129}},"line":31},"3":{"name":"(anonymous_3)","decl":{"start":{"line":33,"column":16},"end":{"line":33,"column":17}},"loc":{"start":{"line":33,"column":24},"end":{"line":42,"column":3}},"line":33},"4":{"name":"(anonymous_4)","decl":{"start":{"line":44,"column":32},"end":{"line":44,"column":33}},"loc":{"start":{"line":44,"column":40},"end":{"line":54,"column":3}},"line":44},"5":{"name":"dump","decl":{"start":{"line":60,"column":15},"end":{"line":60,"column":19}},"loc":{"start":{"line":60,"column":29},"end":{"line":81,"column":1}},"line":60},"6":{"name":"(anonymous_6)","decl":{"start":{"line":68,"column":25},"end":{"line":68,"column":26}},"loc":{"start":{"line":68,"column":37},"end":{"line":80,"column":3}},"line":68}},"branchMap":{"0":{"loc":{"start":{"line":23,"column":46},"end":{"line":23,"column":92}},"type":"cond-expr","locations":[{"start":{"line":23,"column":70},"end":{"line":23,"column":73}},{"start":{"line":23,"column":76},"end":{"line":23,"column":92}}],"line":23},"1":{"loc":{"start":{"line":23,"column":46},"end":{"line":23,"column":67}},"type":"binary-expr","locations":[{"start":{"line":23,"column":46},"end":{"line":23,"column":49}},{"start":{"line":23,"column":53},"end":{"line":23,"column":67}}],"line":23},"2":{"loc":{"start":{"line":28,"column":2},"end":{"line":30,"column":4}},"type":"if","locations":[{"start":{"line":28,"column":2},"end":{"line":30,"column":4}},{"start":{"line":28,"column":2},"end":{"line":30,"column":4}}],"line":28},"3":{"loc":{"start":{"line":39,"column":4},"end":{"line":39,"column":41}},"type":"if","locations":[{"start":{"line":39,"column":4},"end":{"line":39,"column":41}},{"start":{"line":39,"column":4},"end":{"line":39,"column":41}}],"line":39},"4":{"loc":{"start":{"line":40,"column":4},"end":{"line":40,"column":50}},"type":"if","locations":[{"start":{"line":40,"column":4},"end":{"line":40,"column":50}},{"start":{"line":40,"column":4},"end":{"line":40,"column":50}}],"line":40},"5":{"loc":{"start":{"line":41,"column":4},"end":{"line":41,"column":50}},"type":"if","locations":[{"start":{"line":41,"column":4},"end":{"line":41,"column":50}},{"start":{"line":41,"column":4},"end":{"line":41,"column":50}}],"line":41},"6":{"loc":{"start":{"line":45,"column":4},"end":{"line":53,"column":5}},"type":"if","locations":[{"start":{"line":45,"column":4},"end":{"line":53,"column":5}},{"start":{"line":45,"column":4},"end":{"line":53,"column":5}}],"line":45},"7":{"loc":{"start":{"line":47,"column":11},"end":{"line":53,"column":5}},"type":"if","locations":[{"start":{"line":47,"column":11},"end":{"line":53,"column":5}},{"start":{"line":47,"column":11},"end":{"line":53,"column":5}}],"line":47},"8":{"loc":{"start":{"line":61,"column":30},"end":{"line":61,"column":65}},"type":"binary-expr","locations":[{"start":{"line":61,"column":30},"end":{"line":61,"column":59}},{"start":{"line":61,"column":63},"end":{"line":61,"column":65}}],"line":61},"9":{"loc":{"start":{"line":62,"column":2},"end":{"line":62,"column":30}},"type":"if","locations":[{"start":{"line":62,"column":2},"end":{"line":62,"column":30}},{"start":{"line":62,"column":2},"end":{"line":62,"column":30}}],"line":62}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":3,"10":43,"11":43,"12":40,"13":3,"14":11,"15":3,"16":3,"17":8,"18":8,"19":4,"20":8,"21":4,"22":8,"23":4,"24":3,"25":3,"26":4,"27":0,"28":4,"29":0,"30":4,"31":3,"32":1,"33":1,"34":0,"35":1,"36":1,"37":1,"38":2,"39":2,"40":2,"41":2,"42":2,"43":1},"f":{"0":3,"1":43,"2":11,"3":8,"4":4,"5":1,"6":2},"b":{"0":[1,2],"1":[3,3],"2":[40,3],"3":[4,4],"4":[4,4],"5":[4,4],"6":[0,4],"7":[0,4],"8":[1,0],"9":[0,1]},"inputSourceMap":{"version":3,"sources":["emailTemplates.js"],"names":["parse","context","emailsFolder","path","join","filePath","constants","EMAIL_TEMPLATES_DIRECTORY","emailTemplates","undefined","files","filter","f","basename","sorted","forEach","file","ext","name","meta","html","Object","values","data","log","warn","push","mappings","body","dump","assets","templatesFolder","fs","ensureDirSync","template","templateHtml","info","writeFileSync","templateFile"],"mappings":"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","sourceRoot":"/home/circleci/repo/src/context/directory/handlers/","sourcesContent":["import fs from 'fs-extra';\nimport path from 'path';\nimport { constants, loadFile } from '../../../tools';\n\nimport log from '../../../logger';\nimport {\n  getFiles, existsMustBeDir, dumpJSON, loadJSON\n} from '../../../utils';\n\nfunction parse(context) {\n  const emailsFolder = path.join(context.filePath, constants.EMAIL_TEMPLATES_DIRECTORY);\n  if (!existsMustBeDir(emailsFolder)) return { emailTemplates: undefined }; // Skip\n\n  const files = getFiles(emailsFolder, [ '.json', '.html' ]).filter((f) => path.basename(f) !== 'provider.json');\n\n  const sorted = {};\n\n  files.forEach((file) => {\n    const { ext, name } = path.parse(file);\n    if (!sorted[name]) sorted[name] = {};\n    if (ext === '.json') sorted[name].meta = file;\n    if (ext === '.html') sorted[name].html = file;\n  });\n\n  const emailTemplates = [];\n  Object.values(sorted).forEach((data) => {\n    if (!data.meta) {\n      log.warn(`Skipping email template file ${data.html} as missing the corresponding '.json' file`);\n    } else if (!data.html) {\n      log.warn(`Skipping email template file ${data.meta} as missing corresponding '.html' file`);\n    } else {\n      emailTemplates.push({\n        ...loadJSON(data.meta, context.mappings),\n        body: loadFile(data.html, context.mappings)\n      });\n    }\n  });\n\n  return {\n    emailTemplates\n  };\n}\n\nasync function dump(context) {\n  const emailTemplates = [ ...context.assets.emailTemplates || [] ];\n\n  if (!emailTemplates) return; // Skip, nothing to dump\n\n  // Create Templates folder\n  const templatesFolder = path.join(context.filePath, constants.EMAIL_TEMPLATES_DIRECTORY);\n  fs.ensureDirSync(templatesFolder);\n  emailTemplates.forEach((template) => {\n    // Dump template html to file\n    const templateHtml = path.join(templatesFolder, `${template.template}.html`);\n    log.info(`Writing ${templateHtml}`);\n    fs.writeFileSync(templateHtml, template.body);\n\n    // Dump template metadata\n    const templateFile = path.join(templatesFolder, `${template.template}.json`);\n    dumpJSON(templateFile, { ...template, body: `./${template.template}.html` });\n  });\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"c8345b0d5bff9af84fe5f992c3f026ca042ba228","contentHash":"0d206d59445635ca0ceabcee24f610d4dda744007ef862b52d17332869ee5616"},"/home/circleci/repo/src/context/directory/handlers/clientGrants.js":{"path":"/home/circleci/repo/src/context/directory/handlers/clientGrants.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":15},"end":{"line":7,"column":34}},"2":{"start":{"line":9,"column":16},"end":{"line":9,"column":48}},"3":{"start":{"line":11,"column":12},"end":{"line":11,"column":27}},"4":{"start":{"line":13,"column":13},"end":{"line":13,"column":42}},"5":{"start":{"line":15,"column":13},"end":{"line":15,"column":38}},"6":{"start":{"line":17,"column":13},"end":{"line":17,"column":38}},"7":{"start":{"line":19,"column":39},"end":{"line":19,"column":93}},"8":{"start":{"line":22,"column":23},"end":{"line":22,"column":103}},"9":{"start":{"line":24,"column":2},"end":{"line":26,"column":4}},"10":{"start":{"line":24,"column":50},"end":{"line":26,"column":4}},"11":{"start":{"line":27,"column":21},"end":{"line":27,"column":66}},"12":{"start":{"line":28,"column":23},"end":{"line":28,"column":124}},"13":{"start":{"line":28,"column":43},"end":{"line":28,"column":84}},"14":{"start":{"line":28,"column":98},"end":{"line":28,"column":123}},"15":{"start":{"line":29,"column":2},"end":{"line":31,"column":4}},"16":{"start":{"line":37,"column":6},"end":{"line":37,"column":20}},"17":{"start":{"line":38,"column":2},"end":{"line":38,"column":28}},"18":{"start":{"line":38,"column":21},"end":{"line":38,"column":28}},"19":{"start":{"line":40,"column":23},"end":{"line":40,"column":103}},"20":{"start":{"line":42,"column":2},"end":{"line":42,"column":48}},"21":{"start":{"line":44,"column":2},"end":{"line":53,"column":5}},"22":{"start":{"line":45,"column":22},"end":{"line":46,"column":5}},"23":{"start":{"line":47,"column":4},"end":{"line":47,"column":109}},"24":{"start":{"line":48,"column":17},"end":{"line":48,"column":87}},"25":{"start":{"line":50,"column":22},"end":{"line":50,"column":71}},"26":{"start":{"line":52,"column":4},"end":{"line":52,"column":47}},"27":{"start":{"line":56,"column":0},"end":{"line":59,"column":2}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":19,"column":9},"end":{"line":19,"column":31}},"loc":{"start":{"line":19,"column":37},"end":{"line":19,"column":95}},"line":19},"1":{"name":"parse","decl":{"start":{"line":21,"column":9},"end":{"line":21,"column":14}},"loc":{"start":{"line":21,"column":24},"end":{"line":32,"column":1}},"line":21},"2":{"name":"(anonymous_2)","decl":{"start":{"line":28,"column":38},"end":{"line":28,"column":39}},"loc":{"start":{"line":28,"column":43},"end":{"line":28,"column":84}},"line":28},"3":{"name":"(anonymous_3)","decl":{"start":{"line":28,"column":93},"end":{"line":28,"column":94}},"loc":{"start":{"line":28,"column":98},"end":{"line":28,"column":123}},"line":28},"4":{"name":"dump","decl":{"start":{"line":34,"column":15},"end":{"line":34,"column":19}},"loc":{"start":{"line":34,"column":29},"end":{"line":54,"column":1}},"line":34},"5":{"name":"(anonymous_5)","decl":{"start":{"line":44,"column":23},"end":{"line":44,"column":24}},"loc":{"start":{"line":44,"column":32},"end":{"line":53,"column":3}},"line":44}},"branchMap":{"0":{"loc":{"start":{"line":19,"column":46},"end":{"line":19,"column":92}},"type":"cond-expr","locations":[{"start":{"line":19,"column":70},"end":{"line":19,"column":73}},{"start":{"line":19,"column":76},"end":{"line":19,"column":92}}],"line":19},"1":{"loc":{"start":{"line":19,"column":46},"end":{"line":19,"column":67}},"type":"binary-expr","locations":[{"start":{"line":19,"column":46},"end":{"line":19,"column":49}},{"start":{"line":19,"column":53},"end":{"line":19,"column":67}}],"line":19},"2":{"loc":{"start":{"line":24,"column":2},"end":{"line":26,"column":4}},"type":"if","locations":[{"start":{"line":24,"column":2},"end":{"line":26,"column":4}},{"start":{"line":24,"column":2},"end":{"line":26,"column":4}}],"line":24},"3":{"loc":{"start":{"line":38,"column":2},"end":{"line":38,"column":28}},"type":"if","locations":[{"start":{"line":38,"column":2},"end":{"line":38,"column":28}},{"start":{"line":38,"column":2},"end":{"line":38,"column":28}}],"line":38}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":2,"8":49,"9":49,"10":46,"11":2,"12":2,"13":2,"14":2,"15":2,"16":2,"17":2,"18":0,"19":2,"20":2,"21":2,"22":2,"23":2,"24":2,"25":2,"26":2,"27":1},"f":{"0":2,"1":49,"2":2,"3":2,"4":2,"5":2},"b":{"0":[0,2],"1":[2,2],"2":[46,2],"3":[0,2]},"inputSourceMap":{"version":3,"sources":["clientGrants.js"],"names":["parse","context","grantsFolder","path","join","filePath","constants","CLIENTS_GRANTS_DIRECTORY","clientGrants","undefined","foundFiles","map","f","mappings","filter","p","Object","keys","length","dump","assets","fs","ensureDirSync","forEach","grant","dumpGrant","client_id","clientsOrig","name","audience","grantFile"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;AAEA;;;;AAIA,SAASA,KAAT,CAAeC,OAAf,EAAwB;AACtB,QAAMC,YAAY,GAAGC,eAAKC,IAAL,CAAUH,OAAO,CAACI,QAAlB,EAA4BC,iBAAUC,wBAAtC,CAArB;;AACA,MAAI,CAAC,4BAAgBL,YAAhB,CAAL,EAAoC,OAAO;AAAEM,IAAAA,YAAY,EAAEC;AAAhB,GAAP;AAEpC,QAAMC,UAAU,GAAG,qBAASR,YAAT,EAAuB,CAAE,OAAF,CAAvB,CAAnB;AAEA,QAAMM,YAAY,GAAGE,UAAU,CAACC,GAAX,CAAgBC,CAAD,IAAO,qBAASA,CAAT,EAAYX,OAAO,CAACY,QAApB,CAAtB,EAClBC,MADkB,CACVC,CAAD,IAAOC,MAAM,CAACC,IAAP,CAAYF,CAAZ,EAAeG,MAAf,GAAwB,CADpB,CAArB;AAGA,SAAO;AACLV,IAAAA;AADK,GAAP;AAGD;;AAED,eAAeW,IAAf,CAAoBlB,OAApB,EAA6B;AAC3B,QAAM;AAAEO,IAAAA;AAAF,MAAmBP,OAAO,CAACmB,MAAjC;AAEA,MAAI,CAACZ,YAAL,EAAmB;;AAEnB,QAAMN,YAAY,GAAGC,eAAKC,IAAL,CAAUH,OAAO,CAACI,QAAlB,EAA4BC,iBAAUC,wBAAtC,CAArB;;AACAc,oBAAGC,aAAH,CAAiBpB,YAAjB;;AAGAM,EAAAA,YAAY,CAACe,OAAb,CAAsBC,KAAD,IAAW;AAC9B,UAAMC,SAAS,GAAG,EAAE,GAAGD;AAAL,KAAlB;AACAC,IAAAA,SAAS,CAACC,SAAV,GAAsB,kCAAsBD,SAAS,CAACC,SAAhC,EAA2CzB,OAAO,CAACmB,MAAR,CAAeO,WAA1D,CAAtB;AAEA,UAAMC,IAAI,GAAG,qBAAU,GAAEH,SAAS,CAACC,SAAU,KAAID,SAAS,CAACI,QAAS,GAAvD,CAAb;;AACA,UAAMC,SAAS,GAAG3B,eAAKC,IAAL,CAAUF,YAAV,EAAyB,GAAE0B,IAAK,OAAhC,CAAlB;;AACA,yBAASE,SAAT,EAAoBL,SAApB;AACD,GAPD;AAQD;;kBAEc;AACbzB,EAAAA,KADa;AAEbmB,EAAAA;AAFa,C","sourceRoot":"/home/circleci/repo/src/context/directory/handlers/","sourcesContent":["import fs from 'fs-extra';\nimport path from 'path';\nimport { constants } from '../../../tools';\n\nimport {\n  getFiles, existsMustBeDir, dumpJSON, loadJSON, sanitize, convertClientIdToName\n} from '../../../utils';\n\nfunction parse(context) {\n  const grantsFolder = path.join(context.filePath, constants.CLIENTS_GRANTS_DIRECTORY);\n  if (!existsMustBeDir(grantsFolder)) return { clientGrants: undefined }; // Skip\n\n  const foundFiles = getFiles(grantsFolder, [ '.json' ]);\n\n  const clientGrants = foundFiles.map((f) => loadJSON(f, context.mappings))\n    .filter((p) => Object.keys(p).length > 0); // Filter out empty grants\n\n  return {\n    clientGrants\n  };\n}\n\nasync function dump(context) {\n  const { clientGrants } = context.assets;\n\n  if (!clientGrants) return; // Skip, nothing to dump\n\n  const grantsFolder = path.join(context.filePath, constants.CLIENTS_GRANTS_DIRECTORY);\n  fs.ensureDirSync(grantsFolder);\n\n  // Convert client_id to the client name for readability\n  clientGrants.forEach((grant) => {\n    const dumpGrant = { ...grant };\n    dumpGrant.client_id = convertClientIdToName(dumpGrant.client_id, context.assets.clientsOrig);\n\n    const name = sanitize(`${dumpGrant.client_id} (${dumpGrant.audience})`);\n    const grantFile = path.join(grantsFolder, `${name}.json`);\n    dumpJSON(grantFile, dumpGrant);\n  });\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"2ba8ae795183a7e0e418afb82ce3d4768bb5c35f","contentHash":"15350509bc55abd88d37de82476d42b100cb4e071c9fe60a816f1e7b07f60470"},"/home/circleci/repo/src/context/directory/handlers/rulesConfigs.js":{"path":"/home/circleci/repo/src/context/directory/handlers/rulesConfigs.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":12},"end":{"line":7,"column":27}},"2":{"start":{"line":9,"column":13},"end":{"line":9,"column":42}},"3":{"start":{"line":11,"column":13},"end":{"line":11,"column":38}},"4":{"start":{"line":13,"column":13},"end":{"line":13,"column":38}},"5":{"start":{"line":15,"column":39},"end":{"line":15,"column":93}},"6":{"start":{"line":18,"column":29},"end":{"line":18,"column":108}},"7":{"start":{"line":20,"column":2},"end":{"line":22,"column":4}},"8":{"start":{"line":20,"column":56},"end":{"line":22,"column":4}},"9":{"start":{"line":23,"column":21},"end":{"line":23,"column":72}},"10":{"start":{"line":24,"column":23},"end":{"line":24,"column":124}},"11":{"start":{"line":24,"column":43},"end":{"line":24,"column":84}},"12":{"start":{"line":24,"column":98},"end":{"line":24,"column":123}},"13":{"start":{"line":25,"column":2},"end":{"line":27,"column":4}},"14":{"start":{"line":31,"column":2},"end":{"line":31,"column":14}},"15":{"start":{"line":34,"column":0},"end":{"line":37,"column":2}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":15,"column":9},"end":{"line":15,"column":31}},"loc":{"start":{"line":15,"column":37},"end":{"line":15,"column":95}},"line":15},"1":{"name":"parse","decl":{"start":{"line":17,"column":9},"end":{"line":17,"column":14}},"loc":{"start":{"line":17,"column":24},"end":{"line":28,"column":1}},"line":17},"2":{"name":"(anonymous_2)","decl":{"start":{"line":24,"column":38},"end":{"line":24,"column":39}},"loc":{"start":{"line":24,"column":43},"end":{"line":24,"column":84}},"line":24},"3":{"name":"(anonymous_3)","decl":{"start":{"line":24,"column":93},"end":{"line":24,"column":94}},"loc":{"start":{"line":24,"column":98},"end":{"line":24,"column":123}},"line":24},"4":{"name":"dump","decl":{"start":{"line":30,"column":15},"end":{"line":30,"column":19}},"loc":{"start":{"line":30,"column":22},"end":{"line":32,"column":1}},"line":30}},"branchMap":{"0":{"loc":{"start":{"line":15,"column":46},"end":{"line":15,"column":92}},"type":"cond-expr","locations":[{"start":{"line":15,"column":70},"end":{"line":15,"column":73}},{"start":{"line":15,"column":76},"end":{"line":15,"column":92}}],"line":15},"1":{"loc":{"start":{"line":15,"column":46},"end":{"line":15,"column":67}},"type":"binary-expr","locations":[{"start":{"line":15,"column":46},"end":{"line":15,"column":49}},{"start":{"line":15,"column":53},"end":{"line":15,"column":67}}],"line":15},"2":{"loc":{"start":{"line":20,"column":2},"end":{"line":22,"column":4}},"type":"if","locations":[{"start":{"line":20,"column":2},"end":{"line":22,"column":4}},{"start":{"line":20,"column":2},"end":{"line":22,"column":4}}],"line":20}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":52,"7":52,"8":49,"9":2,"10":2,"11":3,"12":3,"13":2,"14":1,"15":1},"f":{"0":1,"1":52,"2":3,"3":3,"4":1},"b":{"0":[0,1],"1":[1,1],"2":[49,2]},"inputSourceMap":{"version":3,"sources":["rulesConfigs.js"],"names":["parse","context","rulesConfigsFolder","path","join","filePath","constants","RULES_CONFIGS_DIRECTORY","rulesConfigs","undefined","foundFiles","map","f","mappings","filter","p","Object","keys","length","dump"],"mappings":";;;;;;AAAA;;;;AACA;;AAEA;;;;AAEA,SAASA,KAAT,CAAeC,OAAf,EAAwB;AACtB,QAAMC,kBAAkB,GAAGC,eAAKC,IAAL,CAAUH,OAAO,CAACI,QAAlB,EAA4BC,iBAAUC,uBAAtC,CAA3B;;AACA,MAAI,CAAC,4BAAgBL,kBAAhB,CAAL,EAA0C,OAAO;AAAEM,IAAAA,YAAY,EAAEC;AAAhB,GAAP;AAE1C,QAAMC,UAAU,GAAG,qBAASR,kBAAT,EAA6B,CAAE,OAAF,CAA7B,CAAnB;AAEA,QAAMM,YAAY,GAAGE,UAAU,CAACC,GAAX,CAAgBC,CAAD,IAAO,qBAASA,CAAT,EAAYX,OAAO,CAACY,QAApB,CAAtB,EAClBC,MADkB,CACVC,CAAD,IAAOC,MAAM,CAACC,IAAP,CAAYF,CAAZ,EAAeG,MAAf,GAAwB,CADpB,CAArB;AAGA,SAAO;AACLV,IAAAA;AADK,GAAP;AAGD;;AAED,eAAeW,IAAf,GAAsB;AAEpB,SAAO,IAAP;AACD;;kBAEc;AACbnB,EAAAA,KADa;AAEbmB,EAAAA;AAFa,C","sourceRoot":"/home/circleci/repo/src/context/directory/handlers/","sourcesContent":["import path from 'path';\nimport { constants } from '../../../tools';\n\nimport { getFiles, existsMustBeDir, loadJSON } from '../../../utils';\n\nfunction parse(context) {\n  const rulesConfigsFolder = path.join(context.filePath, constants.RULES_CONFIGS_DIRECTORY);\n  if (!existsMustBeDir(rulesConfigsFolder)) return { rulesConfigs: undefined }; // Skip\n\n  const foundFiles = getFiles(rulesConfigsFolder, [ '.json' ]);\n\n  const rulesConfigs = foundFiles.map((f) => loadJSON(f, context.mappings))\n    .filter((p) => Object.keys(p).length > 0); // Filter out empty rulesConfigs\n\n  return {\n    rulesConfigs\n  };\n}\n\nasync function dump() {\n  // do not export rulesConfigs as its values cannot be extracted\n  return null;\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"f2a81133e8558e3d0cadbf951b985bae5099ef88","contentHash":"fa3996e49d0cfac9abe1e2767912223bab2994927c0dafc361f69176fc01ac6b"},"/home/circleci/repo/src/context/directory/handlers/resourceServers.js":{"path":"/home/circleci/repo/src/context/directory/handlers/resourceServers.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":15},"end":{"line":7,"column":34}},"2":{"start":{"line":9,"column":16},"end":{"line":9,"column":48}},"3":{"start":{"line":11,"column":12},"end":{"line":11,"column":27}},"4":{"start":{"line":13,"column":13},"end":{"line":13,"column":42}},"5":{"start":{"line":15,"column":13},"end":{"line":15,"column":38}},"6":{"start":{"line":17,"column":13},"end":{"line":17,"column":38}},"7":{"start":{"line":19,"column":39},"end":{"line":19,"column":93}},"8":{"start":{"line":22,"column":32},"end":{"line":22,"column":114}},"9":{"start":{"line":24,"column":2},"end":{"line":26,"column":4}},"10":{"start":{"line":24,"column":59},"end":{"line":26,"column":4}},"11":{"start":{"line":27,"column":21},"end":{"line":27,"column":75}},"12":{"start":{"line":28,"column":26},"end":{"line":28,"column":127}},"13":{"start":{"line":28,"column":46},"end":{"line":28,"column":87}},"14":{"start":{"line":28,"column":101},"end":{"line":28,"column":126}},"15":{"start":{"line":29,"column":2},"end":{"line":31,"column":4}},"16":{"start":{"line":37,"column":6},"end":{"line":37,"column":20}},"17":{"start":{"line":38,"column":2},"end":{"line":38,"column":31}},"18":{"start":{"line":38,"column":24},"end":{"line":38,"column":31}},"19":{"start":{"line":40,"column":32},"end":{"line":40,"column":114}},"20":{"start":{"line":42,"column":2},"end":{"line":42,"column":57}},"21":{"start":{"line":44,"column":2},"end":{"line":48,"column":5}},"22":{"start":{"line":45,"column":31},"end":{"line":45,"column":126}},"23":{"start":{"line":47,"column":4},"end":{"line":47,"column":61}},"24":{"start":{"line":51,"column":0},"end":{"line":54,"column":2}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":19,"column":9},"end":{"line":19,"column":31}},"loc":{"start":{"line":19,"column":37},"end":{"line":19,"column":95}},"line":19},"1":{"name":"parse","decl":{"start":{"line":21,"column":9},"end":{"line":21,"column":14}},"loc":{"start":{"line":21,"column":24},"end":{"line":32,"column":1}},"line":21},"2":{"name":"(anonymous_2)","decl":{"start":{"line":28,"column":41},"end":{"line":28,"column":42}},"loc":{"start":{"line":28,"column":46},"end":{"line":28,"column":87}},"line":28},"3":{"name":"(anonymous_3)","decl":{"start":{"line":28,"column":96},"end":{"line":28,"column":97}},"loc":{"start":{"line":28,"column":101},"end":{"line":28,"column":126}},"line":28},"4":{"name":"dump","decl":{"start":{"line":34,"column":15},"end":{"line":34,"column":19}},"loc":{"start":{"line":34,"column":29},"end":{"line":49,"column":1}},"line":34},"5":{"name":"(anonymous_5)","decl":{"start":{"line":44,"column":26},"end":{"line":44,"column":27}},"loc":{"start":{"line":44,"column":44},"end":{"line":48,"column":3}},"line":44}},"branchMap":{"0":{"loc":{"start":{"line":19,"column":46},"end":{"line":19,"column":92}},"type":"cond-expr","locations":[{"start":{"line":19,"column":70},"end":{"line":19,"column":73}},{"start":{"line":19,"column":76},"end":{"line":19,"column":92}}],"line":19},"1":{"loc":{"start":{"line":19,"column":46},"end":{"line":19,"column":67}},"type":"binary-expr","locations":[{"start":{"line":19,"column":46},"end":{"line":19,"column":49}},{"start":{"line":19,"column":53},"end":{"line":19,"column":67}}],"line":19},"2":{"loc":{"start":{"line":24,"column":2},"end":{"line":26,"column":4}},"type":"if","locations":[{"start":{"line":24,"column":2},"end":{"line":26,"column":4}},{"start":{"line":24,"column":2},"end":{"line":26,"column":4}}],"line":24},"3":{"loc":{"start":{"line":38,"column":2},"end":{"line":38,"column":31}},"type":"if","locations":[{"start":{"line":38,"column":2},"end":{"line":38,"column":31}},{"start":{"line":38,"column":2},"end":{"line":38,"column":31}}],"line":38}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":2,"8":48,"9":48,"10":45,"11":2,"12":2,"13":2,"14":2,"15":2,"16":2,"17":2,"18":0,"19":2,"20":2,"21":2,"22":2,"23":2,"24":1},"f":{"0":2,"1":48,"2":2,"3":2,"4":2,"5":2},"b":{"0":[0,2],"1":[2,2],"2":[45,2],"3":[0,2]},"inputSourceMap":{"version":3,"sources":["resourceServers.js"],"names":["parse","context","resourceServersFolder","path","join","filePath","constants","RESOURCE_SERVERS_DIRECTORY","resourceServers","undefined","foundFiles","map","f","mappings","filter","p","Object","keys","length","dump","assets","fs","ensureDirSync","forEach","resourceServer","resourceServerFile","name"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;AACA;;;;AAIA,SAASA,KAAT,CAAeC,OAAf,EAAwB;AACtB,QAAMC,qBAAqB,GAAGC,eAAKC,IAAL,CAAUH,OAAO,CAACI,QAAlB,EAA4BC,iBAAUC,0BAAtC,CAA9B;;AACA,MAAI,CAAC,4BAAgBL,qBAAhB,CAAL,EAA6C,OAAO;AAAEM,IAAAA,eAAe,EAAEC;AAAnB,GAAP;AAE7C,QAAMC,UAAU,GAAG,qBAASR,qBAAT,EAAgC,CAAE,OAAF,CAAhC,CAAnB;AAEA,QAAMM,eAAe,GAAGE,UAAU,CAACC,GAAX,CAAgBC,CAAD,IAAO,qBAASA,CAAT,EAAYX,OAAO,CAACY,QAApB,CAAtB,EACrBC,MADqB,CACbC,CAAD,IAAOC,MAAM,CAACC,IAAP,CAAYF,CAAZ,EAAeG,MAAf,GAAwB,CADjB,CAAxB;AAGA,SAAO;AACLV,IAAAA;AADK,GAAP;AAGD;;AAED,eAAeW,IAAf,CAAoBlB,OAApB,EAA6B;AAC3B,QAAM;AAAEO,IAAAA;AAAF,MAAsBP,OAAO,CAACmB,MAApC;AAEA,MAAI,CAACZ,eAAL,EAAsB;;AAEtB,QAAMN,qBAAqB,GAAGC,eAAKC,IAAL,CAAUH,OAAO,CAACI,QAAlB,EAA4BC,iBAAUC,0BAAtC,CAA9B;;AACAc,oBAAGC,aAAH,CAAiBpB,qBAAjB;;AAEAM,EAAAA,eAAe,CAACe,OAAhB,CAAyBC,cAAD,IAAoB;AAC1C,UAAMC,kBAAkB,GAAGtB,eAAKC,IAAL,CAAUF,qBAAV,EAAiC,qBAAU,GAAEsB,cAAc,CAACE,IAAK,OAAhC,CAAjC,CAA3B;;AACA,yBAASD,kBAAT,EAA6BD,cAA7B;AACD,GAHD;AAID;;kBAEc;AACbxB,EAAAA,KADa;AAEbmB,EAAAA;AAFa,C","sourceRoot":"/home/circleci/repo/src/context/directory/handlers/","sourcesContent":["import fs from 'fs-extra';\nimport path from 'path';\nimport { constants } from '../../../tools';\nimport {\n  getFiles, existsMustBeDir, dumpJSON, loadJSON, sanitize\n} from '../../../utils';\n\nfunction parse(context) {\n  const resourceServersFolder = path.join(context.filePath, constants.RESOURCE_SERVERS_DIRECTORY);\n  if (!existsMustBeDir(resourceServersFolder)) return { resourceServers: undefined }; // Skip\n\n  const foundFiles = getFiles(resourceServersFolder, [ '.json' ]);\n\n  const resourceServers = foundFiles.map((f) => loadJSON(f, context.mappings))\n    .filter((p) => Object.keys(p).length > 0); // Filter out empty resourceServers\n\n  return {\n    resourceServers\n  };\n}\n\nasync function dump(context) {\n  const { resourceServers } = context.assets;\n\n  if (!resourceServers) return; // Skip, nothing to dump\n\n  const resourceServersFolder = path.join(context.filePath, constants.RESOURCE_SERVERS_DIRECTORY);\n  fs.ensureDirSync(resourceServersFolder);\n\n  resourceServers.forEach((resourceServer) => {\n    const resourceServerFile = path.join(resourceServersFolder, sanitize(`${resourceServer.name}.json`));\n    dumpJSON(resourceServerFile, resourceServer);\n  });\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"d377f12210a8c6eedd4e485151ae0275e57ab9f0","contentHash":"a5ae1891704ff56cf21441284b94bf43eb192b72f5dc85baef596109da9f6509"},"/home/circleci/repo/src/context/directory/handlers/guardianFactors.js":{"path":"/home/circleci/repo/src/context/directory/handlers/guardianFactors.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":15},"end":{"line":7,"column":34}},"2":{"start":{"line":9,"column":16},"end":{"line":9,"column":48}},"3":{"start":{"line":11,"column":12},"end":{"line":11,"column":27}},"4":{"start":{"line":13,"column":13},"end":{"line":13,"column":42}},"5":{"start":{"line":15,"column":13},"end":{"line":15,"column":38}},"6":{"start":{"line":17,"column":13},"end":{"line":17,"column":38}},"7":{"start":{"line":19,"column":39},"end":{"line":19,"column":93}},"8":{"start":{"line":22,"column":24},"end":{"line":22,"column":143}},"9":{"start":{"line":24,"column":2},"end":{"line":26,"column":4}},"10":{"start":{"line":24,"column":51},"end":{"line":26,"column":4}},"11":{"start":{"line":27,"column":21},"end":{"line":27,"column":67}},"12":{"start":{"line":28,"column":26},"end":{"line":28,"column":127}},"13":{"start":{"line":28,"column":46},"end":{"line":28,"column":87}},"14":{"start":{"line":28,"column":101},"end":{"line":28,"column":126}},"15":{"start":{"line":29,"column":2},"end":{"line":31,"column":4}},"16":{"start":{"line":37,"column":6},"end":{"line":37,"column":20}},"17":{"start":{"line":38,"column":2},"end":{"line":38,"column":31}},"18":{"start":{"line":38,"column":24},"end":{"line":38,"column":31}},"19":{"start":{"line":40,"column":24},"end":{"line":40,"column":143}},"20":{"start":{"line":42,"column":2},"end":{"line":42,"column":49}},"21":{"start":{"line":44,"column":2},"end":{"line":48,"column":5}},"22":{"start":{"line":45,"column":23},"end":{"line":45,"column":80}},"23":{"start":{"line":47,"column":4},"end":{"line":47,"column":45}},"24":{"start":{"line":51,"column":0},"end":{"line":54,"column":2}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":19,"column":9},"end":{"line":19,"column":31}},"loc":{"start":{"line":19,"column":37},"end":{"line":19,"column":95}},"line":19},"1":{"name":"parse","decl":{"start":{"line":21,"column":9},"end":{"line":21,"column":14}},"loc":{"start":{"line":21,"column":24},"end":{"line":32,"column":1}},"line":21},"2":{"name":"(anonymous_2)","decl":{"start":{"line":28,"column":41},"end":{"line":28,"column":42}},"loc":{"start":{"line":28,"column":46},"end":{"line":28,"column":87}},"line":28},"3":{"name":"(anonymous_3)","decl":{"start":{"line":28,"column":96},"end":{"line":28,"column":97}},"loc":{"start":{"line":28,"column":101},"end":{"line":28,"column":126}},"line":28},"4":{"name":"dump","decl":{"start":{"line":34,"column":15},"end":{"line":34,"column":19}},"loc":{"start":{"line":34,"column":29},"end":{"line":49,"column":1}},"line":34},"5":{"name":"(anonymous_5)","decl":{"start":{"line":44,"column":26},"end":{"line":44,"column":27}},"loc":{"start":{"line":44,"column":36},"end":{"line":48,"column":3}},"line":44}},"branchMap":{"0":{"loc":{"start":{"line":19,"column":46},"end":{"line":19,"column":92}},"type":"cond-expr","locations":[{"start":{"line":19,"column":70},"end":{"line":19,"column":73}},{"start":{"line":19,"column":76},"end":{"line":19,"column":92}}],"line":19},"1":{"loc":{"start":{"line":19,"column":46},"end":{"line":19,"column":67}},"type":"binary-expr","locations":[{"start":{"line":19,"column":46},"end":{"line":19,"column":49}},{"start":{"line":19,"column":53},"end":{"line":19,"column":67}}],"line":19},"2":{"loc":{"start":{"line":24,"column":2},"end":{"line":26,"column":4}},"type":"if","locations":[{"start":{"line":24,"column":2},"end":{"line":26,"column":4}},{"start":{"line":24,"column":2},"end":{"line":26,"column":4}}],"line":24},"3":{"loc":{"start":{"line":38,"column":2},"end":{"line":38,"column":31}},"type":"if","locations":[{"start":{"line":38,"column":2},"end":{"line":38,"column":31}},{"start":{"line":38,"column":2},"end":{"line":38,"column":31}}],"line":38}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":2,"8":43,"9":43,"10":42,"11":1,"12":1,"13":2,"14":2,"15":1,"16":1,"17":1,"18":0,"19":1,"20":1,"21":1,"22":2,"23":2,"24":1},"f":{"0":2,"1":43,"2":2,"3":2,"4":1,"5":2},"b":{"0":[0,2],"1":[2,2],"2":[42,1],"3":[0,1]},"inputSourceMap":{"version":3,"sources":["guardianFactors.js"],"names":["parse","context","factorsFolder","path","join","filePath","constants","GUARDIAN_DIRECTORY","GUARDIAN_FACTORS_DIRECTORY","guardianFactors","undefined","foundFiles","map","f","mappings","filter","p","Object","keys","length","dump","assets","fs","ensureDirSync","forEach","factor","factorFile","name"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;AAEA;;;;AAIA,SAASA,KAAT,CAAeC,OAAf,EAAwB;AACtB,QAAMC,aAAa,GAAGC,eAAKC,IAAL,CAAUH,OAAO,CAACI,QAAlB,EAA4BC,iBAAUC,kBAAtC,EAA0DD,iBAAUE,0BAApE,CAAtB;;AACA,MAAI,CAAC,4BAAgBN,aAAhB,CAAL,EAAqC,OAAO;AAAEO,IAAAA,eAAe,EAAEC;AAAnB,GAAP;AAErC,QAAMC,UAAU,GAAG,qBAAST,aAAT,EAAwB,CAAE,OAAF,CAAxB,CAAnB;AAEA,QAAMO,eAAe,GAAGE,UAAU,CAACC,GAAX,CAAgBC,CAAD,IAAO,qBAASA,CAAT,EAAYZ,OAAO,CAACa,QAApB,CAAtB,EACrBC,MADqB,CACbC,CAAD,IAAOC,MAAM,CAACC,IAAP,CAAYF,CAAZ,EAAeG,MAAf,GAAwB,CADjB,CAAxB;AAGA,SAAO;AACLV,IAAAA;AADK,GAAP;AAGD;;AAED,eAAeW,IAAf,CAAoBnB,OAApB,EAA6B;AAC3B,QAAM;AAAEQ,IAAAA;AAAF,MAAsBR,OAAO,CAACoB,MAApC;AAEA,MAAI,CAACZ,eAAL,EAAsB;;AAEtB,QAAMP,aAAa,GAAGC,eAAKC,IAAL,CAAUH,OAAO,CAACI,QAAlB,EAA4BC,iBAAUC,kBAAtC,EAA0DD,iBAAUE,0BAApE,CAAtB;;AACAc,oBAAGC,aAAH,CAAiBrB,aAAjB;;AAEAO,EAAAA,eAAe,CAACe,OAAhB,CAAyBC,MAAD,IAAY;AAClC,UAAMC,UAAU,GAAGvB,eAAKC,IAAL,CAAUF,aAAV,EAA0B,GAAEuB,MAAM,CAACE,IAAK,OAAxC,CAAnB;;AACA,yBAASD,UAAT,EAAqBD,MAArB;AACD,GAHD;AAID;;kBAEc;AACbzB,EAAAA,KADa;AAEboB,EAAAA;AAFa,C","sourceRoot":"/home/circleci/repo/src/context/directory/handlers/","sourcesContent":["import fs from 'fs-extra';\nimport path from 'path';\nimport { constants } from '../../../tools';\n\nimport {\n  getFiles, existsMustBeDir, dumpJSON, loadJSON\n} from '../../../utils';\n\nfunction parse(context) {\n  const factorsFolder = path.join(context.filePath, constants.GUARDIAN_DIRECTORY, constants.GUARDIAN_FACTORS_DIRECTORY);\n  if (!existsMustBeDir(factorsFolder)) return { guardianFactors: undefined }; // Skip\n\n  const foundFiles = getFiles(factorsFolder, [ '.json' ]);\n\n  const guardianFactors = foundFiles.map((f) => loadJSON(f, context.mappings))\n    .filter((p) => Object.keys(p).length > 0); // Filter out empty guardianFactors\n\n  return {\n    guardianFactors\n  };\n}\n\nasync function dump(context) {\n  const { guardianFactors } = context.assets;\n\n  if (!guardianFactors) return; // Skip, nothing to dump\n\n  const factorsFolder = path.join(context.filePath, constants.GUARDIAN_DIRECTORY, constants.GUARDIAN_FACTORS_DIRECTORY);\n  fs.ensureDirSync(factorsFolder);\n\n  guardianFactors.forEach((factor) => {\n    const factorFile = path.join(factorsFolder, `${factor.name}.json`);\n    dumpJSON(factorFile, factor);\n  });\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"c3bd47ce1b8b9901852841b772fe4a83bb91871f","contentHash":"c5a1fbe81cd79c982f92f469a86cb6b69b17e611b86e2d255830432e16ed8278"},"/home/circleci/repo/src/context/directory/handlers/guardianFactorProviders.js":{"path":"/home/circleci/repo/src/context/directory/handlers/guardianFactorProviders.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":15},"end":{"line":7,"column":34}},"2":{"start":{"line":9,"column":16},"end":{"line":9,"column":48}},"3":{"start":{"line":11,"column":12},"end":{"line":11,"column":27}},"4":{"start":{"line":13,"column":13},"end":{"line":13,"column":42}},"5":{"start":{"line":15,"column":13},"end":{"line":15,"column":38}},"6":{"start":{"line":17,"column":13},"end":{"line":17,"column":38}},"7":{"start":{"line":19,"column":39},"end":{"line":19,"column":93}},"8":{"start":{"line":22,"column":32},"end":{"line":22,"column":153}},"9":{"start":{"line":24,"column":2},"end":{"line":26,"column":4}},"10":{"start":{"line":24,"column":59},"end":{"line":26,"column":4}},"11":{"start":{"line":27,"column":21},"end":{"line":27,"column":75}},"12":{"start":{"line":28,"column":34},"end":{"line":28,"column":135}},"13":{"start":{"line":28,"column":54},"end":{"line":28,"column":95}},"14":{"start":{"line":28,"column":109},"end":{"line":28,"column":134}},"15":{"start":{"line":29,"column":2},"end":{"line":31,"column":4}},"16":{"start":{"line":37,"column":6},"end":{"line":37,"column":20}},"17":{"start":{"line":38,"column":2},"end":{"line":38,"column":39}},"18":{"start":{"line":38,"column":32},"end":{"line":38,"column":39}},"19":{"start":{"line":40,"column":32},"end":{"line":40,"column":153}},"20":{"start":{"line":42,"column":2},"end":{"line":42,"column":57}},"21":{"start":{"line":44,"column":2},"end":{"line":48,"column":5}},"22":{"start":{"line":45,"column":31},"end":{"line":45,"column":131}},"23":{"start":{"line":47,"column":4},"end":{"line":47,"column":61}},"24":{"start":{"line":51,"column":0},"end":{"line":54,"column":2}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":19,"column":9},"end":{"line":19,"column":31}},"loc":{"start":{"line":19,"column":37},"end":{"line":19,"column":95}},"line":19},"1":{"name":"parse","decl":{"start":{"line":21,"column":9},"end":{"line":21,"column":14}},"loc":{"start":{"line":21,"column":24},"end":{"line":32,"column":1}},"line":21},"2":{"name":"(anonymous_2)","decl":{"start":{"line":28,"column":49},"end":{"line":28,"column":50}},"loc":{"start":{"line":28,"column":54},"end":{"line":28,"column":95}},"line":28},"3":{"name":"(anonymous_3)","decl":{"start":{"line":28,"column":104},"end":{"line":28,"column":105}},"loc":{"start":{"line":28,"column":109},"end":{"line":28,"column":134}},"line":28},"4":{"name":"dump","decl":{"start":{"line":34,"column":15},"end":{"line":34,"column":19}},"loc":{"start":{"line":34,"column":29},"end":{"line":49,"column":1}},"line":34},"5":{"name":"(anonymous_5)","decl":{"start":{"line":44,"column":34},"end":{"line":44,"column":35}},"loc":{"start":{"line":44,"column":52},"end":{"line":48,"column":3}},"line":44}},"branchMap":{"0":{"loc":{"start":{"line":19,"column":46},"end":{"line":19,"column":92}},"type":"cond-expr","locations":[{"start":{"line":19,"column":70},"end":{"line":19,"column":73}},{"start":{"line":19,"column":76},"end":{"line":19,"column":92}}],"line":19},"1":{"loc":{"start":{"line":19,"column":46},"end":{"line":19,"column":67}},"type":"binary-expr","locations":[{"start":{"line":19,"column":46},"end":{"line":19,"column":49}},{"start":{"line":19,"column":53},"end":{"line":19,"column":67}}],"line":19},"2":{"loc":{"start":{"line":24,"column":2},"end":{"line":26,"column":4}},"type":"if","locations":[{"start":{"line":24,"column":2},"end":{"line":26,"column":4}},{"start":{"line":24,"column":2},"end":{"line":26,"column":4}}],"line":24},"3":{"loc":{"start":{"line":38,"column":2},"end":{"line":38,"column":39}},"type":"if","locations":[{"start":{"line":38,"column":2},"end":{"line":38,"column":39}},{"start":{"line":38,"column":2},"end":{"line":38,"column":39}}],"line":38}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":2,"8":43,"9":43,"10":42,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":0,"19":1,"20":1,"21":1,"22":1,"23":1,"24":1},"f":{"0":2,"1":43,"2":1,"3":1,"4":1,"5":1},"b":{"0":[0,2],"1":[2,2],"2":[42,1],"3":[0,1]},"inputSourceMap":{"version":3,"sources":["guardianFactorProviders.js"],"names":["parse","context","factorProvidersFolder","path","join","filePath","constants","GUARDIAN_DIRECTORY","GUARDIAN_PROVIDERS_DIRECTORY","guardianFactorProviders","undefined","foundFiles","map","f","mappings","filter","p","Object","keys","length","dump","assets","fs","ensureDirSync","forEach","factorProvider","factorProviderFile","name","provider"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;AAEA;;;;AAIA,SAASA,KAAT,CAAeC,OAAf,EAAwB;AACtB,QAAMC,qBAAqB,GAAGC,eAAKC,IAAL,CAAUH,OAAO,CAACI,QAAlB,EAA4BC,iBAAUC,kBAAtC,EAA0DD,iBAAUE,4BAApE,CAA9B;;AACA,MAAI,CAAC,4BAAgBN,qBAAhB,CAAL,EAA6C,OAAO;AAAEO,IAAAA,uBAAuB,EAAEC;AAA3B,GAAP;AAE7C,QAAMC,UAAU,GAAG,qBAAST,qBAAT,EAAgC,CAAE,OAAF,CAAhC,CAAnB;AAEA,QAAMO,uBAAuB,GAAGE,UAAU,CAACC,GAAX,CAAgBC,CAAD,IAAO,qBAASA,CAAT,EAAYZ,OAAO,CAACa,QAApB,CAAtB,EAC7BC,MAD6B,CACrBC,CAAD,IAAOC,MAAM,CAACC,IAAP,CAAYF,CAAZ,EAAeG,MAAf,GAAwB,CADT,CAAhC;AAGA,SAAO;AACLV,IAAAA;AADK,GAAP;AAGD;;AAED,eAAeW,IAAf,CAAoBnB,OAApB,EAA6B;AAC3B,QAAM;AAAEQ,IAAAA;AAAF,MAA8BR,OAAO,CAACoB,MAA5C;AAEA,MAAI,CAACZ,uBAAL,EAA8B;;AAE9B,QAAMP,qBAAqB,GAAGC,eAAKC,IAAL,CAAUH,OAAO,CAACI,QAAlB,EAA4BC,iBAAUC,kBAAtC,EAA0DD,iBAAUE,4BAApE,CAA9B;;AACAc,oBAAGC,aAAH,CAAiBrB,qBAAjB;;AAEAO,EAAAA,uBAAuB,CAACe,OAAxB,CAAiCC,cAAD,IAAoB;AAClD,UAAMC,kBAAkB,GAAGvB,eAAKC,IAAL,CAAUF,qBAAV,EAAkC,GAAEuB,cAAc,CAACE,IAAK,IAAGF,cAAc,CAACG,QAAS,OAAnF,CAA3B;;AACA,yBAASF,kBAAT,EAA6BD,cAA7B;AACD,GAHD;AAID;;kBAEc;AACbzB,EAAAA,KADa;AAEboB,EAAAA;AAFa,C","sourceRoot":"/home/circleci/repo/src/context/directory/handlers/","sourcesContent":["import fs from 'fs-extra';\nimport path from 'path';\nimport { constants } from '../../../tools';\n\nimport {\n  getFiles, existsMustBeDir, dumpJSON, loadJSON\n} from '../../../utils';\n\nfunction parse(context) {\n  const factorProvidersFolder = path.join(context.filePath, constants.GUARDIAN_DIRECTORY, constants.GUARDIAN_PROVIDERS_DIRECTORY);\n  if (!existsMustBeDir(factorProvidersFolder)) return { guardianFactorProviders: undefined }; // Skip\n\n  const foundFiles = getFiles(factorProvidersFolder, [ '.json' ]);\n\n  const guardianFactorProviders = foundFiles.map((f) => loadJSON(f, context.mappings))\n    .filter((p) => Object.keys(p).length > 0); // Filter out empty factorProvidersFolder\n\n  return {\n    guardianFactorProviders\n  };\n}\n\nasync function dump(context) {\n  const { guardianFactorProviders } = context.assets;\n\n  if (!guardianFactorProviders) return; // Skip, nothing to dump\n\n  const factorProvidersFolder = path.join(context.filePath, constants.GUARDIAN_DIRECTORY, constants.GUARDIAN_PROVIDERS_DIRECTORY);\n  fs.ensureDirSync(factorProvidersFolder);\n\n  guardianFactorProviders.forEach((factorProvider) => {\n    const factorProviderFile = path.join(factorProvidersFolder, `${factorProvider.name}-${factorProvider.provider}.json`);\n    dumpJSON(factorProviderFile, factorProvider);\n  });\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"630e1c59b1445cf423aa2316233c40a8529c31ec","contentHash":"19f4eed058682ad6700715c53b6bc57cca2dee39e8773b6a3bb63da14ba63a57"},"/home/circleci/repo/src/context/directory/handlers/guardianFactorTemplates.js":{"path":"/home/circleci/repo/src/context/directory/handlers/guardianFactorTemplates.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":15},"end":{"line":7,"column":34}},"2":{"start":{"line":9,"column":16},"end":{"line":9,"column":48}},"3":{"start":{"line":11,"column":12},"end":{"line":11,"column":27}},"4":{"start":{"line":13,"column":13},"end":{"line":13,"column":42}},"5":{"start":{"line":15,"column":13},"end":{"line":15,"column":38}},"6":{"start":{"line":17,"column":13},"end":{"line":17,"column":38}},"7":{"start":{"line":19,"column":39},"end":{"line":19,"column":93}},"8":{"start":{"line":22,"column":32},"end":{"line":22,"column":153}},"9":{"start":{"line":24,"column":2},"end":{"line":26,"column":4}},"10":{"start":{"line":24,"column":59},"end":{"line":26,"column":4}},"11":{"start":{"line":27,"column":21},"end":{"line":27,"column":75}},"12":{"start":{"line":28,"column":34},"end":{"line":28,"column":135}},"13":{"start":{"line":28,"column":54},"end":{"line":28,"column":95}},"14":{"start":{"line":28,"column":109},"end":{"line":28,"column":134}},"15":{"start":{"line":29,"column":2},"end":{"line":31,"column":4}},"16":{"start":{"line":37,"column":6},"end":{"line":37,"column":20}},"17":{"start":{"line":38,"column":2},"end":{"line":38,"column":39}},"18":{"start":{"line":38,"column":32},"end":{"line":38,"column":39}},"19":{"start":{"line":40,"column":32},"end":{"line":40,"column":153}},"20":{"start":{"line":42,"column":2},"end":{"line":42,"column":57}},"21":{"start":{"line":44,"column":2},"end":{"line":48,"column":5}},"22":{"start":{"line":45,"column":32},"end":{"line":45,"column":106}},"23":{"start":{"line":47,"column":4},"end":{"line":47,"column":63}},"24":{"start":{"line":51,"column":0},"end":{"line":54,"column":2}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":19,"column":9},"end":{"line":19,"column":31}},"loc":{"start":{"line":19,"column":37},"end":{"line":19,"column":95}},"line":19},"1":{"name":"parse","decl":{"start":{"line":21,"column":9},"end":{"line":21,"column":14}},"loc":{"start":{"line":21,"column":24},"end":{"line":32,"column":1}},"line":21},"2":{"name":"(anonymous_2)","decl":{"start":{"line":28,"column":49},"end":{"line":28,"column":50}},"loc":{"start":{"line":28,"column":54},"end":{"line":28,"column":95}},"line":28},"3":{"name":"(anonymous_3)","decl":{"start":{"line":28,"column":104},"end":{"line":28,"column":105}},"loc":{"start":{"line":28,"column":109},"end":{"line":28,"column":134}},"line":28},"4":{"name":"dump","decl":{"start":{"line":34,"column":15},"end":{"line":34,"column":19}},"loc":{"start":{"line":34,"column":29},"end":{"line":49,"column":1}},"line":34},"5":{"name":"(anonymous_5)","decl":{"start":{"line":44,"column":34},"end":{"line":44,"column":35}},"loc":{"start":{"line":44,"column":53},"end":{"line":48,"column":3}},"line":44}},"branchMap":{"0":{"loc":{"start":{"line":19,"column":46},"end":{"line":19,"column":92}},"type":"cond-expr","locations":[{"start":{"line":19,"column":70},"end":{"line":19,"column":73}},{"start":{"line":19,"column":76},"end":{"line":19,"column":92}}],"line":19},"1":{"loc":{"start":{"line":19,"column":46},"end":{"line":19,"column":67}},"type":"binary-expr","locations":[{"start":{"line":19,"column":46},"end":{"line":19,"column":49}},{"start":{"line":19,"column":53},"end":{"line":19,"column":67}}],"line":19},"2":{"loc":{"start":{"line":24,"column":2},"end":{"line":26,"column":4}},"type":"if","locations":[{"start":{"line":24,"column":2},"end":{"line":26,"column":4}},{"start":{"line":24,"column":2},"end":{"line":26,"column":4}}],"line":24},"3":{"loc":{"start":{"line":38,"column":2},"end":{"line":38,"column":39}},"type":"if","locations":[{"start":{"line":38,"column":2},"end":{"line":38,"column":39}},{"start":{"line":38,"column":2},"end":{"line":38,"column":39}}],"line":38}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":2,"8":43,"9":43,"10":42,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":0,"19":1,"20":1,"21":1,"22":1,"23":1,"24":1},"f":{"0":2,"1":43,"2":1,"3":1,"4":1,"5":1},"b":{"0":[0,2],"1":[2,2],"2":[42,1],"3":[0,1]},"inputSourceMap":{"version":3,"sources":["guardianFactorTemplates.js"],"names":["parse","context","factorTemplatesFolder","path","join","filePath","constants","GUARDIAN_DIRECTORY","GUARDIAN_TEMPLATES_DIRECTORY","guardianFactorTemplates","undefined","foundFiles","map","f","mappings","filter","p","Object","keys","length","dump","assets","fs","ensureDirSync","forEach","factorTemplates","factorTemplatesFile","name"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;AAEA;;;;AAIA,SAASA,KAAT,CAAeC,OAAf,EAAwB;AACtB,QAAMC,qBAAqB,GAAGC,eAAKC,IAAL,CAAUH,OAAO,CAACI,QAAlB,EAA4BC,iBAAUC,kBAAtC,EAA0DD,iBAAUE,4BAApE,CAA9B;;AACA,MAAI,CAAC,4BAAgBN,qBAAhB,CAAL,EAA6C,OAAO;AAAEO,IAAAA,uBAAuB,EAAEC;AAA3B,GAAP;AAE7C,QAAMC,UAAU,GAAG,qBAAST,qBAAT,EAAgC,CAAE,OAAF,CAAhC,CAAnB;AAEA,QAAMO,uBAAuB,GAAGE,UAAU,CAACC,GAAX,CAAgBC,CAAD,IAAO,qBAASA,CAAT,EAAYZ,OAAO,CAACa,QAApB,CAAtB,EAC7BC,MAD6B,CACrBC,CAAD,IAAOC,MAAM,CAACC,IAAP,CAAYF,CAAZ,EAAeG,MAAf,GAAwB,CADT,CAAhC;AAGA,SAAO;AACLV,IAAAA;AADK,GAAP;AAGD;;AAED,eAAeW,IAAf,CAAoBnB,OAApB,EAA6B;AAC3B,QAAM;AAAEQ,IAAAA;AAAF,MAA8BR,OAAO,CAACoB,MAA5C;AAEA,MAAI,CAACZ,uBAAL,EAA8B;;AAE9B,QAAMP,qBAAqB,GAAGC,eAAKC,IAAL,CAAUH,OAAO,CAACI,QAAlB,EAA4BC,iBAAUC,kBAAtC,EAA0DD,iBAAUE,4BAApE,CAA9B;;AACAc,oBAAGC,aAAH,CAAiBrB,qBAAjB;;AAEAO,EAAAA,uBAAuB,CAACe,OAAxB,CAAiCC,eAAD,IAAqB;AACnD,UAAMC,mBAAmB,GAAGvB,eAAKC,IAAL,CAAUF,qBAAV,EAAkC,GAAEuB,eAAe,CAACE,IAAK,OAAzD,CAA5B;;AACA,yBAASD,mBAAT,EAA8BD,eAA9B;AACD,GAHD;AAID;;kBAEc;AACbzB,EAAAA,KADa;AAEboB,EAAAA;AAFa,C","sourceRoot":"/home/circleci/repo/src/context/directory/handlers/","sourcesContent":["import fs from 'fs-extra';\nimport path from 'path';\nimport { constants } from '../../../tools';\n\nimport {\n  getFiles, existsMustBeDir, dumpJSON, loadJSON\n} from '../../../utils';\n\nfunction parse(context) {\n  const factorTemplatesFolder = path.join(context.filePath, constants.GUARDIAN_DIRECTORY, constants.GUARDIAN_TEMPLATES_DIRECTORY);\n  if (!existsMustBeDir(factorTemplatesFolder)) return { guardianFactorTemplates: undefined }; // Skip\n\n  const foundFiles = getFiles(factorTemplatesFolder, [ '.json' ]);\n\n  const guardianFactorTemplates = foundFiles.map((f) => loadJSON(f, context.mappings))\n    .filter((p) => Object.keys(p).length > 0); // Filter out empty guardianFactorTemplates\n\n  return {\n    guardianFactorTemplates\n  };\n}\n\nasync function dump(context) {\n  const { guardianFactorTemplates } = context.assets;\n\n  if (!guardianFactorTemplates) return; // Skip, nothing to dump\n\n  const factorTemplatesFolder = path.join(context.filePath, constants.GUARDIAN_DIRECTORY, constants.GUARDIAN_TEMPLATES_DIRECTORY);\n  fs.ensureDirSync(factorTemplatesFolder);\n\n  guardianFactorTemplates.forEach((factorTemplates) => {\n    const factorTemplatesFile = path.join(factorTemplatesFolder, `${factorTemplates.name}.json`);\n    dumpJSON(factorTemplatesFile, factorTemplates);\n  });\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"630e33bb4b8200d9f62e748cc0613b73622ed791","contentHash":"a931b75ec03291662453bf489b6216f702462d18354d7c14c84770566b07c9e9"},"/home/circleci/repo/src/context/directory/handlers/guardianPhoneFactorMessageTypes.js":{"path":"/home/circleci/repo/src/context/directory/handlers/guardianPhoneFactorMessageTypes.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":15},"end":{"line":7,"column":34}},"2":{"start":{"line":9,"column":16},"end":{"line":9,"column":48}},"3":{"start":{"line":11,"column":12},"end":{"line":11,"column":27}},"4":{"start":{"line":13,"column":13},"end":{"line":13,"column":42}},"5":{"start":{"line":15,"column":13},"end":{"line":15,"column":38}},"6":{"start":{"line":17,"column":13},"end":{"line":17,"column":38}},"7":{"start":{"line":19,"column":39},"end":{"line":19,"column":93}},"8":{"start":{"line":22,"column":25},"end":{"line":22,"column":99}},"9":{"start":{"line":24,"column":2},"end":{"line":24,"column":62}},"10":{"start":{"line":24,"column":52},"end":{"line":24,"column":62}},"11":{"start":{"line":26,"column":15},"end":{"line":26,"column":82}},"12":{"start":{"line":28,"column":2},"end":{"line":32,"column":3}},"13":{"start":{"line":29,"column":4},"end":{"line":31,"column":6}},"14":{"start":{"line":34,"column":2},"end":{"line":34,"column":12}},"15":{"start":{"line":40,"column":6},"end":{"line":40,"column":20}},"16":{"start":{"line":41,"column":2},"end":{"line":41,"column":47}},"17":{"start":{"line":41,"column":40},"end":{"line":41,"column":47}},"18":{"start":{"line":43,"column":25},"end":{"line":43,"column":99}},"19":{"start":{"line":45,"column":2},"end":{"line":45,"column":50}},"20":{"start":{"line":47,"column":15},"end":{"line":47,"column":82}},"21":{"start":{"line":49,"column":2},"end":{"line":49,"column":62}},"22":{"start":{"line":52,"column":0},"end":{"line":55,"column":2}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":19,"column":9},"end":{"line":19,"column":31}},"loc":{"start":{"line":19,"column":37},"end":{"line":19,"column":95}},"line":19},"1":{"name":"parse","decl":{"start":{"line":21,"column":9},"end":{"line":21,"column":14}},"loc":{"start":{"line":21,"column":24},"end":{"line":35,"column":1}},"line":21},"2":{"name":"dump","decl":{"start":{"line":37,"column":15},"end":{"line":37,"column":19}},"loc":{"start":{"line":37,"column":29},"end":{"line":50,"column":1}},"line":37}},"branchMap":{"0":{"loc":{"start":{"line":19,"column":46},"end":{"line":19,"column":92}},"type":"cond-expr","locations":[{"start":{"line":19,"column":70},"end":{"line":19,"column":73}},{"start":{"line":19,"column":76},"end":{"line":19,"column":92}}],"line":19},"1":{"loc":{"start":{"line":19,"column":46},"end":{"line":19,"column":67}},"type":"binary-expr","locations":[{"start":{"line":19,"column":46},"end":{"line":19,"column":49}},{"start":{"line":19,"column":53},"end":{"line":19,"column":67}}],"line":19},"2":{"loc":{"start":{"line":24,"column":2},"end":{"line":24,"column":62}},"type":"if","locations":[{"start":{"line":24,"column":2},"end":{"line":24,"column":62}},{"start":{"line":24,"column":2},"end":{"line":24,"column":62}}],"line":24},"3":{"loc":{"start":{"line":28,"column":2},"end":{"line":32,"column":3}},"type":"if","locations":[{"start":{"line":28,"column":2},"end":{"line":32,"column":3}},{"start":{"line":28,"column":2},"end":{"line":32,"column":3}}],"line":28},"4":{"loc":{"start":{"line":41,"column":2},"end":{"line":41,"column":47}},"type":"if","locations":[{"start":{"line":41,"column":2},"end":{"line":41,"column":47}},{"start":{"line":41,"column":2},"end":{"line":41,"column":47}}],"line":41}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":2,"8":43,"9":43,"10":37,"11":6,"12":6,"13":1,"14":5,"15":1,"16":1,"17":0,"18":1,"19":1,"20":1,"21":1,"22":1},"f":{"0":2,"1":43,"2":1},"b":{"0":[0,2],"1":[2,2],"2":[37,6],"3":[1,5],"4":[0,1]},"inputSourceMap":{"version":3,"sources":["guardianPhoneFactorMessageTypes.js"],"names":["parse","context","guardianFolder","path","join","filePath","constants","GUARDIAN_DIRECTORY","file","guardianPhoneFactorMessageTypes","mappings","dump","assets","fs","ensureDirSync"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;AACA;;;;AAIA,SAASA,KAAT,CAAeC,OAAf,EAAwB;AACtB,QAAMC,cAAc,GAAGC,eAAKC,IAAL,CAAUH,OAAO,CAACI,QAAlB,EAA4BC,iBAAUC,kBAAtC,CAAvB;;AACA,MAAI,CAAC,4BAAgBL,cAAhB,CAAL,EAAsC,OAAO,EAAP;;AAEtC,QAAMM,IAAI,GAAGL,eAAKC,IAAL,CAAUF,cAAV,EAA0B,8BAA1B,CAAb;;AAEA,MAAI,mBAAOM,IAAP,CAAJ,EAAkB;AAChB,WAAO;AACLC,MAAAA,+BAA+B,EAAE,qBAASD,IAAT,EAAeP,OAAO,CAACS,QAAvB;AAD5B,KAAP;AAGD;;AAED,SAAO,EAAP;AACD;;AAED,eAAeC,IAAf,CAAoBV,OAApB,EAA6B;AAC3B,QAAM;AAAEQ,IAAAA;AAAF,MAAsCR,OAAO,CAACW,MAApD;AAEA,MAAI,CAACH,+BAAL,EAAsC;;AAEtC,QAAMP,cAAc,GAAGC,eAAKC,IAAL,CAAUH,OAAO,CAACI,QAAlB,EAA4BC,iBAAUC,kBAAtC,CAAvB;;AACAM,oBAAGC,aAAH,CAAiBZ,cAAjB;;AAEA,QAAMM,IAAI,GAAGL,eAAKC,IAAL,CAAUF,cAAV,EAA0B,8BAA1B,CAAb;;AACA,uBAASM,IAAT,EAAeC,+BAAf;AACD;;kBAEc;AACbT,EAAAA,KADa;AAEbW,EAAAA;AAFa,C","sourceRoot":"/home/circleci/repo/src/context/directory/handlers/","sourcesContent":["import fs from 'fs-extra';\nimport path from 'path';\nimport { constants } from '../../../tools';\nimport {\n  existsMustBeDir, dumpJSON, loadJSON, isFile\n} from '../../../utils';\n\nfunction parse(context) {\n  const guardianFolder = path.join(context.filePath, constants.GUARDIAN_DIRECTORY);\n  if (!existsMustBeDir(guardianFolder)) return {}; // Skip\n\n  const file = path.join(guardianFolder, 'phoneFactorMessageTypes.json');\n\n  if (isFile(file)) {\n    return {\n      guardianPhoneFactorMessageTypes: loadJSON(file, context.mappings)\n    };\n  }\n\n  return {};\n}\n\nasync function dump(context) {\n  const { guardianPhoneFactorMessageTypes } = context.assets;\n\n  if (!guardianPhoneFactorMessageTypes) return; // Skip, nothing to dump\n\n  const guardianFolder = path.join(context.filePath, constants.GUARDIAN_DIRECTORY);\n  fs.ensureDirSync(guardianFolder);\n\n  const file = path.join(guardianFolder, 'phoneFactorMessageTypes.json');\n  dumpJSON(file, guardianPhoneFactorMessageTypes);\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"f896713768193106cb066da3868d895b0825f2b5","contentHash":"25259811cdd72647741af611f1620448c5e5da4800fa0a0e292b58d6dd531787"},"/home/circleci/repo/src/context/directory/handlers/guardianPhoneFactorSelectedProvider.js":{"path":"/home/circleci/repo/src/context/directory/handlers/guardianPhoneFactorSelectedProvider.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":15},"end":{"line":7,"column":34}},"2":{"start":{"line":9,"column":16},"end":{"line":9,"column":48}},"3":{"start":{"line":11,"column":12},"end":{"line":11,"column":27}},"4":{"start":{"line":13,"column":13},"end":{"line":13,"column":42}},"5":{"start":{"line":15,"column":13},"end":{"line":15,"column":38}},"6":{"start":{"line":17,"column":13},"end":{"line":17,"column":38}},"7":{"start":{"line":19,"column":39},"end":{"line":19,"column":93}},"8":{"start":{"line":22,"column":25},"end":{"line":22,"column":99}},"9":{"start":{"line":24,"column":2},"end":{"line":24,"column":62}},"10":{"start":{"line":24,"column":52},"end":{"line":24,"column":62}},"11":{"start":{"line":26,"column":15},"end":{"line":26,"column":86}},"12":{"start":{"line":28,"column":2},"end":{"line":32,"column":3}},"13":{"start":{"line":29,"column":4},"end":{"line":31,"column":6}},"14":{"start":{"line":34,"column":2},"end":{"line":34,"column":12}},"15":{"start":{"line":40,"column":6},"end":{"line":40,"column":20}},"16":{"start":{"line":41,"column":2},"end":{"line":41,"column":51}},"17":{"start":{"line":41,"column":44},"end":{"line":41,"column":51}},"18":{"start":{"line":43,"column":25},"end":{"line":43,"column":99}},"19":{"start":{"line":45,"column":2},"end":{"line":45,"column":50}},"20":{"start":{"line":47,"column":15},"end":{"line":47,"column":86}},"21":{"start":{"line":49,"column":2},"end":{"line":49,"column":66}},"22":{"start":{"line":52,"column":0},"end":{"line":55,"column":2}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":19,"column":9},"end":{"line":19,"column":31}},"loc":{"start":{"line":19,"column":37},"end":{"line":19,"column":95}},"line":19},"1":{"name":"parse","decl":{"start":{"line":21,"column":9},"end":{"line":21,"column":14}},"loc":{"start":{"line":21,"column":24},"end":{"line":35,"column":1}},"line":21},"2":{"name":"dump","decl":{"start":{"line":37,"column":15},"end":{"line":37,"column":19}},"loc":{"start":{"line":37,"column":29},"end":{"line":50,"column":1}},"line":37}},"branchMap":{"0":{"loc":{"start":{"line":19,"column":46},"end":{"line":19,"column":92}},"type":"cond-expr","locations":[{"start":{"line":19,"column":70},"end":{"line":19,"column":73}},{"start":{"line":19,"column":76},"end":{"line":19,"column":92}}],"line":19},"1":{"loc":{"start":{"line":19,"column":46},"end":{"line":19,"column":67}},"type":"binary-expr","locations":[{"start":{"line":19,"column":46},"end":{"line":19,"column":49}},{"start":{"line":19,"column":53},"end":{"line":19,"column":67}}],"line":19},"2":{"loc":{"start":{"line":24,"column":2},"end":{"line":24,"column":62}},"type":"if","locations":[{"start":{"line":24,"column":2},"end":{"line":24,"column":62}},{"start":{"line":24,"column":2},"end":{"line":24,"column":62}}],"line":24},"3":{"loc":{"start":{"line":28,"column":2},"end":{"line":32,"column":3}},"type":"if","locations":[{"start":{"line":28,"column":2},"end":{"line":32,"column":3}},{"start":{"line":28,"column":2},"end":{"line":32,"column":3}}],"line":28},"4":{"loc":{"start":{"line":41,"column":2},"end":{"line":41,"column":51}},"type":"if","locations":[{"start":{"line":41,"column":2},"end":{"line":41,"column":51}},{"start":{"line":41,"column":2},"end":{"line":41,"column":51}}],"line":41}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":2,"8":43,"9":43,"10":37,"11":6,"12":6,"13":1,"14":5,"15":1,"16":1,"17":0,"18":1,"19":1,"20":1,"21":1,"22":1},"f":{"0":2,"1":43,"2":1},"b":{"0":[0,2],"1":[2,2],"2":[37,6],"3":[1,5],"4":[0,1]},"inputSourceMap":{"version":3,"sources":["guardianPhoneFactorSelectedProvider.js"],"names":["parse","context","guardianFolder","path","join","filePath","constants","GUARDIAN_DIRECTORY","file","guardianPhoneFactorSelectedProvider","mappings","dump","assets","fs","ensureDirSync"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;AACA;;;;AAIA,SAASA,KAAT,CAAeC,OAAf,EAAwB;AACtB,QAAMC,cAAc,GAAGC,eAAKC,IAAL,CAAUH,OAAO,CAACI,QAAlB,EAA4BC,iBAAUC,kBAAtC,CAAvB;;AACA,MAAI,CAAC,4BAAgBL,cAAhB,CAAL,EAAsC,OAAO,EAAP;;AAEtC,QAAMM,IAAI,GAAGL,eAAKC,IAAL,CAAUF,cAAV,EAA0B,kCAA1B,CAAb;;AAEA,MAAI,mBAAOM,IAAP,CAAJ,EAAkB;AAChB,WAAO;AACLC,MAAAA,mCAAmC,EAAE,qBAASD,IAAT,EAAeP,OAAO,CAACS,QAAvB;AADhC,KAAP;AAGD;;AAED,SAAO,EAAP;AACD;;AAED,eAAeC,IAAf,CAAoBV,OAApB,EAA6B;AAC3B,QAAM;AAAEQ,IAAAA;AAAF,MAA0CR,OAAO,CAACW,MAAxD;AAEA,MAAI,CAACH,mCAAL,EAA0C;;AAE1C,QAAMP,cAAc,GAAGC,eAAKC,IAAL,CAAUH,OAAO,CAACI,QAAlB,EAA4BC,iBAAUC,kBAAtC,CAAvB;;AACAM,oBAAGC,aAAH,CAAiBZ,cAAjB;;AAEA,QAAMM,IAAI,GAAGL,eAAKC,IAAL,CAAUF,cAAV,EAA0B,kCAA1B,CAAb;;AACA,uBAASM,IAAT,EAAeC,mCAAf;AACD;;kBAEc;AACbT,EAAAA,KADa;AAEbW,EAAAA;AAFa,C","sourceRoot":"/home/circleci/repo/src/context/directory/handlers/","sourcesContent":["import fs from 'fs-extra';\nimport path from 'path';\nimport { constants } from '../../../tools';\nimport {\n  existsMustBeDir, dumpJSON, loadJSON, isFile\n} from '../../../utils';\n\nfunction parse(context) {\n  const guardianFolder = path.join(context.filePath, constants.GUARDIAN_DIRECTORY);\n  if (!existsMustBeDir(guardianFolder)) return {}; // Skip\n\n  const file = path.join(guardianFolder, 'phoneFactorSelectedProvider.json');\n\n  if (isFile(file)) {\n    return {\n      guardianPhoneFactorSelectedProvider: loadJSON(file, context.mappings)\n    };\n  }\n\n  return {};\n}\n\nasync function dump(context) {\n  const { guardianPhoneFactorSelectedProvider } = context.assets;\n\n  if (!guardianPhoneFactorSelectedProvider) return; // Skip, nothing to dump\n\n  const guardianFolder = path.join(context.filePath, constants.GUARDIAN_DIRECTORY);\n  fs.ensureDirSync(guardianFolder);\n\n  const file = path.join(guardianFolder, 'phoneFactorSelectedProvider.json');\n  dumpJSON(file, guardianPhoneFactorSelectedProvider);\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"cb8381ac3a69b40b421a8b0bc2aba3978bf287f0","contentHash":"8ea9aa496bdb7fb4e71d133423bd67bc281deaa5ee98d1d6e19cd6995eefcaa5"},"/home/circleci/repo/src/context/directory/handlers/guardianPolicies.js":{"path":"/home/circleci/repo/src/context/directory/handlers/guardianPolicies.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":15},"end":{"line":7,"column":34}},"2":{"start":{"line":9,"column":16},"end":{"line":9,"column":48}},"3":{"start":{"line":11,"column":12},"end":{"line":11,"column":27}},"4":{"start":{"line":13,"column":13},"end":{"line":13,"column":42}},"5":{"start":{"line":15,"column":13},"end":{"line":15,"column":38}},"6":{"start":{"line":17,"column":13},"end":{"line":17,"column":38}},"7":{"start":{"line":19,"column":39},"end":{"line":19,"column":93}},"8":{"start":{"line":22,"column":25},"end":{"line":22,"column":99}},"9":{"start":{"line":24,"column":2},"end":{"line":24,"column":62}},"10":{"start":{"line":24,"column":52},"end":{"line":24,"column":62}},"11":{"start":{"line":26,"column":15},"end":{"line":26,"column":67}},"12":{"start":{"line":28,"column":2},"end":{"line":32,"column":3}},"13":{"start":{"line":29,"column":4},"end":{"line":31,"column":6}},"14":{"start":{"line":34,"column":2},"end":{"line":34,"column":12}},"15":{"start":{"line":40,"column":6},"end":{"line":40,"column":20}},"16":{"start":{"line":41,"column":2},"end":{"line":41,"column":32}},"17":{"start":{"line":41,"column":25},"end":{"line":41,"column":32}},"18":{"start":{"line":43,"column":25},"end":{"line":43,"column":99}},"19":{"start":{"line":45,"column":2},"end":{"line":45,"column":50}},"20":{"start":{"line":47,"column":15},"end":{"line":47,"column":67}},"21":{"start":{"line":49,"column":2},"end":{"line":49,"column":47}},"22":{"start":{"line":52,"column":0},"end":{"line":55,"column":2}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":19,"column":9},"end":{"line":19,"column":31}},"loc":{"start":{"line":19,"column":37},"end":{"line":19,"column":95}},"line":19},"1":{"name":"parse","decl":{"start":{"line":21,"column":9},"end":{"line":21,"column":14}},"loc":{"start":{"line":21,"column":24},"end":{"line":35,"column":1}},"line":21},"2":{"name":"dump","decl":{"start":{"line":37,"column":15},"end":{"line":37,"column":19}},"loc":{"start":{"line":37,"column":29},"end":{"line":50,"column":1}},"line":37}},"branchMap":{"0":{"loc":{"start":{"line":19,"column":46},"end":{"line":19,"column":92}},"type":"cond-expr","locations":[{"start":{"line":19,"column":70},"end":{"line":19,"column":73}},{"start":{"line":19,"column":76},"end":{"line":19,"column":92}}],"line":19},"1":{"loc":{"start":{"line":19,"column":46},"end":{"line":19,"column":67}},"type":"binary-expr","locations":[{"start":{"line":19,"column":46},"end":{"line":19,"column":49}},{"start":{"line":19,"column":53},"end":{"line":19,"column":67}}],"line":19},"2":{"loc":{"start":{"line":24,"column":2},"end":{"line":24,"column":62}},"type":"if","locations":[{"start":{"line":24,"column":2},"end":{"line":24,"column":62}},{"start":{"line":24,"column":2},"end":{"line":24,"column":62}}],"line":24},"3":{"loc":{"start":{"line":28,"column":2},"end":{"line":32,"column":3}},"type":"if","locations":[{"start":{"line":28,"column":2},"end":{"line":32,"column":3}},{"start":{"line":28,"column":2},"end":{"line":32,"column":3}}],"line":28},"4":{"loc":{"start":{"line":41,"column":2},"end":{"line":41,"column":32}},"type":"if","locations":[{"start":{"line":41,"column":2},"end":{"line":41,"column":32}},{"start":{"line":41,"column":2},"end":{"line":41,"column":32}}],"line":41}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":2,"8":43,"9":43,"10":37,"11":6,"12":6,"13":1,"14":5,"15":1,"16":1,"17":0,"18":1,"19":1,"20":1,"21":1,"22":1},"f":{"0":2,"1":43,"2":1},"b":{"0":[0,2],"1":[2,2],"2":[37,6],"3":[1,5],"4":[0,1]},"inputSourceMap":{"version":3,"sources":["guardianPolicies.js"],"names":["parse","context","guardianFolder","path","join","filePath","constants","GUARDIAN_DIRECTORY","file","guardianPolicies","mappings","dump","assets","fs","ensureDirSync"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;AACA;;;;AAIA,SAASA,KAAT,CAAeC,OAAf,EAAwB;AACtB,QAAMC,cAAc,GAAGC,eAAKC,IAAL,CAAUH,OAAO,CAACI,QAAlB,EAA4BC,iBAAUC,kBAAtC,CAAvB;;AACA,MAAI,CAAC,4BAAgBL,cAAhB,CAAL,EAAsC,OAAO,EAAP;;AAEtC,QAAMM,IAAI,GAAGL,eAAKC,IAAL,CAAUF,cAAV,EAA0B,eAA1B,CAAb;;AAEA,MAAI,mBAAOM,IAAP,CAAJ,EAAkB;AAChB,WAAO;AACLC,MAAAA,gBAAgB,EAAE,qBAASD,IAAT,EAAeP,OAAO,CAACS,QAAvB;AADb,KAAP;AAGD;;AAED,SAAO,EAAP;AACD;;AAED,eAAeC,IAAf,CAAoBV,OAApB,EAA6B;AAC3B,QAAM;AAAEQ,IAAAA;AAAF,MAAuBR,OAAO,CAACW,MAArC;AAEA,MAAI,CAACH,gBAAL,EAAuB;;AAEvB,QAAMP,cAAc,GAAGC,eAAKC,IAAL,CAAUH,OAAO,CAACI,QAAlB,EAA4BC,iBAAUC,kBAAtC,CAAvB;;AACAM,oBAAGC,aAAH,CAAiBZ,cAAjB;;AAEA,QAAMM,IAAI,GAAGL,eAAKC,IAAL,CAAUF,cAAV,EAA0B,eAA1B,CAAb;;AACA,uBAASM,IAAT,EAAeC,gBAAf;AACD;;kBAEc;AACbT,EAAAA,KADa;AAEbW,EAAAA;AAFa,C","sourceRoot":"/home/circleci/repo/src/context/directory/handlers/","sourcesContent":["import fs from 'fs-extra';\nimport path from 'path';\nimport { constants } from '../../../tools';\nimport {\n  existsMustBeDir, dumpJSON, loadJSON, isFile\n} from '../../../utils';\n\nfunction parse(context) {\n  const guardianFolder = path.join(context.filePath, constants.GUARDIAN_DIRECTORY);\n  if (!existsMustBeDir(guardianFolder)) return {}; // Skip\n\n  const file = path.join(guardianFolder, 'policies.json');\n\n  if (isFile(file)) {\n    return {\n      guardianPolicies: loadJSON(file, context.mappings)\n    };\n  }\n\n  return {};\n}\n\nasync function dump(context) {\n  const { guardianPolicies } = context.assets;\n\n  if (!guardianPolicies) return; // Skip, nothing to dump\n\n  const guardianFolder = path.join(context.filePath, constants.GUARDIAN_DIRECTORY);\n  fs.ensureDirSync(guardianFolder);\n\n  const file = path.join(guardianFolder, 'policies.json');\n  dumpJSON(file, guardianPolicies);\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"36f2d851af8c821564cef12b3432089a40aa6af1","contentHash":"1bd607d29c04c1a353489885bfe86d6ddf716206c4195c3c2aed53641c2808dd"},"/home/circleci/repo/src/context/directory/handlers/roles.js":{"path":"/home/circleci/repo/src/context/directory/handlers/roles.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":15},"end":{"line":7,"column":34}},"2":{"start":{"line":9,"column":16},"end":{"line":9,"column":48}},"3":{"start":{"line":11,"column":12},"end":{"line":11,"column":27}},"4":{"start":{"line":13,"column":13},"end":{"line":13,"column":42}},"5":{"start":{"line":15,"column":13},"end":{"line":15,"column":38}},"6":{"start":{"line":17,"column":14},"end":{"line":17,"column":40}},"7":{"start":{"line":19,"column":15},"end":{"line":19,"column":46}},"8":{"start":{"line":21,"column":13},"end":{"line":21,"column":38}},"9":{"start":{"line":23,"column":39},"end":{"line":23,"column":93}},"10":{"start":{"line":26,"column":22},"end":{"line":26,"column":93}},"11":{"start":{"line":28,"column":2},"end":{"line":30,"column":4}},"12":{"start":{"line":28,"column":49},"end":{"line":30,"column":4}},"13":{"start":{"line":31,"column":16},"end":{"line":31,"column":60}},"14":{"start":{"line":32,"column":16},"end":{"line":36,"column":4}},"15":{"start":{"line":33,"column":17},"end":{"line":34,"column":5}},"16":{"start":{"line":35,"column":4},"end":{"line":35,"column":16}},"17":{"start":{"line":37,"column":2},"end":{"line":39,"column":4}},"18":{"start":{"line":45,"column":6},"end":{"line":45,"column":20}},"19":{"start":{"line":46,"column":2},"end":{"line":46,"column":53}},"20":{"start":{"line":46,"column":46},"end":{"line":46,"column":53}},"21":{"start":{"line":48,"column":22},"end":{"line":48,"column":93}},"22":{"start":{"line":50,"column":2},"end":{"line":50,"column":47}},"23":{"start":{"line":52,"column":2},"end":{"line":62,"column":5}},"24":{"start":{"line":53,"column":21},"end":{"line":53,"column":96}},"25":{"start":{"line":55,"column":4},"end":{"line":55,"column":49}},"26":{"start":{"line":57,"column":4},"end":{"line":59,"column":5}},"27":{"start":{"line":58,"column":6},"end":{"line":58,"column":30}},"28":{"start":{"line":61,"column":4},"end":{"line":61,"column":41}},"29":{"start":{"line":65,"column":0},"end":{"line":68,"column":2}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":23,"column":9},"end":{"line":23,"column":31}},"loc":{"start":{"line":23,"column":37},"end":{"line":23,"column":95}},"line":23},"1":{"name":"parse","decl":{"start":{"line":25,"column":9},"end":{"line":25,"column":14}},"loc":{"start":{"line":25,"column":24},"end":{"line":40,"column":1}},"line":25},"2":{"name":"(anonymous_2)","decl":{"start":{"line":32,"column":26},"end":{"line":32,"column":27}},"loc":{"start":{"line":32,"column":31},"end":{"line":36,"column":3}},"line":32},"3":{"name":"dump","decl":{"start":{"line":42,"column":15},"end":{"line":42,"column":19}},"loc":{"start":{"line":42,"column":29},"end":{"line":63,"column":1}},"line":42},"4":{"name":"(anonymous_4)","decl":{"start":{"line":52,"column":16},"end":{"line":52,"column":17}},"loc":{"start":{"line":52,"column":24},"end":{"line":62,"column":3}},"line":52}},"branchMap":{"0":{"loc":{"start":{"line":23,"column":46},"end":{"line":23,"column":92}},"type":"cond-expr","locations":[{"start":{"line":23,"column":70},"end":{"line":23,"column":73}},{"start":{"line":23,"column":76},"end":{"line":23,"column":92}}],"line":23},"1":{"loc":{"start":{"line":23,"column":46},"end":{"line":23,"column":67}},"type":"binary-expr","locations":[{"start":{"line":23,"column":46},"end":{"line":23,"column":49}},{"start":{"line":23,"column":53},"end":{"line":23,"column":67}}],"line":23},"2":{"loc":{"start":{"line":28,"column":2},"end":{"line":30,"column":4}},"type":"if","locations":[{"start":{"line":28,"column":2},"end":{"line":30,"column":4}},{"start":{"line":28,"column":2},"end":{"line":30,"column":4}}],"line":28},"3":{"loc":{"start":{"line":46,"column":2},"end":{"line":46,"column":53}},"type":"if","locations":[{"start":{"line":46,"column":2},"end":{"line":46,"column":53}},{"start":{"line":46,"column":2},"end":{"line":46,"column":53}}],"line":46},"4":{"loc":{"start":{"line":46,"column":6},"end":{"line":46,"column":44}},"type":"binary-expr","locations":[{"start":{"line":46,"column":6},"end":{"line":46,"column":12}},{"start":{"line":46,"column":16},"end":{"line":46,"column":44}}],"line":46},"5":{"loc":{"start":{"line":57,"column":4},"end":{"line":59,"column":5}},"type":"if","locations":[{"start":{"line":57,"column":4},"end":{"line":59,"column":5}},{"start":{"line":57,"column":4},"end":{"line":59,"column":5}}],"line":57}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":3,"10":43,"11":43,"12":40,"13":2,"14":2,"15":4,"16":4,"17":2,"18":2,"19":2,"20":1,"21":1,"22":1,"23":1,"24":2,"25":2,"26":2,"27":0,"28":2,"29":1},"f":{"0":3,"1":43,"2":4,"3":2,"4":2},"b":{"0":[1,2],"1":[3,3],"2":[40,2],"3":[1,1],"4":[2,2],"5":[0,2]},"inputSourceMap":{"version":3,"sources":["roles.js"],"names":["parse","context","rolesFolder","path","join","filePath","constants","ROLES_DIRECTORY","roles","undefined","files","map","f","role","mappings","dump","assets","constructor","Object","fs","ensureDirSync","forEach","roleFile","name","log","info","description"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;AAEA;;;;AACA;;;;AAIA,SAASA,KAAT,CAAeC,OAAf,EAAwB;AACtB,QAAMC,WAAW,GAAGC,eAAKC,IAAL,CAAUH,OAAO,CAACI,QAAlB,EAA4BC,iBAAUC,eAAtC,CAApB;;AACA,MAAI,CAAC,4BAAgBL,WAAhB,CAAL,EAAmC,OAAO;AAAEM,IAAAA,KAAK,EAAEC;AAAT,GAAP;AAEnC,QAAMC,KAAK,GAAG,qBAASR,WAAT,EAAsB,CAAE,OAAF,CAAtB,CAAd;AAEA,QAAMM,KAAK,GAAGE,KAAK,CAACC,GAAN,CAAWC,CAAD,IAAO;AAC7B,UAAMC,IAAI,GAAG,EAAE,GAAG,qBAASD,CAAT,EAAYX,OAAO,CAACa,QAApB;AAAL,KAAb;AACA,WAAOD,IAAP;AACD,GAHa,CAAd;AAKA,SAAO;AACLL,IAAAA;AADK,GAAP;AAGD;;AAED,eAAeO,IAAf,CAAoBd,OAApB,EAA6B;AAC3B,QAAM;AAAEO,IAAAA;AAAF,MAAYP,OAAO,CAACe,MAA1B;AAGA,MAAI,CAACR,KAAD,IAAUA,KAAK,CAACS,WAAN,KAAsBC,MAApC,EAA4C;;AAE5C,QAAMhB,WAAW,GAAGC,eAAKC,IAAL,CAAUH,OAAO,CAACI,QAAlB,EAA4BC,iBAAUC,eAAtC,CAApB;;AACAY,oBAAGC,aAAH,CAAiBlB,WAAjB;;AAEAM,EAAAA,KAAK,CAACa,OAAN,CAAeR,IAAD,IAAU;AACtB,UAAMS,QAAQ,GAAGnB,eAAKC,IAAL,CAAUF,WAAV,EAAuB,qBAAU,GAAEW,IAAI,CAACU,IAAK,OAAtB,CAAvB,CAAjB;;AACAC,qBAAIC,IAAJ,CAAU,WAAUH,QAAS,EAA7B;;AAGA,QAAIT,IAAI,CAACa,WAAL,KAAqB,IAAzB,EAA+B;AAC7B,aAAOb,IAAI,CAACa,WAAZ;AACD;;AAED,yBAASJ,QAAT,EAAmBT,IAAnB;AACD,GAVD;AAWD;;kBAEc;AACbb,EAAAA,KADa;AAEbe,EAAAA;AAFa,C","sourceRoot":"/home/circleci/repo/src/context/directory/handlers/","sourcesContent":["import fs from 'fs-extra';\nimport path from 'path';\nimport { constants } from '../../../tools';\n\nimport log from '../../../logger';\nimport {\n  getFiles, existsMustBeDir, dumpJSON, loadJSON, sanitize\n} from '../../../utils';\n\nfunction parse(context) {\n  const rolesFolder = path.join(context.filePath, constants.ROLES_DIRECTORY);\n  if (!existsMustBeDir(rolesFolder)) return { roles: undefined }; // Skip\n\n  const files = getFiles(rolesFolder, [ '.json' ]);\n\n  const roles = files.map((f) => {\n    const role = { ...loadJSON(f, context.mappings) };\n    return role;\n  });\n\n  return {\n    roles\n  };\n}\n\nasync function dump(context) {\n  const { roles } = context.assets;\n\n  // API returns an empty object if no grants are present\n  if (!roles || roles.constructor === Object) return; // Skip, nothing to dump\n\n  const rolesFolder = path.join(context.filePath, constants.ROLES_DIRECTORY);\n  fs.ensureDirSync(rolesFolder);\n\n  roles.forEach((role) => {\n    const roleFile = path.join(rolesFolder, sanitize(`${role.name}.json`));\n    log.info(`Writing ${roleFile}`);\n\n    // remove empty description\n    if (role.description === null) {\n      delete role.description;\n    }\n\n    dumpJSON(roleFile, role);\n  });\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"1cd87ec6d426863ba9decbc5f4213b21a3106ae7","contentHash":"c6598ba16eed13ec4479eb6cfe711d8dfc0f4070748addd568ca082949af5e55"},"/home/circleci/repo/src/context/directory/handlers/migrations.js":{"path":"/home/circleci/repo/src/context/directory/handlers/migrations.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":12},"end":{"line":7,"column":27}},"2":{"start":{"line":9,"column":13},"end":{"line":9,"column":42}},"3":{"start":{"line":11,"column":13},"end":{"line":11,"column":38}},"4":{"start":{"line":13,"column":39},"end":{"line":13,"column":93}},"5":{"start":{"line":16,"column":21},"end":{"line":16,"column":58}},"6":{"start":{"line":18,"column":2},"end":{"line":18,"column":58}},"7":{"start":{"line":18,"column":48},"end":{"line":18,"column":58}},"8":{"start":{"line":20,"column":25},"end":{"line":20,"column":75}},"9":{"start":{"line":22,"column":2},"end":{"line":27,"column":3}},"10":{"start":{"line":23,"column":23},"end":{"line":23,"column":77}},"11":{"start":{"line":24,"column":4},"end":{"line":26,"column":6}},"12":{"start":{"line":29,"column":2},"end":{"line":29,"column":12}},"13":{"start":{"line":35,"column":6},"end":{"line":35,"column":20}},"14":{"start":{"line":36,"column":2},"end":{"line":36,"column":66}},"15":{"start":{"line":36,"column":59},"end":{"line":36,"column":66}},"16":{"start":{"line":38,"column":25},"end":{"line":38,"column":81}},"17":{"start":{"line":40,"column":2},"end":{"line":40,"column":51}},"18":{"start":{"line":43,"column":0},"end":{"line":46,"column":2}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":13,"column":9},"end":{"line":13,"column":31}},"loc":{"start":{"line":13,"column":37},"end":{"line":13,"column":95}},"line":13},"1":{"name":"parse","decl":{"start":{"line":15,"column":9},"end":{"line":15,"column":14}},"loc":{"start":{"line":15,"column":24},"end":{"line":30,"column":1}},"line":15},"2":{"name":"dump","decl":{"start":{"line":32,"column":15},"end":{"line":32,"column":19}},"loc":{"start":{"line":32,"column":29},"end":{"line":41,"column":1}},"line":32}},"branchMap":{"0":{"loc":{"start":{"line":13,"column":46},"end":{"line":13,"column":92}},"type":"cond-expr","locations":[{"start":{"line":13,"column":70},"end":{"line":13,"column":73}},{"start":{"line":13,"column":76},"end":{"line":13,"column":92}}],"line":13},"1":{"loc":{"start":{"line":13,"column":46},"end":{"line":13,"column":67}},"type":"binary-expr","locations":[{"start":{"line":13,"column":46},"end":{"line":13,"column":49}},{"start":{"line":13,"column":53},"end":{"line":13,"column":67}}],"line":13},"2":{"loc":{"start":{"line":18,"column":2},"end":{"line":18,"column":58}},"type":"if","locations":[{"start":{"line":18,"column":2},"end":{"line":18,"column":58}},{"start":{"line":18,"column":2},"end":{"line":18,"column":58}}],"line":18},"3":{"loc":{"start":{"line":22,"column":2},"end":{"line":27,"column":3}},"type":"if","locations":[{"start":{"line":22,"column":2},"end":{"line":27,"column":3}},{"start":{"line":22,"column":2},"end":{"line":27,"column":3}}],"line":22},"4":{"loc":{"start":{"line":36,"column":2},"end":{"line":36,"column":66}},"type":"if","locations":[{"start":{"line":36,"column":2},"end":{"line":36,"column":66}},{"start":{"line":36,"column":2},"end":{"line":36,"column":66}}],"line":36},"5":{"loc":{"start":{"line":36,"column":6},"end":{"line":36,"column":57}},"type":"binary-expr","locations":[{"start":{"line":36,"column":6},"end":{"line":36,"column":17}},{"start":{"line":36,"column":21},"end":{"line":36,"column":57}}],"line":36}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":43,"6":43,"7":0,"8":43,"9":43,"10":1,"11":1,"12":42,"13":1,"14":1,"15":0,"16":1,"17":1,"18":1},"f":{"0":1,"1":43,"2":1},"b":{"0":[0,1],"1":[1,1],"2":[0,43],"3":[1,42],"4":[0,1],"5":[1,1]},"inputSourceMap":{"version":3,"sources":["migrations.js"],"names":["parse","context","baseFolder","path","join","filePath","migrationsFile","migrations","mappings","dump","assets","Object","keys","length"],"mappings":";;;;;;AAAA;;;;AACA;;;;AAIA,SAASA,KAAT,CAAeC,OAAf,EAAwB;AACtB,QAAMC,UAAU,GAAGC,eAAKC,IAAL,CAAUH,OAAO,CAACI,QAAlB,CAAnB;;AACA,MAAI,CAAC,4BAAgBH,UAAhB,CAAL,EAAkC,OAAO,EAAP;;AAElC,QAAMI,cAAc,GAAGH,eAAKC,IAAL,CAAUF,UAAV,EAAsB,iBAAtB,CAAvB;;AAEA,MAAI,mBAAOI,cAAP,CAAJ,EAA4B;AAE1B,UAAMC,UAAU,GAAG,qBAASD,cAAT,EAAyBL,OAAO,CAACO,QAAjC,CAAnB;AAEA,WAAO;AAAED,MAAAA;AAAF,KAAP;AACD;;AAED,SAAO,EAAP;AACD;;AAED,eAAeE,IAAf,CAAoBR,OAApB,EAA6B;AAC3B,QAAM;AAAEM,IAAAA;AAAF,MAAiBN,OAAO,CAACS,MAA/B;AAEA,MAAI,CAACH,UAAD,IAAeI,MAAM,CAACC,IAAP,CAAYL,UAAZ,EAAwBM,MAAxB,KAAmC,CAAtD,EAAyD;;AAEzD,QAAMP,cAAc,GAAGH,eAAKC,IAAL,CAAUH,OAAO,CAACI,QAAlB,EAA4B,iBAA5B,CAAvB;;AACA,uBAASC,cAAT,EAAyBC,UAAzB;AACD;;kBAEc;AACbP,EAAAA,KADa;AAEbS,EAAAA;AAFa,C","sourceRoot":"/home/circleci/repo/src/context/directory/handlers/","sourcesContent":["import path from 'path';\nimport {\n  existsMustBeDir, isFile, dumpJSON, loadJSON\n} from '../../../utils';\n\nfunction parse(context) {\n  const baseFolder = path.join(context.filePath);\n  if (!existsMustBeDir(baseFolder)) return {}; // Skip\n\n  const migrationsFile = path.join(baseFolder, 'migrations.json');\n\n  if (isFile(migrationsFile)) {\n    /* eslint-disable camelcase */\n    const migrations = loadJSON(migrationsFile, context.mappings);\n\n    return { migrations };\n  }\n\n  return {};\n}\n\nasync function dump(context) {\n  const { migrations } = context.assets;\n\n  if (!migrations || Object.keys(migrations).length === 0) return; // Skip, nothing to dump\n\n  const migrationsFile = path.join(context.filePath, 'migrations.json');\n  dumpJSON(migrationsFile, migrations);\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"8b179bc5128d8f93f0828211278d0966346bb103","contentHash":"13eeda0c3da1429b0b1687f8d31e9ed3c6cab0de90bfb40dca4112978c7a23f4"},"/home/circleci/repo/src/context/directory/handlers/actions.js":{"path":"/home/circleci/repo/src/context/directory/handlers/actions.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":15},"end":{"line":7,"column":34}},"2":{"start":{"line":9,"column":16},"end":{"line":9,"column":48}},"3":{"start":{"line":11,"column":12},"end":{"line":11,"column":27}},"4":{"start":{"line":13,"column":13},"end":{"line":13,"column":42}},"5":{"start":{"line":15,"column":13},"end":{"line":15,"column":38}},"6":{"start":{"line":17,"column":13},"end":{"line":17,"column":38}},"7":{"start":{"line":19,"column":14},"end":{"line":19,"column":40}},"8":{"start":{"line":21,"column":15},"end":{"line":21,"column":46}},"9":{"start":{"line":23,"column":39},"end":{"line":23,"column":93}},"10":{"start":{"line":26,"column":24},"end":{"line":26,"column":97}},"11":{"start":{"line":28,"column":2},"end":{"line":30,"column":4}},"12":{"start":{"line":28,"column":51},"end":{"line":30,"column":4}},"13":{"start":{"line":31,"column":16},"end":{"line":31,"column":62}},"14":{"start":{"line":32,"column":18},"end":{"line":43,"column":4}},"15":{"start":{"line":33,"column":19},"end":{"line":34,"column":5}},"16":{"start":{"line":36,"column":25},"end":{"line":36,"column":98}},"17":{"start":{"line":38,"column":4},"end":{"line":40,"column":5}},"18":{"start":{"line":39,"column":6},"end":{"line":39,"column":64}},"19":{"start":{"line":42,"column":4},"end":{"line":42,"column":18}},"20":{"start":{"line":44,"column":2},"end":{"line":46,"column":4}},"21":{"start":{"line":50,"column":2},"end":{"line":55,"column":3}},"22":{"start":{"line":51,"column":4},"end":{"line":54,"column":8}},"23":{"start":{"line":51,"column":34},"end":{"line":54,"column":5}},"24":{"start":{"line":57,"column":2},"end":{"line":57,"column":12}},"25":{"start":{"line":63,"column":6},"end":{"line":63,"column":12}},"26":{"start":{"line":65,"column":2},"end":{"line":67,"column":3}},"27":{"start":{"line":66,"column":4},"end":{"line":66,"column":14}},"28":{"start":{"line":69,"column":21},"end":{"line":69,"column":54}},"29":{"start":{"line":71,"column":23},"end":{"line":71,"column":105}},"30":{"start":{"line":73,"column":2},"end":{"line":73,"column":48}},"31":{"start":{"line":75,"column":19},"end":{"line":75,"column":63}},"32":{"start":{"line":77,"column":2},"end":{"line":77,"column":47}},"33":{"start":{"line":79,"column":2},"end":{"line":79,"column":50}},"34":{"start":{"line":81,"column":2},"end":{"line":81,"column":23}},"35":{"start":{"line":85,"column":2},"end":{"line":94,"column":4}},"36":{"start":{"line":98,"column":18},"end":{"line":98,"column":53}},"37":{"start":{"line":99,"column":2},"end":{"line":99,"column":33}},"38":{"start":{"line":99,"column":26},"end":{"line":99,"column":33}},"39":{"start":{"line":101,"column":24},"end":{"line":101,"column":97}},"40":{"start":{"line":103,"column":2},"end":{"line":103,"column":49}},"41":{"start":{"line":105,"column":2},"end":{"line":113,"column":5}},"42":{"start":{"line":106,"column":17},"end":{"line":106,"column":50}},"43":{"start":{"line":108,"column":23},"end":{"line":108,"column":73}},"44":{"start":{"line":110,"column":4},"end":{"line":110,"column":51}},"45":{"start":{"line":112,"column":4},"end":{"line":112,"column":112}},"46":{"start":{"line":116,"column":0},"end":{"line":119,"column":2}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":23,"column":9},"end":{"line":23,"column":31}},"loc":{"start":{"line":23,"column":37},"end":{"line":23,"column":95}},"line":23},"1":{"name":"parse","decl":{"start":{"line":25,"column":9},"end":{"line":25,"column":14}},"loc":{"start":{"line":25,"column":24},"end":{"line":47,"column":1}},"line":25},"2":{"name":"(anonymous_2)","decl":{"start":{"line":32,"column":28},"end":{"line":32,"column":29}},"loc":{"start":{"line":32,"column":36},"end":{"line":43,"column":3}},"line":32},"3":{"name":"mapSecrets","decl":{"start":{"line":49,"column":9},"end":{"line":49,"column":19}},"loc":{"start":{"line":49,"column":29},"end":{"line":58,"column":1}},"line":49},"4":{"name":"(anonymous_4)","decl":{"start":{"line":51,"column":23},"end":{"line":51,"column":24}},"loc":{"start":{"line":51,"column":34},"end":{"line":54,"column":5}},"line":51},"5":{"name":"mapActionCode","decl":{"start":{"line":60,"column":9},"end":{"line":60,"column":22}},"loc":{"start":{"line":60,"column":41},"end":{"line":82,"column":1}},"line":60},"6":{"name":"mapToAction","decl":{"start":{"line":84,"column":9},"end":{"line":84,"column":20}},"loc":{"start":{"line":84,"column":39},"end":{"line":95,"column":1}},"line":84},"7":{"name":"dump","decl":{"start":{"line":97,"column":15},"end":{"line":97,"column":19}},"loc":{"start":{"line":97,"column":29},"end":{"line":114,"column":1}},"line":97},"8":{"name":"(anonymous_8)","decl":{"start":{"line":105,"column":18},"end":{"line":105,"column":19}},"loc":{"start":{"line":105,"column":28},"end":{"line":113,"column":3}},"line":105}},"branchMap":{"0":{"loc":{"start":{"line":23,"column":46},"end":{"line":23,"column":92}},"type":"cond-expr","locations":[{"start":{"line":23,"column":70},"end":{"line":23,"column":73}},{"start":{"line":23,"column":76},"end":{"line":23,"column":92}}],"line":23},"1":{"loc":{"start":{"line":23,"column":46},"end":{"line":23,"column":67}},"type":"binary-expr","locations":[{"start":{"line":23,"column":46},"end":{"line":23,"column":49}},{"start":{"line":23,"column":53},"end":{"line":23,"column":67}}],"line":23},"2":{"loc":{"start":{"line":28,"column":2},"end":{"line":30,"column":4}},"type":"if","locations":[{"start":{"line":28,"column":2},"end":{"line":30,"column":4}},{"start":{"line":28,"column":2},"end":{"line":30,"column":4}}],"line":28},"3":{"loc":{"start":{"line":38,"column":4},"end":{"line":40,"column":5}},"type":"if","locations":[{"start":{"line":38,"column":4},"end":{"line":40,"column":5}},{"start":{"line":38,"column":4},"end":{"line":40,"column":5}}],"line":38},"4":{"loc":{"start":{"line":50,"column":2},"end":{"line":55,"column":3}},"type":"if","locations":[{"start":{"line":50,"column":2},"end":{"line":55,"column":3}},{"start":{"line":50,"column":2},"end":{"line":55,"column":3}}],"line":50},"5":{"loc":{"start":{"line":50,"column":6},"end":{"line":50,"column":35}},"type":"binary-expr","locations":[{"start":{"line":50,"column":6},"end":{"line":50,"column":13}},{"start":{"line":50,"column":17},"end":{"line":50,"column":35}}],"line":50},"6":{"loc":{"start":{"line":65,"column":2},"end":{"line":67,"column":3}},"type":"if","locations":[{"start":{"line":65,"column":2},"end":{"line":67,"column":3}},{"start":{"line":65,"column":2},"end":{"line":67,"column":3}}],"line":65},"7":{"loc":{"start":{"line":90,"column":18},"end":{"line":90,"column":43}},"type":"binary-expr","locations":[{"start":{"line":90,"column":18},"end":{"line":90,"column":37}},{"start":{"line":90,"column":41},"end":{"line":90,"column":43}}],"line":90},"8":{"loc":{"start":{"line":93,"column":14},"end":{"line":93,"column":60}},"type":"binary-expr","locations":[{"start":{"line":93,"column":14},"end":{"line":93,"column":29}},{"start":{"line":93,"column":33},"end":{"line":93,"column":60}}],"line":93},"9":{"loc":{"start":{"line":98,"column":23},"end":{"line":98,"column":51}},"type":"binary-expr","locations":[{"start":{"line":98,"column":23},"end":{"line":98,"column":45}},{"start":{"line":98,"column":49},"end":{"line":98,"column":51}}],"line":98},"10":{"loc":{"start":{"line":99,"column":2},"end":{"line":99,"column":33}},"type":"if","locations":[{"start":{"line":99,"column":2},"end":{"line":99,"column":33}},{"start":{"line":99,"column":2},"end":{"line":99,"column":33}}],"line":99}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":3,"10":42,"11":42,"12":39,"13":2,"14":2,"15":2,"16":2,"17":2,"18":2,"19":2,"20":2,"21":1,"22":0,"23":0,"24":1,"25":1,"26":1,"27":0,"28":1,"29":1,"30":1,"31":1,"32":1,"33":1,"34":1,"35":1,"36":1,"37":1,"38":0,"39":1,"40":1,"41":1,"42":1,"43":1,"44":1,"45":1,"46":1},"f":{"0":3,"1":42,"2":2,"3":1,"4":0,"5":1,"6":1,"7":1,"8":1},"b":{"0":[1,2],"1":[3,3],"2":[39,2],"3":[2,0],"4":[0,1],"5":[1,1],"6":[0,1],"7":[1,0],"8":[1,0],"9":[1,0],"10":[0,1]},"inputSourceMap":{"version":3,"sources":["actions.js"],"names":["parse","context","actionsFolder","path","join","filePath","constants","ACTIONS_DIRECTORY","actions","undefined","files","map","file","action","mappings","actionFolder","name","code","loadFile","mapSecrets","secrets","length","secret","value","mapActionCode","actionName","fs","ensureDirSync","codeFile","log","info","writeFileSync","mapToAction","runtime","status","dependencies","supported_triggers","deployed","all_changes_deployed","dump","assets","forEach","actionFile","JSON","stringify"],"mappings":"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","sourceRoot":"/home/circleci/repo/src/context/directory/handlers/","sourcesContent":["/* eslint-disable consistent-return */\nimport fs from 'fs-extra';\nimport path from 'path';\nimport { constants } from '../../../tools';\n\nimport {\n  getFiles, existsMustBeDir, loadJSON, sanitize\n} from '../../../utils';\nimport log from '../../../logger';\n\nfunction parse(context) {\n  const actionsFolder = path.join(context.filePath, constants.ACTIONS_DIRECTORY);\n  if (!existsMustBeDir(actionsFolder)) return { actions: undefined }; // Skip\n  const files = getFiles(actionsFolder, [ '.json' ]);\n  const actions = files.map((file) => {\n    const action = { ...loadJSON(file, context.mappings) };\n    const actionFolder = path.join(constants.ACTIONS_DIRECTORY, `${action.name}`);\n    if (action.code) {\n      action.code = context.loadFile(action.code, actionFolder);\n    }\n    return action;\n  });\n  return {\n    actions\n  };\n}\n\nfunction mapSecrets(secrets) {\n  if (secrets && secrets.length > 0) {\n    return secrets.map((secret) => ({ name: secret.name, value: secret.value }));\n  }\n  return [];\n}\n\nfunction mapActionCode(filePath, action) {\n  const { code } = action;\n\n  if (!code) {\n    return '';\n  }\n\n  const actionName = sanitize(action.name);\n  const actionFolder = path.join(filePath, constants.ACTIONS_DIRECTORY, `${actionName}`);\n  fs.ensureDirSync(actionFolder);\n\n  const codeFile = path.join(actionFolder, 'code.js');\n  log.info(`Writing ${codeFile}`);\n  fs.writeFileSync(codeFile, code);\n\n  return `${codeFile}`;\n}\n\nfunction mapToAction(filePath, action) {\n  return {\n    name: action.name,\n    code: mapActionCode(filePath, action),\n    runtime: action.runtime,\n    status: action.status,\n    dependencies: action.dependencies || [],\n    secrets: mapSecrets(action.secrets),\n    supported_triggers: action.supported_triggers,\n    deployed: action.deployed || action.all_changes_deployed\n  };\n}\n\nasync function dump(context) {\n  const actions = [ ...context.assets.actions || [] ];\n  if (actions.length < 1) return;\n\n  // Create Actions folder\n  const actionsFolder = path.join(context.filePath, constants.ACTIONS_DIRECTORY);\n  fs.ensureDirSync(actionsFolder);\n  actions.forEach((action) => {\n    // Dump template metadata\n    const name = sanitize(action.name);\n    const actionFile = path.join(actionsFolder, `${name}.json`);\n    log.info(`Writing ${actionFile}`);\n    fs.writeFileSync(actionFile, JSON.stringify(mapToAction(context.filePath, action), null, 2));\n  });\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"ab5be21f54a1d8443096d92cf0a2250659e83951","contentHash":"a7d2fb548e27ddbe00db2b6f2642e3fbe9ebe681c8101e3b8b7abb41ea6a3d53"},"/home/circleci/repo/src/context/directory/handlers/organizations.js":{"path":"/home/circleci/repo/src/context/directory/handlers/organizations.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":15},"end":{"line":7,"column":34}},"2":{"start":{"line":9,"column":16},"end":{"line":9,"column":48}},"3":{"start":{"line":11,"column":12},"end":{"line":11,"column":27}},"4":{"start":{"line":13,"column":13},"end":{"line":13,"column":42}},"5":{"start":{"line":15,"column":14},"end":{"line":15,"column":40}},"6":{"start":{"line":17,"column":15},"end":{"line":17,"column":46}},"7":{"start":{"line":19,"column":13},"end":{"line":19,"column":38}},"8":{"start":{"line":21,"column":39},"end":{"line":21,"column":93}},"9":{"start":{"line":24,"column":30},"end":{"line":24,"column":84}},"10":{"start":{"line":26,"column":2},"end":{"line":28,"column":4}},"11":{"start":{"line":26,"column":57},"end":{"line":28,"column":4}},"12":{"start":{"line":29,"column":16},"end":{"line":29,"column":68}},"13":{"start":{"line":30,"column":24},"end":{"line":34,"column":4}},"14":{"start":{"line":31,"column":16},"end":{"line":32,"column":5}},"15":{"start":{"line":33,"column":4},"end":{"line":33,"column":15}},"16":{"start":{"line":35,"column":2},"end":{"line":37,"column":4}},"17":{"start":{"line":43,"column":6},"end":{"line":43,"column":20}},"18":{"start":{"line":44,"column":2},"end":{"line":44,"column":69}},"19":{"start":{"line":44,"column":62},"end":{"line":44,"column":69}},"20":{"start":{"line":46,"column":30},"end":{"line":46,"column":84}},"21":{"start":{"line":48,"column":2},"end":{"line":48,"column":55}},"22":{"start":{"line":50,"column":2},"end":{"line":69,"column":5}},"23":{"start":{"line":51,"column":29},"end":{"line":51,"column":120}},"24":{"start":{"line":53,"column":4},"end":{"line":53,"column":57}},"25":{"start":{"line":55,"column":4},"end":{"line":66,"column":5}},"26":{"start":{"line":56,"column":6},"end":{"line":65,"column":9}},"27":{"start":{"line":57,"column":21},"end":{"line":57,"column":54}},"28":{"start":{"line":58,"column":21},"end":{"line":61,"column":9}},"29":{"start":{"line":62,"column":8},"end":{"line":62,"column":34}},"30":{"start":{"line":63,"column":8},"end":{"line":63,"column":31}},"31":{"start":{"line":64,"column":8},"end":{"line":64,"column":20}},"32":{"start":{"line":68,"column":4},"end":{"line":68,"column":57}},"33":{"start":{"line":72,"column":0},"end":{"line":75,"column":2}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":21,"column":9},"end":{"line":21,"column":31}},"loc":{"start":{"line":21,"column":37},"end":{"line":21,"column":95}},"line":21},"1":{"name":"parse","decl":{"start":{"line":23,"column":9},"end":{"line":23,"column":14}},"loc":{"start":{"line":23,"column":24},"end":{"line":38,"column":1}},"line":23},"2":{"name":"(anonymous_2)","decl":{"start":{"line":30,"column":34},"end":{"line":30,"column":35}},"loc":{"start":{"line":30,"column":39},"end":{"line":34,"column":3}},"line":30},"3":{"name":"dump","decl":{"start":{"line":40,"column":15},"end":{"line":40,"column":19}},"loc":{"start":{"line":40,"column":29},"end":{"line":70,"column":1}},"line":40},"4":{"name":"(anonymous_4)","decl":{"start":{"line":50,"column":24},"end":{"line":50,"column":25}},"loc":{"start":{"line":50,"column":40},"end":{"line":69,"column":3}},"line":50},"5":{"name":"(anonymous_5)","decl":{"start":{"line":56,"column":62},"end":{"line":56,"column":63}},"loc":{"start":{"line":56,"column":67},"end":{"line":65,"column":7}},"line":56}},"branchMap":{"0":{"loc":{"start":{"line":21,"column":46},"end":{"line":21,"column":92}},"type":"cond-expr","locations":[{"start":{"line":21,"column":70},"end":{"line":21,"column":73}},{"start":{"line":21,"column":76},"end":{"line":21,"column":92}}],"line":21},"1":{"loc":{"start":{"line":21,"column":46},"end":{"line":21,"column":67}},"type":"binary-expr","locations":[{"start":{"line":21,"column":46},"end":{"line":21,"column":49}},{"start":{"line":21,"column":53},"end":{"line":21,"column":67}}],"line":21},"2":{"loc":{"start":{"line":26,"column":2},"end":{"line":28,"column":4}},"type":"if","locations":[{"start":{"line":26,"column":2},"end":{"line":28,"column":4}},{"start":{"line":26,"column":2},"end":{"line":28,"column":4}}],"line":26},"3":{"loc":{"start":{"line":44,"column":2},"end":{"line":44,"column":69}},"type":"if","locations":[{"start":{"line":44,"column":2},"end":{"line":44,"column":69}},{"start":{"line":44,"column":2},"end":{"line":44,"column":69}}],"line":44},"4":{"loc":{"start":{"line":44,"column":6},"end":{"line":44,"column":60}},"type":"binary-expr","locations":[{"start":{"line":44,"column":6},"end":{"line":44,"column":20}},{"start":{"line":44,"column":24},"end":{"line":44,"column":60}}],"line":44},"5":{"loc":{"start":{"line":55,"column":4},"end":{"line":66,"column":5}},"type":"if","locations":[{"start":{"line":55,"column":4},"end":{"line":66,"column":5}},{"start":{"line":55,"column":4},"end":{"line":66,"column":5}}],"line":55},"6":{"loc":{"start":{"line":57,"column":21},"end":{"line":57,"column":54}},"type":"binary-expr","locations":[{"start":{"line":57,"column":21},"end":{"line":57,"column":33}},{"start":{"line":57,"column":37},"end":{"line":57,"column":54}}],"line":57}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":3,"9":41,"10":41,"11":39,"12":1,"13":1,"14":2,"15":2,"16":1,"17":2,"18":2,"19":1,"20":1,"21":1,"22":1,"23":2,"24":2,"25":2,"26":2,"27":2,"28":2,"29":2,"30":2,"31":2,"32":2,"33":1},"f":{"0":3,"1":41,"2":2,"3":2,"4":2,"5":2},"b":{"0":[1,2],"1":[3,3],"2":[39,1],"3":[1,1],"4":[2,2],"5":[2,0],"6":[2,0]},"inputSourceMap":{"version":3,"sources":["organizations.js"],"names":["parse","context","organizationsFolder","path","join","filePath","organizations","undefined","files","map","f","org","mappings","dump","assets","constructor","Object","fs","ensureDirSync","forEach","organization","organizationFile","name","log","info","connections","length","c","connection","conn","connection_id"],"mappings":";;;;;;AAAA;;;;AACA;;;;AAEA;;;;AACA;;;;AAIA,SAASA,KAAT,CAAeC,OAAf,EAAwB;AACtB,QAAMC,mBAAmB,GAAGC,eAAKC,IAAL,CAAUH,OAAO,CAACI,QAAlB,EAA4B,eAA5B,CAA5B;;AAEA,MAAI,CAAC,4BAAgBH,mBAAhB,CAAL,EAA2C,OAAO;AAAEI,IAAAA,aAAa,EAAEC;AAAjB,GAAP;AAE3C,QAAMC,KAAK,GAAG,qBAASN,mBAAT,EAA8B,CAAE,OAAF,CAA9B,CAAd;AAEA,QAAMI,aAAa,GAAGE,KAAK,CAACC,GAAN,CAAWC,CAAD,IAAO;AACrC,UAAMC,GAAG,GAAG,EAAE,GAAG,qBAASD,CAAT,EAAYT,OAAO,CAACW,QAApB;AAAL,KAAZ;AACA,WAAOD,GAAP;AACD,GAHqB,CAAtB;AAKA,SAAO;AACLL,IAAAA;AADK,GAAP;AAGD;;AAED,eAAeO,IAAf,CAAoBZ,OAApB,EAA6B;AAC3B,QAAM;AAAEK,IAAAA;AAAF,MAAoBL,OAAO,CAACa,MAAlC;AAGA,MAAI,CAACR,aAAD,IAAkBA,aAAa,CAACS,WAAd,KAA8BC,MAApD,EAA4D;;AAE5D,QAAMd,mBAAmB,GAAGC,eAAKC,IAAL,CAAUH,OAAO,CAACI,QAAlB,EAA4B,eAA5B,CAA5B;;AACAY,oBAAGC,aAAH,CAAiBhB,mBAAjB;;AAEAI,EAAAA,aAAa,CAACa,OAAd,CAAuBC,YAAD,IAAkB;AACtC,UAAMC,gBAAgB,GAAGlB,eAAKC,IAAL,CAAUF,mBAAV,EAA+B,qBAAU,GAAEkB,YAAY,CAACE,IAAK,OAA9B,CAA/B,CAAzB;;AACAC,qBAAIC,IAAJ,CAAU,WAAUH,gBAAiB,EAArC;;AAEA,QAAID,YAAY,CAACK,WAAb,CAAyBC,MAAzB,GAAkC,CAAtC,EAAyC;AACvCN,MAAAA,YAAY,CAACK,WAAb,GAA2BL,YAAY,CAACK,WAAb,CAAyBhB,GAAzB,CAA8BkB,CAAD,IAAO;AAE7D,cAAML,IAAI,GAAGK,CAAC,CAACC,UAAF,IAAgBD,CAAC,CAACC,UAAF,CAAaN,IAA1C;AAEA,cAAMO,IAAI,GAAG;AACXP,UAAAA,IADW;AAEX,aAAGK;AAFQ,SAAb;AAKA,eAAOE,IAAI,CAACC,aAAZ;AACA,eAAOD,IAAI,CAACD,UAAZ;AAEA,eAAOC,IAAP;AACD,OAb0B,CAA3B;AAcD;;AAED,yBAASR,gBAAT,EAA2BD,YAA3B;AACD,GAtBD;AAuBD;;kBAEc;AACbpB,EAAAA,KADa;AAEba,EAAAA;AAFa,C","sourceRoot":"/home/circleci/repo/src/context/directory/handlers/","sourcesContent":["import fs from 'fs-extra';\nimport path from 'path';\n\nimport log from '../../../logger';\nimport {\n  getFiles, existsMustBeDir, dumpJSON, loadJSON, sanitize\n} from '../../../utils';\n\nfunction parse(context) {\n  const organizationsFolder = path.join(context.filePath, 'organizations');\n\n  if (!existsMustBeDir(organizationsFolder)) return { organizations: undefined }; // Skip\n\n  const files = getFiles(organizationsFolder, [ '.json' ]);\n\n  const organizations = files.map((f) => {\n    const org = { ...loadJSON(f, context.mappings) };\n    return org;\n  });\n\n  return {\n    organizations\n  };\n}\n\nasync function dump(context) {\n  const { organizations } = context.assets;\n\n  // API returns an empty object if no grants are present\n  if (!organizations || organizations.constructor === Object) return; // Skip, nothing to dump\n\n  const organizationsFolder = path.join(context.filePath, 'organizations');\n  fs.ensureDirSync(organizationsFolder);\n\n  organizations.forEach((organization) => {\n    const organizationFile = path.join(organizationsFolder, sanitize(`${organization.name}.json`));\n    log.info(`Writing ${organizationFile}`);\n\n    if (organization.connections.length > 0) {\n      organization.connections = organization.connections.map((c) => {\n        // connection is a computed field\n        const name = c.connection && c.connection.name;\n\n        const conn = {\n          name,\n          ...c\n        };\n\n        delete conn.connection_id;\n        delete conn.connection;\n\n        return conn;\n      });\n    }\n\n    dumpJSON(organizationFile, organization);\n  });\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"603feb42728d3655274acb8492a463ae291d8598","contentHash":"86113e42ec112634f1e918b89bd9f3ed7ad28646ffcfa6f4d3f9741ff3c0d3ab"},"/home/circleci/repo/src/context/directory/handlers/triggers.js":{"path":"/home/circleci/repo/src/context/directory/handlers/triggers.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":15},"end":{"line":7,"column":34}},"2":{"start":{"line":9,"column":16},"end":{"line":9,"column":48}},"3":{"start":{"line":11,"column":12},"end":{"line":11,"column":27}},"4":{"start":{"line":13,"column":13},"end":{"line":13,"column":42}},"5":{"start":{"line":15,"column":13},"end":{"line":15,"column":38}},"6":{"start":{"line":17,"column":13},"end":{"line":17,"column":38}},"7":{"start":{"line":19,"column":14},"end":{"line":19,"column":40}},"8":{"start":{"line":21,"column":15},"end":{"line":21,"column":46}},"9":{"start":{"line":23,"column":39},"end":{"line":23,"column":93}},"10":{"start":{"line":26,"column":25},"end":{"line":26,"column":99}},"11":{"start":{"line":28,"column":2},"end":{"line":30,"column":4}},"12":{"start":{"line":28,"column":52},"end":{"line":30,"column":4}},"13":{"start":{"line":31,"column":16},"end":{"line":31,"column":63}},"14":{"start":{"line":32,"column":19},"end":{"line":33,"column":3}},"15":{"start":{"line":34,"column":2},"end":{"line":36,"column":4}},"16":{"start":{"line":42,"column":6},"end":{"line":42,"column":20}},"17":{"start":{"line":43,"column":2},"end":{"line":43,"column":24}},"18":{"start":{"line":43,"column":17},"end":{"line":43,"column":24}},"19":{"start":{"line":45,"column":25},"end":{"line":45,"column":99}},"20":{"start":{"line":47,"column":2},"end":{"line":47,"column":50}},"21":{"start":{"line":49,"column":22},"end":{"line":49,"column":74}},"22":{"start":{"line":51,"column":2},"end":{"line":51,"column":50}},"23":{"start":{"line":53,"column":2},"end":{"line":53,"column":82}},"24":{"start":{"line":56,"column":0},"end":{"line":59,"column":2}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":23,"column":9},"end":{"line":23,"column":31}},"loc":{"start":{"line":23,"column":37},"end":{"line":23,"column":95}},"line":23},"1":{"name":"parse","decl":{"start":{"line":25,"column":9},"end":{"line":25,"column":14}},"loc":{"start":{"line":25,"column":24},"end":{"line":37,"column":1}},"line":25},"2":{"name":"dump","decl":{"start":{"line":39,"column":15},"end":{"line":39,"column":19}},"loc":{"start":{"line":39,"column":29},"end":{"line":54,"column":1}},"line":39}},"branchMap":{"0":{"loc":{"start":{"line":23,"column":46},"end":{"line":23,"column":92}},"type":"cond-expr","locations":[{"start":{"line":23,"column":70},"end":{"line":23,"column":73}},{"start":{"line":23,"column":76},"end":{"line":23,"column":92}}],"line":23},"1":{"loc":{"start":{"line":23,"column":46},"end":{"line":23,"column":67}},"type":"binary-expr","locations":[{"start":{"line":23,"column":46},"end":{"line":23,"column":49}},{"start":{"line":23,"column":53},"end":{"line":23,"column":67}}],"line":23},"2":{"loc":{"start":{"line":28,"column":2},"end":{"line":30,"column":4}},"type":"if","locations":[{"start":{"line":28,"column":2},"end":{"line":30,"column":4}},{"start":{"line":28,"column":2},"end":{"line":30,"column":4}}],"line":28},"3":{"loc":{"start":{"line":43,"column":2},"end":{"line":43,"column":24}},"type":"if","locations":[{"start":{"line":43,"column":2},"end":{"line":43,"column":24}},{"start":{"line":43,"column":2},"end":{"line":43,"column":24}}],"line":43}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":3,"10":40,"11":40,"12":38,"13":1,"14":1,"15":1,"16":1,"17":1,"18":0,"19":1,"20":1,"21":1,"22":1,"23":1,"24":1},"f":{"0":3,"1":40,"2":1},"b":{"0":[1,2],"1":[3,3],"2":[38,1],"3":[0,1]},"inputSourceMap":{"version":3,"sources":["triggers.js"],"names":["parse","context","triggersFolder","path","join","filePath","constants","TRIGGERS_DIRECTORY","triggers","undefined","files","mappings","dump","assets","fs","ensureDirSync","triggerFile","log","info","writeFileSync","JSON","stringify"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;AAEA;;AACA;;;;;;AAEA,SAASA,KAAT,CAAeC,OAAf,EAAwB;AACtB,QAAMC,cAAc,GAAGC,eAAKC,IAAL,CAAUH,OAAO,CAACI,QAAlB,EAA4BC,iBAAUC,kBAAtC,CAAvB;;AAEA,MAAI,CAAC,4BAAgBL,cAAhB,CAAL,EAAsC,OAAO;AAAEM,IAAAA,QAAQ,EAAEC;AAAZ,GAAP;AAEtC,QAAMC,KAAK,GAAG,qBAASR,cAAT,EAAyB,CAAE,OAAF,CAAzB,CAAd;AAEA,QAAMM,QAAQ,GAAG,EAAE,GAAG,qBAASE,KAAK,CAAC,CAAD,CAAd,EAAmBT,OAAO,CAACU,QAA3B;AAAL,GAAjB;AAEA,SAAO;AAAEH,IAAAA;AAAF,GAAP;AACD;;AAED,eAAeI,IAAf,CAAoBX,OAApB,EAA6B;AAC3B,QAAM;AAAEO,IAAAA;AAAF,MAAeP,OAAO,CAACY,MAA7B;AAEA,MAAI,CAACL,QAAL,EAAe;;AAGf,QAAMN,cAAc,GAAGC,eAAKC,IAAL,CAAUH,OAAO,CAACI,QAAlB,EAA4BC,iBAAUC,kBAAtC,CAAvB;;AACAO,oBAAGC,aAAH,CAAiBb,cAAjB;;AACA,QAAMc,WAAW,GAAGb,eAAKC,IAAL,CAAUF,cAAV,EAA0B,eAA1B,CAApB;;AACAe,mBAAIC,IAAJ,CAAU,WAAUF,WAAY,EAAhC;;AACAF,oBAAGK,aAAH,CAAiBH,WAAjB,EAA8BI,IAAI,CAACC,SAAL,CAAeb,QAAf,EAAyB,IAAzB,EAA+B,CAA/B,CAA9B;AACD;;kBAEc;AACbR,EAAAA,KADa;AAEbY,EAAAA;AAFa,C","sourceRoot":"/home/circleci/repo/src/context/directory/handlers/","sourcesContent":["import fs from 'fs-extra';\nimport path from 'path';\nimport { constants } from '../../../tools';\n\nimport { getFiles, existsMustBeDir, loadJSON } from '../../../utils';\nimport log from '../../../logger';\n\nfunction parse(context) {\n  const triggersFolder = path.join(context.filePath, constants.TRIGGERS_DIRECTORY);\n\n  if (!existsMustBeDir(triggersFolder)) return { triggers: undefined }; // Skip\n\n  const files = getFiles(triggersFolder, [ '.json' ]);\n\n  const triggers = { ...loadJSON(files[0], context.mappings) };\n\n  return { triggers };\n}\n\nasync function dump(context) {\n  const { triggers } = context.assets;\n\n  if (!triggers) return;\n\n  // Create triggers folder\n  const triggersFolder = path.join(context.filePath, constants.TRIGGERS_DIRECTORY);\n  fs.ensureDirSync(triggersFolder);\n  const triggerFile = path.join(triggersFolder, 'triggers.json');\n  log.info(`Writing ${triggerFile}`);\n  fs.writeFileSync(triggerFile, JSON.stringify(triggers, null, 2));\n}\n\nexport default {\n  parse,\n  dump\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"3d84a67b11649c12ad859a7e3813f5743c15202f","contentHash":"7f2299272013ded26f689f91269252dc605294d3b7b1a1bb597343370564b520"},"/home/circleci/repo/src/index.js":{"path":"/home/circleci/repo/src/index.js","statementMap":{"0":{"start":{"line":4,"column":19},"end":{"line":4,"column":42}},"1":{"start":{"line":6,"column":12},"end":{"line":6,"column":29}},"2":{"start":{"line":8,"column":16},"end":{"line":8,"column":37}},"3":{"start":{"line":10,"column":17},"end":{"line":10,"column":50}},"4":{"start":{"line":12,"column":14},"end":{"line":12,"column":33}},"5":{"start":{"line":14,"column":15},"end":{"line":14,"column":46}},"6":{"start":{"line":16,"column":13},"end":{"line":16,"column":31}},"7":{"start":{"line":18,"column":14},"end":{"line":18,"column":44}},"8":{"start":{"line":20,"column":39},"end":{"line":20,"column":93}},"9":{"start":{"line":23,"column":14},"end":{"line":23,"column":45}},"10":{"start":{"line":24,"column":16},"end":{"line":24,"column":32}},"11":{"start":{"line":26,"column":2},"end":{"line":35,"column":3}},"12":{"start":{"line":27,"column":33},"end":{"line":27,"column":85}},"13":{"start":{"line":29,"column":4},"end":{"line":31,"column":5}},"14":{"start":{"line":30,"column":6},"end":{"line":30,"column":80}},"15":{"start":{"line":33,"column":4},"end":{"line":33,"column":48}},"16":{"start":{"line":34,"column":4},"end":{"line":34,"column":34}},"17":{"start":{"line":37,"column":2},"end":{"line":37,"column":57}},"18":{"start":{"line":39,"column":2},"end":{"line":39,"column":20}},"19":{"start":{"line":41,"column":2},"end":{"line":41,"column":60}},"20":{"start":{"line":44,"column":0},"end":{"line":78,"column":1}},"21":{"start":{"line":45,"column":17},"end":{"line":45,"column":39}},"22":{"start":{"line":47,"column":2},"end":{"line":47,"column":59}},"23":{"start":{"line":49,"column":2},"end":{"line":49,"column":59}},"24":{"start":{"line":51,"column":2},"end":{"line":55,"column":3}},"25":{"start":{"line":52,"column":4},"end":{"line":52,"column":56}},"26":{"start":{"line":53,"column":4},"end":{"line":53,"column":37}},"27":{"start":{"line":54,"column":4},"end":{"line":54,"column":36}},"28":{"start":{"line":57,"column":2},"end":{"line":77,"column":5}},"29":{"start":{"line":57,"column":25},"end":{"line":57,"column":40}},"30":{"start":{"line":58,"column":4},"end":{"line":62,"column":5}},"31":{"start":{"line":59,"column":6},"end":{"line":59,"column":134}},"32":{"start":{"line":61,"column":6},"end":{"line":61,"column":71}},"33":{"start":{"line":64,"column":16},"end":{"line":64,"column":49}},"34":{"start":{"line":66,"column":4},"end":{"line":66,"column":32}},"35":{"start":{"line":68,"column":4},"end":{"line":70,"column":5}},"36":{"start":{"line":69,"column":6},"end":{"line":69,"column":42}},"37":{"start":{"line":72,"column":4},"end":{"line":74,"column":5}},"38":{"start":{"line":73,"column":6},"end":{"line":73,"column":118}},"39":{"start":{"line":76,"column":4},"end":{"line":76,"column":20}},"40":{"start":{"line":80,"column":0},"end":{"line":86,"column":2}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":20,"column":9},"end":{"line":20,"column":31}},"loc":{"start":{"line":20,"column":37},"end":{"line":20,"column":95}},"line":20},"1":{"name":"run","decl":{"start":{"line":22,"column":15},"end":{"line":22,"column":18}},"loc":{"start":{"line":22,"column":27},"end":{"line":42,"column":1}},"line":22},"2":{"name":"(anonymous_2)","decl":{"start":{"line":57,"column":19},"end":{"line":57,"column":20}},"loc":{"start":{"line":57,"column":25},"end":{"line":57,"column":40}},"line":57},"3":{"name":"(anonymous_3)","decl":{"start":{"line":57,"column":48},"end":{"line":57,"column":49}},"loc":{"start":{"line":57,"column":57},"end":{"line":77,"column":3}},"line":57}},"branchMap":{"0":{"loc":{"start":{"line":20,"column":46},"end":{"line":20,"column":92}},"type":"cond-expr","locations":[{"start":{"line":20,"column":70},"end":{"line":20,"column":73}},{"start":{"line":20,"column":76},"end":{"line":20,"column":92}}],"line":20},"1":{"loc":{"start":{"line":20,"column":46},"end":{"line":20,"column":67}},"type":"binary-expr","locations":[{"start":{"line":20,"column":46},"end":{"line":20,"column":49}},{"start":{"line":20,"column":53},"end":{"line":20,"column":67}}],"line":20},"2":{"loc":{"start":{"line":26,"column":2},"end":{"line":35,"column":3}},"type":"if","locations":[{"start":{"line":26,"column":2},"end":{"line":35,"column":3}},{"start":{"line":26,"column":2},"end":{"line":35,"column":3}}],"line":26},"3":{"loc":{"start":{"line":29,"column":4},"end":{"line":31,"column":5}},"type":"if","locations":[{"start":{"line":29,"column":4},"end":{"line":31,"column":5}},{"start":{"line":29,"column":4},"end":{"line":31,"column":5}}],"line":29},"4":{"loc":{"start":{"line":44,"column":0},"end":{"line":78,"column":1}},"type":"if","locations":[{"start":{"line":44,"column":0},"end":{"line":78,"column":1}},{"start":{"line":44,"column":0},"end":{"line":78,"column":1}}],"line":44},"5":{"loc":{"start":{"line":51,"column":2},"end":{"line":55,"column":3}},"type":"if","locations":[{"start":{"line":51,"column":2},"end":{"line":55,"column":3}},{"start":{"line":51,"column":2},"end":{"line":55,"column":3}}],"line":51},"6":{"loc":{"start":{"line":58,"column":4},"end":{"line":62,"column":5}},"type":"if","locations":[{"start":{"line":58,"column":4},"end":{"line":62,"column":5}},{"start":{"line":58,"column":4},"end":{"line":62,"column":5}}],"line":58},"7":{"loc":{"start":{"line":58,"column":8},"end":{"line":58,"column":33}},"type":"binary-expr","locations":[{"start":{"line":58,"column":8},"end":{"line":58,"column":18}},{"start":{"line":58,"column":22},"end":{"line":58,"column":33}}],"line":58},"8":{"loc":{"start":{"line":64,"column":16},"end":{"line":64,"column":49}},"type":"binary-expr","locations":[{"start":{"line":64,"column":16},"end":{"line":64,"column":29}},{"start":{"line":64,"column":33},"end":{"line":64,"column":49}}],"line":64},"9":{"loc":{"start":{"line":68,"column":4},"end":{"line":70,"column":5}},"type":"if","locations":[{"start":{"line":68,"column":4},"end":{"line":70,"column":5}},{"start":{"line":68,"column":4},"end":{"line":70,"column":5}}],"line":68},"10":{"loc":{"start":{"line":72,"column":4},"end":{"line":74,"column":5}},"type":"if","locations":[{"start":{"line":72,"column":4},"end":{"line":74,"column":5}},{"start":{"line":72,"column":4},"end":{"line":74,"column":5}}],"line":72},"11":{"loc":{"start":{"line":72,"column":8},"end":{"line":72,"column":75}},"type":"binary-expr","locations":[{"start":{"line":72,"column":8},"end":{"line":72,"column":31}},{"start":{"line":72,"column":35},"end":{"line":72,"column":75}}],"line":72}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":3,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":1,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":1},"f":{"0":3,"1":0,"2":0,"3":0},"b":{"0":[3,0],"1":[3,3],"2":[0,0],"3":[0,0],"4":[0,1],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0]},"inputSourceMap":{"version":3,"sources":["index.js"],"names":["run","params","cmd","commands","_","proxy","proxy_url","MAJOR_NODEJS_VERSION","parseInt","process","version","slice","split","Error","env","GLOBAL_AGENT_HTTP_PROXY","log","debug","require","main","module","transports","console","level","AUTH0_DEBUG","AUTH0_LOG","then","exit","catch","error","type","stage","msg","message","toString","stack","includes","info","exports","deploy","import","dump","export","tools"],"mappings":"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","sourceRoot":"/home/circleci/repo/src/","sourcesContent":["#!/usr/bin/env node\nimport { bootstrap } from 'global-agent';\n\nimport { getParams } from './args';\nimport commands from './commands';\nimport log from './logger';\nimport tools from './tools';\n\nasync function run(params) {\n  // Run command\n  const cmd = commands[params._[0]];\n  const proxy = params.proxy_url;\n\n  if (proxy) {\n    const MAJOR_NODEJS_VERSION = parseInt(process.version.slice(1).split('.')[0], 10);\n\n    if (MAJOR_NODEJS_VERSION < 10) {\n      // `global-agent` works with Node.js v10 and above.\n      throw new Error('The --proxy_url option is only supported on Node >= 10');\n    }\n\n    process.env.GLOBAL_AGENT_HTTP_PROXY = proxy;\n    bootstrap();\n  }\n\n  log.debug(`Start command ${params._[0]}`);\n  await cmd(params);\n  log.debug(`Finished command ${params._[0]}`);\n}\n\n// Only run if from command line\nif (require.main === module) {\n  // Load cli params\n  const params = getParams();\n\n  log.debug('Starting Auth0 Deploy CLI Tool');\n\n  // Set log level\n  log.transports.console.level = params.level;\n  if (params.debug) {\n    log.transports.console.level = 'debug';\n    // Set for tools\n    process.env.AUTH0_DEBUG = 'true';\n    process.env.AUTH0_LOG = 'debug';\n  }\n\n  run(params)\n    .then(() => process.exit(0))\n    .catch((error) => {\n      if (error.type || error.stage) {\n        log.error(`Problem running command ${params._[0]} during stage ${error.stage} when processing type ${error.type}`);\n      } else {\n        log.error(`Problem running command ${params._[0]}`);\n      }\n\n      const msg = error.message || error.toString();\n      log.error(msg);\n\n      if (process.env.AUTH0_DEBUG === 'true') {\n        log.debug(error.stack);\n      }\n\n      if (typeof msg === 'string' && msg.includes('Payload validation error')) {\n        log.info('Please see https://github.com/auth0/auth0-deploy-cli#troubleshooting for common issues');\n      }\n      process.exit(1);\n    });\n}\n\n// Export commands to be used programmatically\nmodule.exports = {\n  deploy: commands.import,\n  dump: commands.export,\n  import: commands.import,\n  export: commands.export,\n  tools: tools\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"e8077e19194700ee36313313ba9c215c80563663","contentHash":"e0f93245fb58f96ba72b5f2673b504ea28c7016310049cc072a79e209255623b"},"/home/circleci/repo/src/args.js":{"path":"/home/circleci/repo/src/args.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":30}},"2":{"start":{"line":8,"column":13},"end":{"line":8,"column":29}},"3":{"start":{"line":10,"column":14},"end":{"line":10,"column":44}},"4":{"start":{"line":12,"column":39},"end":{"line":12,"column":93}},"5":{"start":{"line":15,"column":15},"end":{"line":78,"column":896}},"6":{"start":{"line":80,"column":2},"end":{"line":80,"column":19}},"7":{"start":{"line":83,"column":0},"end":{"line":85,"column":2}},"8":{"start":{"line":86,"column":0},"end":{"line":86,"column":30}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":12,"column":9},"end":{"line":12,"column":31}},"loc":{"start":{"line":12,"column":37},"end":{"line":12,"column":95}},"line":12},"1":{"name":"getParams","decl":{"start":{"line":14,"column":9},"end":{"line":14,"column":18}},"loc":{"start":{"line":14,"column":21},"end":{"line":81,"column":1}},"line":14}},"branchMap":{"0":{"loc":{"start":{"line":12,"column":46},"end":{"line":12,"column":92}},"type":"cond-expr","locations":[{"start":{"line":12,"column":70},"end":{"line":12,"column":73}},{"start":{"line":12,"column":76},"end":{"line":12,"column":92}}],"line":12},"1":{"loc":{"start":{"line":12,"column":46},"end":{"line":12,"column":67}},"type":"binary-expr","locations":[{"start":{"line":12,"column":46},"end":{"line":12,"column":49}},{"start":{"line":12,"column":53},"end":{"line":12,"column":67}}],"line":12}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":0,"6":0,"7":1,"8":1},"f":{"0":1,"1":0},"b":{"0":[0,1],"1":[1,1]},"inputSourceMap":{"version":3,"sources":["args.js"],"names":["getParams","args","yargs","demandCommand","usage","option","alias","describe","type","default","command","input_file","demandOption","config_file","env","boolean","secret","output_folder","format","choices","export_ids","example","epilogue","wrap","argv"],"mappings":"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","sourceRoot":"/home/circleci/repo/src/","sourcesContent":["import yargs from 'yargs';\n\nfunction getParams() {\n  const args = yargs\n    .demandCommand(1, 'A command is required')\n    .usage('Auth0 Deploy CLI')\n    .option('debug', {\n      alias: 'd',\n      describe: 'Dump extra debug information.',\n      type: 'boolean',\n      default: false\n    })\n    .option('proxy_url', {\n      alias: 'p',\n      describe: 'A url for proxying requests, only set this if you are behind a proxy.',\n      type: 'string'\n    })\n    .command([ 'import', 'deploy' ], 'Deploy Configuration', {\n      input_file: {\n        alias: 'i',\n        describe: 'The updates to deploy. Either a JSON file, or directory that contains the correct file layout. See README and online for more info.',\n        type: 'string',\n        demandOption: true\n      },\n      config_file: {\n        alias: 'c',\n        describe: 'The JSON configuration file.',\n        type: 'string'\n      },\n      env: {\n        alias: 'e',\n        describe: 'Override the mappings in config with process.env environment variables.',\n        type: 'string',\n        boolean: true,\n        default: true\n      },\n      secret: {\n        alias: 'x',\n        describe: 'The client secret, this allows you to encrypt the secret in your build configuration instead of storing it in a config file',\n        type: 'string'\n      }\n    })\n    .command([ 'export', 'dump' ], 'Export Auth0 Tenant Configuration', {\n      output_folder: {\n        alias: 'o',\n        describe: 'The output directory.',\n        type: 'string',\n        demandOption: true\n      },\n      format: {\n        alias: 'f',\n        describe: 'The output format.',\n        type: 'string',\n        choices: [ 'yaml', 'directory' ],\n        demandOption: true\n      },\n      config_file: {\n        alias: 'c',\n        describe: 'The JSON configuration file.',\n        type: 'string'\n      },\n      secret: {\n        alias: 'x',\n        describe: 'The client secret, this allows you to encrypt the secret in your build configuration instead of storing it in a config file',\n        type: 'string'\n      },\n      export_ids: {\n        alias: 'e',\n        describe: 'Export identifier field for each object type.',\n        type: 'boolean',\n        default: false\n      }\n    })\n    .example('$0 export -c config.json -f yaml -o path/to/export', 'Dump Auth0 config to folder in YAML format')\n    .example('$0 export -c config.json -f directory -o path/to/export', 'Dump Auth0 config to folder in directory format')\n    .example('$0 import -c config.json -i tenant.yaml', 'Deploy Auth0 via YAML')\n    .example('$0 import -c config.json -i path/to/files', 'Deploy Auth0 via Path')\n    .example('$0 dump -c config.json -f yaml -o path/to/export', 'Dump Auth0 config to folder in YAML format')\n    .example('$0 dump -c config.json -f directory -o path/to/export', 'Dump Auth0 config to folder in directory format')\n    .example('$0 deploy -c config.json -i tenant.yaml', 'Deploy Auth0 via YAML')\n    .example('$0 deploy -c config.json -i path/to/files', 'Deploy Auth0 via Path')\n    .epilogue('See README (https://github.com/auth0/auth0-deploy-cli) for more in-depth information on configuration and setup.')\n    .wrap(null);\n  return args.argv;\n}\n\nexport default {\n  getParams\n};\n\nexport {\n  getParams\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"9ed9b8d540406be4693dc28499a1ac1f18d60e94","contentHash":"74d05b4ac57ed0d707c53bdf36235272f3df8889a9c9e229bdd56a3a726919f6"},"/home/circleci/repo/src/commands/index.js":{"path":"/home/circleci/repo/src/commands/index.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":14},"end":{"line":7,"column":33}},"2":{"start":{"line":9,"column":15},"end":{"line":9,"column":46}},"3":{"start":{"line":11,"column":14},"end":{"line":11,"column":33}},"4":{"start":{"line":13,"column":15},"end":{"line":13,"column":46}},"5":{"start":{"line":15,"column":39},"end":{"line":15,"column":93}},"6":{"start":{"line":17,"column":0},"end":{"line":22,"column":2}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":15,"column":9},"end":{"line":15,"column":31}},"loc":{"start":{"line":15,"column":37},"end":{"line":15,"column":95}},"line":15}},"branchMap":{"0":{"loc":{"start":{"line":15,"column":46},"end":{"line":15,"column":92}},"type":"cond-expr","locations":[{"start":{"line":15,"column":70},"end":{"line":15,"column":73}},{"start":{"line":15,"column":76},"end":{"line":15,"column":92}}],"line":15},"1":{"loc":{"start":{"line":15,"column":46},"end":{"line":15,"column":67}},"type":"binary-expr","locations":[{"start":{"line":15,"column":46},"end":{"line":15,"column":49}},{"start":{"line":15,"column":53},"end":{"line":15,"column":67}}],"line":15}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":2,"6":1},"f":{"0":2},"b":{"0":[2,0],"1":[2,2]},"inputSourceMap":{"version":3,"sources":["index.js"],"names":["import","importCMD","export","exportCMD","deploy","dump"],"mappings":";;;;;;AAAA;;;;AACA;;;;;;kBAEe;AACbA,EAAAA,MAAM,EAAEC,gBADK;AAEbC,EAAAA,MAAM,EAAEC,gBAFK;AAGbC,EAAAA,MAAM,EAAEH,gBAHK;AAIbI,EAAAA,IAAI,EAAEF;AAJO,C","sourceRoot":"/home/circleci/repo/src/commands/","sourcesContent":["import importCMD from './import';\nimport exportCMD from './export';\n\nexport default {\n  import: importCMD,\n  export: exportCMD,\n  deploy: importCMD,\n  dump: exportCMD\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"86ccc4b02a07e22bbe6a824d78fd384cc1a524f7","contentHash":"0c2b94003fb645c4befc082c067e3ec66ef8b489eaa80b5e0b751ac918c5e79d"},"/home/circleci/repo/src/commands/import.js":{"path":"/home/circleci/repo/src/commands/import.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":25}},"2":{"start":{"line":8,"column":13},"end":{"line":8,"column":29}},"3":{"start":{"line":10,"column":14},"end":{"line":10,"column":44}},"4":{"start":{"line":12,"column":21},"end":{"line":12,"column":48}},"5":{"start":{"line":14,"column":22},"end":{"line":14,"column":60}},"6":{"start":{"line":16,"column":13},"end":{"line":16,"column":32}},"7":{"start":{"line":18,"column":14},"end":{"line":18,"column":34}},"8":{"start":{"line":20,"column":15},"end":{"line":20,"column":46}},"9":{"start":{"line":22,"column":15},"end":{"line":22,"column":36}},"10":{"start":{"line":24,"column":16},"end":{"line":24,"column":48}},"11":{"start":{"line":26,"column":39},"end":{"line":26,"column":93}},"12":{"start":{"line":36,"column":6},"end":{"line":36,"column":12}},"13":{"start":{"line":38,"column":2},"end":{"line":38,"column":38}},"14":{"start":{"line":40,"column":2},"end":{"line":42,"column":3}},"15":{"start":{"line":41,"column":4},"end":{"line":41,"column":37}},"16":{"start":{"line":44,"column":20},"end":{"line":50,"column":3}},"17":{"start":{"line":52,"column":2},"end":{"line":54,"column":3}},"18":{"start":{"line":53,"column":4},"end":{"line":53,"column":43}},"19":{"start":{"line":56,"column":2},"end":{"line":60,"column":3}},"20":{"start":{"line":57,"column":21},"end":{"line":57,"column":80}},"21":{"start":{"line":59,"column":4},"end":{"line":59,"column":96}},"22":{"start":{"line":62,"column":2},"end":{"line":62,"column":39}},"23":{"start":{"line":64,"column":18},"end":{"line":64,"column":69}},"24":{"start":{"line":65,"column":2},"end":{"line":65,"column":23}},"25":{"start":{"line":66,"column":17},"end":{"line":66,"column":47}},"26":{"start":{"line":67,"column":2},"end":{"line":67,"column":54}},"27":{"start":{"line":67,"column":28},"end":{"line":67,"column":52}},"28":{"start":{"line":68,"column":2},"end":{"line":68,"column":71}},"29":{"start":{"line":70,"column":2},"end":{"line":70,"column":45}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":26,"column":9},"end":{"line":26,"column":31}},"loc":{"start":{"line":26,"column":37},"end":{"line":26,"column":95}},"line":26},"1":{"name":"deploy","decl":{"start":{"line":28,"column":15},"end":{"line":28,"column":21}},"loc":{"start":{"line":28,"column":30},"end":{"line":71,"column":1}},"line":28},"2":{"name":"(anonymous_2)","decl":{"start":{"line":67,"column":21},"end":{"line":67,"column":22}},"loc":{"start":{"line":67,"column":28},"end":{"line":67,"column":52}},"line":67}},"branchMap":{"0":{"loc":{"start":{"line":26,"column":46},"end":{"line":26,"column":92}},"type":"cond-expr","locations":[{"start":{"line":26,"column":70},"end":{"line":26,"column":73}},{"start":{"line":26,"column":76},"end":{"line":26,"column":92}}],"line":26},"1":{"loc":{"start":{"line":26,"column":46},"end":{"line":26,"column":67}},"type":"binary-expr","locations":[{"start":{"line":26,"column":46},"end":{"line":26,"column":49}},{"start":{"line":26,"column":53},"end":{"line":26,"column":67}}],"line":26},"2":{"loc":{"start":{"line":40,"column":2},"end":{"line":42,"column":3}},"type":"if","locations":[{"start":{"line":40,"column":2},"end":{"line":42,"column":3}},{"start":{"line":40,"column":2},"end":{"line":42,"column":3}}],"line":40},"3":{"loc":{"start":{"line":49,"column":8},"end":{"line":49,"column":23}},"type":"binary-expr","locations":[{"start":{"line":49,"column":8},"end":{"line":49,"column":17}},{"start":{"line":49,"column":21},"end":{"line":49,"column":23}}],"line":49},"4":{"loc":{"start":{"line":52,"column":2},"end":{"line":54,"column":3}},"type":"if","locations":[{"start":{"line":52,"column":2},"end":{"line":54,"column":3}},{"start":{"line":52,"column":2},"end":{"line":54,"column":3}}],"line":52},"5":{"loc":{"start":{"line":56,"column":2},"end":{"line":60,"column":3}},"type":"if","locations":[{"start":{"line":56,"column":2},"end":{"line":60,"column":3}},{"start":{"line":56,"column":2},"end":{"line":60,"column":3}}],"line":56},"6":{"loc":{"start":{"line":57,"column":21},"end":{"line":57,"column":80}},"type":"binary-expr","locations":[{"start":{"line":57,"column":21},"end":{"line":57,"column":74}},{"start":{"line":57,"column":78},"end":{"line":57,"column":80}}],"line":57}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":4,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0},"f":{"0":4,"1":0,"2":0},"b":{"0":[2,2],"1":[4,4],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0]},"inputSourceMap":{"version":3,"sources":["import.js"],"names":["deploy","params","input_file","inputFile","base_path","basePath","config_file","configFile","config","configObj","env","secret","nconf","use","file","overrides","AUTH0_INPUT_FILE","AUTH0_BASE_PATH","AUTH0_CONFIG_FILE","AUTH0_KEYWORD_REPLACE_MAPPINGS","AUTH0_CLIENT_SECRET","mappings","get","set","Object","assign","process","context","load","setProvider","key","assets","mgmtClient","log","info"],"mappings":";;;;;kBAM8BA,M;;AAN9B;;;;AACA;;;;AACA;;AACA;;;;AACA;;;;;;AAEe,eAAeA,MAAf,CAAsBC,MAAtB,EAA8B;AAC3C,QAAM;AACJC,IAAAA,UAAU,EAAEC,SADR;AAEJC,IAAAA,SAAS,EAAEC,QAFP;AAGJC,IAAAA,WAAW,EAAEC,UAHT;AAIJC,IAAAA,MAAM,EAAEC,SAJJ;AAKJC,IAAAA,GALI;AAMJC,IAAAA;AANI,MAOFV,MAPJ;;AASAW,kBAAMF,GAAN,GAAYG,GAAZ,CAAgB,QAAhB;;AAEA,MAAIN,UAAJ,EAAgB;AACdK,oBAAME,IAAN,CAAWP,UAAX;AACD;;AAED,QAAMQ,SAAS,GAAG;AAChBC,IAAAA,gBAAgB,EAAEb,SADF;AAEhBc,IAAAA,eAAe,EAAEZ,QAFD;AAGhBa,IAAAA,iBAAiB,EAAEX,UAHH;AAIhBY,IAAAA,8BAA8B,EAAE,EAJhB;AAKhB,QAAGV,SAAS,IAAI,EAAhB;AALgB,GAAlB;;AAUA,MAAIE,MAAJ,EAAY;AACVI,IAAAA,SAAS,CAACK,mBAAV,GAAgCT,MAAhC;AACD;;AAED,MAAID,GAAJ,EAAS;AACP,UAAMW,QAAQ,GAAGT,gBAAMU,GAAN,CAAU,gCAAV,KAA+C,EAAhE;;AACAV,oBAAMW,GAAN,CAAU,gCAAV,EAA4CC,MAAM,CAACC,MAAP,CAAcJ,QAAd,EAAwBK,OAAO,CAAChB,GAAhC,CAA5C;AACD;;AAEDE,kBAAMG,SAAN,CAAgBA,SAAhB;;AAGA,QAAMY,OAAO,GAAG,MAAM,uBAAaf,gBAAMU,GAAN,EAAb,CAAtB;AACA,QAAMK,OAAO,CAACC,IAAR,EAAN;AAEA,QAAMpB,MAAM,GAAG,8BAAf;AACAA,EAAAA,MAAM,CAACqB,WAAP,CAAoBC,GAAD,IAASlB,gBAAMU,GAAN,CAAUQ,GAAV,CAA5B;AAEA,QAAM,mBAAYH,OAAO,CAACI,MAApB,EAA4BJ,OAAO,CAACK,UAApC,EAAgDxB,MAAhD,CAAN;;AAEAyB,mBAAIC,IAAJ,CAAS,mBAAT;AACD","sourceRoot":"/home/circleci/repo/src/commands/","sourcesContent":["import nconf from 'nconf';\nimport configFactory from '../configFactory';\nimport { deploy as toolsDeploy } from '../tools';\nimport log from '../logger';\nimport setupContext from '../context';\n\nexport default async function deploy(params) {\n  const {\n    input_file: inputFile,\n    base_path: basePath,\n    config_file: configFile,\n    config: configObj,\n    env,\n    secret\n  } = params;\n\n  nconf.env().use('memory');\n\n  if (configFile) {\n    nconf.file(configFile);\n  }\n\n  const overrides = {\n    AUTH0_INPUT_FILE: inputFile,\n    AUTH0_BASE_PATH: basePath,\n    AUTH0_CONFIG_FILE: configFile,\n    AUTH0_KEYWORD_REPLACE_MAPPINGS: {},\n    ...configObj || {}\n  };\n\n  // Prepare configuration by initializing nconf, then passing that as the provider to the config object\n  // Allow passed in secret to override the configured one\n  if (secret) {\n    overrides.AUTH0_CLIENT_SECRET = secret;\n  }\n\n  if (env) {\n    const mappings = nconf.get('AUTH0_KEYWORD_REPLACE_MAPPINGS') || {};\n    nconf.set('AUTH0_KEYWORD_REPLACE_MAPPINGS', Object.assign(mappings, process.env));\n  }\n\n  nconf.overrides(overrides);\n\n  // Setup context and load\n  const context = await setupContext(nconf.get());\n  await context.load();\n\n  const config = configFactory();\n  config.setProvider((key) => nconf.get(key));\n\n  await toolsDeploy(context.assets, context.mgmtClient, config);\n\n  log.info('Import Successful');\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"fbd6ea00c31393fdeed8b9c783e5966ef6a8f094","contentHash":"71a4cdea74084105a6f17d50501256bb6d8758b0e834a27dd3b281e6b6756220"},"/home/circleci/repo/src/configFactory.js":{"path":"/home/circleci/repo/src/configFactory.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":28,"column":2}},"1":{"start":{"line":4,"column":19},"end":{"line":4,"column":21}},"2":{"start":{"line":5,"column":24},"end":{"line":5,"column":28}},"3":{"start":{"line":7,"column":17},"end":{"line":17,"column":3}},"4":{"start":{"line":8,"column":4},"end":{"line":10,"column":5}},"5":{"start":{"line":9,"column":6},"end":{"line":9,"column":27}},"6":{"start":{"line":12,"column":4},"end":{"line":14,"column":5}},"7":{"start":{"line":13,"column":6},"end":{"line":13,"column":67}},"8":{"start":{"line":16,"column":4},"end":{"line":16,"column":32}},"9":{"start":{"line":19,"column":2},"end":{"line":21,"column":4}},"10":{"start":{"line":20,"column":4},"end":{"line":20,"column":39}},"11":{"start":{"line":23,"column":2},"end":{"line":25,"column":4}},"12":{"start":{"line":24,"column":4},"end":{"line":24,"column":26}},"13":{"start":{"line":27,"column":2},"end":{"line":27,"column":16}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":3,"column":17},"end":{"line":3,"column":18}},"loc":{"start":{"line":3,"column":29},"end":{"line":28,"column":1}},"line":3},"1":{"name":"getConfig","decl":{"start":{"line":7,"column":26},"end":{"line":7,"column":35}},"loc":{"start":{"line":7,"column":41},"end":{"line":17,"column":3}},"line":7},"2":{"name":"setProvider","decl":{"start":{"line":19,"column":32},"end":{"line":19,"column":43}},"loc":{"start":{"line":19,"column":62},"end":{"line":21,"column":3}},"line":19},"3":{"name":"setValue","decl":{"start":{"line":23,"column":29},"end":{"line":23,"column":37}},"loc":{"start":{"line":23,"column":50},"end":{"line":25,"column":3}},"line":23}},"branchMap":{"0":{"loc":{"start":{"line":8,"column":4},"end":{"line":10,"column":5}},"type":"if","locations":[{"start":{"line":8,"column":4},"end":{"line":10,"column":5}},{"start":{"line":8,"column":4},"end":{"line":10,"column":5}}],"line":8},"1":{"loc":{"start":{"line":8,"column":8},"end":{"line":8,"column":33}},"type":"binary-expr","locations":[{"start":{"line":8,"column":8},"end":{"line":8,"column":16}},{"start":{"line":8,"column":20},"end":{"line":8,"column":33}}],"line":8},"2":{"loc":{"start":{"line":12,"column":4},"end":{"line":14,"column":5}},"type":"if","locations":[{"start":{"line":12,"column":4},"end":{"line":14,"column":5}},{"start":{"line":12,"column":4},"end":{"line":14,"column":5}}],"line":12}},"s":{"0":1,"1":1,"2":1,"3":1,"4":0,"5":0,"6":0,"7":0,"8":0,"9":1,"10":0,"11":1,"12":0,"13":1},"f":{"0":1,"1":0,"2":0,"3":0},"b":{"0":[0,0],"1":[0,0],"2":[0,0]},"inputSourceMap":{"version":3,"sources":["configFactory.js"],"names":["module","exports","settings","currentProvider","config","getConfig","key","Error","setProvider","providerFunction","setValue","value"],"mappings":";;AAAAA,MAAM,CAACC,OAAP,GAAiB,YAAW;AAC1B,QAAMC,QAAQ,GAAG,EAAjB;AACA,MAAIC,eAAe,GAAG,IAAtB;;AAEA,QAAMC,MAAM,GAAG,SAASC,SAAT,CAAmBC,GAAnB,EAAwB;AACrC,QAAIJ,QAAQ,IAAIA,QAAQ,CAACI,GAAD,CAAxB,EAA+B;AAC7B,aAAOJ,QAAQ,CAACI,GAAD,CAAf;AACD;;AAED,QAAI,CAACH,eAAL,EAAsB;AACpB,YAAM,IAAII,KAAJ,CAAU,2CAAV,CAAN;AACD;;AAED,WAAOJ,eAAe,CAACG,GAAD,CAAtB;AACD,GAVD;;AAYAF,EAAAA,MAAM,CAACI,WAAP,GAAqB,SAASA,WAAT,CAAqBC,gBAArB,EAAuC;AAC1DN,IAAAA,eAAe,GAAGM,gBAAlB;AACD,GAFD;;AAIAL,EAAAA,MAAM,CAACM,QAAP,GAAkB,SAASA,QAAT,CAAkBJ,GAAlB,EAAuBK,KAAvB,EAA8B;AAC9CT,IAAAA,QAAQ,CAACI,GAAD,CAAR,GAAgBK,KAAhB;AACD,GAFD;;AAIA,SAAOP,MAAP;AACD,CAzBD","sourceRoot":"/home/circleci/repo/src/","sourcesContent":["module.exports = function() {\n  const settings = { };\n  let currentProvider = null;\n\n  const config = function getConfig(key) {\n    if (settings && settings[key]) {\n      return settings[key];\n    }\n\n    if (!currentProvider) {\n      throw new Error('A configuration provider has not been set');\n    }\n\n    return currentProvider(key);\n  };\n\n  config.setProvider = function setProvider(providerFunction) {\n    currentProvider = providerFunction;\n  };\n\n  config.setValue = function setValue(key, value) {\n    settings[key] = value;\n  };\n\n  return config;\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"3b906837a71a81b6638693bbedcb54f35c829f92","contentHash":"4d9177ae0c7dfbc8534dc50a1c66a55704b2d149ebca5f5cfacc279c45748bd3"},"/home/circleci/repo/src/commands/export.js":{"path":"/home/circleci/repo/src/commands/export.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":25}},"2":{"start":{"line":8,"column":12},"end":{"line":8,"column":27}},"3":{"start":{"line":10,"column":13},"end":{"line":10,"column":42}},"4":{"start":{"line":12,"column":13},"end":{"line":12,"column":29}},"5":{"start":{"line":14,"column":14},"end":{"line":14,"column":44}},"6":{"start":{"line":16,"column":14},"end":{"line":16,"column":31}},"7":{"start":{"line":18,"column":15},"end":{"line":18,"column":46}},"8":{"start":{"line":20,"column":14},"end":{"line":20,"column":34}},"9":{"start":{"line":22,"column":15},"end":{"line":22,"column":46}},"10":{"start":{"line":24,"column":13},"end":{"line":24,"column":32}},"11":{"start":{"line":26,"column":15},"end":{"line":26,"column":36}},"12":{"start":{"line":28,"column":16},"end":{"line":28,"column":48}},"13":{"start":{"line":30,"column":39},"end":{"line":30,"column":93}},"14":{"start":{"line":40,"column":6},"end":{"line":40,"column":12}},"15":{"start":{"line":42,"column":2},"end":{"line":42,"column":38}},"16":{"start":{"line":44,"column":2},"end":{"line":46,"column":3}},"17":{"start":{"line":45,"column":4},"end":{"line":45,"column":37}},"18":{"start":{"line":48,"column":20},"end":{"line":53,"column":3}},"19":{"start":{"line":55,"column":2},"end":{"line":57,"column":3}},"20":{"start":{"line":56,"column":4},"end":{"line":56,"column":43}},"21":{"start":{"line":59,"column":2},"end":{"line":61,"column":3}},"22":{"start":{"line":60,"column":4},"end":{"line":60,"column":51}},"23":{"start":{"line":63,"column":2},"end":{"line":67,"column":3}},"24":{"start":{"line":64,"column":4},"end":{"line":64,"column":54}},"25":{"start":{"line":66,"column":4},"end":{"line":66,"column":40}},"26":{"start":{"line":69,"column":2},"end":{"line":71,"column":3}},"27":{"start":{"line":70,"column":4},"end":{"line":70,"column":82}},"28":{"start":{"line":73,"column":2},"end":{"line":73,"column":39}},"29":{"start":{"line":75,"column":18},"end":{"line":75,"column":69}},"30":{"start":{"line":76,"column":2},"end":{"line":76,"column":23}},"31":{"start":{"line":78,"column":2},"end":{"line":78,"column":45}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":30,"column":9},"end":{"line":30,"column":31}},"loc":{"start":{"line":30,"column":37},"end":{"line":30,"column":95}},"line":30},"1":{"name":"deploy","decl":{"start":{"line":32,"column":15},"end":{"line":32,"column":21}},"loc":{"start":{"line":32,"column":30},"end":{"line":79,"column":1}},"line":32}},"branchMap":{"0":{"loc":{"start":{"line":30,"column":46},"end":{"line":30,"column":92}},"type":"cond-expr","locations":[{"start":{"line":30,"column":70},"end":{"line":30,"column":73}},{"start":{"line":30,"column":76},"end":{"line":30,"column":92}}],"line":30},"1":{"loc":{"start":{"line":30,"column":46},"end":{"line":30,"column":67}},"type":"binary-expr","locations":[{"start":{"line":30,"column":46},"end":{"line":30,"column":49}},{"start":{"line":30,"column":53},"end":{"line":30,"column":67}}],"line":30},"2":{"loc":{"start":{"line":44,"column":2},"end":{"line":46,"column":3}},"type":"if","locations":[{"start":{"line":44,"column":2},"end":{"line":46,"column":3}},{"start":{"line":44,"column":2},"end":{"line":46,"column":3}}],"line":44},"3":{"loc":{"start":{"line":52,"column":8},"end":{"line":52,"column":23}},"type":"binary-expr","locations":[{"start":{"line":52,"column":8},"end":{"line":52,"column":17}},{"start":{"line":52,"column":21},"end":{"line":52,"column":23}}],"line":52},"4":{"loc":{"start":{"line":55,"column":2},"end":{"line":57,"column":3}},"type":"if","locations":[{"start":{"line":55,"column":2},"end":{"line":57,"column":3}},{"start":{"line":55,"column":2},"end":{"line":57,"column":3}}],"line":55},"5":{"loc":{"start":{"line":59,"column":2},"end":{"line":61,"column":3}},"type":"if","locations":[{"start":{"line":59,"column":2},"end":{"line":61,"column":3}},{"start":{"line":59,"column":2},"end":{"line":61,"column":3}}],"line":59},"6":{"loc":{"start":{"line":63,"column":2},"end":{"line":67,"column":3}},"type":"if","locations":[{"start":{"line":63,"column":2},"end":{"line":67,"column":3}},{"start":{"line":63,"column":2},"end":{"line":67,"column":3}}],"line":63},"7":{"loc":{"start":{"line":69,"column":2},"end":{"line":71,"column":3}},"type":"if","locations":[{"start":{"line":69,"column":2},"end":{"line":71,"column":3}},{"start":{"line":69,"column":2},"end":{"line":71,"column":3}}],"line":69}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":5,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0},"f":{"0":5,"1":0},"b":{"0":[2,3],"1":[5,5],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0]},"inputSourceMap":{"version":3,"sources":["export.js"],"names":["deploy","params","output_folder","outputFolder","base_path","basePath","config_file","configFile","config","configObj","export_ids","exportIds","secret","nconf","env","use","file","overrides","AUTH0_INPUT_FILE","AUTH0_BASE_PATH","AUTH0_CONFIG_FILE","AUTH0_CLIENT_SECRET","AUTH0_EXPORT_IDENTIFIERS","log","info","mkdirp","sync","format","path","join","context","get","dump"],"mappings":";;;;;kBAQ8BA,M;;AAR9B;;;;AACA;;;;AACA;;;;AAEA;;;;AACA;;AACA;;;;;;AAEe,eAAeA,MAAf,CAAsBC,MAAtB,EAA8B;AAC3C,QAAM;AACJC,IAAAA,aAAa,EAAEC,YADX;AAEJC,IAAAA,SAAS,EAAEC,QAFP;AAGJC,IAAAA,WAAW,EAAEC,UAHT;AAIJC,IAAAA,MAAM,EAAEC,SAJJ;AAKJC,IAAAA,UAAU,EAAEC,SALR;AAMJC,IAAAA;AANI,MAOFX,MAPJ;;AASAY,kBAAMC,GAAN,GAAYC,GAAZ,CAAgB,QAAhB;;AAEA,MAAIR,UAAJ,EAAgB;AACdM,oBAAMG,IAAN,CAAWT,UAAX;AACD;;AAED,QAAMU,SAAS,GAAG;AAChBC,IAAAA,gBAAgB,EAAEf,YADF;AAEhBgB,IAAAA,eAAe,EAAEd,QAFD;AAGhBe,IAAAA,iBAAiB,EAAEb,UAHH;AAIhB,QAAGE,SAAS,IAAI,EAAhB;AAJgB,GAAlB;;AASA,MAAIG,MAAJ,EAAY;AACVK,IAAAA,SAAS,CAACI,mBAAV,GAAgCT,MAAhC;AACD;;AAGD,MAAID,SAAJ,EAAe;AACbM,IAAAA,SAAS,CAACK,wBAAV,GAAqCX,SAArC;AACD;;AAGD,MAAI,CAAC,wBAAYR,YAAZ,CAAL,EAAgC;AAC9BoB,qBAAIC,IAAJ,CAAU,YAAWrB,YAAa,EAAlC;;AACAsB,qBAAOC,IAAP,CAAYvB,YAAZ;AACD;;AAED,MAAIF,MAAM,CAAC0B,MAAP,KAAkB,MAAtB,EAA8B;AAC5BV,IAAAA,SAAS,CAACC,gBAAV,GAA6BU,eAAKC,IAAL,CAAU1B,YAAV,EAAwB,aAAxB,CAA7B;AACD;;AAEDU,kBAAMI,SAAN,CAAgBA,SAAhB;;AAGA,QAAMa,OAAO,GAAG,MAAM,uBAAajB,gBAAMkB,GAAN,EAAb,CAAtB;AACA,QAAMD,OAAO,CAACE,IAAR,EAAN;;AACAT,mBAAIC,IAAJ,CAAS,mBAAT;AACD","sourceRoot":"/home/circleci/repo/src/commands/","sourcesContent":["import path from 'path';\nimport nconf from 'nconf';\nimport mkdirp from 'mkdirp';\n\nimport log from '../logger';\nimport { isDirectory } from '../utils';\nimport setupContext from '../context';\n\nexport default async function deploy(params) {\n  const {\n    output_folder: outputFolder,\n    base_path: basePath,\n    config_file: configFile,\n    config: configObj,\n    export_ids: exportIds,\n    secret\n  } = params;\n\n  nconf.env().use('memory');\n\n  if (configFile) {\n    nconf.file(configFile);\n  }\n\n  const overrides = {\n    AUTH0_INPUT_FILE: outputFolder,\n    AUTH0_BASE_PATH: basePath,\n    AUTH0_CONFIG_FILE: configFile,\n    ...configObj || {}\n  };\n\n  // Prepare configuration by initializing nconf, then passing that as the provider to the config object\n  // Allow passed in secret to override the configured one\n  if (secret) {\n    overrides.AUTH0_CLIENT_SECRET = secret;\n  }\n\n  // Allow passed in export_ids to override the configured one\n  if (exportIds) {\n    overrides.AUTH0_EXPORT_IDENTIFIERS = exportIds;\n  }\n\n  // Check output folder\n  if (!isDirectory(outputFolder)) {\n    log.info(`Creating ${outputFolder}`);\n    mkdirp.sync(outputFolder);\n  }\n\n  if (params.format === 'yaml') {\n    overrides.AUTH0_INPUT_FILE = path.join(outputFolder, 'tenant.yaml');\n  }\n\n  nconf.overrides(overrides);\n\n  // Setup context and load\n  const context = await setupContext(nconf.get());\n  await context.dump();\n  log.info('Export Successful');\n}\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"edb172e3f8289ccbf9e56b540946e5654ad7ba43","contentHash":"de206d951766e79ce6ee7397d62e1bbe2c2ea1b6a7fcd8bb96607e7e84876cb3"}}