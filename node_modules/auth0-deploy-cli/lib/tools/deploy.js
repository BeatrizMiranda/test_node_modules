"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = deploy;

var _auth = require("./auth0");

var _auth2 = _interopRequireDefault(_auth);

var _logger = require("./logger");

var _logger2 = _interopRequireDefault(_logger);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

async function deploy(assets, client, config) {
  _logger2.default.transports.console.level = process.env.AUTH0_DEBUG === 'true' ? 'debug' : 'info';

  _logger2.default.info('Getting access token for ' + config('AUTH0_CLIENT_ID') + '/' + config('AUTH0_DOMAIN'));

  const auth0 = new _auth2.default(client, assets, config);
  await auth0.validate();
  await auth0.processChanges();
  return auth0.handlers.reduce((accum, h) => {
    accum[h.type] = {
      deleted: h.deleted,
      created: h.created,
      updated: h.updated
    };
    return accum;
  }, {});
}