"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _fsExtra = require("fs-extra");

var _fsExtra2 = _interopRequireDefault(_fsExtra);

var _path = require("path");

var _path2 = _interopRequireDefault(_path);

var _logger = require("../../../logger");

var _logger2 = _interopRequireDefault(_logger);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

async function parse(context) {
  const emailTemplates = context.assets.emailTemplates || [];
  return {
    emailTemplates: [...emailTemplates.map(et => ({ ...et,
      body: context.loadFile(et.body)
    }))]
  };
}

async function dump(context) {
  let emailTemplates = [...(context.assets.emailTemplates || [])];

  if (emailTemplates.length > 0) {
    const templatesFolder = _path2.default.join(context.basePath, 'emailTemplates');

    _fsExtra2.default.ensureDirSync(templatesFolder);

    emailTemplates = emailTemplates.map(template => {
      const templateFile = _path2.default.join(templatesFolder, `${template.template}.html`);

      _logger2.default.info(`Writing ${templateFile}`);

      _fsExtra2.default.writeFileSync(templateFile, template.body);

      return { ...template,
        body: `./emailTemplates/${template.template}.html`
      };
    });
  }

  return {
    emailTemplates
  };
}

exports.default = {
  parse,
  dump
};