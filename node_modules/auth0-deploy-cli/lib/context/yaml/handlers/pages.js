"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _path = require("path");

var _path2 = _interopRequireDefault(_path);

var _fsExtra = require("fs-extra");

var _fsExtra2 = _interopRequireDefault(_fsExtra);

var _logger = require("../../../logger");

var _logger2 = _interopRequireDefault(_logger);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

async function parse(context) {
  if (!context.assets.pages) return {};
  return {
    pages: [...context.assets.pages.map(page => ({ ...page,
      html: page.html ? context.loadFile(page.html) : ''
    }))]
  };
}

async function dump(context) {
  let pages = [...(context.assets.pages || [])];

  if (pages.length > 0) {
    const pagesFolder = _path2.default.join(context.basePath, 'pages');

    _fsExtra2.default.ensureDirSync(pagesFolder);

    pages = pages.map(page => {
      if (page.name === 'error_page' && page.html === undefined) {
        return page;
      }

      const htmlFile = _path2.default.join(pagesFolder, `${page.name}.html`);

      _logger2.default.info(`Writing ${htmlFile}`);

      _fsExtra2.default.writeFileSync(htmlFile, page.html);

      return { ...page,
        html: `./pages/${page.name}.html`
      };
    });
  }

  return {
    pages
  };
}

exports.default = {
  parse,
  dump
};