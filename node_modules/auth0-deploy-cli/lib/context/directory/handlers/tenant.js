"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _path = require("path");

var _path2 = _interopRequireDefault(_path);

var _utils = require("../../../utils");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function parse(context) {
  const baseFolder = _path2.default.join(context.filePath);

  if (!(0, _utils.existsMustBeDir)(baseFolder)) return {};

  const tenantFile = _path2.default.join(baseFolder, 'tenant.json');

  if ((0, _utils.isFile)(tenantFile)) {
    const {
      session_lifetime,
      idle_session_lifetime,
      ...tenant
    } = (0, _utils.loadJSON)(tenantFile, context.mappings);
    (0, _utils.clearTenantFlags)(tenant);
    return {
      tenant: Object.assign(tenant, session_lifetime && (0, _utils.hoursAsInteger)('session_lifetime', session_lifetime), idle_session_lifetime && (0, _utils.hoursAsInteger)('idle_session_lifetime', idle_session_lifetime))
    };
  }

  return {};
}

async function dump(context) {
  const {
    tenant
  } = context.assets;
  if (!tenant) return;
  (0, _utils.clearTenantFlags)(tenant);

  const tenantFile = _path2.default.join(context.filePath, 'tenant.json');

  (0, _utils.dumpJSON)(tenantFile, tenant);
}

exports.default = {
  parse,
  dump
};