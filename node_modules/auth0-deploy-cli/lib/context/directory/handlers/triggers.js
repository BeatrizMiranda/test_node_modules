"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _fsExtra = require("fs-extra");

var _fsExtra2 = _interopRequireDefault(_fsExtra);

var _path = require("path");

var _path2 = _interopRequireDefault(_path);

var _tools = require("../../../tools");

var _utils = require("../../../utils");

var _logger = require("../../../logger");

var _logger2 = _interopRequireDefault(_logger);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function parse(context) {
  const triggersFolder = _path2.default.join(context.filePath, _tools.constants.TRIGGERS_DIRECTORY);

  if (!(0, _utils.existsMustBeDir)(triggersFolder)) return {
    triggers: undefined
  };
  const files = (0, _utils.getFiles)(triggersFolder, ['.json']);
  const triggers = { ...(0, _utils.loadJSON)(files[0], context.mappings)
  };
  return {
    triggers
  };
}

async function dump(context) {
  const {
    triggers
  } = context.assets;
  if (!triggers) return;

  const triggersFolder = _path2.default.join(context.filePath, _tools.constants.TRIGGERS_DIRECTORY);

  _fsExtra2.default.ensureDirSync(triggersFolder);

  const triggerFile = _path2.default.join(triggersFolder, 'triggers.json');

  _logger2.default.info(`Writing ${triggerFile}`);

  _fsExtra2.default.writeFileSync(triggerFile, JSON.stringify(triggers, null, 2));
}

exports.default = {
  parse,
  dump
};