"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _fsExtra = require("fs-extra");

var _fsExtra2 = _interopRequireDefault(_fsExtra);

var _path = require("path");

var _path2 = _interopRequireDefault(_path);

var _tools = require("../../../tools");

var _utils = require("../../../utils");

var _defaults = require("../../defaults");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function parse(context) {
  const emailsFolder = _path2.default.join(context.filePath, _tools.constants.EMAIL_TEMPLATES_DIRECTORY);

  if (!(0, _utils.existsMustBeDir)(emailsFolder)) return {};

  const providerFile = _path2.default.join(emailsFolder, 'provider.json');

  if ((0, _utils.isFile)(providerFile)) {
    return {
      emailProvider: (0, _utils.loadJSON)(providerFile, context.mappings)
    };
  }

  return {};
}

async function dump(context) {
  let {
    emailProvider
  } = context.assets;
  if (!emailProvider) return;
  const excludedDefaults = context.assets.exclude.defaults || [];

  if (!excludedDefaults.includes('emailProvider')) {
    emailProvider = (0, _defaults.emailProviderDefaults)(emailProvider);
  }

  const emailsFolder = _path2.default.join(context.filePath, _tools.constants.EMAIL_TEMPLATES_DIRECTORY);

  _fsExtra2.default.ensureDirSync(emailsFolder);

  const emailProviderFile = _path2.default.join(emailsFolder, 'provider.json');

  (0, _utils.dumpJSON)(emailProviderFile, emailProvider);
}

exports.default = {
  parse,
  dump
};